{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js!D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\MeterReading\\DownloadPlan.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\MeterReading\\DownloadPlan.vue","mtime":1705912800041},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\babel.config.js","mtime":1705912799600},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCB7IE5hdkJhciwgTGlzdCwgUHVsbFJlZnJlc2gsIE5vdGlmeSwgVG9hc3QgfSBmcm9tICdmYXdrZXMtbW9iaWxlLWxpYic7CmltcG9ydCB7IGdldFJlYWRpbmdCb29rLCBkb3dubG9hZFBsYW4gfSBmcm9tICcuL2FwaSc7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBbTmF2QmFyLm5hbWVdOiBOYXZCYXIsCiAgICBbTGlzdC5uYW1lXTogTGlzdCwKICAgIFtQdWxsUmVmcmVzaC5uYW1lXTogUHVsbFJlZnJlc2gsCiAgICBbTm90aWZ5Lm5hbWVdOiBOb3RpZnksCiAgICBbVG9hc3QubmFtZV06IFRvYXN0CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcmVmcmVzaGluZzogZmFsc2UsCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICBpbkV4ZWN1dGlvblBhZ2U6IDEsCiAgICAgIHRvZG9QYWdlOiAxLAogICAgICBmaW5pc2hlZFBhZ2U6IDEsCiAgICAgIHBsYW5MaXN0OiBbXSwKICAgICAgbm90U3RhcnRMaXN0OiBbXSwKICAgICAgLy8n5pyq5oqE5pWw57uEJwogICAgICBub3RDb21taXRMaXN0OiBbXSAvLyfmnKrmj5DkuqTmlbDnu4QnCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgcGFnZVJlc2V0KCkgewogICAgICB0aGlzLmluRXhlY3V0aW9uUGFnZSA9IDE7CiAgICAgIHRoaXMudG9kb1BhZ2UgPSAxOwogICAgICB0aGlzLmZpbmlzaGVkUGFnZSA9IDE7CiAgICB9LAogICAgLy8g6aG16Z2i5Yqg6L29L+S4i+aLieWIt+aWsAogICAgb25SZWZyZXNoKCkgewogICAgICB0aGlzLnBhZ2VSZXNldCgpOwogICAgICB0aGlzLmZpcnN0UmVxdWVzdEZpbmlzaGVkID0gZmFsc2U7CiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMuZ2V0TGlzdCgpOwogICAgfSwKICAgIC8vIOWIl+ihqOWKoOi9veabtOWkmgogICAgb25Mb2FkKCkgewogICAgICB0aGlzLmdldExpc3QoKTsKICAgIH0sCiAgICBnZXRMaXN0KCkgewogICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgbGV0IHVpZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjc191c2VySWQnKTsKICAgICAgbGV0IHBhcmFtcyA9IHt9OwogICAgICBwYXJhbXMuY2hhcmdlUGVyc29uID0gdWlkOwogICAgICBnZXRSZWFkaW5nQm9vayhwYXJhbXMpLnRoZW4ocmVzID0+IHsKICAgICAgICBpZiAocmVzLmRhdGEpIHsKICAgICAgICAgIHRoaXMucGxhbkxpc3QgPSByZXMuZGF0YTsKICAgICAgICB9CiAgICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMucmVmcmVzaGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuZmlyc3RSZXF1ZXN0RmluaXNoZWQgPSB0cnVlOwogICAgICB9KTsKICAgIH0sCiAgICBkb3dubG9hZChib29rQ29kZSkgewogICAgICBsZXQgcGxhbnMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbXlEb3dubG9hZFBsYW4nKTsKICAgICAgbGV0IG5zTGlzdCA9IHBsYW5zID8gSlNPTi5wYXJzZShwbGFucykgOiBbXTsKICAgICAgdGhpcy5ub3RTdGFydExpc3QgPSBuc0xpc3QuZmlsdGVyKGl0ZW0gPT4gewogICAgICAgIHJldHVybiBpdGVtLmJvb2tDb2RlID09IGJvb2tDb2RlOwogICAgICB9KTsKICAgICAgbGV0IHNhdmVkVGFza3MgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2F2ZWRUYXNrcycpOwogICAgICBsZXQgbmNMaXN0ID0gc2F2ZWRUYXNrcyA/IEpTT04ucGFyc2Uoc2F2ZWRUYXNrcykgOiBbXTsKICAgICAgdGhpcy5ub3RDb21taXRMaXN0ID0gbmNMaXN0LmZpbHRlcihpdGVtID0+IHsKICAgICAgICByZXR1cm4gaXRlbS5ib29rQ29kZSA9PSBib29rQ29kZTsKICAgICAgfSk7CiAgICAgIGlmICh0aGlzLm5vdENvbW1pdExpc3QubGVuZ3RoICE9PSAwIHx8IHRoaXMubm90U3RhcnRMaXN0Lmxlbmd0aCAhPT0gMCkgewogICAgICAgIE5vdGlmeSh7CiAgICAgICAgICB0eXBlOiAnd2FybmluZycsCiAgICAgICAgICBtZXNzYWdlOiAn5pys5pyI5bey5LiL6L295q2k6KGo5YaM6K6h5YiSJwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBUb2FzdC5sb2FkaW5nKHsKICAgICAgICBtZXNzYWdlOiAn5LiL6L295LitLi4uJywKICAgICAgICBmb3JiaWRDbGljazogdHJ1ZQogICAgICB9KTsKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICBib29rQ29kZQogICAgICB9OwogICAgICBkb3dubG9hZFBsYW4ocGFyYW1zKS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcy5kYXRhKSB7CiAgICAgICAgICBsZXQgZGF0YSA9IHJlcy5kYXRhOwogICAgICAgICAgbGV0IG9sZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdteURvd25sb2FkUGxhbicpOwogICAgICAgICAgbGV0IG9sZEFsbCA9IG9sZCA/IEpTT04ucGFyc2Uob2xkKSA6IFtdOwogICAgICAgICAgb2xkQWxsLnB1c2goLi4uZGF0YSk7CiAgICAgICAgICBsZXQgbmV3QWxsID0gSlNPTi5zdHJpbmdpZnkob2xkQWxsKTsKICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdteURvd25sb2FkUGxhbicpOwogICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ215RG93bmxvYWRQbGFuJywgbmV3QWxsKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgIE5vdGlmeSh7CiAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgICAgZHVyYXRpb246IDUwMCwKICAgICAgICAgICAgbWVzc2FnZTogJ+S4i+i9veaIkOWKnycKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBOb3RpZnkoewogICAgICAgICAgICB0eXBlOiAnZXJyb3InLAogICAgICAgICAgICBkdXJhdGlvbjogNTAwLAogICAgICAgICAgICBtZXNzYWdlOiByZXMubWVzc2FnZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgTm90aWZ5KHsKICAgICAgICAgIHR5cGU6ICdlcnJvcicsCiAgICAgICAgICBkdXJhdGlvbjogNTAwLAogICAgICAgICAgbWVzc2FnZTogJ+S4i+i9veWksei0pScKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5vblJlZnJlc2goKTsKICB9Cn07"},{"version":3,"names":["NavBar","List","PullRefresh","Notify","Toast","getReadingBook","downloadPlan","components","name","data","refreshing","loading","inExecutionPage","todoPage","finishedPage","planList","notStartList","notCommitList","methods","pageReset","onRefresh","firstRequestFinished","getList","onLoad","uid","localStorage","getItem","params","chargePerson","then","res","finally","download","bookCode","plans","nsList","JSON","parse","filter","item","savedTasks","ncList","length","type","message","forbidClick","old","oldAll","push","newAll","stringify","removeItem","setItem","status","duration","catch","mounted"],"sources":["src/views/MeterReading/DownloadPlan.vue"],"sourcesContent":["<template>\r\n  <div id='DownloadPlan'>\r\n    <fm-pull-refresh id='DownloadPlan' v-model='refreshing' success-text='刷新成功' @refresh='onRefresh'>\r\n      <fm-nav-bar title='计划下载' left-arrow @click-left=\"$router.replace('/index')\">\r\n      </fm-nav-bar>\r\n      <div class='plan-container'>\r\n        <fm-list v-model='loading' @load='onLoad' :immediate-check='false'>\r\n          <div v-for='(item, index) in planList' :key='index' class='list-item'>\r\n            <img src='@/assets/svg/doc_books.svg'>\r\n            <span class='ptitle'>{{ item.bookName }}</span>\r\n            <span class='plink' @click='download(item.bookCode)'>下载表册</span>\r\n          </div>\r\n        </fm-list>\r\n        <template v-if='planList && planList.length == 0'>\r\n          <div class='no-data-img'>\r\n            <fm-image fit='cover' :src=\"require('@/assets/img/no-data-img.png')\" />\r\n          </div>\r\n          <div class='no-data-text'>\r\n            <div class='no-data-text-descripe'>暂无表册数据</div>\r\n          </div>\r\n        </template>\r\n      </div>\r\n    </fm-pull-refresh>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { NavBar, List, PullRefresh, Notify, Toast } from 'fawkes-mobile-lib'\r\nimport { getReadingBook, downloadPlan } from './api'\r\n\r\nexport default {\r\n  components: {\r\n    [NavBar.name]: NavBar,\r\n    [List.name]: List,\r\n    [PullRefresh.name]: PullRefresh,\r\n    [Notify.name]: Notify,\r\n    [Toast.name]: Toast\r\n  },\r\n  data() {\r\n    return {\r\n      refreshing: false,\r\n      loading: false,\r\n      inExecutionPage: 1,\r\n      todoPage: 1,\r\n      finishedPage: 1,\r\n      planList: [],\r\n      notStartList: [], //'未抄数组'\r\n      notCommitList: [] //'未提交数组'\r\n    }\r\n  },\r\n  methods: {\r\n    pageReset() {\r\n      this.inExecutionPage = 1\r\n      this.todoPage = 1\r\n      this.finishedPage = 1\r\n    },\r\n    // 页面加载/下拉刷新\r\n    onRefresh() {\r\n      this.pageReset()\r\n      this.firstRequestFinished = false\r\n      this.loading = true\r\n      this.getList()\r\n    },\r\n    // 列表加载更多\r\n    onLoad() {\r\n      this.getList()\r\n    },\r\n    getList() {\r\n      this.loading = false\r\n      let uid = localStorage.getItem('cs_userId')\r\n      let params = {}\r\n      params.chargePerson = uid\r\n      getReadingBook(params)\r\n        .then((res) => {\r\n          if (res.data) {\r\n            this.planList = res.data\r\n          }\r\n        })\r\n        .finally(() => {\r\n          this.loading = false\r\n          this.refreshing = false\r\n          this.firstRequestFinished = true\r\n        })\r\n    },\r\n    download(bookCode) {\r\n      let plans = localStorage.getItem('myDownloadPlan')\r\n      let nsList = plans ? JSON.parse(plans) : []\r\n      this.notStartList = nsList.filter((item) => {\r\n        return item.bookCode == bookCode\r\n      })\r\n      let savedTasks = localStorage.getItem('savedTasks')\r\n      let ncList = savedTasks ? JSON.parse(savedTasks) : []\r\n      this.notCommitList = ncList.filter((item) => {\r\n        return item.bookCode == bookCode\r\n      })\r\n      if (this.notCommitList.length !== 0 || this.notStartList.length !== 0) {\r\n        Notify({ type: 'warning', message: '本月已下载此表册计划' })\r\n        return\r\n      }\r\n      Toast.loading({\r\n        message: '下载中...',\r\n        forbidClick: true\r\n      })\r\n      let params = { bookCode }\r\n      downloadPlan(params)\r\n        .then((res) => {\r\n          if (res.data) {\r\n            let data = res.data\r\n            let old = localStorage.getItem('myDownloadPlan')\r\n            let oldAll = old ? JSON.parse(old) : []\r\n            oldAll.push(...data)\r\n            let newAll = JSON.stringify(oldAll)\r\n            localStorage.removeItem('myDownloadPlan')\r\n            localStorage.setItem('myDownloadPlan', newAll)\r\n          }\r\n          if (res.status) {\r\n            Notify({ type: 'success', duration: 500, message: '下载成功' })\r\n          } else {\r\n            Notify({ type: 'error', duration: 500, message: res.message })\r\n          }\r\n        })\r\n        .catch(() => {\r\n          Notify({ type: 'error', duration: 500, message: '下载失败' })\r\n        })\r\n    }\r\n  },\r\n  mounted() {\r\n    this.onRefresh()\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang='less' scoped>\r\n#DownloadPlan {\r\n  height: 100%;\r\n  overflow: auto;\r\n  background-color: #ecf4ff !important;\r\n\r\n  /deep/ .fm-nav-bar__content {\r\n    background-color: #0676fd !important;\r\n    height: 1.8rem;\r\n  }\r\n\r\n  /deep/ .fm-nav-bar__title {\r\n    color: #ffffff !important;\r\n  }\r\n\r\n  /deep/ .fm-nav-bar .fm-icon {\r\n    color: #ffffff !important;\r\n  }\r\n\r\n  /deep/ .fm-pull-refresh {\r\n    overflow: visible;\r\n  }\r\n\r\n  /* 暂无数据begin */\r\n\r\n  .no-data-img {\r\n    margin: 200px 95px 0 95px;\r\n  }\r\n\r\n  .no-data-text {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n\r\n  .no-data-text-descripe {\r\n    font-size: 32px;\r\n    font-weight: 400;\r\n    color: #999999;\r\n  }\r\n\r\n  .list-item {\r\n    width: 100%;\r\n    height: 80px;\r\n    // padding: 0 10px;\r\n    line-height: 80px;\r\n    border-bottom: 1px solid #fff;\r\n    background-color: #ecf4ff;\r\n    font-size: 24px;\r\n    font-weight: 500;\r\n    display: flex;\r\n    justify-content: space-between;\r\n\r\n    .ptitle {\r\n      width: 80%;\r\n      padding-left: 8px;\r\n      white-space: nowrap;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      text-align: left;\r\n    }\r\n\r\n    .plink {\r\n      width: 20%;\r\n      padding-right: 8px;\r\n      text-align: right;\r\n      color: #0676fd;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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"}]}