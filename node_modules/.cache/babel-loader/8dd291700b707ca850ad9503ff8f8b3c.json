{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\TerminatedTask.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\TerminatedTask.vue","mtime":1705912915819},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\babel.config.js","mtime":1705912799600},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCBJbnNwZWN0aW9uU3VibWl0Q2FyZCBmcm9tICcuL0luc3BlY3Rpb25TdWJtaXRDYXJkLnZ1ZSc7CmltcG9ydCB7IHBhdHJvbCwgcGF0cm9sRWRpdCwgdXBsb2FkVHJhY2tMaXN0IH0gZnJvbSAnLi4vYXBpJzsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIEluc3BlY3Rpb25TdWJtaXRDYXJkCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcmVhc29uOiAnJywKICAgICAgc2hvdzogZmFsc2UsCiAgICAgIFBhdHJvbERhdGE6IG51bGwsCiAgICAgIHBhdHJvbFBvaW50UmVzdWx0TGlzdDogW10KICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRQYXRyb2woKTsKICAgIHRoaXMucmVxdWVzdFNpbmdsZUxvY2F0aW9uKCk7CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy5zdG9wUmVxdWVzdExvY2F0aW9ucygpOwogIH0sCiAgbWV0aG9kczogewogICAgLy/ojrflj5bnlKjmiLflt6Hmo4DngrkKICAgIGFzeW5jIGdldFBhdHJvbCgpIHsKICAgICAgbGV0IHsKICAgICAgICB0YXNrSWQKICAgICAgfSA9IHRoaXMuJHJvdXRlLnF1ZXJ5OwogICAgICBjb25zdCB7CiAgICAgICAgZGF0YSwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBwYXRyb2xQb2ludFJlc3VsdExpc3QKICAgICAgICB9CiAgICAgIH0gPSBhd2FpdCBwYXRyb2wodGFza0lkKTsKICAgICAgdGhpcy5QYXRyb2xEYXRhID0gZGF0YTsKICAgICAgdGhpcy5wYXRyb2xQb2ludFJlc3VsdExpc3QgPSBwYXRyb2xQb2ludFJlc3VsdExpc3Q7CiAgICB9LAogICAgLy/lvIDlp4vlt6Hmo4AKICAgIHJlcXVlc3RTaW5nbGVMb2NhdGlvbigpIHsKICAgICAgaWYgKHR5cGVvZiB5dWFuY2h1ICE9ICd1bmRlZmluZWQnKSB7CiAgICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAucmVxdWVzdFNpbmdsZUxvY2F0aW9uKFsnMSddLCByZXMgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgbGF0aXR1ZGUsCiAgICAgICAgICAgIGxvbmdpdHVkZQogICAgICAgICAgfSA9IHJlczsKICAgICAgICAgIGxldCBwYXRoID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLiRzdG9yZS5zdGF0ZS5wdW1wLnB1bXBQYXRoKSk7CiAgICAgICAgICBwYXRoLnB1c2goewogICAgICAgICAgICBsYXQ6IGxhdGl0dWRlLAogICAgICAgICAgICBsb246IGxvbmdpdHVkZQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFB1bXBQYXRoJywgcGF0aCk7CiAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLiRzdG9yZS5zdGF0ZS5wdW1wLnB1bXBQYXRoKTsKICAgICAgICB9LCBlcnIgPT4gewogICAgICAgICAgY29uc29sZS5sb2coJ2Vycj0nLCBlcnIpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLy/nu5PmnZ/lt6Hmo4AKICAgIHN0b3BSZXF1ZXN0TG9jYXRpb25zKCkgewogICAgICBpZiAodHlwZW9mIHl1YW5jaHUgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICB5dWFuY2h1LmxvY2F0aW9uQU1hcC5zdG9wUmVxdWVzdExvY2F0aW9ucygpOwogICAgICB9CiAgICB9LAogICAgLy/ngrnlh7vmj5DkuqTmjInpkq4KICAgIHN1Ym1pdCgpIHsKICAgICAgaWYgKHRoaXMucmVhc29uID09PSAnJykgewogICAgICAgIHRoaXMuJHRvYXN0KCfor7floavlhpnnu4jmraLljp/lm6AnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5pc1Vuc3VibWl0dGVkKCk7CiAgICAgIHRoaXMuUGF0cm9sRGF0YSA9IHsKICAgICAgICAuLi50aGlzLlBhdHJvbERhdGEsCiAgICAgICAgaWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZCwKICAgICAgICBwYXRyb2xFbmRUaW1lOiB0aGlzLiRkYXlqcygpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcycpLAogICAgICAgIHN1Ym1pdFRpbWU6IHRoaXMuJGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJyksCiAgICAgICAgcGF0cm9sU3RhdHVzOiA0LAogICAgICAgIGVuZFJlYXNvbjogdGhpcy5yZWFzb24sCiAgICAgICAgcGF0cm9sUG9pbnRSZXN1bHRMaXN0OiB0aGlzLnBhdHJvbFBvaW50UmVzdWx0TGlzdAogICAgICB9OwogICAgICB0aGlzLnNob3cgPSB0cnVlOwogICAgfSwKICAgIC8v5qOA5p+l5piv5ZCm5pyJ5pyq5o+Q5Lqk6aG5LOW5tuaPkOS6pAogICAgYXN5bmMgaXNVbnN1Ym1pdHRlZCgpIHsKICAgICAgdmFyIF90aGlzJHBhdHJvbFBvaW50UmVzdTsKICAgICAgbGV0IHN0b3JhZ2VJdGVtRGF0YUxpc3QgPSBKU09OLnBhcnNlKHRoaXMuJHN0b3JhZ2UuZ2V0KCdwdW1wLXN0b3JhZ2VJdGVtRGF0YUxpc3QnKSk7CiAgICAgIChfdGhpcyRwYXRyb2xQb2ludFJlc3UgPSB0aGlzLnBhdHJvbFBvaW50UmVzdWx0TGlzdCkgPT09IG51bGwgfHwgX3RoaXMkcGF0cm9sUG9pbnRSZXN1ID09PSB2b2lkIDAgfHwgX3RoaXMkcGF0cm9sUG9pbnRSZXN1LmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7CiAgICAgICAgc3RvcmFnZUl0ZW1EYXRhTGlzdCA9PT0gbnVsbCB8fCBzdG9yYWdlSXRlbURhdGFMaXN0ID09PSB2b2lkIDAgfHwgc3RvcmFnZUl0ZW1EYXRhTGlzdC5mb3JFYWNoKChkYXRhLCBpKSA9PiB7CiAgICAgICAgICBpdGVtLmlkID09PSBkYXRhLmlkID8gdGhpcy5wYXRyb2xQb2ludFJlc3VsdExpc3RbaW5kZXhdID0gc3RvcmFnZUl0ZW1EYXRhTGlzdFtpXSA6IG51bGw7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLiRzdG9yYWdlLnJlbW92ZSgncHVtcC1zdG9yYWdlSXRlbURhdGFMaXN0Jyk7CiAgICAgIGF3YWl0IHVwbG9hZFRyYWNrTGlzdCh0aGlzLiRzdG9yZS5zdGF0ZS5wdW1wLnB1bXBQYXRoKTsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRQdW1wUGF0aCcsIFtdKTsKICAgIH0sCiAgICAvL+aPkOS6pOe7iOatouS7u+WKoQogICAgYXN5bmMgb25Db25maXJtKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHBhdHJvbEVkaXQodGhpcy5QYXRyb2xEYXRhKTsKICAgICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZSgnL3B1bXAvaW5zcGVjdGlvbk1hbmFnZScpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgfQogICAgfSwKICAgIC8v6L+U5Zue5YiX6KGo6aG1CiAgICBnb1RvKCkgewogICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZSh7CiAgICAgICAgcGF0aDogJy9wdW1wL2luc3BlY3Rpb24nLAogICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICB0YXNrSWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZCwKICAgICAgICAgIGZpcnN0Q29uZmlnOiBmYWxzZQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"names":["InspectionSubmitCard","patrol","patrolEdit","uploadTrackList","components","data","reason","show","PatrolData","patrolPointResultList","created","getPatrol","requestSingleLocation","beforeDestroy","stopRequestLocations","methods","taskId","$route","query","yuanchu","locationAMap","res","latitude","longitude","path","JSON","parse","stringify","$store","state","pump","pumpPath","push","lat","lon","commit","console","log","err","submit","$toast","isUnsubmitted","id","patrolEndTime","$dayjs","format","submitTime","patrolStatus","endReason","_this$patrolPointResu","storageItemDataList","$storage","get","forEach","item","index","i","remove","onConfirm","$router","replace","error","goTo","firstConfig"],"sources":["src/views/PumpStationInspection/components/TerminatedTask.vue"],"sourcesContent":["<template>\r\n  <div class=\"terminated-task\">\r\n    <fm-nav-bar title=\"任务终止\" left-arrow @click-left=\"goTo()\" />\r\n    <div class=\"terminated-task-content\">\r\n      <div class=\"terminated-task-remark\">任务终止需要填写终止原因</div>\r\n\r\n      <fm-field\r\n        class=\"field\"\r\n        v-model=\"reason\"\r\n        label=\"终止原因\"\r\n        autosize\r\n        maxlength=\"500\"\r\n        show-word-limit\r\n        type=\"textarea\"\r\n        placeholder=\"请填写终止原因\"\r\n      />\r\n\r\n      <fm-button type=\"primary\" class=\"terminated-task-submit\" @click=\"submit()\">提交</fm-button>\r\n      <fm-dialog\r\n        :visible.sync=\"show\"\r\n        title=\"巡检任务提交\"\r\n        @confirm=\"onConfirm\"\r\n        show-cancel-button\r\n        width=\"331\"\r\n      >\r\n        <inspection-submit-card :PatrolData=\"PatrolData\" :reason=\"reason\" />\r\n      </fm-dialog>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport InspectionSubmitCard from './InspectionSubmitCard.vue'\r\nimport { patrol, patrolEdit ,uploadTrackList } from '../api'\r\nexport default {\r\n  components: { InspectionSubmitCard },\r\n  data() {\r\n    return {\r\n      reason: '',\r\n      show: false,\r\n      PatrolData: null,\r\n      patrolPointResultList: [],\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getPatrol()\r\n    this.requestSingleLocation()\r\n  },\r\n  beforeDestroy() {\r\n    this.stopRequestLocations()\r\n  },\r\n\r\n  methods: {\r\n    //获取用户巡检点\r\n    async getPatrol() {\r\n      let { taskId } = this.$route.query\r\n      const {\r\n        data,\r\n        data: { patrolPointResultList },\r\n      } = await patrol(taskId)\r\n      this.PatrolData = data\r\n      this.patrolPointResultList = patrolPointResultList\r\n    },\r\n\r\n    //开始巡检\r\n    requestSingleLocation() {\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.requestSingleLocation(\r\n          ['1'],\r\n          (res) => {\r\n            let { latitude, longitude } = res\r\n            let path = JSON.parse(JSON.stringify(this.$store.state.pump.pumpPath))\r\n            path.push({\r\n              lat: latitude,\r\n              lon: longitude,\r\n            })\r\n            this.$store.commit('setPumpPath', path)\r\n\r\n            console.log(this.$store.state.pump.pumpPath)\r\n          },\r\n          (err) => {\r\n            console.log('err=', err)\r\n          }\r\n        )\r\n      }\r\n    },\r\n\r\n    //结束巡检\r\n    stopRequestLocations() {\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.stopRequestLocations()\r\n      }\r\n    },\r\n\r\n    //点击提交按钮\r\n    submit() {\r\n      if (this.reason === '') {\r\n        this.$toast('请填写终止原因')\r\n        return\r\n      }\r\n\r\n      this.isUnsubmitted()\r\n\r\n      this.PatrolData = {\r\n        ...this.PatrolData,\r\n        id: this.$route.query.taskId,\r\n        patrolEndTime: this.$dayjs().format('YYYY-MM-DD HH:mm:ss'),\r\n        submitTime: this.$dayjs().format('YYYY-MM-DD HH:mm:ss'),\r\n        patrolStatus: 4,\r\n        endReason: this.reason,\r\n        patrolPointResultList: this.patrolPointResultList,\r\n      }\r\n\r\n      this.show = true\r\n    },\r\n\r\n    //检查是否有未提交项,并提交\r\n    async isUnsubmitted() {\r\n      let storageItemDataList = JSON.parse(this.$storage.get('pump-storageItemDataList'))\r\n      this.patrolPointResultList?.forEach((item, index) => {\r\n        storageItemDataList?.forEach((data, i) => {\r\n          item.id === data.id ? (this.patrolPointResultList[index] = storageItemDataList[i]) : null\r\n        })\r\n      })\r\n\r\n      this.$storage.remove('pump-storageItemDataList')\r\n\r\n      await uploadTrackList(this.$store.state.pump.pumpPath)\r\n      this.$store.commit('setPumpPath', [])\r\n    },\r\n\r\n    //提交终止任务\r\n    async onConfirm() {\r\n      try {\r\n        const res = await patrolEdit(this.PatrolData)\r\n        this.$router.replace('/pump/inspectionManage')\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    },\r\n\r\n    //返回列表页\r\n    goTo() {\r\n      this.$router.replace({\r\n        path: '/pump/inspection',\r\n        query: {\r\n          taskId: this.$route.query.taskId,\r\n          firstConfig: false,\r\n        },\r\n      })\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.terminated-task {\r\n  height: 100%;\r\n  background: #f5f7f9;\r\n\r\n  .terminated-task-content {\r\n    padding: 0 30px;\r\n  }\r\n\r\n  .terminated-task-remark {\r\n    display: flex;\r\n    align-items: center;\r\n    height: 74px;\r\n    font-size: 28px;\r\n    color: #999;\r\n  }\r\n\r\n  .field {\r\n    height: auto !important;\r\n    min-height: 300px;\r\n    border-radius: 16px !important;\r\n  }\r\n\r\n  .terminated-task-submit {\r\n    width: 100%;\r\n    height: 88px;\r\n    border-radius: 44px;\r\n    margin-top: 60px;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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"}]}