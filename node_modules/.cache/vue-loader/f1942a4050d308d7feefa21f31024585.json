{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\App.vue?vue&type=style&index=0&id=7ba5bd90&lang=less&scoped=true","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\App.vue","mtime":1713146885260},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQojYXBwIHsNCiAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gY29uc3RhbnQoc2FmZS1hcmVhLWluc2V0LWJvdHRvbSkpOw0KICBoZWlnaHQ6IGNhbGMoMTAwdmggLSBlbnYoc2FmZS1hcmVhLWluc2V0LWJvdHRvbSkpOw0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICBvdmVyZmxvdzogaGlkZGVuOw0KICB3aWR0aDogMTAwJTsNCiAgLy9pb3PlupXpg6jpgILphY0NCg0KICBwYWRkaW5nLWJvdHRvbTogY29uc3RhbnQoc2FmZS1hcmVhLWluc2V0LWJvdHRvbSk7IC8v5YW85a65IElPUzwxMS4yDQoNCiAgcGFkZGluZy1ib3R0b206IGVudihzYWZlLWFyZWEtaW5zZXQtYm90dG9tKTsgLy/lhbzlrrkgSU9TPjExLjINCn0NCi9kZWVwLy5mbS1uYXYtYmFyIHsNCiAgcGFkZGluZy10b3A6IHZhcigtLWhlaWdodCk7DQp9DQovZGVlcC8uZm0tbGlzdF9fZmluaXNoZWQtdGV4dCB7DQogIHBhZGRpbmctYm90dG9tOiB2YXIoLS1oZWlnaHQpOw0KfQ0K"},{"version":3,"sources":["App.vue"],"names":[],"mappings":";AA8UA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<!--\r\n * @Author: xie_sm\r\n * @Date: 2022-02-28 16:07:02\r\n * @LastEditors: Please set LastEditors\r\n * @LastEditTime: 2022-06-16 15:40:47\r\n * @FilePath: \\mobile-template\\src\\App.vue\r\n * @Description:\r\n *\r\n-->\r\n<template>\r\n  <div id=\"app\" ref=\"app\">\r\n    <transition name=\"fade\">\r\n      <keep-alive>\r\n        <router-view v-if=\"$route.meta.keepAlive\" class=\"router\"></router-view>\r\n      </keep-alive>\r\n    </transition>\r\n    <transition name=\"fade\">\r\n      <router-view v-if=\"!$route.meta.keepAlive\" class=\"router\"></router-view>\r\n    </transition>\r\n  </div>\r\n</template>\r\n<script>\r\n/* eslint-disable no-undef */\r\n// 该组件需要和真机交互，会出现原生 API 未定义的情况，故全局应用屏蔽 no-undef 规则\r\nimport { loadLanguageAsync, getLangConfig } from '@/utils/locale' //引入获取系统语言的方法\r\nimport { Toast } from 'fawkes-mobile-lib'\r\nimport {\r\n  clickOther,\r\n  scroll,\r\n  getScrollTop,\r\n  getScrollHeight,\r\n  getWindowHeight,\r\n} from '@/utils/monitor'\r\nimport { LANG_FROM_KEY } from '@/common/constant'\r\nimport { SET_STATUS_BAR_HEIGHT } from '@/store/Mutation/mutationTypes'\r\nimport { mapGetters } from 'vuex'\r\nimport { GET_ENUM } from '@/store/Action/actionTypes'\r\n\r\nexport default {\r\n  components: {\r\n    [Toast.name]: Toast,\r\n  },\r\n  data() {\r\n    return {\r\n      statusBarHeight: null,\r\n      needUpdate: true,\r\n      toast1: null,\r\n      toast2: null,\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters(['isLogin']),\r\n  },\r\n  watch: {\r\n    $route(to) {\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu?.statusBar?.getStatusBarHeight((res) => {\r\n          this.$store.commit(SET_STATUS_BAR_HEIGHT, res)\r\n          if (to.path == '/index') {\r\n            yuanchu.statusBar.styleLightContent()\r\n          } else {\r\n            yuanchu.statusBar.styleDefault()\r\n            this.$refs.app.style.setProperty('--height', res + 'px')\r\n          }\r\n        })\r\n      }\r\n    },\r\n  },\r\n  async created() {\r\n    this.onLoad()\r\n    // 字典查询\r\n    await this.$store.dispatch(GET_ENUM)\r\n  },\r\n  mounted() {\r\n    window.addEventListener('click', clickOther, true)\r\n    window.addEventListener('scroll', this.triggerScrol, true)\r\n    // 获取手机系统语言，同步切换语言\r\n    const language = getLangConfig()\r\n    // TODO: 考虑是否有必要存储在localstorage，后期优化调整点\r\n    this.$storage.set('i18nLocale', language)\r\n    this.$i18n.locale = language\r\n    LANG_FROM_KEY.map((item) => {\r\n      if (item.key == this.$i18n.locale) {\r\n        this.$i18n.locale = item.key\r\n        // loadLanguageAsync(item.key, item.locale, this)\r\n      }\r\n    })\r\n    // iframe文件下载（downloadUrl = https://xionganwater.cn/api/sys-storage/download?f8s=481c0353dd6e3e7fae4e8a27a5f3c5c2）\r\n    window.outWorkFileDownload = (downloadUrl, fileName) => {\r\n      console.log('-------------------------------------------------------------');\r\n      const fileTransfer = new yuanchu.fileTransfer();\r\n      const downUrl = downloadUrl;\r\n      const fileUrl = yuanchu.fileSystemPaths.file.cacheDirectory + fileName; // 文件存储路径\r\n      console.log('下载地址', downUrl);\r\n      console.log('文件存储路径', fileUrl);\r\n      fileTransfer.download(\r\n        downUrl,\r\n        fileUrl,\r\n        (entry) => {\r\n          console.log('下载成功', entry);\r\n          // this.$toast(entry.toURL());\r\n          // this.fileUri = entry.toURL();\r\n          // this.preview(entry.toURL(), '');\r\n          entry.file((data) => {\r\n            console.log(data);\r\n            // 使用默认应用打开文件\r\n            yuanchu.fileOpener2.open(entry.toURL(), data.type, {\r\n              success: function () {\r\n                return\r\n              },\r\n              error: function (err) {\r\n                console.error(err)\r\n              },\r\n            })\r\n          })\r\n        },\r\n        (err) => {\r\n          console.log('下载失败', err);\r\n        },\r\n        false,\r\n        {\r\n          headers: {\r\n            'Fawkes-Auth': this.$storage.get('access_token'),\r\n          },\r\n        }\r\n      );\r\n    },\r\n    // 设置全局函数监听iframe的postMessage事件\r\n    window.addEventListener('message', (e) => {\r\n        // console.log('接收到iframe的postMessage事件', e)\r\n        // e.data = {\r\n        //   \"fileUrl\": \"https://xionganwater.cn/api/sys-storage/download?f8s=e4c3022686ae7b989be3978e8155fa26\",\r\n        //   \"uid\": \"u9rdYLyvQqNbRJVViMRswEkr1XrKduK7\",\r\n        //   \"url\": \"https://xionganwater.cn/api/sys-storage/download?f8s=e4c3022686ae7b989be3978e8155fa26\",\r\n        //   \"name\": \"测试下载.pdf\",\r\n        //   \"fileId\": \"e4c3022686ae7b989be3978e8155fa26\",\r\n        //   \"fileSize\": 728023,\r\n        //   \"fileType\": \"pdf\",\r\n        //   \"error\": false,\r\n        //   \"progress\": 100\r\n        //   \"type\": \"outWorkFileDownload\",\r\n        // }\r\n        if (e.data?.type == 'outWorkFileDownload') {\r\n          window.outWorkFileDownload(e.data.url, e.data.name)\r\n        }\r\n    })\r\n  },\r\n  beforeDestroy() {\r\n    window.removeEventListener('storage', function () {})\r\n  },\r\n  methods: {\r\n    // 页面加载后添加各事件监听\r\n    onLoad() {\r\n      document.addEventListener('deviceready', this.onDeviceReady, false)\r\n    },\r\n    // Cordova加载完毕\r\n    onDeviceReady() {\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.statusBar.styleDefault()\r\n        yuanchu.statusBar.getStatusBarHeight((res) => {\r\n          this.$storage.set('statusBarHeight', res)\r\n          console.log('statusBarHeight: ', statusBarHeight)\r\n        })\r\n      }\r\n      //极光推送初始化\r\n      // this.initJPush()\r\n\r\n      //判断是否需要热更新\r\n      // document.addEventListener(\r\n      //   'chcp_nothingToUpdate',\r\n      //   this.nothingToUpdate,\r\n      //   false\r\n      // )\r\n      //有些项目不需要热更新\r\n      // if (this.needUpdate) {\r\n      //   // this.$loading.show({ title: '检查更新中' })\r\n      //   this.toast1 = Toast.loading({\r\n      //     message: '检查更新中',\r\n      //     duration: 0,\r\n      //     overlay: true,\r\n      //     forbidClick: true,\r\n      //     loadingType: 'spinner',\r\n      //   })\r\n      //   yuanchu.chcp.fetchUpdate(this.fetchUpdateCallback)\r\n      // }\r\n      document.addEventListener('chcp_beforeDownload', this.beforeDownload, false);\r\n      yuanchu.chcp.fetchUpdate(this.fetchUpdateCallback)\r\n      // main.js中定义$back\r\n      document.addEventListener('backbutton', this.$back, false) // 默认返回上一级路由，其他情况自行处理\r\n    },\r\n    initJPush() {\r\n      // console.log('mmmmmmmmmmmmmmmcl:JPush')\r\n      window.JPush.setDebugMode(true)\r\n      window.JPush.init()\r\n      this.getRegistrationID()\r\n      document.addEventListener(\r\n        'jpush.receiveNotification',\r\n        this.onReceiveNotification,\r\n        false\r\n      )\r\n      document.addEventListener(\r\n        'jpush.openNotification',\r\n        this.onOpenNotification,\r\n        false\r\n      )\r\n      document.addEventListener(\r\n        'jpush.receiveMessage',\r\n        this.onReceiveMessage,\r\n        false\r\n      )\r\n    },\r\n    onReceiveNotification(event) {\r\n      try {\r\n        var alertContent\r\n        if (yuanchu.device.platform == 'Android') {\r\n          alertContent = event.alert\r\n        } else {\r\n          alertContent = event.aps.alert\r\n        }\r\n        // alert('接受到消息通知: ' + alertContent)\r\n      } catch (exception) {\r\n        console.log(exception)\r\n      }\r\n    },\r\n    onOpenNotification(event) {\r\n      try {\r\n        var alertContent\r\n        if (yuanchu.device.platform == 'Android') {\r\n          alertContent = event.alert\r\n        } else {\r\n          alertContent = event.aps.alert\r\n        }\r\n        // alert('用户点击消息通知: ' + alertContent)\r\n      } catch (exception) {\r\n        console.log('JPushPlugin:onOpenNotification' + exception)\r\n      }\r\n    },\r\n    onReceiveMessage(event) {\r\n      try {\r\n        var message\r\n        if (yuanchu.device.platform == 'Android') {\r\n          message = event.message\r\n        } else {\r\n          message = event.content\r\n        }\r\n        // alert('接受到消息: ' + message)\r\n      } catch (exception) {\r\n        console.log('JPushPlugin:onReceiveMessage-->' + exception)\r\n      }\r\n    },\r\n    getRegistrationID() {\r\n      window.JPush.getRegistrationID(this.onGetRegistrationID)\r\n    },\r\n    onGetRegistrationID(data) {\r\n      try {\r\n        console.log('JPushPlugin:registrationID is ' + data)\r\n        if (data.length == 0) {\r\n          // 如果获取到为空，重新获取\r\n          var t1 = window.setTimeout(this.getRegistrationID, 1000)\r\n        }\r\n        console.log('registrationID: ' + data)\r\n      } catch (exception) {\r\n        console.log(exception)\r\n      }\r\n    },\r\n    beforeDownload() {\r\n      console.log(\"即将开始下载热更新！\");\r\n      this.toast1 = Toast.loading({\r\n        message: '检查更新中',\r\n        duration: 0,\r\n        overlay: true,\r\n        forbidClick: true,\r\n        loadingType: 'spinner',\r\n      })      \r\n    },\r\n    //无热更新\r\n    nothingToUpdate() {\r\n      this.needUpdate = false\r\n    },\r\n    fetchUpdateCallback(error, data) {\r\n      if (error) {\r\n        //没更新\r\n        // this.$loading.hide()\r\n        this.toast1.clear()\r\n        Toast('当前版本已是最新版本')\r\n        console.log('error', JSON.stringify(error))\r\n        console.log('data', JSON.stringify(data))\r\n        if (error.code == 2) {\r\n        } else if (error.code == -2) {\r\n          Toast('您的App版本过低，请升级')\r\n          //您的App原生框架版本过低，请升级\r\n        } else {\r\n          //根据error.code对获取更新结果做提示用户、重新调用更新检查方法等其他额外处理\r\n        }\r\n      } else {\r\n        this.toast1.clear()\r\n        this.toast2 = Toast.loading({\r\n          message: '更新中',\r\n          duration: 0,\r\n          overlay: true,\r\n          forbidClick: true,\r\n          loadingType: 'spinner',\r\n        })\r\n        //检查更新正常，开始安装更新\r\n        yuanchu.chcp.installUpdate(this.installationCallback)\r\n      }\r\n    },\r\n    installationCallback(error) {\r\n      if (error) {\r\n        // this.$loading.hide()\r\n        this.toast2.clear()\r\n        Toast.error({\r\n          message: '更新失败',\r\n          duration: 2000,\r\n        })\r\n        //根据error.code对安装更新异常做提示用户、重新调用安装更新方法等其他额外处理\r\n      } else {\r\n        this.toast2.clear()\r\n        Toast.success({\r\n          message: '更新完成',\r\n          duration: 2000,\r\n        })\r\n        // this.$loading.hide()\r\n      }\r\n    },\r\n    triggerScrol() {\r\n      if (Math.round(getScrollTop() + getWindowHeight()) == getScrollHeight()) {\r\n        scroll()\r\n      }\r\n    },\r\n  },\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n#app {\r\n  height: calc(100vh - constant(safe-area-inset-bottom));\r\n  height: calc(100vh - env(safe-area-inset-bottom));\r\n  background-color: #fff;\r\n  overflow: hidden;\r\n  width: 100%;\r\n  //ios底部适配\r\n\r\n  padding-bottom: constant(safe-area-inset-bottom); //兼容 IOS<11.2\r\n\r\n  padding-bottom: env(safe-area-inset-bottom); //兼容 IOS>11.2\r\n}\r\n/deep/.fm-nav-bar {\r\n  padding-top: var(--height);\r\n}\r\n/deep/.fm-list__finished-text {\r\n  padding-bottom: var(--height);\r\n}\r\n</style>\r\n"]}]}