{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\inspectionManage\\add-event.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\inspectionManage\\add-event.vue","mtime":1705912800083},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgTWFwQ29tcCBmcm9tICIuLi9pbnNwZWN0TWFwL2luZGV4LnZ1ZSI7DQovLyBpbXBvcnQgU3VudWlVcGltZyBmcm9tICcuLi8uLi9jb21wb25lbnRzL3N1bnVpLXVwaW1nL3N1bnVpLXVwaW1nLnZ1ZSc7DQppbXBvcnQgYnVzIGZyb20gIi4uLy4uL3ZpZXdzL2luc3BlY3RNYXAvdXRpbHMvQnVzLmpzIjsNCi8vIGltcG9ydCBQdWxsdXBCYXIgZnJvbSAiQGNvbXAvcHVsbHVwLWJhci9pbmRleDIudnVlIjsNCi8vIGltcG9ydCBVbmlEYXRhQ2hlY2tib3ggZnJvbSAnLi4vLi4vY29tcG9uZW50cy91bmktZGF0YS1jaGVja2JveC91bmktZGF0YS1jaGVja2JveC52dWUnOw0KaW1wb3J0IF8gZnJvbSAibG9kYXNoIjsNCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7DQppbXBvcnQgdXJsIGZyb20gIkBjb21tb24vY29uZmlnLmpzIjsNCmltcG9ydCAqIGFzIHR1cmYgZnJvbSAnQHR1cmYvdHVyZicNCmltcG9ydCB7IGVuZ1Byb3BlcnR5VmFsdWUsIHRyZWUsIGluc2VydCwgZ2V0QWxsUG9pbnRPckxpbmVHZW9tSW5zcCB9IGZyb20gJy4vYXBpJw0KaW1wb3J0IHsgVG9hc3QgfSBmcm9tICdmYXdrZXMtbW9iaWxlLWxpYic7DQpjb25zdCBtYXBPYmogPSB7DQogIG1hcDogbnVsbCwNCiAgbWFwSW5zdGFuY2U6IG51bGwNCn0NCmNvbnN0IHN1cGVyTWFwVXJsID0gew0KICAnUE9JJzogew0KICAgIHVybDoNCiAgICAgIHVybC5naXNEb21haW4gKw0KICAgICAgIi9pc2VydmVyL3NlcnZpY2VzL2RhdGEtTHVXYW5nWXVQT0kvcmVzdC9kYXRhL2ZlYXR1cmVSZXN1bHRzLnJqc29uP3JldHVybkNvbnRlbnQ9dHJ1ZSIsDQogICAgZGF0YXNldHM6IFsiUE9JOlBPSSJdLA0KICB9LA0KICAn6YGT6Lev5ZCNJzogew0KICAgIHVybDoNCiAgICAgIHVybC5naXNEb21haW4gKw0KICAgICAgIi9pc2VydmVyL3NlcnZpY2VzL2RhdGEtTHVXYW5nWXVQT0kvcmVzdC9kYXRhL2ZlYXR1cmVSZXN1bHRzLnJqc29uP3JldHVybkNvbnRlbnQ9dHJ1ZSIsDQogICAgZGF0YXNldHM6IFsiUE9JOuS9meadreWMuuefoumHj+i3r+e9kSJdLA0KICB9LA0KfTsNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogImFkZC1ldmVudCIsDQogIGNvbXBvbmVudHM6IHsNCiAgICBNYXBDb21wLA0KICAgIC8vIFN1bnVpVXBpbWcsDQogICAgLy8gUHVsbHVwQmFyLA0KICAgIC8vIFVuaURhdGFDaGVja2JveA0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBkaWN0aW9uYXJ5OiB7DQogICAgICAgIFdBVEVSX1NVUFBMWTogJ+S+m+awtCcsDQogICAgICAgIFJBSV9XQVRFUjogJ+mbqOawtCcsDQogICAgICAgIFBPTExVVEVEX1dBVEVSOiAn5rGh5rC0Jw0KICAgICAgfSwNCg0KICAgICAgbG9jYXRpb25OYW1lOiAi5L2N572u5o+P6L+w5L+h5oGvIiwNCiAgICAgIHBvc2l0aW9uOiBbMCwgMF0sDQogICAgICBjdXJFbmc6IG51bGwsDQogICAgICBjdXJGZWF0dXJlOiBudWxsLA0KICAgICAgZW5nTGlzdDogW10sDQogICAgICBmaWx0ZXJlZExpc3Q6IFtdLA0KICAgICAgaW5pdFRvcDogIjcwJSIsDQogICAgICBrZXl3b3JkOiAiIiwNCiAgICAgIHVzZXJJbmZvOiB7fSwNCiAgICAgIGZlYXR1cmU6IHt9LA0KICAgICAgcG9wdXBTaG93OiBmYWxzZSwNCiAgICAgIGV2ZW50Rm9ybTogew0KICAgICAgICBldmVudFR5cGU6ICIiLA0KICAgICAgICBmaWxlczogW10sDQogICAgICAgIGluc3BUYXNrRGV0YWlsRGVzYzogew0KICAgICAgICAgIHRleHQ6ICIiLA0KICAgICAgICAgIHZvaWNlOiB7fQ0KICAgICAgICB9LA0KICAgICAgICByZW1hcms6IHsNCiAgICAgICAgICB0ZXh0OiAiIiwNCiAgICAgICAgICB2b2ljZToge30NCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIGV2ZW50VHlwZUxpc3Q6IFtdLA0KICAgICAgcmFuZ2VMaXN0OiBbXSwNCiAgICAgIHRhc2tEZXRhaWw6IHt9LA0KICAgICAgZW5nSW5mb0RUTzogbnVsbCwNCiAgICAgIHNlbGVjdEV2ZW50VHlwZTogZmFsc2UsDQogICAgICBydWxlczogew0KICAgICAgICBldmVudFR5cGU6IFsNCiAgICAgICAgICB7DQogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwNCiAgICAgICAgICAgIG1lc3NhZ2U6ICLor7fpgInmi6nkuovku7bnsbvlnosiDQogICAgICAgICAgfQ0KICAgICAgICBdLA0KICAgICAgICBwaG90b0xlbmd0aDogWw0KICAgICAgICAgIHsNCiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLA0KICAgICAgICAgICAgbWVzc2FnZTogIuivt+S4iuS8oOmZhOS7tiIsDQogICAgICAgICAgICB0cmlnZ2VyOiBbImNoYW5nZSIsICJibHVyIl0NCiAgICAgICAgICB9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICBwcmV2aWV3VVJMOiAiL3N5cy1zdG9yYWdlL2Rvd25sb2FkX2ltYWdlP2Y4cz0iLA0KICAgICAgdXBpbWdQcmV2aWV3OiBbXSwNCiAgICAgIGhlYWRlcnM6IHt9LA0KICAgICAgdXJsOiB7DQogICAgICAgIC8vIOacrOmhtemdouS9v+eUqOWIsOeahHVybA0KICAgICAgICB1cGxvYWRGaWxlOiAic3lzLXN0b3JhZ2UvdXBsb2FkIiwNCiAgICAgICAgLy8gZmluZEZpbGU6ICJlY2lkaS1jbXAvZmlsZS9jbXBGaWxlR3JvdXAvZmluZEZpbGVzQnlHcm91cElkIiwNCiAgICAgIH0sDQogICAgICBzaG93VmlzaWJsZTogZmFsc2UNCiAgICB9DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgZXZlbnRUeXBlTGlzdE5ld0ZpbHRlcmVkKCkgew0KICAgICAgY29uc3QgeyBkaWN0aW9uYXJ5LCBldmVudFR5cGVMaXN0LCB0YXNrRGV0YWlsIH0gPSB0aGlzOw0KICAgICAgbGV0IHRlbXAgPSBldmVudFR5cGVMaXN0LmZpbmQoaXRlbSA9PiB7DQogICAgICAgIHJldHVybiBpdGVtLmxhYmVsID09PSBkaWN0aW9uYXJ5W3Rhc2tEZXRhaWwuaW5zcEJ1c2luZXNzVHlwZV07DQogICAgICB9KTsNCiAgICAgIGlmICh0ZW1wKSB7DQogICAgICAgIHJldHVybiB0ZW1wLmNoaWxkcmVuOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICB9DQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuaGVhZGVycyA9IHsNCiAgICAgIC8vICJGYXdrZXMtQXV0aCI6IHVuaS5nZXRTdG9yYWdlU3luYygiRmF3a2VzLUF1dGgiKSwNCiAgICB9Ow0KICB9LA0KICBhY3RpdmF0ZWQoKSB7DQogICAgdGhpcy5zZXRMb2NhdGlvbk5hbWUoKTsNCiAgICB1bmkuc2V0U3RvcmFnZVN5bmMoImlzUmVwb3J0RXZlbnQiLCB0cnVlKTsNCiAgICBpZiAoIXRoaXMuc2hvd1Zpc2libGUpIHsNCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgdGhpcy5yZWZyZXNoUmVwb3J0RXZlbnQoKTsNCiAgICAgIH0pDQogICAgICB0aGlzLmdldEV2ZW50VHlwZUxpc3QoKTsNCiAgICB9DQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdGhpcy5zZXRMb2NhdGlvbk5hbWUoKTsNCiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiaXNSZXBvcnRFdmVudCIsIHRydWUpOw0KICAgIHRoaXMudXNlckluZm8gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidXNlckluZm8iKTsNCiAgICBidXMuJG9uKCJldmVudE1hcmtlclBvc2l0aW9uIiwgKHBvcykgPT4gew0KICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvczsNCiAgICAgIHRoaXMuZ2V0RW5nRGF0YSgpOw0KICAgIH0pDQogICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgdGhpcy5yZWZyZXNoUmVwb3J0RXZlbnQoKTsNCiAgICB9KQ0KICAgIHRoaXMuZ2V0RXZlbnRUeXBlTGlzdCgpOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgbWFwTG9hZGVkKG1hcEluc3RhbmNlKSB7DQogICAgICBtYXBPYmoubWFwSW5zdGFuY2UgPSBtYXBJbnN0YW5jZQ0KICAgICAgbWFwT2JqLm1hcCA9IG1hcEluc3RhbmNlLm1hcA0KICAgIH0sDQogICAgLy8g5Yi35pawDQogICAgcmVmcmVzaFJlcG9ydEV2ZW50KCkgew0KICAgICAgdGhpcy5wb3NpdGlvbj0gWzAsIDBdOw0KICAgICAgdGhpcy5jdXJFbmc9IG51bGw7DQogICAgICB0aGlzLmN1ckZlYXR1cmUgPSBudWxsOw0KICAgICAgdGhpcy5lbmdMaXN0PSBbXTsNCiAgICAgIHRoaXMuZmlsdGVyZWRMaXN0PSBbXTsNCiAgICAgIHRoaXMubG9jYXRpb25OYW1lID0gIuS9jee9ruaPj+i/sOS/oeaBryI7DQogICAgICB0aGlzLmluaXRUb3A9ICI3MCUiOw0KICAgICAgdGhpcy5rZXl3b3JkPSAiIjsNCiAgICAgIHRoaXMuZXZlbnRGb3JtID0gew0KICAgICAgICBldmVudFR5cGU6ICIiLA0KICAgICAgICBmaWxlczogW10sDQogICAgICAgIGluc3BUYXNrRGV0YWlsRGVzYzogew0KICAgICAgICAgIHRleHQ6ICIiLA0KICAgICAgICAgIHZvaWNlOiB7fQ0KICAgICAgICB9LA0KICAgICAgICByZW1hcms6IHsNCiAgICAgICAgICB0ZXh0OiAiIiwNCiAgICAgICAgICB2b2ljZToge30NCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICAgIHRoaXMudXBpbWdQcmV2aWV3ID0gW107DQogICAgICBpZiAodGhpcy4kcm91dGUucXVlcnkucG9zaXRpb24pIHsNCiAgICAgICAgLy8gdGhpcy5mZWF0dXJlID0gdGhpcy4kcm91dGUucXVlcnkuZmVhdHVyZTsNCiAgICAgICAgdGhpcy5yYW5nZUxpc3QgPSB0aGlzLiRyb3V0ZS5xdWVyeS5yYW5nZUxpc3Q7DQogICAgICAgIHRoaXMudGFza0RldGFpbCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tEZXRhaWw7DQogICAgICAgIHRoaXMucG9zaXRpb24gPSB0aGlzLiRyb3V0ZS5xdWVyeS5wb3NpdGlvbjsNCiAgICAgIH0NCiAgICAgIG1hcE9iai5tYXAubWFwT25Mb2FkKCgpID0+IHsNCiAgICAgICAgaWYgKHRoaXMucG9zaXRpb24pIHsNCiAgICAgICAgICBtYXBPYmoubWFwLmFkZFJlcG9ydEV2ZW50TWFya2VyKHRoaXMucG9zaXRpb24pOw0KICAgICAgICAgIG1hcE9iai5tYXAuYWRkUmFuZ2VMaXN0KHRoaXMucmFuZ2VMaXN0KTsNCiAgICAgICAgICBtYXBPYmoubWFwLmZseVRvKHsgcG9zaXRpb246IHRoaXMucG9zaXRpb24sIHpvb206IDE4fSk7DQogICAgICAgIH0gDQogICAgICAgIA0KICAgICAgfSkNCiAgICAgIC8vIHRoaXMuJHJlZnMuZXZlbnRGb3JtLnNldFJ1bGVzKHRoaXMucnVsZXMpOw0KICAgIH0sDQogICAgLy8g6I635Y+W5LqL5Lu257G75Z6LDQogICAgZ2V0RXZlbnRUeXBlTGlzdCgpIHsNCiAgICAgIHRyZWUoKS50aGVuKHJlcyA9PiB7DQogICAgICAgIHRoaXMuZXZlbnRUeXBlTGlzdCA9IHJlcy5kYXRhLnNvbnMubWFwKGl0ZW0gPT4gew0KICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICB2YWx1ZTogaXRlbS5jb2RlLA0KICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubmFtZSwNCiAgICAgICAgICAgIGNoaWxkcmVuOiBpdGVtLnNvbnMubWFwKGl0ZW0gPT4gew0KICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtLmNvZGUsDQogICAgICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubmFtZSwNCiAgICAgICAgICAgICAgICBjaGlsZHJlbjogaXRlbS5zb25zLm1hcChpdGVtID0+IHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtLmNvZGUsDQogICAgICAgICAgICAgICAgICAgIGxhYmVsOiBpdGVtLm5hbWUNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0pLmNhdGNoKCgpID0+IHsNCiAgICAgICAgVG9hc3Qoew0KICAgICAgICAgIG1lc3NhZ2U6ICLlrZflhbjliqDovb3lpLHotKUiLA0KICAgICAgICB9KTsNCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyDojrflj5blm77niYfkv6Hmga8NCiAgICBnZXRJbWFnZUluZm8odmFsKSB7DQogICAgICBpZiAodmFsICYmIHZhbFswXS5sZW5ndGggPiAwKSB7DQogICAgICAgIHRoaXMuZXZlbnRGb3JtLmZpbGVzID0gdmFsWzBdOw0KICAgICAgICBsZXQgcGhvdG9MaXN0ID0gW107DQogICAgICAgIHZhbFswXS5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4gew0KICAgICAgICAgIHBob3RvTGlzdC5wdXNoKGl0ZW0uZmlsZVRva2VuKTsNCiAgICAgICAgfSk7DQogICAgICAgIGxldCB0ZW1wID0gcGhvdG9MaXN0Lmxlbmd0aCArICIiOw0KICAgICAgICB0aGlzLiRzZXQodGhpcy5ldmVudEZvcm0sICJwaG90b0xlbmd0aCIsIHRlbXApOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kc2V0KHRoaXMuZXZlbnRGb3JtLCAicGhvdG9MZW5ndGgiLCAiIik7DQogICAgICB9DQogICAgfSwNCiAgICAvLyDkuovku7bnsbvlnovpgInmi6nnoa7orqQNCiAgICBldmVudFR5cGVDb25maXJtKGV2ZW50KSB7DQogICAgICB0aGlzLiRzZXQodGhpcy5ldmVudEZvcm0sICJldmVudFR5cGUiLCBldmVudFsxXS5sYWJlbCk7DQogICAgICB0aGlzLiRzZXQodGhpcy5ldmVudEZvcm0sICJpbnNwSXRlbUNvZGUiLCBldmVudFsxXS52YWx1ZSk7DQogICAgfSwNCiAgICAvLyDpgInmi6nkvY3nva4NCiAgICBwaWNrUG9zaXRpb24oKSB7DQogICAgICAvLyDkuIrkvKDnu4Tku7blm57mmL4NCiAgICAgIHRoaXMudXBpbWdQcmV2aWV3ID0gdGhpcy5ldmVudEZvcm0uZmlsZXMubWFwKChpdGVtKSA9PiB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgdXBsb2FkRmlsZTogew0KICAgICAgICAgICAgc2F2ZVBhdGg6IGl0ZW0uZmlsZVRva2VuLA0KICAgICAgICAgIH0sDQogICAgICAgICAgLi4uaXRlbQ0KICAgICAgICB9Ow0KICAgICAgfSk7DQogICAgICB0aGlzLnBvcHVwU2hvdyA9IHRydWU7DQogICAgICB0aGlzLmxvY2F0aW9uTmFtZSA9ICLkvY3nva7mj4/ov7Dkv6Hmga8iOw0KICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBtYXBPYmoubWFwLm1hcE9uTG9hZCgoKSA9PiB7DQogICAgICAgICAgbWFwT2JqLm1hcC5hZGRSZXBvcnRFdmVudE1hcmtlcih0aGlzLnBvc2l0aW9uKTsNCiAgICAgICAgICBpZiAodGhpcy5wb3NpdGlvbikgew0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRSYW5nZUxpc3QodGhpcy5yYW5nZUxpc3QpOw0KICAgICAgICAgICAgbWFwT2JqLm1hcC5mbHlUbyh7IHBvc2l0aW9uOiB0aGlzLnBvc2l0aW9uLCB6b29tOiAxOH0pOw0KICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgIHRoaXMuY3VyRmVhdHVyZSAmJiBtYXBPYmoubWFwLnNldExpbmVHZW9Tb3VyY2UoW3RoaXMuY3VyRmVhdHVyZV0sICJjdXJJbnNwTGluZVNvdXJjZSIpOw0KICAgICAgICAgICAgfSwgMTUwMCkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g5Y+W5raI6YCJ5oup5L2N572uDQogICAgb25DYW5jZWwoKSB7DQogICAgICB0aGlzLnBvcHVwU2hvdyA9IGZhbHNlOw0KICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBtYXBPYmoubWFwLm1hcE9uTG9hZCgoKSA9PiB7DQogICAgICAgICAgbWFwT2JqLm1hcC5hZGRSZXBvcnRFdmVudE1hcmtlcih0aGlzLnBvc2l0aW9uKTsNCiAgICAgICAgICBpZiAodGhpcy5wb3NpdGlvbikgew0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRSYW5nZUxpc3QodGhpcy5yYW5nZUxpc3QpOw0KICAgICAgICAgICAgbWFwT2JqLm1hcC5mbHlUbyh7IHBvc2l0aW9uOiB0aGlzLnBvc2l0aW9uLCB6b29tOiAxOH0pOw0KICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgIHRoaXMuY3VyRmVhdHVyZSAmJiBtYXBPYmoubWFwLnNldExpbmVHZW9Tb3VyY2UoW3RoaXMuY3VyRmVhdHVyZV0sICJjdXJJbnNwTGluZVNvdXJjZSIpOw0KICAgICAgICAgICAgfSwgMTUwMCkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g56Gu6K6k6YCJ5oup5L2N572uDQogICAgb25Db25maXJtKCkgew0KICAgICAgaWYgKCF0aGlzLnBvc2l0aW9uKSByZXR1cm47DQogICAgICB0aGlzLnBvcHVwU2hvdyA9IGZhbHNlOw0KICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBtYXBPYmoubWFwLm1hcE9uTG9hZCgoKSA9PiB7DQogICAgICAgICAgbWFwT2JqLm1hcC5hZGRSZXBvcnRFdmVudE1hcmtlcih0aGlzLnBvc2l0aW9uKTsNCiAgICAgICAgICBpZiAodGhpcy5wb3NpdGlvbikgew0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRSYW5nZUxpc3QodGhpcy5yYW5nZUxpc3QpOw0KICAgICAgICAgICAgbWFwT2JqLm1hcC5mbHlUbyh7IHBvc2l0aW9uOiB0aGlzLnBvc2l0aW9uLCB6b29tOiAxOH0pOw0KICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgIHRoaXMuY3VyRmVhdHVyZSAmJiBtYXBPYmoubWFwLnNldExpbmVHZW9Tb3VyY2UoW3RoaXMuY3VyRmVhdHVyZV0sICJjdXJJbnNwTGluZVNvdXJjZSIpOw0KICAgICAgICAgICAgfSwgMTUwMCkNCiAgICAgICAgICB9DQogICAgICAgICAgLyog5rOo6YeK6auY5b63YXBp6LCD55SoDQogICAgICAgICAgdmFyIGNvcmRGb3JMb2Nfc3RhcnQgPQ0KICAgICAgICAgICAgdGhpcy5wb3NpdGlvblswXS50b1N0cmluZygpICsNCiAgICAgICAgICAgICIsIiArDQogICAgICAgICAgICB0aGlzLnBvc2l0aW9uWzFdLnRvU3RyaW5nKCk7DQogICAgICAgICAgdmFyIEdhb0RlVXJsX3N0YXJ0ID0NCiAgICAgICAgICAgICJodHRwczovL3Jlc3RhcGkuYW1hcC5jb20vdjMvZ2VvY29kZS9yZWdlbz9sb2NhdGlvbj0iICsNCiAgICAgICAgICAgIGNvcmRGb3JMb2Nfc3RhcnQgKw0KICAgICAgICAgICAgIiZrZXk9NzUwNDZjMWQ2Njk3OTllM2JlYzY1MDNlZmJjOTRjM2UiICsNCiAgICAgICAgICAgICImcmFkaXVzPTUwIjsNCiAgICAgICAgICAgIGF4aW9zDQogICAgICAgICAgICAuZ2V0KEdhb0RlVXJsX3N0YXJ0KQ0KICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgICAgICB0aGlzLmxvY2F0aW9uTmFtZSA9IHJlcy5kYXRhLnJlZ2VvY29kZS5mb3JtYXR0ZWRfYWRkcmVzcy5zcGxpdCgNCiAgICAgICAgICAgICAgICAi5biCIg0KICAgICAgICAgICAgICApW3Jlcy5kYXRhLnJlZ2VvY29kZS5mb3JtYXR0ZWRfYWRkcmVzcy5zcGxpdCgi5biCIikubGVuZ3RoIC0gMV07DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHsNCiAgICAgICAgICAgICAgY29uc29sZS5sb2coIuWcsOeQhue8lueggeaKpemUme+8miIgKyBlcnIpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAqLw0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIOi2heWbvuWdkOagh+i9rOaNouS4umZlYXR1cmUNCiAgICAgKi8NCiAgICBzdXBlck1hcFBhcmFtc1RvRmVhdHVyZShnZW9tZXRyeSkgew0KICAgICAgbGV0IGNvb3JkOw0KICAgICAgbGV0IHR5cGU7DQogICAgICBzd2l0Y2ggKGdlb21ldHJ5LnR5cGUpIHsNCiAgICAgICAgY2FzZSAiUE9JTlQiOg0KICAgICAgICAgIHR5cGUgPSAiUG9pbnQiOw0KICAgICAgICAgIGNvb3JkID0gW2dlb21ldHJ5LnBvaW50c1swXS54LCBnZW9tZXRyeS5wb2ludHNbMF0ueV07DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgIkxJTkUiOg0KICAgICAgICAgIHR5cGUgPSAiTGluZVN0cmluZyI7DQogICAgICAgICAgY29vcmQgPSBnZW9tZXRyeS5wb2ludHMubWFwKChwb2ludCkgPT4gW3BvaW50LngsIHBvaW50LnldKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiUkVHSU9OIjoNCiAgICAgICAgICB0eXBlID0gIlBvbHlnb24iOw0KICAgICAgICAgIGNvb3JkID0gW2dlb21ldHJ5LnBvaW50cy5tYXAoKHBvaW50KSA9PiBbcG9pbnQueCwgcG9pbnQueV0pXTsNCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICAgIHJldHVybiB7DQogICAgICAgIHR5cGU6ICJGZWF0dXJlIiwNCiAgICAgICAgZ2VvbWV0cnk6IHsNCiAgICAgICAgICB0eXBlLA0KICAgICAgICAgIGNvb3JkaW5hdGVzOiBjb29yZCwNCiAgICAgICAgfSwNCiAgICAgIH07DQogICAgfSwNCiAgICBmZWF0dXJlVG9PYmplY3QobmFtZXMsIHZhbHVlcykgew0KICAgICAgbGV0IG9iaiA9IHt9Ow0KICAgICAgbmFtZXMuZm9yRWFjaCgobmFtZSwgaW5kZXgpID0+IHsNCiAgICAgICAgb2JqW25hbWVdID0gdmFsdWVzW2luZGV4XTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIG9iajsNCiAgICB9LA0KICAgIC8vIOmAmui/h+i2heWbvuafpeivouiuvue9rmxvY2F0aW9uTmFtZQ0KICAgIGFzeW5jIHNldExvY2F0aW9uTmFtZSh0eXBlID0gIlBPSSIpIHsNCiAgICAgIGlmICh0aGlzLnBvc2l0aW9uKSB7DQogICAgICAgIC8vIOeUn+aIkDUwbee8k+WGsuWMuui/m+ihjOafpeivog0KICAgICAgICBsZXQgZ2VvbSA9IHR1cmYuYnVmZmVyKHR1cmYucG9pbnQodGhpcy5wb3NpdGlvbiksIDAuMDUsIHt1bml0OiAna2lsb21ldGVycyd9KTsNCiAgICAgICAgbGV0IGdlb21ldHJ5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShnZW9tLmdlb21ldHJ5KSk7DQogICAgICAgIGxldCBjb29yZGluYXRlcyA9IGdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdLm1hcCgoaXRlbSkgPT4gew0KICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICB4OiBpdGVtWzBdLA0KICAgICAgICAgICAgeTogaXRlbVsxXSwNCiAgICAgICAgICB9Ow0KICAgICAgICB9KTsNCiAgICAgICAgZ2VvbWV0cnkucG9pbnRzID0gY29vcmRpbmF0ZXM7DQogICAgICAgIGdlb21ldHJ5LnR5cGUgPSAiUkVHSU9OIjsNCiAgICAgICAgZGVsZXRlIGdlb21ldHJ5LmNvb3JkaW5hdGVzOw0KICAgICAgICBsZXQgeyBkYXRhIH0gPSBhd2FpdCBheGlvcyh7DQogICAgICAgICAgbWV0aG9kOiAicG9zdCIsDQogICAgICAgICAgdXJsOiBzdXBlck1hcFVybFt0eXBlXS51cmwsDQogICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgZ2V0RmVhdHVyZU1vZGU6ICJTUEFUSUFMX0FUVFJJQlVURUZJTFRFUiIsDQogICAgICAgICAgICBkYXRhc2V0TmFtZXM6IHN1cGVyTWFwVXJsW3R5cGVdLmRhdGFzZXRzLA0KICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiAnJywNCiAgICAgICAgICAgIGdlb21ldHJ5LA0KICAgICAgICAgICAgc3BhdGlhbFF1ZXJ5TW9kZTogIkNPTlRBSU4iLA0KICAgICAgICAgIH0pLA0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKGRhdGEudG90YWxDb3VudCkgew0KICAgICAgICAgIGxldCBhcnIgPSBbXTsNCiAgICAgICAgICBkYXRhLmZlYXR1cmVzICYmDQogICAgICAgICAgICBkYXRhLmZlYXR1cmVzLmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgbGV0IHByb3BlcnRpZXMgPSB0aGlzLmZlYXR1cmVUb09iamVjdCgNCiAgICAgICAgICAgICAgICBpdGVtLmZpZWxkTmFtZXMsDQogICAgICAgICAgICAgICAgaXRlbS5maWVsZFZhbHVlcw0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICBsZXQgY29vcmQgPSB0aGlzLnN1cGVyTWFwUGFyYW1zVG9GZWF0dXJlKGl0ZW0uZ2VvbWV0cnkpOw0KICAgICAgICAgICAgICBhcnIucHVzaCh7DQogICAgICAgICAgICAgICAgLi4ucHJvcGVydGllcywNCiAgICAgICAgICAgICAgICBjb29yZCwNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICBjb25zdCB0ZW1wRGF0YSA9IGFyci5tYXAoKGl0ZW0pID0+IHsNCiAgICAgICAgICAgIGl0ZW0uQURSRVNTID0gaXRlbS5BRFJFU1MgPyBpdGVtLkFEUkVTUy5yZXBsYWNlKCLmtZnmsZ/nnIEiLCAiIikgOiBpdGVtLk5BTUUucmVwbGFjZSgi5rWZ5rGf55yBIiwgIiIpOw0KICAgICAgICAgICAgaXRlbS5BRFJFU1MgPSBpdGVtLkFEUkVTUyA/IGl0ZW0uQURSRVNTLnJlcGxhY2UoIuadreW3nuW4giIsICIiKSA6IGl0ZW0uTkFNRS5yZXBsYWNlKCLmna3lt57luIIiLCAiIik7DQogICAgICAgICAgICByZXR1cm4gaXRlbTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBpZiAodGVtcERhdGEubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgdGhpcy5sb2NhdGlvbk5hbWUgPSB0ZW1wRGF0YVswXS5BRFJFU1M7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICB0aGlzLmxvY2F0aW9uTmFtZSA9ICcnOw0KICAgIH0sDQogICAgLy8g5o+Q5LqkDQogICAgc3VibWl0KCkgew0KICAgICAgdGhpcy4kcmVmcy5ldmVudEZvcm0udmFsaWRhdGUodmFsaWQgPT4gew0KICAgICAgICBpZiAodmFsaWQpIHsNCiAgICAgICAgICAvLyBpZiAoIXRoaXMuZW5nSW5mb0RUTykgIHsNCiAgICAgICAgICAvLyAgIHVuaS5zaG93VG9hc3Qoew0KICAgICAgICAgIC8vICAgICB0aXRsZTogIuaVsOaNruS4jeWtmOWcqCIsDQogICAgICAgICAgLy8gICAgIGR1cmF0aW9uOiAzMDAwDQogICAgICAgICAgLy8gICB9KTsNCiAgICAgICAgICAvLyAgIHJldHVybjsNCiAgICAgICAgICAvLyB9DQogICAgICAgICAgbGV0IGNvcHlFdmVudEZvcm0gPSB0aGlzLmRlZXBDbG9uZSh0aGlzLmV2ZW50Rm9ybSk7DQogICAgICAgICAgLy8g5LiK5oql5L2N572uDQogICAgICAgICAgLy8gY29uc3QgZ2VvbSA9IHRoaXMuY29tcHV0ZUNlbnRlcih0aGlzLmZlYXR1cmUpOw0KICAgICAgICAgIGNvbnN0IGdlb20gPSB7DQogICAgICAgICAgICB0eXBlOiAiUG9pbnQiLA0KICAgICAgICAgICAgY29vcmRpbmF0ZXM6IHRoaXMucG9zaXRpb24NCiAgICAgICAgICB9DQogICAgICAgICAgbGV0IHVwbG9hZEZpbGVzID0gW107DQogICAgICAgICAgaWYgKHRoaXMuZXZlbnRGb3JtLmluc3BUYXNrRGV0YWlsRGVzYy52b2ljZS5maWxlVG9rZW4pIHsNCiAgICAgICAgICAgIHVwbG9hZEZpbGVzLnB1c2godGhpcy5ldmVudEZvcm0uaW5zcFRhc2tEZXRhaWxEZXNjLnZvaWNlKTsNCiAgICAgICAgICB9DQogICAgICAgICAgdXBsb2FkRmlsZXMgPSB1cGxvYWRGaWxlcy5jb25jYXQodGhpcy5ldmVudEZvcm0uZmlsZXMpOw0KICAgICAgICAgIGNvbnN0IHByZWxpbWluYXJ5SGFuZGxlRmlsZSA9IEpTT04uc3RyaW5naWZ5KHVwbG9hZEZpbGVzKTsNCiAgICAgICAgICBjb25zdCBpbnNwT3JnID0gSlNPTi5wYXJzZSh0aGlzLnRhc2tEZXRhaWwuaW5zcE9yZyk7DQogICAgICAgICAgY29uc3QgZXZlbnRQYXlsb2FkID0gew0KICAgICAgICAgICAgYWRkcmVzczogdGhpcy5sb2NhdGlvbk5hbWUsDQogICAgICAgICAgICBjb25jbHVzaW9uOiBjb3B5RXZlbnRGb3JtLmV2ZW50VHlwZSwNCiAgICAgICAgICAgIGV2ZW50RGVzY3JpYmU6IHRoaXMuZXZlbnRGb3JtLnJlbWFyay50ZXh0LA0KICAgICAgICAgICAgZXZlbnRTb3VyY2U6ICJpbnNwZWN0aW9uX2V2ZW50X3NvdXJjZV9pbnNwZWN0aW9uIiwNCiAgICAgICAgICAgIGV2ZW50VHlwZTogY29weUV2ZW50Rm9ybS5pbnNwSXRlbUNvZGUsDQogICAgICAgICAgICBpbnNwQnVzaW5lc3NUeXBlOiB0aGlzLnRhc2tEZXRhaWwuaW5zcEJ1c2luZXNzVHlwZSwNCiAgICAgICAgICAgIG9mZmljZUlkOiB0aGlzLnRhc2tEZXRhaWwuaW5zcE9yZ0lkLA0KICAgICAgICAgICAgb2ZmaWNlOiBpbnNwT3JnLm9mZmljZSwNCiAgICAgICAgICAgIGNvbXBhbnk6IGluc3BPcmcuY29tcGFueSwNCiAgICAgICAgICAgIGNvbXBhbnlJZDogaW5zcE9yZy5jb21wYW55SWQsDQogICAgICAgICAgICBwcmVsaW1pbmFyeUhhbmRsZTogdGhpcy5ldmVudEZvcm0uaW5zcFRhc2tEZXRhaWxEZXNjLnRleHQsDQogICAgICAgICAgICBwcmVsaW1pbmFyeUhhbmRsZUZpbGU6IHByZWxpbWluYXJ5SGFuZGxlRmlsZSwNCiAgICAgICAgICAgIGV2ZW50RGVzY3JpYmVGaWxlOiAgdGhpcy5ldmVudEZvcm0ucmVtYXJrLnZvaWNlLmZpbGVUb2tlbiA/IEpTT04uc3RyaW5naWZ5KHRoaXMuZXZlbnRGb3JtLnJlbWFyay52b2ljZSkgOiAiIiwNCiAgICAgICAgICAgIC8vIOS/neWtmOS4iuaKpeS6i+S7tuS9jee9rg0KICAgICAgICAgICAgcmVnaW9uSXRlbVRleHQ6IEpTT04uc3RyaW5naWZ5KGdlb20pLA0KICAgICAgICAgICAgLy8gcmVnaW9uSXRlbVRleHQ6IHRoaXMuZW5nSW5mb0RUTy5pbmZvRFRPLmVuZ0dlb20sDQogICAgICAgICAgICB0YXNrSWQ6IHRoaXMudGFza0RldGFpbC50YXNrSWQsDQogICAgICAgICAgICAvLyANCiAgICAgICAgICAgIGVuZ0lkOiB0aGlzLmVuZ0luZm9EVE8gPyB0aGlzLmVuZ0luZm9EVE8uZW5nSWQgOiB1bmRlZmluZWQsDQogICAgICAgICAgICBldmVudEl0ZW1UZXh0OiBKU09OLnN0cmluZ2lmeShnZW9tKSwNCiAgICAgICAgICAgIC8vIGV2ZW50SXRlbVRleHQ6IHRoaXMuZW5nSW5mb0RUTy5pbmZvRFRPLmVuZ0dlb20sDQoNCiAgICAgICAgICAgIGxuZzogZ2VvbS5jb29yZGluYXRlc1swXSwNCiAgICAgICAgICAgIGxhdDogZ2VvbS5jb29yZGluYXRlc1sxXSwNCiAgICAgICAgICAgIHJlcG9ydGVySWQ6IHRoaXMudXNlckluZm8uaWQsDQogICAgICAgICAgICByZXBvcnRlck5hbWU6IHRoaXMudXNlckluZm8udXNlckZ1bGxuYW1lDQogICAgICAgICAgfQ0KICAgICAgICAgIGluc2VydChldmVudFBheWxvYWQpLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7DQogICAgICAgICAgICAgIFRvYXN0KHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAi5LiK5oql5LqL5Lu25oiQ5YqfIiwNCiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwMA0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g5rex5ou36LSdDQogICAgZGVlcENsb25lKGRhdGEpIHsNCiAgICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTsNCiAgICB9LA0KICAgIC8vIOiuoeeul+S4reW/g+eCuQ0KICAgIGNvbXB1dGVDZW50ZXIoZmVhdHVyZSkgew0KICAgICAgbGV0IHBvc2l0aW9uOw0KICAgICAgaWYgKGZlYXR1cmUuZ2VvbWV0cnkudHlwZSA9PT0gJ1BvbHlnb24nIHx8IGZlYXR1cmUuZ2VvbWV0cnkudHlwZSA9PT0gJ011bHRpUG9seWdvbicpIHsNCiAgICAgICAgY29uc3QgY2VudGVyID0gdHVyZi5jZW50ZXIoZmVhdHVyZS5nZW9tZXRyeSk7DQogICAgICAgIHBvc2l0aW9uID0gY2VudGVyLmdlb21ldHJ5Ow0KICAgICAgfSBlbHNlIGlmIChmZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdMaW5lU3RyaW5nJykgew0KICAgICAgICBjb25zdCBjZW50ZXIgPSB0dXJmLmNlbnRlcihmZWF0dXJlLmdlb21ldHJ5KTsNCiAgICAgICAgcG9zaXRpb24gPSBjZW50ZXIuZ2VvbWV0cnk7DQogICAgICB9IGVsc2UgaWYgKGZlYXR1cmUuZ2VvbWV0cnkudHlwZSA9PT0gJ1BvaW50Jykgew0KICAgICAgICBwb3NpdGlvbiA9IGZlYXR1cmUuZ2VvbWV0cnk7DQogICAgICB9DQogICAgICByZXR1cm4gcG9zaXRpb247DQogICAgfSwNCiAgICAvLyDmoLnmja7lhbPplK7lrZfmn6Xor6INCiAgICBhc3luYyBnZXRFbmdQcm9wZXJ0eVZhbChndWlkKSB7DQogICAgICBjb25zdCBwYXJhbXMgPSB7DQogICAgICAgIHZhbHVlOiBndWlkDQogICAgICB9DQogICAgICBjb25zdCByZXMgPSBhd2FpdCBlbmdQcm9wZXJ0eVZhbHVlKHBhcmFtcyk7DQogICAgICBpZiAocmVzLnN0YXR1cykgew0KICAgICAgICB0aGlzLmVuZ0luZm9EVE8gPSByZXMuZGF0YTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuZW5nSW5mb0RUTyA9IG51bGw7DQogICAgICB9DQogICAgfSwNCiAgICBnZXRFbmdEYXRhOiBfLmRlYm91bmNlKGZ1bmN0aW9uKCkgew0KICAgICAgY29uc3QgcGFyYW1zID0gew0KICAgICAgICBpbnNwQnVzaW5lc3NUeXBlOiB0aGlzLnRhc2tEZXRhaWwuaW5zcEJ1c2luZXNzVHlwZSwNCiAgICAgICAgZ2VvbWV0cnk6IHsNCiAgICAgICAgICB0eXBlOiAiUG9pbnQiLA0KICAgICAgICAgIGNvb3JkaW5hdGVzOiB0aGlzLnBvc2l0aW9uDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHRoaXMuc2V0TG9jYXRpb25OYW1lKCk7DQogICAgICB0aGlzLmdldEVuZ0xpc3QocGFyYW1zKTsNCiAgICB9LCA1MDApLA0KICAgIGZpbHRlckVuZ0xpc3Qoa2V5d29yZCkgew0KICAgICAgaWYgKGtleXdvcmQpIHsNCiAgICAgICAgdGhpcy5maWx0ZXJlZExpc3QgPSB0aGlzLmVuZ0xpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5kZXZpY2VpZC5zZWFyY2goa2V5d29yZCkgIT0gLTEpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5maWx0ZXJlZExpc3QgPSB0aGlzLmVuZ0xpc3Q7DQogICAgICB9DQogICAgfSwNCiAgICAvLyDov5Tlm55yYWRpdXPkuLrljYrlvoTojIPlm7TnmoTlt6XnqIvlr7nosaHmlbDmja4NCiAgICBhc3luYyBnZXRFbmdMaXN0KHBvc2l0aW9uLCByYWRpdXMgPSAzNSkgew0KICAgICAgVG9hc3QubG9hZGluZyh7DQogICAgICAgIG1lc3NhZ2U6ICLojrflj5YyNW3lhoXorr7mlr3mlbDmja4uLi4iDQogICAgICB9KQ0KICAgICAgbGV0IHBpcGVUeXBlOw0KICAgICAgc3dpdGNoIChwb3NpdGlvbi5pbnNwQnVzaW5lc3NUeXBlKSB7DQogICAgICAgIGNhc2UgIldBVEVSX1NVUFBMWSI6DQogICAgICAgICAgcGlwZVR5cGUgPSAi5L6b5rC0566h57q/IjsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiUkFJX1dBVEVSIjoNCiAgICAgICAgICBwaXBlVHlwZSA9ICLpm6jmsLTnrqHnur8iOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJQT0xMVVRFRF9XQVRFUiI6DQogICAgICAgICAgcGlwZVR5cGUgPSAi5rGh5rC0566h57q/IjsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiT1JJR0lOX1dBVEVSIjoNCiAgICAgICAgICBwaXBlVHlwZSA9ICLmupDmsLTnrqHnur8iOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJSSVZFUl9XQVRFUiI6DQogICAgICAgICAgcGlwZVR5cGUgPSAi5o6S5rGf566hIjsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICAgIGNvbnN0IHBhcmFtcyA9IHsNCiAgICAgICAgZ2VvbVBvaW50OiBwb3NpdGlvbi5nZW9tZXRyeSwNCiAgICAgICAgcGlwZVR5cGU6IHBpcGVUeXBlLA0KICAgICAgICByYWRpdXM6IHJhZGl1cywNCiAgICAgICAgdHlwZTogJ+WFqOmDqCcNCiAgICAgIH0NCiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldEFsbFBvaW50T3JMaW5lR2VvbUluc3AocGFyYW1zKTsNCiAgICAgIC8vIGNvbnNvbGUubG9nKCJnZXQgYWxsIFBvaW50IG9yIExpbmUgZ2VvbT09PiIsIHJlcy5kYXRhKTsNCiAgICAgIGlmIChyZXMgJiYgcmVzLnN0YXR1cykgew0KICAgICAgICB0aGlzLmVuZ0xpc3QgPSByZXMuZGF0YS5tYXAoaXRlbSA9PiB7DQogICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIC4uLml0ZW0sDQogICAgICAgICAgICB0ZXh0OiBpdGVtLmRldmljZWlkICsgIiB8ICIgKyAoaXRlbS5waXBldHlwZSB8fCBpdGVtLnR5cGUpLA0KICAgICAgICAgICAgdmFsdWU6IGl0ZW0uZGV2aWNlaWQNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmZpbHRlcmVkTGlzdCA9IHRoaXMuZW5nTGlzdDsNCiAgICAgIH0NCiAgICB9LA0KICAgIGNob29zZUVuZyh2YWx1ZSkgew0KICAgICAgY29uc3QgZGF0YSA9IHZhbHVlPy5kZXRhaWw/LmRhdGE7DQogICAgICBpZiAoIWRhdGEpIHJldHVybjsNCiAgICAgIHRoaXMuZ2V0RW5nUHJvcGVydHlWYWwoZGF0YS5ndWlkKTsNCiAgICAgIGNvbnN0IGdlb20gPSBkYXRhLnN0X2FzZ2VvanNvbiB8fCBkYXRhLmdlb207DQogICAgICBpZiAoIWdlb20pIHJldHVybjsNCiAgICAgIGNvbnN0IGZlYXR1cmUgPSB7DQogICAgICAgIGlkOiBkYXRhLmlkLA0KICAgICAgICBwcm9wZXJ0aWVzOiB7DQogICAgICAgICAgLi4uZGF0YQ0KICAgICAgICB9LA0KICAgICAgICBnZW9tZXRyeTogSlNPTi5wYXJzZShnZW9tKSwNCiAgICAgICAgdHlwZTogJ2ZlYXR1cmUnDQogICAgICB9DQogICAgICB0aGlzLmN1ckZlYXR1cmUgPSBmZWF0dXJlOw0KICAgICAgbWFwT2JqLm1hcC5zZXRMaW5lR2VvU291cmNlKFtmZWF0dXJlXSwgImN1ckluc3BMaW5lU291cmNlIik7DQogICAgfQ0KICB9LA0KICB3YXRjaDogew0KICAgICRyb3V0ZTogew0KICAgICAgaGFuZGxlcih0bywgZnJvbSwgbmV4dCkgew0KICAgICAgICBpZiAoZnJvbS5wYXRoID09PSAiL3ByZXZpZXctaW1hZ2UiKSB7DQogICAgICAgICAgdGhpcy5zaG93VmlzaWJsZSA9IHRydWU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5zaG93VmlzaWJsZSA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9LA0KICAgIH0sDQogIH0sDQogIC8vIOi/lOWbnuWIsOWIl+ihqOmhtemdog0KICBvbkJhY2tQcmVzcyhvcHRpb25zKSB7DQogICAgaWYgKG9wdGlvbnMuZnJvbSA9PT0gJ2JhY2tidXR0b24nKSB7ICANCiAgICAgIERpYWxvZy5jb25maXJtKHsgIA0KICAgICAgICB0aXRsZTogJ+aPkOekuicsICANCiAgICAgICAgbWVzc2FnZTogJ+ehruWumumAgOWHuuS4iuaKpeS6i+S7tuWQl++8nycsICANCiAgICAgIH0pLnRoZW4oKHJlcykgPT4geyAgDQogICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7ICANCiAgICAgICAgICAgIG1hcE9iai5tYXAubWFwSW5zdGFuY2UgJiYgbWFwT2JqLm1hcC5tYXBJbnN0YW5jZS5kZXN0b3J5TWFwKCk7DQogICAgICAgICAgICBtYXBPYmoubWFwLm1hcEluc3RhbmNlID0gbnVsbDsNCiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsNCiAgICAgICAgICAgICAgbmFtZTogJ0luc3BlY3Rpb25NYW5hZ2UnLA0KICAgICAgICAgICAgICBwYXJhbXM6IHsNCiAgICAgICAgICAgICAgICBuYW1lOiAn5omn6KGMJywNCiAgICAgICAgICAgICAgICB0YXNrSWQ6IHRoaXMudGFza0RldGFpbC50YXNrSWQsDQogICAgICAgICAgICAgICAgaW5zcEJ1c2luZXNzVHlwZTogdGhpcy50YXNrRGV0YWlsLmluc3BCdXNpbmVzc1R5cGUsDQogICAgICAgICAgICAgICAgcmVwb3J0RXZlbnQ6IHRydWUNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9ICANCiAgICAgICAgfSkNCiAgICAgIC8vIOemgeatoum7mOiupOi/lOWbniAgDQogICAgICByZXR1cm4gdHJ1ZSAgDQogICAgfQ0KICB9LA0KICBiZWZvcmVEZXN0cm95KCkgew0KICAgIGJ1cy4kb2ZmKCJldmVudE1hcmtlclBvc2l0aW9uIik7DQogIH0NCn0NCg=="},{"version":3,"sources":["add-event.vue"],"names":[],"mappings":";AAyEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"add-event.vue","sourceRoot":"src/views/inspectionManage","sourcesContent":["<!--\r\n * @Description: \r\n * @Author: wei_qx@hdec.com\r\n * @Date: 2021-04-23 08:52:00\r\n * @LastEditor: wei_qx@hdec.com\r\n * @LastEditTime: 2021-09-23 17:04:57\r\n-->\r\n<template>\r\n  <div class=\"popup-container\">\r\n    <fm-popup \r\n      :visible.sync=\"popupShow\"\r\n      position=\"bottom\"\r\n      height=\"100%\"\r\n      width=\"100%\"\r\n      :modal=\"false\"\r\n      :close-on-click-modal=\"false\"\r\n      class=\"popup\"\r\n    >\r\n      <div class=\"head\">\r\n        <i class=\"fm-icon fm-icon-arrow-left\" width=\"24\" height=\"24\" @click=\"onCancel\"></i>\r\n        <text style=\"font-weight: 600;\">{{\"请选位置\"}}</text>\r\n        <text class=\"on-confirm\" @click=\"onConfirm\">确定</text>\r\n      </div>\r\n      <MapComp ref=\"mymap\" :ifInspection=\"true\" :inspBusinessType=\"taskDetail.inspBusinessType\" @mapLoaded=\"mapLoaded\" ></MapComp>\r\n      <fm-list class=\"emergency-pull-bar\" v-if=\"popupShow\">\r\n        <div class=\"content\">\r\n          <fm-search placeholder=\"请输入设备编号\" shape=\"square\" v-model=\"keyword\" :show-action=\"false\" @change=\"filterEngList\"></fm-search>\r\n          <!-- <uni-data-checkbox class=\"checkbox\" mode=\"list\" icon=\"right\" v-model=\"curEng\" :localdata=\"filteredList\" @change=\"chooseEng\"></uni-data-checkbox> -->\r\n          <fm-empty\r\n            v-if=\"!filteredList.length\"\r\n            description=\"暂无数据\"\r\n          />\r\n        </div>\r\n      </fm-list>\r\n    </fm-popup>\r\n    <fm-nav-bar title=\"事件上报\" left-arrow @click-left=\"$router.go(-1)\">\r\n    </fm-nav-bar>\r\n    <fm-list v-if=\"!popupShow\" class=\"scroll\">\r\n      <fm-form :model=\"eventForm\" ref=\"eventForm\" class=\"event-form\">\r\n        <fm-field label=\"事件类型\" label-width=\"4.44rem\" required v-model=\"eventForm.eventType\">\r\n        </fm-field>\r\n        <!-- <fm-picker\r\n          v-model=\"selectEventType\"\r\n          :columns=\"eventTypeListNewFiltered\"\r\n          @confirm=\"eventTypeConfirm\"\r\n          title=\"事件类型\"\r\n          confirm-button-text=\"确定\"\r\n          cancel-button-text=\"返回\"\r\n        ></fm-picker> -->\r\n        <fm-field label=\"现场描述\" v-model=\"eventForm.remark.text\" label-width=\"4.44rem\" />\r\n        <fm-field label=\"初步处理\" v-model=\"eventForm.inspTaskDetailDesc.text\" label-width=\"4.44rem\" />\r\n        <!-- <u-gap height=\"8\" bg-color=\"#F5F7F9\"></u-gap> -->\r\n        <fm-field label=\"多媒体附件\" label-width=\"4.44rem\" label-position=\"top\" required>\r\n          <div>\r\n            <fm-uploader\r\n            />\r\n          </div>\r\n          <fm-field style=\"width: 0.55rem;visibility:hidden;\" v-model=\"eventForm.photoLength\"  placeholder=\"\" disabled />\r\n        </fm-field>\r\n        <!-- <u-gap height=\"8\" bg-color=\"#F5F7F9\"></u-gap> -->\r\n        <div class=\"position\">\r\n          <MapComp style=\"height: 7.77rem;\" ref=\"mymap\" :ifInspection=\"true\" :inspBusinessType=\"taskDetail.inspBusinessType\" ></MapComp>\r\n          <fm-field label=\"位置\" v-model=\"locationName\" label-width=\"3.33rem\" @click-suffix-icon=\"pickPosition\" suffix-icon=\"location-o\">\r\n          </fm-field>\r\n        </div>\r\n      </fm-form>\r\n    </fm-list>\r\n    <div class=\"submit-event\">\r\n      <fm-button style=\"width: 100%;\" type=\"primary\" @click=\"submit\">提交</fm-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport MapComp from \"../inspectMap/index.vue\";\r\n// import SunuiUpimg from '../../components/sunui-upimg/sunui-upimg.vue';\r\nimport bus from \"../../views/inspectMap/utils/Bus.js\";\r\n// import PullupBar from \"@comp/pullup-bar/index2.vue\";\r\n// import UniDataCheckbox from '../../components/uni-data-checkbox/uni-data-checkbox.vue';\r\nimport _ from \"lodash\";\r\nimport axios from \"axios\";\r\nimport url from \"@common/config.js\";\r\nimport * as turf from '@turf/turf'\r\nimport { engPropertyValue, tree, insert, getAllPointOrLineGeomInsp } from './api'\r\nimport { Toast } from 'fawkes-mobile-lib';\r\nconst mapObj = {\r\n  map: null,\r\n  mapInstance: null\r\n}\r\nconst superMapUrl = {\r\n  'POI': {\r\n    url:\r\n      url.gisDomain +\r\n      \"/iserver/services/data-LuWangYuPOI/rest/data/featureResults.rjson?returnContent=true\",\r\n    datasets: [\"POI:POI\"],\r\n  },\r\n  '道路名': {\r\n    url:\r\n      url.gisDomain +\r\n      \"/iserver/services/data-LuWangYuPOI/rest/data/featureResults.rjson?returnContent=true\",\r\n    datasets: [\"POI:余杭区矢量路网\"],\r\n  },\r\n};\r\nexport default {\r\n  name: \"add-event\",\r\n  components: {\r\n    MapComp,\r\n    // SunuiUpimg,\r\n    // PullupBar,\r\n    // UniDataCheckbox\r\n  },\r\n  data() {\r\n    return {\r\n      dictionary: {\r\n        WATER_SUPPLY: '供水',\r\n        RAI_WATER: '雨水',\r\n        POLLUTED_WATER: '污水'\r\n      },\r\n\r\n      locationName: \"位置描述信息\",\r\n      position: [0, 0],\r\n      curEng: null,\r\n      curFeature: null,\r\n      engList: [],\r\n      filteredList: [],\r\n      initTop: \"70%\",\r\n      keyword: \"\",\r\n      userInfo: {},\r\n      feature: {},\r\n      popupShow: false,\r\n      eventForm: {\r\n        eventType: \"\",\r\n        files: [],\r\n        inspTaskDetailDesc: {\r\n          text: \"\",\r\n          voice: {}\r\n        },\r\n        remark: {\r\n          text: \"\",\r\n          voice: {}\r\n        }\r\n      },\r\n      eventTypeList: [],\r\n      rangeList: [],\r\n      taskDetail: {},\r\n      engInfoDTO: null,\r\n      selectEventType: false,\r\n      rules: {\r\n        eventType: [\r\n          {\r\n            required: true,\r\n            message: \"请选择事件类型\"\r\n          }\r\n        ],\r\n        photoLength: [\r\n          {\r\n            required: true,\r\n            message: \"请上传附件\",\r\n            trigger: [\"change\", \"blur\"]\r\n          }\r\n        ]\r\n      },\r\n      previewURL: \"/sys-storage/download_image?f8s=\",\r\n      upimgPreview: [],\r\n      headers: {},\r\n      url: {\r\n        // 本页面使用到的url\r\n        uploadFile: \"sys-storage/upload\",\r\n        // findFile: \"ecidi-cmp/file/cmpFileGroup/findFilesByGroupId\",\r\n      },\r\n      showVisible: false\r\n    }\r\n  },\r\n  computed: {\r\n    eventTypeListNewFiltered() {\r\n      const { dictionary, eventTypeList, taskDetail } = this;\r\n      let temp = eventTypeList.find(item => {\r\n        return item.label === dictionary[taskDetail.inspBusinessType];\r\n      });\r\n      if (temp) {\r\n        return temp.children;\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.headers = {\r\n      // \"Fawkes-Auth\": uni.getStorageSync(\"Fawkes-Auth\"),\r\n    };\r\n  },\r\n  activated() {\r\n    this.setLocationName();\r\n    uni.setStorageSync(\"isReportEvent\", true);\r\n    if (!this.showVisible) {\r\n      this.$nextTick(() => {\r\n        this.refreshReportEvent();\r\n      })\r\n      this.getEventTypeList();\r\n    }\r\n  },\r\n  mounted() {\r\n    this.setLocationName();\r\n    localStorage.setItem(\"isReportEvent\", true);\r\n    this.userInfo = localStorage.getItem(\"userInfo\");\r\n    bus.$on(\"eventMarkerPosition\", (pos) => {\r\n      this.position = pos;\r\n      this.getEngData();\r\n    })\r\n    this.$nextTick(() => {\r\n      this.refreshReportEvent();\r\n    })\r\n    this.getEventTypeList();\r\n  },\r\n  methods: {\r\n    mapLoaded(mapInstance) {\r\n      mapObj.mapInstance = mapInstance\r\n      mapObj.map = mapInstance.map\r\n    },\r\n    // 刷新\r\n    refreshReportEvent() {\r\n      this.position= [0, 0];\r\n      this.curEng= null;\r\n      this.curFeature = null;\r\n      this.engList= [];\r\n      this.filteredList= [];\r\n      this.locationName = \"位置描述信息\";\r\n      this.initTop= \"70%\";\r\n      this.keyword= \"\";\r\n      this.eventForm = {\r\n        eventType: \"\",\r\n        files: [],\r\n        inspTaskDetailDesc: {\r\n          text: \"\",\r\n          voice: {}\r\n        },\r\n        remark: {\r\n          text: \"\",\r\n          voice: {}\r\n        }\r\n      };\r\n      this.upimgPreview = [];\r\n      if (this.$route.query.position) {\r\n        // this.feature = this.$route.query.feature;\r\n        this.rangeList = this.$route.query.rangeList;\r\n        this.taskDetail = this.$route.query.taskDetail;\r\n        this.position = this.$route.query.position;\r\n      }\r\n      mapObj.map.mapOnLoad(() => {\r\n        if (this.position) {\r\n          mapObj.map.addReportEventMarker(this.position);\r\n          mapObj.map.addRangeList(this.rangeList);\r\n          mapObj.map.flyTo({ position: this.position, zoom: 18});\r\n        } \r\n        \r\n      })\r\n      // this.$refs.eventForm.setRules(this.rules);\r\n    },\r\n    // 获取事件类型\r\n    getEventTypeList() {\r\n      tree().then(res => {\r\n        this.eventTypeList = res.data.sons.map(item => {\r\n          return {\r\n            value: item.code,\r\n            label: item.name,\r\n            children: item.sons.map(item => {\r\n              return {\r\n                value: item.code,\r\n                label: item.name,\r\n                children: item.sons.map(item => {\r\n                  return {\r\n                    value: item.code,\r\n                    label: item.name\r\n                  }\r\n                })\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }).catch(() => {\r\n        Toast({\r\n          message: \"字典加载失败\",\r\n        });\r\n      })\r\n    },\r\n    // 获取图片信息\r\n    getImageInfo(val) {\r\n      if (val && val[0].length > 0) {\r\n        this.eventForm.files = val[0];\r\n        let photoList = [];\r\n        val[0].forEach((item, index) => {\r\n          photoList.push(item.fileToken);\r\n        });\r\n        let temp = photoList.length + \"\";\r\n        this.$set(this.eventForm, \"photoLength\", temp);\r\n      } else {\r\n        this.$set(this.eventForm, \"photoLength\", \"\");\r\n      }\r\n    },\r\n    // 事件类型选择确认\r\n    eventTypeConfirm(event) {\r\n      this.$set(this.eventForm, \"eventType\", event[1].label);\r\n      this.$set(this.eventForm, \"inspItemCode\", event[1].value);\r\n    },\r\n    // 选择位置\r\n    pickPosition() {\r\n      // 上传组件回显\r\n      this.upimgPreview = this.eventForm.files.map((item) => {\r\n        return {\r\n          uploadFile: {\r\n            savePath: item.fileToken,\r\n          },\r\n          ...item\r\n        };\r\n      });\r\n      this.popupShow = true;\r\n      this.locationName = \"位置描述信息\";\r\n      this.$nextTick(() => {\r\n        mapObj.map.mapOnLoad(() => {\r\n          mapObj.map.addReportEventMarker(this.position);\r\n          if (this.position) {\r\n            mapObj.map.addRangeList(this.rangeList);\r\n            mapObj.map.flyTo({ position: this.position, zoom: 18});\r\n            setTimeout(() => {\r\n              this.curFeature && mapObj.map.setLineGeoSource([this.curFeature], \"curInspLineSource\");\r\n            }, 1500)\r\n          }\r\n        })\r\n      })\r\n    },\r\n    // 取消选择位置\r\n    onCancel() {\r\n      this.popupShow = false;\r\n      this.$nextTick(() => {\r\n        mapObj.map.mapOnLoad(() => {\r\n          mapObj.map.addReportEventMarker(this.position);\r\n          if (this.position) {\r\n            mapObj.map.addRangeList(this.rangeList);\r\n            mapObj.map.flyTo({ position: this.position, zoom: 18});\r\n            setTimeout(() => {\r\n              this.curFeature && mapObj.map.setLineGeoSource([this.curFeature], \"curInspLineSource\");\r\n            }, 1500)\r\n          }\r\n        })\r\n      })\r\n    },\r\n    // 确认选择位置\r\n    onConfirm() {\r\n      if (!this.position) return;\r\n      this.popupShow = false;\r\n      this.$nextTick(() => {\r\n        mapObj.map.mapOnLoad(() => {\r\n          mapObj.map.addReportEventMarker(this.position);\r\n          if (this.position) {\r\n            mapObj.map.addRangeList(this.rangeList);\r\n            mapObj.map.flyTo({ position: this.position, zoom: 18});\r\n            setTimeout(() => {\r\n              this.curFeature && mapObj.map.setLineGeoSource([this.curFeature], \"curInspLineSource\");\r\n            }, 1500)\r\n          }\r\n          /* 注释高德api调用\r\n          var cordForLoc_start =\r\n            this.position[0].toString() +\r\n            \",\" +\r\n            this.position[1].toString();\r\n          var GaoDeUrl_start =\r\n            \"https://restapi.amap.com/v3/geocode/regeo?location=\" +\r\n            cordForLoc_start +\r\n            \"&key=75046c1d669799e3bec6503efbc94c3e\" +\r\n            \"&radius=50\";\r\n            axios\r\n            .get(GaoDeUrl_start)\r\n            .then((res) => {\r\n              this.locationName = res.data.regeocode.formatted_address.split(\r\n                \"市\"\r\n              )[res.data.regeocode.formatted_address.split(\"市\").length - 1];\r\n            })\r\n            .catch((err) => {\r\n              console.log(\"地理编码报错：\" + err);\r\n            });\r\n            */\r\n        })\r\n      })\r\n    },\r\n    /**\r\n     * 超图坐标转换为feature\r\n     */\r\n    superMapParamsToFeature(geometry) {\r\n      let coord;\r\n      let type;\r\n      switch (geometry.type) {\r\n        case \"POINT\":\r\n          type = \"Point\";\r\n          coord = [geometry.points[0].x, geometry.points[0].y];\r\n          break;\r\n        case \"LINE\":\r\n          type = \"LineString\";\r\n          coord = geometry.points.map((point) => [point.x, point.y]);\r\n          break;\r\n        case \"REGION\":\r\n          type = \"Polygon\";\r\n          coord = [geometry.points.map((point) => [point.x, point.y])];\r\n          break;\r\n      }\r\n      return {\r\n        type: \"Feature\",\r\n        geometry: {\r\n          type,\r\n          coordinates: coord,\r\n        },\r\n      };\r\n    },\r\n    featureToObject(names, values) {\r\n      let obj = {};\r\n      names.forEach((name, index) => {\r\n        obj[name] = values[index];\r\n      });\r\n      return obj;\r\n    },\r\n    // 通过超图查询设置locationName\r\n    async setLocationName(type = \"POI\") {\r\n      if (this.position) {\r\n        // 生成50m缓冲区进行查询\r\n        let geom = turf.buffer(turf.point(this.position), 0.05, {unit: 'kilometers'});\r\n        let geometry = JSON.parse(JSON.stringify(geom.geometry));\r\n        let coordinates = geometry.coordinates[0].map((item) => {\r\n          return {\r\n            x: item[0],\r\n            y: item[1],\r\n          };\r\n        });\r\n        geometry.points = coordinates;\r\n        geometry.type = \"REGION\";\r\n        delete geometry.coordinates;\r\n        let { data } = await axios({\r\n          method: \"post\",\r\n          url: superMapUrl[type].url,\r\n          data: JSON.stringify({\r\n            getFeatureMode: \"SPATIAL_ATTRIBUTEFILTER\",\r\n            datasetNames: superMapUrl[type].datasets,\r\n            attributeFilter: '',\r\n            geometry,\r\n            spatialQueryMode: \"CONTAIN\",\r\n          }),\r\n        });\r\n        if (data.totalCount) {\r\n          let arr = [];\r\n          data.features &&\r\n            data.features.forEach((item) => {\r\n              let properties = this.featureToObject(\r\n                item.fieldNames,\r\n                item.fieldValues\r\n              );\r\n              let coord = this.superMapParamsToFeature(item.geometry);\r\n              arr.push({\r\n                ...properties,\r\n                coord,\r\n              });\r\n            });\r\n          const tempData = arr.map((item) => {\r\n            item.ADRESS = item.ADRESS ? item.ADRESS.replace(\"浙江省\", \"\") : item.NAME.replace(\"浙江省\", \"\");\r\n            item.ADRESS = item.ADRESS ? item.ADRESS.replace(\"杭州市\", \"\") : item.NAME.replace(\"杭州市\", \"\");\r\n            return item;\r\n          });\r\n          if (tempData.length > 0) {\r\n            this.locationName = tempData[0].ADRESS;\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      this.locationName = '';\r\n    },\r\n    // 提交\r\n    submit() {\r\n      this.$refs.eventForm.validate(valid => {\r\n        if (valid) {\r\n          // if (!this.engInfoDTO)  {\r\n          //   uni.showToast({\r\n          //     title: \"数据不存在\",\r\n          //     duration: 3000\r\n          //   });\r\n          //   return;\r\n          // }\r\n          let copyEventForm = this.deepClone(this.eventForm);\r\n          // 上报位置\r\n          // const geom = this.computeCenter(this.feature);\r\n          const geom = {\r\n            type: \"Point\",\r\n            coordinates: this.position\r\n          }\r\n          let uploadFiles = [];\r\n          if (this.eventForm.inspTaskDetailDesc.voice.fileToken) {\r\n            uploadFiles.push(this.eventForm.inspTaskDetailDesc.voice);\r\n          }\r\n          uploadFiles = uploadFiles.concat(this.eventForm.files);\r\n          const preliminaryHandleFile = JSON.stringify(uploadFiles);\r\n          const inspOrg = JSON.parse(this.taskDetail.inspOrg);\r\n          const eventPayload = {\r\n            address: this.locationName,\r\n            conclusion: copyEventForm.eventType,\r\n            eventDescribe: this.eventForm.remark.text,\r\n            eventSource: \"inspection_event_source_inspection\",\r\n            eventType: copyEventForm.inspItemCode,\r\n            inspBusinessType: this.taskDetail.inspBusinessType,\r\n            officeId: this.taskDetail.inspOrgId,\r\n            office: inspOrg.office,\r\n            company: inspOrg.company,\r\n            companyId: inspOrg.companyId,\r\n            preliminaryHandle: this.eventForm.inspTaskDetailDesc.text,\r\n            preliminaryHandleFile: preliminaryHandleFile,\r\n            eventDescribeFile:  this.eventForm.remark.voice.fileToken ? JSON.stringify(this.eventForm.remark.voice) : \"\",\r\n            // 保存上报事件位置\r\n            regionItemText: JSON.stringify(geom),\r\n            // regionItemText: this.engInfoDTO.infoDTO.engGeom,\r\n            taskId: this.taskDetail.taskId,\r\n            // \r\n            engId: this.engInfoDTO ? this.engInfoDTO.engId : undefined,\r\n            eventItemText: JSON.stringify(geom),\r\n            // eventItemText: this.engInfoDTO.infoDTO.engGeom,\r\n\r\n            lng: geom.coordinates[0],\r\n            lat: geom.coordinates[1],\r\n            reporterId: this.userInfo.id,\r\n            reporterName: this.userInfo.userFullname\r\n          }\r\n          insert(eventPayload).then(res => {\r\n            if (res.status) {\r\n              Toast({\r\n                message: \"上报事件成功\",\r\n                duration: 3000\r\n              });\r\n              this.$router.go(-1);\r\n            }\r\n          })\r\n        }\r\n      })\r\n    },\r\n    // 深拷贝\r\n    deepClone(data) {\r\n      return JSON.parse(JSON.stringify(data));\r\n    },\r\n    // 计算中心点\r\n    computeCenter(feature) {\r\n      let position;\r\n      if (feature.geometry.type === 'Polygon' || feature.geometry.type === 'MultiPolygon') {\r\n        const center = turf.center(feature.geometry);\r\n        position = center.geometry;\r\n      } else if (feature.geometry.type === 'LineString') {\r\n        const center = turf.center(feature.geometry);\r\n        position = center.geometry;\r\n      } else if (feature.geometry.type === 'Point') {\r\n        position = feature.geometry;\r\n      }\r\n      return position;\r\n    },\r\n    // 根据关键字查询\r\n    async getEngPropertyVal(guid) {\r\n      const params = {\r\n        value: guid\r\n      }\r\n      const res = await engPropertyValue(params);\r\n      if (res.status) {\r\n        this.engInfoDTO = res.data;\r\n      } else {\r\n        this.engInfoDTO = null;\r\n      }\r\n    },\r\n    getEngData: _.debounce(function() {\r\n      const params = {\r\n        inspBusinessType: this.taskDetail.inspBusinessType,\r\n        geometry: {\r\n          type: \"Point\",\r\n          coordinates: this.position\r\n        }\r\n      }\r\n      this.setLocationName();\r\n      this.getEngList(params);\r\n    }, 500),\r\n    filterEngList(keyword) {\r\n      if (keyword) {\r\n        this.filteredList = this.engList.filter(item => item.deviceid.search(keyword) != -1);\r\n      } else {\r\n        this.filteredList = this.engList;\r\n      }\r\n    },\r\n    // 返回radius为半径范围的工程对象数据\r\n    async getEngList(position, radius = 35) {\r\n      Toast.loading({\r\n        message: \"获取25m内设施数据...\"\r\n      })\r\n      let pipeType;\r\n      switch (position.inspBusinessType) {\r\n        case \"WATER_SUPPLY\":\r\n          pipeType = \"供水管线\";\r\n          break;\r\n        case \"RAI_WATER\":\r\n          pipeType = \"雨水管线\";\r\n          break;\r\n        case \"POLLUTED_WATER\":\r\n          pipeType = \"污水管线\";\r\n          break;\r\n        case \"ORIGIN_WATER\":\r\n          pipeType = \"源水管线\";\r\n          break;\r\n        case \"RIVER_WATER\":\r\n          pipeType = \"排江管\";\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n      const params = {\r\n        geomPoint: position.geometry,\r\n        pipeType: pipeType,\r\n        radius: radius,\r\n        type: '全部'\r\n      }\r\n      const res = await getAllPointOrLineGeomInsp(params);\r\n      // console.log(\"get all Point or Line geom==>\", res.data);\r\n      if (res && res.status) {\r\n        this.engList = res.data.map(item => {\r\n          return {\r\n            ...item,\r\n            text: item.deviceid + \" | \" + (item.pipetype || item.type),\r\n            value: item.deviceid\r\n          }\r\n        });\r\n        this.filteredList = this.engList;\r\n      }\r\n    },\r\n    chooseEng(value) {\r\n      const data = value?.detail?.data;\r\n      if (!data) return;\r\n      this.getEngPropertyVal(data.guid);\r\n      const geom = data.st_asgeojson || data.geom;\r\n      if (!geom) return;\r\n      const feature = {\r\n        id: data.id,\r\n        properties: {\r\n          ...data\r\n        },\r\n        geometry: JSON.parse(geom),\r\n        type: 'feature'\r\n      }\r\n      this.curFeature = feature;\r\n      mapObj.map.setLineGeoSource([feature], \"curInspLineSource\");\r\n    }\r\n  },\r\n  watch: {\r\n    $route: {\r\n      handler(to, from, next) {\r\n        if (from.path === \"/preview-image\") {\r\n          this.showVisible = true;\r\n        } else {\r\n          this.showVisible = false;\r\n        }\r\n      },\r\n    },\r\n  },\r\n  // 返回到列表页面\r\n  onBackPress(options) {\r\n    if (options.from === 'backbutton') {  \r\n      Dialog.confirm({  \r\n        title: '提示',  \r\n        message: '确定退出上报事件吗？',  \r\n      }).then((res) => {  \r\n          if (res.confirm) {  \r\n            mapObj.map.mapInstance && mapObj.map.mapInstance.destoryMap();\r\n            mapObj.map.mapInstance = null;\r\n            this.$router.push({\r\n              name: 'InspectionManage',\r\n              params: {\r\n                name: '执行',\r\n                taskId: this.taskDetail.taskId,\r\n                inspBusinessType: this.taskDetail.inspBusinessType,\r\n                reportEvent: true\r\n              }\r\n            })\r\n          }  \r\n        })\r\n      // 禁止默认返回  \r\n      return true  \r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    bus.$off(\"eventMarkerPosition\");\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.popup-container {\r\n  width: 100%;\r\n  .popup {\r\n    .head {\r\n      padding: 0.55rem 0.55rem;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      font-size: 1rem;\r\n      font-weight: 400;\r\n      color: #333333;\r\n      .on-confirm {\r\n        color: #2a83e6;\r\n      }\r\n    }\r\n  }\r\n\r\n  .scroll {\r\n    height: 33.34rem;\r\n    .event-form {\r\n      margin: 0.44rem;\r\n      .position {\r\n        width: 100%;\r\n        height: 4.44rem;\r\n      }\r\n    }\r\n  }\r\n  .submit-event {\r\n    width: 90%;\r\n    background-color: #fff;\r\n    z-index: 3;\r\n    left: 5%;\r\n    bottom: 0.3rem;\r\n    position: fixed;\r\n  }\r\n  .emergency-pull-bar {\r\n    .content {\r\n      background-color: #ffffff;\r\n      margin: 0.55rem 0.55rem;\r\n      .checkbox {\r\n        margin: 0.27rem 0.55rem;\r\n        height: 17.77rem;\r\n        overflow-y: scroll;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>"]}]}