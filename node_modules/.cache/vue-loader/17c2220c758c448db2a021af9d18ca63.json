{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\index.vue?vue&type=style&index=0&id=e887af0e&scoped=true&lang=less","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\index.vue","mtime":1708928163417},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouaW5zcGVjdGlvbiB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgaGVpZ2h0OiAxMDAlOw0KICBiYWNrZ3JvdW5kOiAjZjVmN2Y5Ow0KDQogIC5pbnNwZWN0aW9uLXJpZ2h0IHsNCiAgICB3aWR0aDogNDhweDsNCiAgICBoZWlnaHQ6IDQ4cHg7DQogIH0NCg0KICAuYm94LXRpbWUtaW1nLXRpbWUgew0KICAgIHdpZHRoOiAzMnB4Ow0KICAgIGhlaWdodDogMzJweDsNCiAgfQ0KDQogIC5pbnNwZWN0aW9uLW1vZGVsIHsNCiAgICBvdmVyZmxvdzogc2Nyb2xsOw0KICAgIGhlaWdodDogY2FsYygxMDAlIC0gNDIwcHgpOw0KICB9DQp9DQoNCi5pbnNwZWN0aW9uLXRhYnMgew0KICBkaXNwbGF5OiBmbGV4Ow0KICBmb250LXNpemU6IDMycHg7DQogIGZvbnQtd2VpZ2h0OiA2MDA7DQoNCiAgLmluc3BlY3Rpb24tdGFicy1pdGVtIHsNCiAgICBmbGV4OiAxOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgY29sb3I6ICMwMDA7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KICB9DQoNCiAgLmFjdGl2ZSB7DQogICAgY29sb3I6ICNmZmY7DQogICAgYmFja2dyb3VuZC1jb2xvcjogIzFiNjdkODsNCiAgfQ0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAoNA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/PumpStationInspection","sourcesContent":["<template>\r\n  <div class=\"inspection\">\r\n    <fm-nav-bar :title=\"title\" left-arrow @click-left=\"goToInspectionManage()\">\r\n      <template #right>\r\n        <img\r\n          src=\"@/assets/img/pump/inspection-icon-nfc.png\"\r\n          class=\"inspection-right\"\r\n          alt=\"\"\r\n          @click=\"handMovementNFC()\"\r\n        />\r\n      </template>\r\n    </fm-nav-bar>\r\n\r\n    <!-- 状态栏 -->\r\n    <inspection-status\r\n      :PatrolData=\"PatrolData\"\r\n      @hiddenDangerClick=\"hiddenDangerShow\"\r\n      @setShowType=\"\r\n        (showType) => {\r\n          this.statusContentShow = showType\r\n        }\r\n      \"\r\n    />\r\n    <!-- 巡检状态详情信息 -->\r\n    <status-content :PatrolData=\"PatrolData\" :show=\"statusContentShow\" />\r\n\r\n    <div class=\"inspection-tabs\" v-if=\"modelType === 'list'\">\r\n      <div class=\"inspection-tabs-item\" :class=\"{ active: activeIndex === 1 }\" @click=\"activeIndex = 1\">未巡检</div>\r\n      <div class=\"inspection-tabs-item\" :class=\"{ active: activeIndex === 2 }\" @click=\"activeIndex = 2\">已巡检</div>\r\n    </div>\r\n    <div class=\"inspection-model\">\r\n      <!-- 地图模块 -->\r\n      <InspectionMap :PatrolData=\"PatrolData\" v-if=\"modelType === 'map'\" />\r\n\r\n      <!-- 巡检点列表 -->\r\n      <InspectionList\r\n        ref=\"inspectionList\"\r\n        v-if=\"modelType === 'list'\"\r\n        :disabled=\"disabled\"\r\n        :patrolStatus=\"PatrolData && PatrolData.patrolStatus\"\r\n        :patrolPointResultList=\"patrolPointResultList\"\r\n        :activeIndex='activeIndex'\r\n        @hiddenDangerClick=\"hiddenDangerShow\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 底部按钮栏 -->\r\n    <inspection-submit\r\n      ref=\"inspectionSubmit\"\r\n      :PatrolData=\"PatrolData\"\r\n      :modelType=\"modelType\"\r\n      @isDisabled=\"isDisabled\"\r\n      @modelTypeChange=\"\r\n        (newModelType) => {\r\n          modelType = newModelType\r\n        }\r\n      \"\r\n    />\r\n\r\n    <!-- 异常隐患列表弹框 -->\r\n    <inspection-hidden-popup ref=\"inspectionHiddenPopup\" :hiddenDangerList=\"hiddenDangerList\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport InspectionStatus from './components/InspectionStatus.vue'\r\nimport StatusContent from './components/StatusContent'\r\nimport InspectionSubmit from './components/InspectionSubmit.vue'\r\nimport InspectionList from './components/InspectionList.vue'\r\nimport InspectionMap from './components/InspectionMap.vue'\r\nimport InspectionHiddenPopup from './components/InspectionHiddenPopup.vue'\r\n\r\nimport { patrol, getToken, ticketList } from './api'\r\nexport default {\r\n  components: {\r\n    InspectionStatus,\r\n    StatusContent,\r\n    InspectionSubmit,\r\n    InspectionList,\r\n    InspectionMap,\r\n    InspectionHiddenPopup,\r\n  },\r\n  data() {\r\n    return {\r\n      title: '',\r\n      PatrolData: {},\r\n      patrolPointResultList: [],\r\n      disabled: true, //请先点击开始或继续按钮\r\n\r\n      statusContentShow: false,\r\n\r\n      createWorkUrl: '',\r\n\r\n      hiddenDangerList: [],\r\n      modelType: 'list', //list列表，map地图\r\n\r\n      trackDTOS: [], //巡检图标\r\n\r\n      // 当前巡检员所处位置\r\n      currentPosition: null,\r\n\r\n      activeIndex: 1,\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getPatrol()\r\n  },\r\n  mounted() {},\r\n  beforeDestroy() {\r\n    this.savePatrolData()\r\n  },\r\n\r\n  //进入守卫:通过路由规则,进入该组件时被调用\r\n  // async beforeRouteLeave(to, from, next) {\r\n  //   if (to.path === '/pump/inspectionManage') {\r\n  //     await this.$refs.inspectionSubmit.isUnsubmitted()\r\n  //     next()\r\n  //   } else {\r\n  //     next() //放行\r\n  //   }\r\n  // },\r\n\r\n  methods: {\r\n    //返回巡检管理页面\r\n    goToInspectionManage() {\r\n      this.$router.push('/pump/inspectionManage')\r\n    },\r\n\r\n    //获取工单详情\r\n    async createWork(data, type) {\r\n      console.log(data, type)\r\n      let workOrderIdList = []\r\n      //单个巡检点工单\r\n      if (type === 'item') {\r\n        data?.patrolItemsResultList?.forEach((item) => {\r\n          item.workOrderId && workOrderIdList.push(item.workOrderId)\r\n        })\r\n      } else {\r\n        //所有巡检点工单\r\n        data?.patrolPointResultList?.forEach((item) => {\r\n          item?.patrolItemsResultList?.forEach((data) => {\r\n            data.workOrderId && workOrderIdList.push(data.workOrderId)\r\n          })\r\n        })\r\n      }\r\n\r\n      const { accessToken } = await getToken(this.$storage.get('access_token'))\r\n\r\n      const { resultData } = await ticketList(accessToken, workOrderIdList)\r\n      this.hiddenDangerList = resultData\r\n    },\r\n\r\n    //是否禁止进入巡检项\r\n    isDisabled(config) {\r\n      this.disabled = config\r\n    },\r\n\r\n    //获取用户巡检点\r\n    async getPatrol() {\r\n      let { taskId } = this.$store.state.pump.urlQuery\r\n\r\n      let PatrolData\r\n      try {\r\n        const { data } = await patrol(taskId)\r\n        PatrolData = data\r\n      } catch (error) {\r\n        PatrolData = JSON.parse(this.$storage.get('PatrolData'))\r\n      }\r\n\r\n      let { patrolRouteName, patrolPointResultList } = PatrolData\r\n\r\n      this.PatrolData = PatrolData\r\n      this.patrolPointResultList = patrolPointResultList\r\n      this.title = patrolRouteName\r\n\r\n      this.isUnsubmitted()\r\n    },\r\n\r\n    //保存巡检详情信息\r\n    savePatrolData() {\r\n      this.$storage.set('PatrolData', JSON.stringify(this.PatrolData))\r\n    },\r\n\r\n    //弹出刷卡界面\r\n    handMovementNFC() {\r\n      if (this.disabled) return\r\n      this.$refs.inspectionList.handMovementNFC()\r\n    },\r\n\r\n    //检查是否有未提交项\r\n    isUnsubmitted() {\r\n      let storageItemDataList = JSON.parse(this.$storage.get('pump-storageItemDataList'))\r\n      this.patrolPointResultList?.forEach((item, index) => {\r\n        storageItemDataList?.forEach((data) => {\r\n          item.id === data.id ? (this.patrolPointResultList[index].isUnsubmitted = true) : null\r\n        })\r\n      })\r\n    },\r\n\r\n    //隐患上报列表显示\r\n    async hiddenDangerShow(item, type) {\r\n      await this.createWork(item, type)\r\n\r\n      if (this.hiddenDangerList.length === 0) return\r\n      this.$refs.inspectionHiddenPopup.show()\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.inspection {\r\n  position: relative;\r\n  height: 100%;\r\n  background: #f5f7f9;\r\n\r\n  .inspection-right {\r\n    width: 48px;\r\n    height: 48px;\r\n  }\r\n\r\n  .box-time-img-time {\r\n    width: 32px;\r\n    height: 32px;\r\n  }\r\n\r\n  .inspection-model {\r\n    overflow: scroll;\r\n    height: calc(100% - 420px);\r\n  }\r\n}\r\n\r\n.inspection-tabs {\r\n  display: flex;\r\n  font-size: 32px;\r\n  font-weight: 600;\r\n\r\n  .inspection-tabs-item {\r\n    flex: 1;\r\n    display: flex;\r\n    justify-content: center;\r\n    color: #000;\r\n    align-items: center;\r\n    padding: 10px;\r\n  }\r\n\r\n  .active {\r\n    color: #fff;\r\n    background-color: #1b67d8;\r\n  }\r\n}\r\n</style>\r\n"]}]}