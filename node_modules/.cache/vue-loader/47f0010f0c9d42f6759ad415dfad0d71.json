{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\InspectionItem.vue?vue&type=style&index=0&id=87fb6bf2&scoped=true&lang=less","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\InspectionItem.vue","mtime":1705912915815},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouaW5zcGVjdGlvbi1pdGVtcyB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgaGVpZ2h0OiAxMDAlOw0KDQogIGJhY2tncm91bmQ6ICNmNWY3Zjk7DQoNCiAgLmluc3BlY3Rpb24taXRlbS1hcmVhIHsNCiAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgaGVpZ2h0OiA0NDBweDsNCg0KICAgIC5hcmVhLWNvbnRlbnQgew0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICBib3R0b206IDBweDsNCiAgICAgIHdpZHRoOiBjYWxjKDEwMCUgLSA2MHB4KTsNCiAgICAgIGhlaWdodDogNTBweDsNCiAgICAgIGZvbnQtc2l6ZTogMjhweDsNCiAgICAgIGNvbG9yOiAjZmZmOw0KICAgICAgcGFkZGluZzogMCAzMHB4Ow0KICAgICAgei1pbmRleDogMTsNCiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMC4zKTsNCg0KICAgICAgLmFyZWEgew0KICAgICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgICAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICAgIH0NCg0KICAgICAgLmFyZWEtY29udGVudC1pY29uIHsNCiAgICAgICAgd2lkdGg6IDMycHg7DQogICAgICAgIGhlaWdodDogMzJweDsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAubWFyay1pY29uIHsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHdpZHRoOiAzMnB4Ow0KICAgICAgaGVpZ2h0OiAzMnB4Ow0KICAgIH0NCiAgfQ0KDQogIC5pbnNwZWN0aW9uLWl0ZW1zLWNvbnRlbnQgew0KICAgIGhlaWdodDogNjAlOw0KICAgIG92ZXJmbG93OiBzY3JvbGw7DQogIH0NCg0KICAuaW5zcGVjdGlvbi1pdGVtLXVwbG9hZCB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGJhY2tncm91bmQ6ICNmZmZmZmY7DQogICAgYm94LXNoYWRvdzogMHB4IDRweCAxNnB4IDBweCByZ2JhKDEwNCwgMTE1LCAxMjcsIDAuMDYpOw0KICAgIGJvcmRlci1yYWRpdXM6IDE2cHg7DQogICAgcGFkZGluZzogMzBweDsNCiAgICBtYXJnaW46IDMwcHggMzBweCAyMHB4Ow0KICB9DQoNCiAgLmluc3BlY3Rpb24taXRlbSB7DQogICAgbWFyZ2luOiAwIDMwcHggMjBweDsNCiAgICBwYWRkaW5nOiAzMHB4Ow0KICAgIGJhY2tncm91bmQ6ICNmZmZmZmY7DQogICAgYm94LXNoYWRvdzogMHB4IDRweCAxNnB4IDBweCByZ2JhKDEwNCwgMTE1LCAxMjcsIDAuMDYpOw0KICAgIGJvcmRlci1yYWRpdXM6IDE2cHg7DQogICAgZm9udC1zaXplOiAzMnB4Ow0KDQogICAgLmluc3BlY3Rpb24taXRlbS1pbnB1dCB7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICB9DQoNCiAgICAuaW5zcGVjdGlvbi1idG4tcm93IHsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KDQogICAgICAuaW5zcGVjdGlvbi1pdGVtLWlucHV0LWxpbWl0IHsNCiAgICAgICAgY29sb3I6ICNmZjRkNGY7DQogICAgICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgICB9DQogICAgfQ0KDQogICAgLmluc3BlY3Rpb24tZGlzcGFseS1yb3cgew0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICBtYXJnaW4tdG9wOiAyMHB4Ow0KICAgICAgZm9udC1zaXplOiAyOHB4Ow0KICAgICAgY29sb3I6ICMxYjY3ZDg7DQogICAgfQ0KDQogICAgLmluc3BlY3Rpb24tYnRuIHsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIHdpZHRoOiAxNjhweDsNCiAgICAgIGhlaWdodDogNjRweDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDM4cHg7DQogICAgICBmb250LXNpemU6IDI2cHg7DQogICAgICBtYXJnaW4tdG9wOiAzMHB4Ow0KICAgIH0NCg0KICAgIC5pdGVtLWNvbnRlbnQgew0KICAgICAgZmxleDogNDsNCiAgICB9DQogIH0NCg0KICAuaW5zcGVjdGlvbi1zdWJtaXQgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogMTEycHg7DQogICAgcG9zaXRpb246IGZpeGVkOw0KICAgIGJvdHRvbTogMDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjsNCiAgICBwYWRkaW5nOiAxMHB4IDA7DQoNCiAgICAuaW5zcGVjdGlvbi1idG4gew0KICAgICAgd2lkdGg6IGNhbGMoMTAwJSAtIDYwcHgpOw0KICAgICAgaGVpZ2h0OiA4OHB4Ow0KICAgICAgYm9yZGVyLXJhZGl1czogNDRweDsNCiAgICB9DQogIH0NCg0KICAubm9BbGFybUNsYXNzIHsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgZm9udC1zaXplOiAyOHB4Ow0KICAgIHBhZGRpbmc6IDEwcHggNDBweDsNCiAgfQ0KDQogIC56b29tSW1nQm94IHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDEwMCU7DQogIH0NCn0NCg=="},{"version":3,"sources":["InspectionItem.vue"],"names":[],"mappings":";AAijBA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"InspectionItem.vue","sourceRoot":"src/views/PumpStationInspection/components","sourcesContent":["<template>\r\n  <div class=\"inspection-items\">\r\n    <fm-nav-bar\r\n      :title=\"itemData && itemData.patrolPointName\"\r\n      fixed\r\n      placeholder\r\n      left-arrow\r\n      @click-left=\"goToInspection()\"\r\n    />\r\n    <div class=\"inspection-item-area\">\r\n      <div class=\"area-content\">\r\n        <div class=\"area\">\r\n          <span>所属区域：</span>\r\n          <span>{{ itemData && itemData.areaLocation }}</span>\r\n          <span style=\"margin: 0 10px\">|</span>\r\n          <span>关联设备：</span>\r\n          <span>{{ itemData && itemData.deviceName }}</span>\r\n        </div>\r\n        <img\r\n          src=\"@/assets/img/pump/inspection-amplifier.png\"\r\n          class=\"area-content-icon\"\r\n          @click=\"imgShow = true\"\r\n          alt=\"\"\r\n        />\r\n      </div>\r\n\r\n      <fm-image width=\"100%\" height=\"100%\" :src=\"imgUrl\" />\r\n      <fm-image\r\n        class=\"mark-icon\"\r\n        :style=\"{\r\n          top: `calc(${itemData && itemData.topPixel} - 0.56rem )`,\r\n          left: `calc(${itemData && itemData.leftPixel} - 0.42667rem)`,\r\n        }\"\r\n        v-if=\"imgUrl\"\r\n        :src=\"require('@/assets/img/pump/inspection-mark-icon.png')\"\r\n      />\r\n\r\n      <fm-popup\r\n        :visible.sync=\"imgShow\"\r\n        :style=\"{ width: '100%', height: '30%', overflow: 'hidden' }\"\r\n      >\r\n        <div class=\"zoomImgBox\">\r\n          <fm-image width=\"100%\" height=\"100%\" :src=\"imgUrl\" class=\"zoomImg\" />\r\n          <fm-image\r\n            class=\"mark-icon\"\r\n            :style=\"{\r\n              top: `calc(${itemData && itemData.topPixel} - 0.56rem )`,\r\n              left: `calc(${itemData && itemData.leftPixel} - 0.42667rem)`,\r\n            }\"\r\n            v-if=\"imgUrl\"\r\n            :src=\"require('@/assets/img/pump/inspection-mark-icon.png')\"\r\n          />\r\n        </div>\r\n      </fm-popup>\r\n    </div>\r\n\r\n    <div class=\"inspection-items-content\">\r\n      <div class=\"inspection-item-upload\">\r\n        <Uploader\r\n          v-model=\"fileValue\"\r\n          class=\"img-upload\"\r\n          @fileChange=\"fileChange\"\r\n          :limit=\"6\"\r\n          :maxImagesCount=\"6\"\r\n          multiple\r\n          label=\"\"\r\n          type=\"image\"\r\n          :disabled=\"allData.patrolStatus === 3\"\r\n          :deletable=\"allData.patrolStatus !== 3\"\r\n        />\r\n      </div>\r\n\r\n      <div v-for=\"(item, index) in patrolItemsResultList\" :key=\"item.id\">\r\n        <div class=\"inspection-item\" v-if=\"item.inputType === '1'\">\r\n          <div class=\"inspection-item-input\">\r\n            <div class=\"item-content\">{{ item.patrolItemName }}</div>\r\n            <fm-switch\r\n              :disabled=\"allData.patrolStatus === 3\"\r\n              v-model=\"patrolItemsResultList[index].patrolItemValue\"\r\n              active-color=\"#40BB5A\"\r\n              inactive-color=\"#FF4D4F\"\r\n              class=\"item-switch\"\r\n              @change=\"switchChange(index)\"\r\n            />\r\n          </div>\r\n\r\n          <div\r\n            class=\"inspection-btn-row\"\r\n            v-if=\"\r\n              !patrolItemsResultList[index].patrolItemValue &&\r\n              !item.reportTime &&\r\n              allData.patrolStatus !== 3\r\n            \"\r\n          >\r\n            <fm-button type=\"danger\" class=\"inspection-btn\" @click=\"createWork(item.id, index)\"\r\n              >异常上报</fm-button\r\n            >\r\n          </div>\r\n\r\n          <div\r\n            class=\"inspection-dispaly-row\"\r\n            style=\"justify-content: flex-end\"\r\n            v-if=\"!patrolItemsResultList[index].patrolItemValue && item.reportTime\"\r\n          >\r\n            <span @click=\"workerDetails(index)\">上报时间:2021/01/23 08:00:00</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"inspection-item\" v-if=\"item.inputType === '2'\">\r\n          <div class=\"inspection-item-input\">\r\n            <span>{{ item.patrolItemName }}</span>\r\n            <fm-field\r\n              v-model=\"patrolItemsResultList[index].patrolItemValue\"\r\n              :disabled=\"!!item.reportTime || allData.patrolStatus === 3\"\r\n              placeholder=\"请输入值\"\r\n            >\r\n              <template #button>\r\n                <i\r\n                  class=\"fm-icon fm-icon-close\"\r\n                  v-if=\"allData.patrolStatus !== 3\"\r\n                  @click=\"valueChange(index)\"\r\n                ></i>\r\n              </template>\r\n            </fm-field>\r\n          </div>\r\n          <div\r\n            class=\"inspection-btn-row\"\r\n            v-if=\"\r\n              configRangeValue(\r\n                patrolItemsResultList[index].patrolItemValue,\r\n                item.upperLimitValue * 1,\r\n                item.lowerLimitValue * 1\r\n              ) &&\r\n              !item.reportTime &&\r\n              allData.patrolStatus !== 3\r\n            \"\r\n          >\r\n            <fm-button type=\"danger\" class=\"inspection-btn\" @click=\"createWork(item.id, index)\"\r\n              >异常上报</fm-button\r\n            >\r\n            <div class=\"inspection-item-input-limit\">\r\n              上下限值：{{ item.lowerLimitValue }}~{{ item.upperLimitValue }}\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            class=\"inspection-dispaly-row\"\r\n            v-if=\"\r\n              configRangeValue(\r\n                patrolItemsResultList[index].patrolItemValue,\r\n                item.upperLimitValue * 1,\r\n                item.lowerLimitValue * 1\r\n              ) && item.reportTime\r\n            \"\r\n          >\r\n            <span style=\"color: #ff4d4f\"\r\n              >上下限值：{{ item.lowerLimitValue }}~{{ item.upperLimitValue }}</span\r\n            >\r\n            <span @click=\"workerDetails(index)\">上报时间:2021/01/23 08:00:00</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <fm-dialog\r\n      :visible.sync=\"noAlarmShow\"\r\n      title=\"巡检点记录提交确认\"\r\n      show-cancel-button\r\n      @confirm=\"confirmSubmit\"\r\n    >\r\n      <div v-if=\"noAlarm() > 0\" class=\"noAlarmClass\">\r\n        <div>\r\n          该巡检点存在\r\n          <span style=\"color: #ff4d4f\">{{ noAlarm() }}</span> 条未上报异常项，请上报！\r\n        </div>\r\n      </div>\r\n      <div v-if=\"noAlarm() === 0\" class=\"noAlarmClass\">是否进行提交！</div>\r\n    </fm-dialog>\r\n\r\n    <div class=\"inspection-submit\" v-if=\"allData.patrolStatus !== 3\">\r\n      <fm-button type=\"primary\" class=\"inspection-btn\" @click=\"submit()\">完成提交</fm-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Uploader from './Uploader.vue'\r\nimport { getToken, closeTicket, patrol, patrolEdit, patrolItemsResult } from '../api'\r\nexport default {\r\n  name: 'InspectionItem',\r\n  components: { Uploader },\r\n  data() {\r\n    return {\r\n      fileValue: '',\r\n      fileList: [],\r\n      picUrl: '',\r\n      checked: false,\r\n      value: '',\r\n      imgShow: false,\r\n      noAlarmShow: false,\r\n      itemData: null,\r\n      patrolItemsResultList: [],\r\n      imgUrl: '',\r\n      allData: '',\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getPatrol()\r\n    this.requestSingleLocation()\r\n  },\r\n  mounted() {},\r\n  beforeDestroy() {\r\n    this.stopRequestLocations()\r\n  },\r\n\r\n  methods: {\r\n    //文件大小\r\n    onOversize(file) {\r\n      console.log(file)\r\n      this.$notify({ type: 'error', message: '文件大小不能超过 6MB', duration: '1000' })\r\n    },\r\n\r\n    //范围值判断\r\n    configRangeValue(value, upperLimitValue, lowerLimitValue) {\r\n      if (!value) return\r\n      return upperLimitValue < value || lowerLimitValue > value\r\n    },\r\n\r\n    //获取用户巡检点\r\n    async getPatrol() {\r\n      let { taskId, index } = this.$route.query\r\n\r\n      let PatrolData\r\n      try {\r\n        const { data } = await patrol(taskId)\r\n        PatrolData = data\r\n      } catch (error) {\r\n        PatrolData = JSON.parse(this.$storage.get('PatrolData'))\r\n      }\r\n\r\n      this.allData = PatrolData\r\n      this.itemData = PatrolData.patrolPointResultList[index]\r\n\r\n      this.isUnsubmitted()\r\n    },\r\n\r\n    //开始巡检\r\n    requestSingleLocation() {\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.requestSingleLocation(\r\n          ['1'],\r\n          (res) => {\r\n            let { latitude, longitude } = res\r\n            let path = JSON.parse(JSON.stringify(this.$store.state.pump.pumpPath))\r\n            path.push({\r\n              lat: latitude,\r\n              lon: longitude,\r\n            })\r\n            this.$store.commit('setPumpPath', path)\r\n\r\n            console.log(this.$store.state.pump.pumpPath)\r\n          },\r\n          (err) => {\r\n            console.log('err=', err)\r\n          }\r\n        )\r\n      }\r\n    },\r\n\r\n    //结束巡检\r\n    stopRequestLocations() {\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.stopRequestLocations()\r\n      }\r\n    },\r\n\r\n    //检查是否有未提交项\r\n    isUnsubmitted() {\r\n      let itemData = JSON.parse(JSON.stringify(this.itemData))\r\n      let storageItemDataList = JSON.parse(this.$storage.get('pump-storageItemDataList'))\r\n      storageItemDataList?.forEach((item, i) => {\r\n        item.id === this.itemData.id\r\n          ? (this.itemData = Object.assign(itemData, storageItemDataList[i]))\r\n          : null\r\n      })\r\n\r\n      this.workDataShow(this.allData)\r\n    },\r\n\r\n    //异常上报后回显\r\n    workDataShow(data) {\r\n      let { index } = this.$route.query\r\n      let itemData = data.patrolPointResultList[index]\r\n\r\n      itemData &&\r\n        itemData.patrolItemsResultList?.forEach((item, index) => {\r\n          console.log(item)\r\n          if (item.workOrderId) {\r\n            console.log(item.workOrderId)\r\n            this.itemData.patrolItemsResultList[index].workOrderId = item.workOrderId\r\n            this.itemData.patrolItemsResultList[index].reportTime = item.reportTime\r\n          }\r\n        })\r\n\r\n      this.getInfoData()\r\n    },\r\n\r\n    //异常返回正常,确认后清除异常上报事件\r\n    switchChange(index) {\r\n      let config =\r\n        this.patrolItemsResultList[index].patrolItemValue &&\r\n        this.patrolItemsResultList[index].workOrderId\r\n\r\n      config &&\r\n        this.$dialog\r\n          .confirm({\r\n            title: '是否取消异常上报事件',\r\n          })\r\n          .then(async () => {\r\n            let { workOrderId } = this.patrolItemsResultList[index]\r\n            await this.setCloseTicket(workOrderId)\r\n            this.workerPush(this.patrolItemsResultList[index].id, null, null, index)\r\n          })\r\n          .catch(() => {\r\n            this.patrolItemsResultList[index].patrolItemValue = false\r\n          })\r\n    },\r\n\r\n    //异常返回正常,确认后清除异常上报事件\r\n    valueChange(index) {\r\n      //如果没有工单,数据清空,然后退出\r\n      if (!this.patrolItemsResultList[index].workOrderId) {\r\n        this.patrolItemsResultList[index].patrolItemValue = ''\r\n        return\r\n      }\r\n      this.$dialog\r\n        .confirm({\r\n          title: '是否取消异常上报事件',\r\n        })\r\n        .then(async () => {\r\n          let { workOrderId } = this.patrolItemsResultList[index]\r\n          await this.setCloseTicket(workOrderId)\r\n          this.patrolItemsResultList[index].patrolItemValue = ''\r\n          this.workerPush(this.patrolItemsResultList[index].id, null, null, index)\r\n        })\r\n        .catch(() => {})\r\n    },\r\n\r\n    //清除工单\r\n    async setCloseTicket(ticketId) {\r\n      let query = {\r\n        reason: '巡检异常项恢复正常',\r\n        ticketId: ticketId,\r\n      }\r\n      const { accessToken } = await getToken(this.$storage.get('access_token'))\r\n      const res = await closeTicket(accessToken, query)\r\n    },\r\n\r\n    //获取巡检点信息\r\n    getInfoData() {\r\n      let { patrolItemsResultList, locationPlan, picUrl } = this.itemData\r\n\r\n      this.patrolItemsResultList = patrolItemsResultList.map((item) => {\r\n        if (item.inputType === '1') {\r\n          let data = item\r\n          data.patrolItemValue = data?.patrolItemValue?.toString() === 'false' ? false : true\r\n          return { ...data }\r\n        } else {\r\n          return { ...item }\r\n        }\r\n      })\r\n      this.fileValue = picUrl ? picUrl : ''\r\n      this.getImg(locationPlan?.url)\r\n    },\r\n\r\n    //获取图片\r\n    getImg(imgToken) {\r\n      this.imgUrl = imgToken ? '/api/sys-storage/download_image?f8s=' + imgToken : null\r\n    },\r\n\r\n    //上传文件更新\r\n    fileChange(item) {\r\n      this.fileList = item.fileList\r\n    },\r\n\r\n    //创建工单\r\n    async createWork(ticketId, i) {\r\n      const { accessToken } = await getToken(this.$storage.get('access_token'))\r\n      let uuid = this.getUUID()\r\n      let formValue = {\r\n        ticketId: uuid,\r\n      }\r\n\r\n      let encodeURIFormValue = encodeURIComponent(JSON.stringify(formValue))\r\n      let time = this.$dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n\r\n      let { taskId, index } = this.$route.query\r\n\r\n      this.itemData.patrolItemsResultList = this.patrolItemsResultList\r\n      this.itemData.picUrl = this.fileValue\r\n\r\n      let pointData = this.allData.patrolPointResultList\r\n      pointData[index] = this.itemData\r\n      let query = {\r\n        id: taskId,\r\n        patrolPointResultList: pointData,\r\n      }\r\n\r\n      try {\r\n        const res = await patrolEdit(query)\r\n      } catch (error) {\r\n        this.setOffLineStorage()\r\n      }\r\n\r\n      await this.workerPush(ticketId, uuid, time, i)\r\n\r\n      this.createWorkUrl = `${process.env.VUE_APP_WPG_URL}/outworkApp/#/pages/index/form?sysCode=xasw-pump&templateCode=trouble_template&token=${accessToken}&formValue=${encodeURIFormValue}`\r\n      window.location.href = this.createWorkUrl\r\n    },\r\n\r\n    //工单详情\r\n    async workerDetails(index) {\r\n      const { accessToken } = await getToken(this.$storage.get('access_token'))\r\n      let workOrderId = this.patrolItemsResultList[index].workOrderId\r\n      let workerDetailsUrl = `${process.env.VUE_APP_WPG_URL}/outworkApp/#/pages/ticket/detail/index?id=${workOrderId}&token=${accessToken}&sysCode=xasw-pump`\r\n      console.log(workerDetailsUrl)\r\n      window.location.href = workerDetailsUrl\r\n    },\r\n\r\n    // 获取UUID\r\n    getUUID(n = 32) {\r\n      var str = 'abcdefghijklmnopqrstuvwxyz0123456789' // 可以作为常量放到random外面\r\n      var result = ''\r\n      for (var i = 0; i < n; i++) {\r\n        result += str[parseInt(Math.random() * str.length)]\r\n      }\r\n      return result\r\n    },\r\n\r\n    //判断是否有未上报巡检项\r\n    noAlarm() {\r\n      let count = 0\r\n      this.patrolItemsResultList?.forEach((item) => {\r\n        let isAlarm\r\n        if (item.inputType === '2') {\r\n          isAlarm = this.configRangeValue(\r\n            item.patrolItemValue,\r\n            item.upperLimitValue * 1,\r\n            item.lowerLimitValue * 1\r\n          )\r\n        } else {\r\n          isAlarm = !item.patrolItemValue\r\n        }\r\n        isAlarm && item.workOrderId === null ? count++ : null\r\n      })\r\n      return count\r\n    },\r\n\r\n    //是否上传图片(1:是，2:否) 是必须上传一张图片\r\n    isUploadImageConfig() {\r\n      let config = false\r\n      config = this.itemData.isUploadImage && this.fileList.length === 0 ? true : false\r\n      config && this.$toast.warning('请至少上传一张图片')\r\n\r\n      return config\r\n    },\r\n\r\n    //巡检点巡检提交\r\n    async submit() {\r\n      if (this.isUploadImageConfig()) return\r\n\r\n      this.noAlarmShow = true\r\n    },\r\n\r\n    //工单上报\r\n    async workerPush(id, workOrderId, time, index) {\r\n      let query = {\r\n        id: id,\r\n        workOrderId: workOrderId,\r\n        reportTime: time,\r\n        patrolItemValue: this.patrolItemsResultList[index].patrolItemValue,\r\n      }\r\n      const res = await patrolItemsResult(query)\r\n\r\n      this.getPatrol()\r\n    },\r\n\r\n    //  确认提交\r\n    async confirmSubmit() {\r\n      let { taskId, index } = this.$route.query\r\n\r\n      this.itemData.patrolStatus = '已巡'\r\n      this.itemData.patrolItemsResultList = this.patrolItemsResultList\r\n      this.itemData.picUrl = this.fileValue\r\n      this.itemData.checkTime = this.$dayjs().format('YYYY-MM-DD HH:mm')\r\n\r\n      let pointData = this.allData.patrolPointResultList\r\n      pointData[index] = this.itemData\r\n      let query = {\r\n        id: taskId,\r\n        patrolPointResultList: pointData,\r\n      }\r\n\r\n      try {\r\n        let storageItemDataList = JSON.parse(this.$storage.get('pump-storageItemDataList'))\r\n\r\n        storageItemDataList?.forEach((item, i) => {\r\n          item.id === this.itemData.id ? storageItemDataList.splice(i, 1) : null\r\n        })\r\n\r\n        this.$storage.set('pump-storageItemDataList', JSON.stringify(storageItemDataList))\r\n\r\n        const res = await patrolEdit(query)\r\n        this.$toast('提交成功')\r\n        this.goToInspection()\r\n      } catch (error) {\r\n        this.setOffLineStorage()\r\n      }\r\n    },\r\n\r\n    // 离线缓存\r\n    setOffLineStorage() {\r\n      this.itemData.patrolItemsResultList = this.patrolItemsResultList\r\n\r\n      let storageItemDataList = JSON.parse(this.$storage.get('pump-storageItemDataList'))\r\n      storageItemDataList ? storageItemDataList : (storageItemDataList = [])\r\n\r\n      if (storageItemDataList.length === 0) {\r\n        storageItemDataList.push(this.itemData)\r\n      } else {\r\n        storageItemDataList?.forEach((item, i) => {\r\n          item.id === this.itemData.id\r\n            ? (storageItemDataList[i] = this.itemData)\r\n            : storageItemDataList.push(this.itemData)\r\n        })\r\n      }\r\n\r\n      console.log(storageItemDataList)\r\n\r\n      this.$storage.set('pump-storageItemDataList', JSON.stringify(storageItemDataList))\r\n\r\n      this.$toast('缓存成功')\r\n      this.goToInspection()\r\n    },\r\n\r\n    //返回列表页\r\n    goToInspection() {\r\n      this.$router.replace({\r\n        path: '/pump/inspection',\r\n        query: {\r\n          taskId: this.$route.query.taskId,\r\n          firstConfig: false,\r\n        },\r\n      })\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.inspection-items {\r\n  position: relative;\r\n  height: 100%;\r\n\r\n  background: #f5f7f9;\r\n\r\n  .inspection-item-area {\r\n    position: relative;\r\n    height: 440px;\r\n\r\n    .area-content {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      position: absolute;\r\n      bottom: 0px;\r\n      width: calc(100% - 60px);\r\n      height: 50px;\r\n      font-size: 28px;\r\n      color: #fff;\r\n      padding: 0 30px;\r\n      z-index: 1;\r\n      background-color: rgba(0, 0, 0, 0.3);\r\n\r\n      .area {\r\n        overflow: hidden;\r\n        white-space: nowrap;\r\n        text-overflow: ellipsis;\r\n      }\r\n\r\n      .area-content-icon {\r\n        width: 32px;\r\n        height: 32px;\r\n      }\r\n    }\r\n\r\n    .mark-icon {\r\n      position: absolute;\r\n      width: 32px;\r\n      height: 32px;\r\n    }\r\n  }\r\n\r\n  .inspection-items-content {\r\n    height: 60%;\r\n    overflow: scroll;\r\n  }\r\n\r\n  .inspection-item-upload {\r\n    display: flex;\r\n    align-items: center;\r\n    background: #ffffff;\r\n    box-shadow: 0px 4px 16px 0px rgba(104, 115, 127, 0.06);\r\n    border-radius: 16px;\r\n    padding: 30px;\r\n    margin: 30px 30px 20px;\r\n  }\r\n\r\n  .inspection-item {\r\n    margin: 0 30px 20px;\r\n    padding: 30px;\r\n    background: #ffffff;\r\n    box-shadow: 0px 4px 16px 0px rgba(104, 115, 127, 0.06);\r\n    border-radius: 16px;\r\n    font-size: 32px;\r\n\r\n    .inspection-item-input {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n    }\r\n\r\n    .inspection-btn-row {\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: center;\r\n      align-items: center;\r\n\r\n      .inspection-item-input-limit {\r\n        color: #ff4d4f;\r\n        margin-top: 20px;\r\n      }\r\n    }\r\n\r\n    .inspection-dispaly-row {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-top: 20px;\r\n      font-size: 28px;\r\n      color: #1b67d8;\r\n    }\r\n\r\n    .inspection-btn {\r\n      text-align: center;\r\n      width: 168px;\r\n      height: 64px;\r\n      border-radius: 38px;\r\n      font-size: 26px;\r\n      margin-top: 30px;\r\n    }\r\n\r\n    .item-content {\r\n      flex: 4;\r\n    }\r\n  }\r\n\r\n  .inspection-submit {\r\n    width: 100%;\r\n    height: 112px;\r\n    position: fixed;\r\n    bottom: 0;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    background-color: #ffffff;\r\n    padding: 10px 0;\r\n\r\n    .inspection-btn {\r\n      width: calc(100% - 60px);\r\n      height: 88px;\r\n      border-radius: 44px;\r\n    }\r\n  }\r\n\r\n  .noAlarmClass {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    font-size: 28px;\r\n    padding: 10px 40px;\r\n  }\r\n\r\n  .zoomImgBox {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n}\r\n</style>\r\n"]}]}