{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\DispatchCenter\\components\\DispatchOrder\\addDispatchOrder.vue?vue&type=style&index=0&id=554651e1&scoped=true&lang=less","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\DispatchCenter\\components\\DispatchOrder\\addDispatchOrder.vue","mtime":1705912915787},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQo6Oi13ZWJraXQtc2Nyb2xsYmFyIHsNCiAgZGlzcGxheTogbm9uZTsgLyogQ2hyb21lIFNhZmFyaSAqLw0KfQ0KL2RlZXAvLmZtLXRhYnMgew0KICBoZWlnaHQ6IDEwMCU7DQp9DQovZGVlcC8uZm0tdGFic19fY29udGVudCB7DQogIGhlaWdodDogMTAwJTsNCn0NCi9kZWVwLy5mbS10YWJfX3BhbmUsDQouZm0tdGFiX19wYW5lLXdyYXBwZXIgew0KICBoZWlnaHQ6IDEwMCU7DQp9DQoubWFpbiB7DQogIHdpZHRoOiAxMDAlOw0KICBoZWlnaHQ6IDEwMCU7DQogIC5jb250YWluZXIgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogY2FsYygxMDAlIC0gMzE2cHgpOw0KICAgIGJhY2tncm91bmQ6ICNmNGY2Zjg7DQogICAgb3ZlcmZsb3c6IHNjcm9sbDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgLmV2ZW50SW5mbyB7DQogICAgICB3aWR0aDogY2FsYygxMDAlIC0gNjBweCk7DQogICAgICBoZWlnaHQ6IGF1dG87DQogICAgICBtYXJnaW46IDMwcHggMzBweCAxNXB4Ow0KICAgICAgYmFja2dyb3VuZDogI2ZmZmZmZjsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDE2cHg7DQogICAgICAudGl0bGUgew0KICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgaGVpZ2h0OiAxMjBweDsNCiAgICAgICAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICNmNWY1ZjU7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIC5uYW1lIHsNCiAgICAgICAgICBmb250LXNpemU6IDM2cHg7DQogICAgICAgICAgZm9udC1mYW1pbHk6IFBpbmdGYW5nU0MtU2VtaWJvbGQsIFBpbmdGYW5nIFNDOw0KICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgICAgICAgY29sb3I6ICMxOTE5MTk7DQogICAgICAgICAgbWFyZ2luOiBhdXRvIDIwcHg7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgLmRpc3BhdGNoSW5mbyB7DQogICAgICB3aWR0aDogY2FsYygxMDAlIC0gNjBweCk7DQogICAgICBoZWlnaHQ6IGF1dG87DQogICAgICBtYXJnaW46IDE1cHggMzBweCAzMHB4Ow0KICAgICAgYmFja2dyb3VuZDogI2ZmZmZmZjsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDE2cHg7DQogICAgICAudGl0bGUgew0KICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgaGVpZ2h0OiAxMjBweDsNCiAgICAgICAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICNmNWY1ZjU7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIC5uYW1lIHsNCiAgICAgICAgICBmb250LXNpemU6IDM2cHg7DQogICAgICAgICAgZm9udC1mYW1pbHk6IFBpbmdGYW5nU0MtU2VtaWJvbGQsIFBpbmdGYW5nIFNDOw0KICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgICAgICAgY29sb3I6ICMxOTE5MTk7DQogICAgICAgICAgbWFyZ2luOiBhdXRvIDIwcHg7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0NCiAgLmZsb3dDb250YWluZXIgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogY2FsYygxMDAlIC0gMTgwcHgpOw0KICAgIGJhY2tncm91bmQ6ICNmNGY2Zjg7DQogICAgb3ZlcmZsb3c6IHNjcm9sbDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogIH0NCiAgLmJ0bkNvbnRhaW5lciB7DQogICAgcG9zaXRpb246IGZpeGVkOw0KICAgIGJvdHRvbTogMDsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDEzNnB4Ow0KICAgIGJhY2tncm91bmQ6ICNmZmZmZmY7DQogICAgYm94LXNoYWRvdzogMHB4IC0ycHggMTZweCAwcHggcmdiYSgxMDQsIDExNSwgMTI3LCAwLjA4KTsNCiAgICAuYnRuQXJlYSB7DQogICAgICBtYXJnaW46IDI0cHggMzBweDsNCiAgICAgIHdpZHRoOiBjYWxjKDEwMCUgLSA2MHB4KTsNCiAgICAgIGhlaWdodDogY2FsYygxMDAlIC0gNDhweCk7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgICAgLmRpc3BhdGNoQnRuIHsNCiAgICAgICAgd2lkdGg6IDQ4JTsNCiAgICAgICAgaGVpZ2h0OiA4OHB4Ow0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["addDispatchOrder.vue"],"names":[],"mappings":";AAwlBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addDispatchOrder.vue","sourceRoot":"src/views/DispatchCenter/components/DispatchOrder","sourcesContent":["<template>\r\n  <div class=\"main\">\r\n    <fm-nav-bar title=\"调度指令\" left-arrow @click-left=\"$router.go(-1)\"></fm-nav-bar>\r\n    <fm-tabs v-model=\"activeTab\">\r\n      <fm-tab v-for=\"(item, idx) in tabList\" :key=\"idx\" :label=\"item\">\r\n        <div\r\n          class=\"container\"\r\n          v-if=\"activeTab == 0\"\r\n          :style=\"{ 'height': $route.query.mode != 'add' ? 'calc(100% - 90px)' : '' }\"\r\n        >\r\n          <fm-form @submit=\"submit\" ref=\"form\" style=\"display: flex; flex-direction: column;\">\r\n            <div class=\"eventInfo\">\r\n              <div class=\"title\">\r\n                <img\r\n                  :src=\"require('@/assets/img/dispatchCenter/矩形.png')\"\r\n                  height=\"30\"\r\n                  style=\"margin: auto 0;\"\r\n                />\r\n                <div class=\"name\">事件信息</div>\r\n              </div>\r\n              <fm-field\r\n                label=\"发送站点\"\r\n                v-model=\"form.sendDepartment\"\r\n                is-link\r\n                readonly\r\n                :disabled=\"mode != 'add'\"\r\n                :placeholder=\"mode != 'add' ? '' : '请选择发送站点'\"\r\n                input-align=\"right\"\r\n                @click=\"openPopup('sendStationShow')\"\r\n              />\r\n              <fm-popup :visible.sync=\"sendStationShow\" round position=\"bottom\">\r\n                <fm-cascader\r\n                  title=\"请选择\"\r\n                  v-model=\"form.sendDepartment\"\r\n                  :disabled=\"mode != 'add'\"\r\n                  :options=\"sendDepartmentList\"\r\n                  @close=\"sendStationShow = false\"\r\n                  @finish=\"arg => onFinish(arg, 'sendStationShow')\"\r\n                />\r\n              </fm-popup>\r\n              <fm-field\r\n                label=\"接收站点\"\r\n                :disabled=\"mode != 'add'\"\r\n                v-model=\"form.receiveDepartment\"\r\n                is-link\r\n                readonly\r\n                name=\"receiveDepartment\"\r\n                :placeholder=\"mode != 'add' ? '' : '请选择接收站点'\"\r\n                input-align=\"right\"\r\n                @click=\"openPopup('getStationShow')\"\r\n                :rules=\"[{ required: true, message: '请选择接收站点' }]\"\r\n              />\r\n              <fm-popup :visible.sync=\"getStationShow\" round position=\"bottom\">\r\n                <fm-cascader\r\n                  title=\"请选择\"\r\n                  :disabled=\"mode != 'add'\"\r\n                  v-model=\"form.receiveDepartment\"\r\n                  :options=\"receiveDepartmentList\"\r\n                  @close=\"getStationShow = false\"\r\n                  @finish=\"arg => onFinish(arg, 'getStationShow')\"\r\n                />\r\n              </fm-popup>\r\n              <!-- <select-user\r\n                title=\"接单人\"\r\n                :userFullname.sync=\"receiveFullName\"\r\n                :disabled=\"mode != 'add'\"\r\n                :userName.sync=\"receiveName\"\r\n                :multiple=\"false\"\r\n                required\r\n                name=\"receiveName\"\r\n                :placeholder=\"mode != 'add' ? '' : '请选择接单人'\"\r\n                @change=\"selectReceive\"\r\n              /> -->\r\n              <fm-field\r\n                label=\"接单人\"\r\n                :disabled=\"mode != 'add'\"\r\n                :placeholder=\"mode != 'add' ? '' : '请选择接单人'\"\r\n                v-model=\"receiveFullName\"\r\n                :rules=\"[{ required: true, message: '请选择接单人' }]\"\r\n                name=\"receiveName\"\r\n                input-align=\"right\"\r\n              />\r\n              <fm-field label=\"接单人联系方式\" v-show=\"mode != 'add'\" :disabled=\"mode != 'add'\" v-model=\"form.receiveContact\" input-align=\"right\" />\r\n              <fm-popup :visible.sync=\"getPersonShow\" round position=\"bottom\">\r\n                <fm-cascader\r\n                  title=\"请选择\"\r\n                  v-model=\"form.receiveName\"\r\n                  :options=\"stationOptions\"\r\n                  @close=\"getPersonShow = false\"\r\n                  @finish=\"arg => onFinish(arg, 'getPersonShow')\"\r\n                />\r\n              </fm-popup>\r\n              <!-- <select-user\r\n                title=\"发单人\"\r\n                v-show=\"mode == 'view' || mode == 'deal'\"\r\n                disabled\r\n                :userFullname.sync=\"sendFullName\"\r\n                :userName.sync=\"sendName\"\r\n                :multiple=\"false\"\r\n                :placeholder=\"(mode == 'view' || mode == 'deal') ? '' : '请选择接收站点'\"\r\n                @change=\"selectSend\"\r\n              /> -->\r\n              <fm-field\r\n                label=\"发单人\"\r\n                :disabled=\"mode != 'add'\"\r\n                v-show=\"mode == 'view' || mode == 'deal'\"\r\n                :placeholder=\"(mode == 'view' || mode == 'deal') ? '' : '请选择接收站点'\"\r\n                v-model=\"sendFullName\"\r\n                input-align=\"right\"\r\n              />\r\n              <fm-popup :visible.sync=\"sendPersonShow\" round position=\"bottom\">\r\n                <fm-cascader\r\n                  title=\"请选择\"\r\n                  v-model=\"form.sendName\"\r\n                  :options=\"stationOptions\"\r\n                  @close=\"sendPersonShow = false\"\r\n                  @finish=\"arg => onFinish(arg, 'sendPersonShow')\"\r\n                />\r\n              </fm-popup>\r\n              <fm-field label=\"发单人联系方式\" v-show=\"mode == 'view' || mode == 'deal'\" :disabled=\"mode != 'add'\" v-model=\"form.sendContact\" input-align=\"right\" />\r\n              <fm-field\r\n                label=\"发送时间\"\r\n                v-show=\"mode == 'view' || mode == 'deal'\"\r\n                v-model=\"form.sendTime\"\r\n                :disabled=\"mode != 'add'\"\r\n                is-link\r\n                readonly\r\n                :placeholder=\"mode != 'add' ? '' : '请选择发送时间'\"\r\n                input-align=\"right\"\r\n                @click=\"openPopup('sendTimeShow')\"\r\n              />\r\n              <fm-popup :visible.sync=\"sendTimeShow\" round position=\"bottom\">\r\n                <fm-datetime-picker v-model=\"sendTime\" :disabled=\"mode != 'add'\" type=\"datetime\" @confirm=\"confirmTime\" />\r\n              </fm-popup>\r\n              <fm-field\r\n                label=\"抄送部门\"\r\n                :disabled=\"mode != 'add'\"\r\n                v-model=\"form.ccDepartment\"\r\n                is-link\r\n                readonly\r\n                :placeholder=\"mode != 'add' ? '' : '请选择抄送部门'\"\r\n                input-align=\"right\"\r\n                @click=\"openPopup('ccStationShow')\"\r\n              />\r\n              <fm-popup :visible.sync=\"ccStationShow\" round position=\"bottom\">\r\n                <fm-cascader\r\n                  title=\"请选择\"\r\n                  :disabled=\"mode != 'add'\"\r\n                  v-model=\"form.ccDepartment\"\r\n                  :options=\"ccDepartmentList\"\r\n                  @close=\"ccStationShow = false\"\r\n                  @finish=\"arg => onFinish(arg, 'ccStationShow')\"\r\n                />\r\n              </fm-popup>\r\n            </div>\r\n            <div class=\"dispatchInfo\">\r\n              <div class=\"title\">\r\n                <img\r\n                  :src=\"require('@/assets/img/dispatchCenter/矩形.png')\"\r\n                  height=\"30\"\r\n                  style=\"margin: auto 0;\"\r\n                />\r\n                <div class=\"name\">调度信息</div>\r\n              </div>\r\n              <fm-field\r\n                label=\"调令名称\"\r\n                :disabled=\"mode != 'add'\"\r\n                :placeholder=\"mode != 'add' ? '' : '请输入调令名称'\"\r\n                v-model=\"form.commandName\"\r\n                :rules=\"[{ required: true, message: '请输入调令名称' }]\"\r\n                name=\"commandName\"\r\n                input-align=\"right\"\r\n              />\r\n              <fm-field\r\n                v-model=\"form.detailedContent\"\r\n                label=\"调令内容\"\r\n                :disabled=\"mode != 'add'\"\r\n                :placeholder=\"mode != 'add' ? '' : '请输入调令内容'\"\r\n                :rules=\"[{ required: true, message: '请输入调令内容' }]\"\r\n                name=\"detailedContent\"\r\n                type=\"textarea\"\r\n                autosize\r\n                maxlength=\"300\"\r\n                input-align=\"right\"\r\n                show-word-limit\r\n              />\r\n              <uploader\r\n                label=\"附件\"\r\n                v-model=\"attachment\"\r\n                @fileChange=\"fileChange\"\r\n                :disabled=\"mode != 'add'\"\r\n                type=\"*\"\r\n                multiple\r\n              />\r\n              <fm-field name=\"stepper\" label=\"接单时限(min)\" input-align=\"right\">\r\n                <template #input>\r\n                  <fm-stepper\r\n                    v-model=\"form.receiveLimit\"\r\n                    :disabled=\"mode != 'add'\"\r\n                    integer\r\n                    min=\"1\"\r\n                  />\r\n                </template>\r\n              </fm-field>\r\n              <fm-field name=\"stepper\" label=\"反馈时限(min)\" input-align=\"right\">\r\n                <template #input>\r\n                  <fm-stepper\r\n                    v-model=\"form.feedbackLimit\"\r\n                    :disabled=\"mode != 'add'\"\r\n                    integer\r\n                    min=\"1\"\r\n                  />\r\n                </template>\r\n              </fm-field>\r\n            </div>\r\n          </fm-form>\r\n        </div>\r\n        <div class=\"btnContainer\" v-if=\"activeTab == 0 && mode == 'add'\">\r\n          <div class=\"btnArea\">\r\n            <fm-button round class=\"dispatchBtn\" @click=\"tempSave\">暂存</fm-button>\r\n            <fm-button round class=\"dispatchBtn\" type=\"primary\" @click=\"submit\">发起</fm-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"flowContainer\" v-if=\"activeTab == 1\">\r\n          <fm-empty v-if=\"flowList.length == 0\" />\r\n          <fm-flow-comments v-else :flowList=\"flowList\"></fm-flow-comments>\r\n        </div>\r\n        <div class=\"container\" v-if=\"activeTab == 2\" :style=\"{ 'height': $route.query.mode != 'deal' ? 'calc(100% - 90px)' : '' }\">\r\n          <fm-form ref=\"approveForm\">\r\n            <div class=\"eventInfo\">\r\n              <fm-field\r\n                v-model=\"approveForm.approvalOpinion\"\r\n                label=\"审批意见\"\r\n                :placeholder=\"mode == 'view' ? '' : '请输入审批意见'\"\r\n                :disabled=\"mode == 'view'\"\r\n                :rules=\"[{ required: true, message: '请输入审批意见' }]\"\r\n                type=\"textarea\"\r\n                name=\"approvalOpinion\"\r\n                autosize\r\n                maxlength=\"500\"\r\n                input-align=\"right\"\r\n                show-word-limit\r\n              />\r\n            </div>\r\n          </fm-form>\r\n        </div>\r\n        <div class=\"btnContainer\" v-if=\"activeTab == 2 && mode == 'deal'\">\r\n          <div class=\"btnArea\">\r\n            <fm-button round class=\"dispatchBtn\" @click=\"reject\">回退</fm-button>\r\n            <fm-button round class=\"dispatchBtn\" type=\"primary\" @click=\"handle\">提交</fm-button>\r\n          </div>\r\n        </div>\r\n      </fm-tab>\r\n    </fm-tabs>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  NavBar,\r\n  Search,\r\n  Toast,\r\n  Cell,\r\n  CellGroup,\r\n  PullRefresh,\r\n  List,\r\n  Sidebar,\r\n  SidebarItem,\r\n  SwipeCell,\r\n  Button,\r\n  NoticeBar,\r\n  Icon,\r\n  Dialog,\r\n} from 'fawkes-mobile-lib'\r\nimport Uploader from '@/components/upload/Uploader.vue'\r\nimport selectUser from '@/components/select-user'\r\nimport * as apis from '../../api'\r\nexport default {\r\n  name: 'addDispatchOrder',\r\n  components: {\r\n    [NavBar.name]: NavBar,\r\n    [Search.name]: Search,\r\n    [Toast.name]: Toast,\r\n    [Cell.name]: Cell,\r\n    [CellGroup.name]: CellGroup,\r\n    [PullRefresh.name]: PullRefresh,\r\n    [List.name]: List,\r\n    [Sidebar.name]: Sidebar,\r\n    [SidebarItem.name]: SidebarItem,\r\n    [SwipeCell.name]: SwipeCell,\r\n    [Button.name]: Button,\r\n    [NoticeBar.name]: NoticeBar,\r\n    [Icon.name]: Icon,\r\n    [Dialog.name]: Dialog,\r\n    Uploader,\r\n    selectUser\r\n  },\r\n  data() {\r\n    return {\r\n      taskId: '',\r\n      processInstanceId: '',\r\n      taskNodeName: '',\r\n      activeTab: 0,\r\n      content: '',\r\n      attachment: '',\r\n      sendStationShow: false,\r\n      getStationShow: false,\r\n      getPersonShow: false,\r\n      sendPersonShow: false,\r\n      sendTimeShow: false,\r\n      dispatchObjShow: false,\r\n      dispatchOrderShow: false,\r\n      ccStationShow: false,\r\n      sendTime: new Date(),\r\n      stationOptions: [\r\n        {\r\n          text: '调度中心',\r\n          value: '调度中心',\r\n        },\r\n        {\r\n          text: '1#供水厂',\r\n          value: '1#供水厂',\r\n        },\r\n        {\r\n          text: 'XXX供水厂',\r\n          value: 'XXX供水厂',\r\n        },\r\n        {\r\n          text: '1#泵站',\r\n          value: '1#泵站',\r\n        },\r\n        {\r\n          text: '2#泵站',\r\n          value: '2#泵站',\r\n        },\r\n      ],\r\n      sendDepartmentList: [],\r\n      receiveDepartmentList: [],\r\n      ccDepartmentList: [],\r\n      form: {},\r\n      approveForm: {},\r\n      receiveFullName: '',\r\n      sendFullName: '',\r\n      flowList: [],\r\n    }\r\n  },\r\n  computed: {\r\n    mode() {\r\n      return this.$route.query.mode\r\n    },\r\n    tabList() {\r\n      let res = ''\r\n      switch (this.mode) {\r\n        case 'add':\r\n          res = ['详情']\r\n          break\r\n        case 'deal':\r\n        case 'view':\r\n          res = ['详情', '流转', '审批']\r\n          break\r\n        // case 'add':\r\n        //     res = ['详情', '流转', '审批']\r\n        //     break\r\n        default:\r\n          res = ['详情']\r\n      }\r\n      return res\r\n    },\r\n  },\r\n  created() {\r\n    if (this.$route.query.mode == 'add') {\r\n      this.getDepartment()\r\n    } else if (this.$route.query.mode == 'view') {\r\n      this.form = JSON.parse(this.$route.query.data)\r\n      this.receiveFullName = this.form.receiveFullName || ''\r\n      this.sendFullName = this.form.sendFullName || ''\r\n      this.attachment = JSON.parse(this.form.fileAttachment)[0].groupToken\r\n      if (this.form.commandStatus == '已接单' || this.form.commandStatus == '待处理' || this.form.commandStatus == '已完成') {\r\n        this.approveForm.approvalOpinion = this.form.approvalOpinion\r\n        this.initProcess(this.form.id)\r\n      }\r\n    } else if (this.$route.query.mode == 'deal') {\r\n      this.form = JSON.parse(this.$route.query.data)\r\n      this.receiveFullName = this.form.receiveFullName || ''\r\n      this.sendFullName = this.form.sendFullName || ''\r\n      this.attachment = JSON.parse(this.form.fileAttachment)[0].groupToken\r\n      if (this.form.commandStatus == '已接单' || this.form.commandStatus == '待处理') {\r\n        this.initProcess(this.form.id)\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    getDepartment() {\r\n      this.sendDepartmentList = []\r\n      this.receiveDepartmentList = []\r\n      this.ccDepartmentList = []\r\n      apis.getDepartment().then(res => {\r\n        if (res.status) {\r\n          res.data.records.filter(it => it.departType == '发送部门').forEach(item => {\r\n            this.sendDepartmentList.push({\r\n              value: item.departName,\r\n              text: item.departName,\r\n              ...item\r\n            })\r\n          })\r\n          res.data.records.filter(it => it.departType == '接单部门').forEach(item => {\r\n            this.receiveDepartmentList.push({\r\n              value: item.departName,\r\n              text: item.departName,\r\n              ...item\r\n            })\r\n          })\r\n          res.data.records.filter(it => it.departType == '抄送部门').forEach(item => {\r\n            this.ccDepartmentList.push({\r\n              value: item.departName,\r\n              text: item.departName,\r\n              ...item\r\n            })\r\n          })\r\n        }\r\n        console.log(this.sendDepartmentList)\r\n      })\r\n    },\r\n    handleAdd(val) {\r\n      let parmas = {};\r\n      if (val == '已完成') {\r\n        parmas = {\r\n          entityName: 'DispatchingCommand',\r\n          entityObject: {},\r\n          formProcessParam: {\r\n            formKey: 'CommandTask',\r\n            taskId: this.taskId,\r\n            modelKey: 'CommandTask',\r\n            variable: {}\r\n          }\r\n        };\r\n      } else {\r\n        parmas = {\r\n          entityName: 'DispatchingCommand',\r\n          entityObject: {},\r\n          formProcessParam: {\r\n            formKey: 'CommandTask',\r\n            processInstanceId: this.taskId,\r\n            taskId: this.taskId,\r\n            modelKey: 'CommandTask',\r\n            variable: {}\r\n          }\r\n        };\r\n      }\r\n      if (val == '已接单') {\r\n        this.form.receiveTime = new Date().getTime();\r\n      }\r\n      this.form.sendName = this.$store.state.userInfo.userName;\r\n      this.form.commandStatus = val;\r\n      if (val == '已退单') {\r\n        this.form.ifback = '否';\r\n      }\r\n      if (val == '已完成') {\r\n        this.form.ifback = '是';\r\n        // this.finishTime = new Date().getTime();\r\n      }\r\n      parmas.entityObject = this.form;\r\n      parmas.formProcessParam.variable = this.form;\r\n\r\n      apis.getCommit(JSON.parse(JSON.stringify(parmas))).then(res => {\r\n        if (res.message == '成功') {\r\n          Toast.success({\r\n            message: '操作成功！',\r\n            duration: 2000\r\n          });\r\n          this.$router.go(-1)\r\n          this.$emit('refreshList');\r\n        } else {\r\n          Toast.error('操作失败！');\r\n        }\r\n      });\r\n    },\r\n    //暂存新增\r\n    handleTempSave(val) {\r\n      let params = JSON.parse(JSON.stringify(this.form))\r\n      if (val == '已发出') {\r\n        params.sendTime = new Date().getTime();\r\n      }\r\n      params.commandStatus = val\r\n      params.id = '';\r\n      if (this.form.fileAttachment) {\r\n        params.fileAttachment = JSON.stringify(this.form.fileAttachment);\r\n      }\r\n      apis.AddDispatchingCommand(params).then(res => {\r\n        if (res.message == '成功') {\r\n          Toast.success({\r\n            message: '操作成功！',\r\n            duration: 2000\r\n          });\r\n          this.$router.go(-1)\r\n          this.$emit('refreshList');\r\n        } else {\r\n          Toast.error('操作失败！');\r\n        }\r\n      });\r\n    },\r\n    async initProcess(id) {\r\n      let result = await apis.getUserTasks();\r\n      let list = result.data.list.filter(item => item.formBizId == id);\r\n      if (list.length > 0) {\r\n        this.taskId = list[0].taskId;\r\n        this.processInstanceId = list[0].processInstanceId;\r\n      }\r\n      //有taskId,获取流程图\r\n      // if (this.taskId) {\r\n      //   // 若有taskId则获取当前任务节点名称\r\n      //   apis.getUserTaskDetail(this.taskId).then(res => {\r\n      //     if (res.status && res.data.taskName) {\r\n      //       this.taskNodeName = '—' + res.data.taskName;\r\n      //     }\r\n      //   });\r\n      // }\r\n      if (this.mode !== 'add') {\r\n        apis.getProcessHistory({ taskId: this.taskId }).then(res => {\r\n          if (res.status && res.data) {\r\n            this.flowList = res.data;\r\n          } else {\r\n            this.flowList = []\r\n          }\r\n        });\r\n      }\r\n    //   apis.getModelXML({ processInstanceId: this.processInstanceId }).then(res => {\r\n    //     this.flowInfo.xml = res.data.bpmnXml;\r\n    //     if (res.data.customProcessJson) {\r\n    //       this.customXML = false;\r\n    //     } else {\r\n    //       this.customXML = true;\r\n    //     }\r\n    //     apis.getHistoryNodes({ processInstanceId: this.processInstanceId }).then(resp => {\r\n    //       this.flowInfo = Object.assign(this.flowInfo, resp.data);\r\n    //     });\r\n    //   });\r\n    },\r\n    handle() {\r\n      this.$refs['approveForm'] && this.$refs['approveForm'][0].validate('approvalOpinion').then(() => {\r\n        this.form.approvalOpinion = this.approveForm.approvalOpinion\r\n        this.handleAdd('已完成')\r\n      })\r\n    },\r\n    reject() {\r\n      this.$refs['approveForm'] && this.$refs['approveForm'][0].validate('approvalOpinion').then(() => {\r\n        this.form.approvalOpinion = this.approveForm.approvalOpinion\r\n        this.handleAdd('已退单')\r\n      })\r\n    },\r\n    tempSave() {\r\n      this.$refs['form'][0].validate(['receiveName', 'commandName', 'detailedContent', 'receiveDepartment']).then(() => {\r\n        this.handleTempSave('暂存')\r\n      })\r\n    },\r\n    submit() {\r\n      this.$refs['form'][0].validate(['receiveName', 'commandName', 'detailedContent', 'receiveDepartment']).then(() => {\r\n        this.handleTempSave('已发出')\r\n      })\r\n    },\r\n    openPopup(type) {\r\n      if (this.mode != 'add') {\r\n        return\r\n      }\r\n      this[type] = true\r\n    },\r\n    fileChange(file) {\r\n      let fileList = []\r\n      file.fileList.forEach((it) => {\r\n        fileList.push({\r\n          groupToken: it.response.groupToken,\r\n          fileToken: it.response.fileToken,\r\n          extName: it.response.extName,\r\n          size: it.response.size,\r\n          url: it.url,\r\n        })\r\n      })\r\n      this.form.fileAttachment = fileList\r\n    },\r\n    onFinish({ selectedOptions }, type) {\r\n      if (selectedOptions[0].departType == '接单部门') {\r\n        this.form.receiveName = selectedOptions[0].userName\r\n        this.receiveFullName = selectedOptions[0].userFullName\r\n        this.form.receiveContact = selectedOptions[0].contact\r\n      } else if (selectedOptions[0].departType == '发送部门') {\r\n        this.form.sendName = selectedOptions[0].userName\r\n        this.sendFullName = selectedOptions[0].userFullName\r\n        this.form.sendContact = selectedOptions[0].contact\r\n      }\r\n      this[type] = false\r\n    },\r\n    confirmTime(val) {\r\n      this.form.sendTime = this.$dayjs(val).format('YYYY-MM-DD HH:mm:ss')\r\n      this.sendTimeShow = false\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n::-webkit-scrollbar {\r\n  display: none; /* Chrome Safari */\r\n}\r\n/deep/.fm-tabs {\r\n  height: 100%;\r\n}\r\n/deep/.fm-tabs__content {\r\n  height: 100%;\r\n}\r\n/deep/.fm-tab__pane,\r\n.fm-tab__pane-wrapper {\r\n  height: 100%;\r\n}\r\n.main {\r\n  width: 100%;\r\n  height: 100%;\r\n  .container {\r\n    width: 100%;\r\n    height: calc(100% - 316px);\r\n    background: #f4f6f8;\r\n    overflow: scroll;\r\n    display: flex;\r\n    flex-direction: column;\r\n    .eventInfo {\r\n      width: calc(100% - 60px);\r\n      height: auto;\r\n      margin: 30px 30px 15px;\r\n      background: #ffffff;\r\n      border-radius: 16px;\r\n      .title {\r\n        width: 100%;\r\n        height: 120px;\r\n        border-bottom: 2px solid #f5f5f5;\r\n        display: flex;\r\n        .name {\r\n          font-size: 36px;\r\n          font-family: PingFangSC-Semibold, PingFang SC;\r\n          font-weight: 600;\r\n          color: #191919;\r\n          margin: auto 20px;\r\n        }\r\n      }\r\n    }\r\n    .dispatchInfo {\r\n      width: calc(100% - 60px);\r\n      height: auto;\r\n      margin: 15px 30px 30px;\r\n      background: #ffffff;\r\n      border-radius: 16px;\r\n      .title {\r\n        width: 100%;\r\n        height: 120px;\r\n        border-bottom: 2px solid #f5f5f5;\r\n        display: flex;\r\n        .name {\r\n          font-size: 36px;\r\n          font-family: PingFangSC-Semibold, PingFang SC;\r\n          font-weight: 600;\r\n          color: #191919;\r\n          margin: auto 20px;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .flowContainer {\r\n    width: 100%;\r\n    height: calc(100% - 180px);\r\n    background: #f4f6f8;\r\n    overflow: scroll;\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n  .btnContainer {\r\n    position: fixed;\r\n    bottom: 0;\r\n    width: 100%;\r\n    height: 136px;\r\n    background: #ffffff;\r\n    box-shadow: 0px -2px 16px 0px rgba(104, 115, 127, 0.08);\r\n    .btnArea {\r\n      margin: 24px 30px;\r\n      width: calc(100% - 60px);\r\n      height: calc(100% - 48px);\r\n      display: flex;\r\n      justify-content: space-between;\r\n      .dispatchBtn {\r\n        width: 48%;\r\n        height: 88px;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>"]}]}