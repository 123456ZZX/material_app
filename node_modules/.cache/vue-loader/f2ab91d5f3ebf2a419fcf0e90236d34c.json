{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\FormCenter\\components\\FlowApproval\\index.vue?vue&type=style&index=0&id=b299f81e&scoped=true&lang=less","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\FormCenter\\components\\FlowApproval\\index.vue","mtime":1705912800021},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouYmxhY2sgew0KICBmb250LXNpemU6IDI4cHg7DQogIGZvbnQtZmFtaWx5OiBQaW5nRmFuZ1NDLVJlZ3VsYXIsIFBpbmdGYW5nIFNDOw0KICBmb250LXdlaWdodDogNDAwOw0KICAvKmNvbG9yOiByZ2JhKDM4LCA0MiwgNTIsIDEpOyovDQogIGNvbG9yOiAjODg4Ow0KICB3b3JkLWJyZWFrOiBicmVhay1hbGw7DQp9DQouYXBwcm92ZS10aXRsZSB7DQogIGZvbnQtc2l6ZTogMzJweDsNCiAgZm9udC1mYW1pbHk6IFBpbmdGYW5nU0MtUmVndWxhciwgUGluZ0ZhbmcgU0M7DQogIGZvbnQtd2VpZ2h0OiA0MDA7DQogIGNvbG9yOiByZ2JhKDc1LCA3NSwgNzUsIDEpOw0KICBsaW5lLWhlaWdodDogNjBweDsNCn0NCi5hcHByb3ZlLXRleHRhcmVhIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCn0NCi5hcHByb3ZlLXRleHRhcmVhIC9kZWVwLyAuZm0tY2VsbCB7DQogIC8vIG1hcmdpbi10b3A6IDYwcHggIWltcG9ydGFudDsNCiAgcGFkZGluZzogMjhweCAxNnB4ICFpbXBvcnRhbnQ7DQp9DQouYXBwcm92ZS10ZXh0YXJlYS1lbnRydXN0IC9kZWVwLyAuZm0tY2VsbF9fdmFsdWUgew0KICAvKmJhY2tncm91bmQ6ICNlZWVlZWU7Ki8NCiAgYm9yZGVyOiAxcHggc29saWQgI2JiYmJiYjsNCiAgb3BhY2l0eTogMC41Ow0KICBwYWRkaW5nOiAyMHB4IDQwcHg7DQogIG92ZXJmbG93LXk6IHNjcm9sbCAhaW1wb3J0YW50Ow0KICBtYXgtaGVpZ2h0OiA0MDBweDsNCn0NCi9kZWVwLyAuZm0tZmllbGQtLW1pbi1oZWlnaHQgLmZtLWZpZWxkX19jb250cm9sIHsNCiAgbWluLWhlaWdodDogMzYwcHg7DQp9DQouYXBwcm92ZS10ZXh0YXJlYSAvZGVlcC8gLmZtLWZpZWxkX193b3JkLWxpbWl0IHsNCiAgbWFyZ2luLXRvcDogMHB4Ow0KfQ0KLmJ0bi1hcmVhIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICB3aWR0aDogMTAwJTsNCiAgbWFyZ2luLXRvcDogMzUlOw0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCn0NCi5idG4gew0KICBmbG9hdDogbGVmdDsNCiAgZm9udC1zaXplOiAyOHB4Ow0KICBoZWlnaHQ6IDkwcHg7DQogIGxpbmUtaGVpZ2h0OiA5MHB4Ow0KICB3aWR0aDogMjgwcHg7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgbWFyZ2luOiAxNnB4Ow0KfQ0KLmdlbmVyYWwtYnRuIHsNCiAgZm9udC1zaXplOiAzMnB4Ow0KICBjb2xvcjogI2ZmZmZmZjsNCiAgYmFja2dyb3VuZC1jb2xvcjogIzRkODZmZjsNCiAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICBmb250LWZhbWlseTogUGluZ0ZhbmdTQy1NZWRpdW07DQogIGZvbnQtd2VpZ2h0OiA1MDA7DQogIHdpZHRoOiAxMDAlOw0KfQ0KLmJhY2stYnRuIHsNCiAgZm9udC1zaXplOiAyOHB4Ow0KICBib3JkZXI6IDFweCBzb2xpZCAjZmJjNGM0Ow0KICBib3JkZXItcmFkaXVzOiAycHg7DQogIGNvbG9yOiAjZjU2YzZjOw0KICBiYWNrZ3JvdW5kOiAjZmVmMGYwOw0KICB3aWR0aDogMTAwJTsNCn0NCi8vIC0tLS0tIOmAgOWbnuiKgueCueWvueivneahhiBzdGFydCAtLS0tLQ0KLnJlamVjdC1ub2RlLWl0ZW06bGFzdC1jaGlsZCB7DQogIG1hcmdpbi1ib3R0b206IDMycHg7DQp9DQoucmVqZWN0LW5vZGUgew0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIHBhZGRpbmctdG9wOiA0OHB4Ow0KfQ0KLnJlamVjdC1ub2RlLmhvdmVyIHsNCiAgY29sb3I6ICM0ZDg2ZmY7DQp9DQovLyAtLS0tLSDpgIDlm57oioLngrnlr7nor53moYYgZW5kIC0tLS0tDQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA4WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/FormCenter/components/FlowApproval","sourcesContent":["<template>\r\n  <div class=\"approve-textarea\">\r\n    <fm-cell-group label-width=\"100px\" :gutter=\"0\">\r\n      <fm-cell title=\"当前环节\" value-align=\"right\" class=\"approve-textarea__cell\">\r\n        <div class=\"black\">{{ row.taskName }}</div>\r\n      </fm-cell>\r\n\r\n      <div class=\"approve-title\"><span class=\"label-before\"></span>审批意见</div>\r\n      <fm-field\r\n        class=\"approve-textarea-entrust\"\r\n        type=\"textarea\"\r\n        placeholder=\"请输入审批意见\"\r\n        show-word-limit\r\n        :maxlength=\"300\"\r\n        v-model=\"comment\"\r\n      ></fm-field>\r\n      <div class=\"btn-area approve-btn-area\">\r\n        <fm-button\r\n          class=\"btn\"\r\n          v-for=\"(item, index) in buttonList\"\r\n          :key=\"index\"\r\n          :disabled=\"isDisable\"\r\n          :type=\"buttonType(item)\"\r\n          @click=\"clickHandler(item)\"\r\n        >\r\n          {{ item.text }}\r\n        </fm-button>\r\n      </div>\r\n      <fm-dialog :visible.sync=\"show\" title=\"选择退回节点\" show-cancel-button @confirm=\"getNode()\">\r\n        <div v-for=\"(item, index) in rejectList\" :key=\"index\" class=\"reject-node-item\">\r\n          <div\r\n            @click=\"getRejectNode(item)\"\r\n            :class=\"[rejectTaskKey == item.taskKey ? 'hover' : '', 'reject-node']\"\r\n          >\r\n            {{ item.taskName }}\r\n          </div>\r\n        </div>\r\n      </fm-dialog>\r\n    </fm-cell-group>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { CURRENT_ROW, REJECT_TASK_KEY } from '@/store/State/stateTypes'\r\nimport { SET_REJECT_TASK_KEY } from '@/store/Mutation/mutationTypes'\r\nimport { Cell, Dialog, Toast, CellGroup, Field, Button } from 'fawkes-mobile-lib'\r\nimport { getButtonInfo, comfirm, backDlg, getTaskKey, processAbandon } from './api'\r\nexport default {\r\n  name: 'FlowApproval',\r\n  components: {\r\n    [Cell.name]: Cell,\r\n    [CellGroup.name]: CellGroup,\r\n    [Toast.name]: Toast,\r\n    [Field.name]: Field,\r\n    [Dialog.Component.name]: Dialog.Component,\r\n    [Button.name]: Button,\r\n  },\r\n  props: {\r\n    submitURL: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    entityName: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    urlAndEntity: {\r\n      type: Object,\r\n      default() {},\r\n    },\r\n    formData: {\r\n      type: Object,\r\n      default() {},\r\n    },\r\n    detailParamList: {\r\n      type: Array,\r\n      default() {\r\n        return []\r\n      },\r\n    },\r\n    modelKey: {\r\n      type: String,\r\n      default() {\r\n        return ''\r\n      },\r\n    },\r\n    beforeSubmit: {\r\n      type: Function,\r\n      default: function () {},\r\n    },\r\n    // 校验规则，默认不检查\r\n    checkRules: {\r\n      type: Function,\r\n      default: function () {\r\n        return true\r\n      },\r\n    },\r\n    afterSubmit: {\r\n      type: Function,\r\n      default: function () {},\r\n    },\r\n    aftereReject: {\r\n      type: Function,\r\n      default: function () {},\r\n    },\r\n    isBeforeSubmit: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      comment: '', // 审批意见\r\n      isDisable: false,\r\n      buttonList: [],\r\n      show: false,\r\n      rejectList: [], //流程退回的节点列表\r\n      currentNode: '',\r\n      currentKey: '',\r\n      stageFlag: 0,\r\n    }\r\n  },\r\n  computed: {\r\n    row() {\r\n      // 页面中使用row来指代当前记录\r\n      return this.$store.state[CURRENT_ROW]\r\n    },\r\n    rejectTaskKey() {\r\n      return this.$store.state[REJECT_TASK_KEY]\r\n    },\r\n  },\r\n  watch: {},\r\n  mounted() {\r\n    if (this?.row?.taskId) {\r\n      this.getButtonInfo()\r\n    }\r\n\r\n    this.$store.commit(SET_REJECT_TASK_KEY, '')\r\n  },\r\n  methods: {\r\n    // 获取流程设计中的按钮信息\r\n    getButtonInfo() {\r\n      getButtonInfo({\r\n        taskId: this.row.taskId,\r\n      }).then((res) => {\r\n        if (res.data) {\r\n          let buttonInfo = JSON.parse(res.data.buttonList)\r\n          if (buttonInfo?.taskButtonList?.length) {\r\n            this.buttonList = buttonInfo.taskButtonList.sort(\r\n              (a, b) => this.sortIcon(b) - this.sortIcon(a)\r\n            )\r\n          } else {\r\n            this.buttonList = buttonInfo.sort((a, b) => this.sortIcon(b) - this.sortIcon(a))\r\n          }\r\n        }\r\n      })\r\n    },\r\n    buttonType(item) {\r\n      switch (item.type) {\r\n        case 'submit':\r\n          return 'primary'\r\n        case 'saveDraft':\r\n          return 'default'\r\n        case 'reject':\r\n          return 'default'\r\n        default:\r\n          return ''\r\n      }\r\n    },\r\n    sortIcon(item) {\r\n      switch (item.type) {\r\n        case 'submit':\r\n          return 1\r\n        case 'saveDraft':\r\n          return 2\r\n        case 'reject':\r\n          return 3\r\n        case 'abandon':\r\n          return 4\r\n        case 'addCountersignee':\r\n          return 5\r\n        case 'edit':\r\n          return 6\r\n        case 'circulate':\r\n          return 7\r\n        default:\r\n          return 8\r\n      }\r\n    },\r\n    clickHandler(item) {\r\n      if (item.type == 'submit') {\r\n        this.confirmDlg()\r\n      } else if (item.type == 'reject') {\r\n        this.backDlg(item)\r\n      } else if (item.type == 'abandon') {\r\n        this.abandonTask()\r\n      } else {\r\n        this.draftDlg()\r\n      }\r\n    },\r\n    // 流程的提交\r\n    confirmDlg() {\r\n      this.stageFlag = 0\r\n      // 表单提交前校验\r\n      if (this.checkRules()) {\r\n        this.beforeSubmit()\r\n        this.confirm()\r\n      }\r\n    },\r\n    // 表单提交方法\r\n    confirm() {\r\n      this.isDisable = true\r\n      let url = this.submitURL\r\n      let formProcessParam = {\r\n        taskId: this.row.taskId,\r\n        bizId: this.row.formBizId,\r\n        approval: '',\r\n        comment: this.comment,\r\n        stageFlag: this.stageFlag,\r\n        formKey: this.row.formKey,\r\n        modelKey: this.modelKey,\r\n        processInstanceId: this.row.processInstanceId,\r\n        variable: this.formData,\r\n      }\r\n      let data = {\r\n        detailParamList: this.detailParamList,\r\n        entityName: this.entityName,\r\n        entityObject: this.formData,\r\n        formProcessParam: formProcessParam,\r\n      }\r\n      comfirm(url, data).then((res) => {\r\n        if (res.status) {\r\n          if (this.stageFlag == 0) {\r\n            this.afterSubmit()\r\n            Toast('审批成功', 'middle')\r\n          } else {\r\n            Toast('暂存成功', 'middle')\r\n          }\r\n          setTimeout(() => {\r\n            Toast.clear()\r\n            this.$router.push('/todo?refresh=true')\r\n          }, 1000)\r\n        } else {\r\n          Toast(res.message, 'middle')\r\n        }\r\n      })\r\n    },\r\n    // 流程退回\r\n    backDlg(item) {\r\n      // 只有一个退回节点时，直接退回\r\n      if (item?.targetNode?.length == 1) {\r\n        Dialog.confirm({\r\n          // 组件除show外的属性\r\n          title: '提示',\r\n          message: '是否要执行退回操作?',\r\n        })\r\n          .then(() => {\r\n            this.isDisable = true\r\n            backDlg({\r\n              taskId: this.row.taskId,\r\n              bizId: '',\r\n              targetKey: this.targetNode.toString(), //目前的流程没有做回退任意节点，回退数组中只取第一个人\r\n              comment: this.comment || '退回',\r\n            }).then((res) => {\r\n              if (res.status) {\r\n                this.aftereReject(this.targetNode)\r\n                Toast('退回成功', 'middle')\r\n                setTimeout(() => {\r\n                  Toast.clear()\r\n                  this.$router.push('/todo?refresh=true')\r\n                }, 1000)\r\n              } else {\r\n                Toast.fail(res.message)\r\n              }\r\n              setTimeout(() => {}, 2000)\r\n            })\r\n          })\r\n          .catch(() => {})\r\n      } else if (item?.targetNode?.length > 1) {\r\n        this.showRejectNodeList(item.targetNode)\r\n        // 多个\r\n        // this.show = true\r\n      }\r\n    },\r\n    // 表单暂存\r\n    draftDlg() {\r\n      if (this.comment.replace(/\\s+/g, '').length == 0) {\r\n        this.comment = '暂存'\r\n      }\r\n      this.stageFlag = 1\r\n      this.beforeSubmit()\r\n      this.confirm()\r\n    },\r\n    abandonTask() {\r\n      Dialog.confirm({\r\n        // 组件除show外的属性\r\n        title: '提示',\r\n        message: '是否要执行废弃操作?',\r\n      })\r\n        .then(() => {\r\n          const flowData = {\r\n            taskId: this.row.taskId,\r\n            bizId: this.bizId,\r\n            comment: this.comment,\r\n            formKey: this.formKey,\r\n          }\r\n          processAbandon(flowData)\r\n            .then((res) => {\r\n              if (res.status) {\r\n                Toast('废弃成功', 'middle')\r\n                setTimeout(() => {\r\n                  Toast.clear()\r\n                  this.$router.push('/todo?refresh=true')\r\n                }, 1000)\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              console.error(err)\r\n            })\r\n        })\r\n        .catch(() => {})\r\n    },\r\n    showRejectNodeList(rejectNode) {\r\n      getTaskKey({\r\n        taskId: this.row.taskId,\r\n      })\r\n        .then((res) => {\r\n          if (res.status) {\r\n            this.rejectList = res.data.filter((task) => rejectNode.includes(task.taskKey))\r\n          }\r\n        })\r\n        .finally(() => {\r\n          this.show = true\r\n        })\r\n    },\r\n    getRejectNode(item) {\r\n      this.currentKey = item.taskKey\r\n      this.$store.commit(SET_REJECT_TASK_KEY, this.currentKey)\r\n      this.currentNode = item.taskKey\r\n    },\r\n    getNode() {\r\n      this.isDisable = true\r\n      backDlg({\r\n        taskId: this.row.taskId,\r\n        bizId: '',\r\n        targetKey: this.currentNode,\r\n        comment: this.comment || '退回',\r\n      }).then((res) => {\r\n        if (res.status) {\r\n          this.aftereReject(this.currentNode)\r\n          Toast('退回成功', 'middle')\r\n          setTimeout(() => {\r\n            Toast.clear()\r\n            this.$router.push('/todo?refresh=true')\r\n          }, 1000)\r\n        } else {\r\n          Toast.fail(res.message)\r\n        }\r\n        setTimeout(() => {}, 2000)\r\n      })\r\n    },\r\n  },\r\n}\r\n</script>\r\n<style scoped lang=\"less\">\r\n.black {\r\n  font-size: 28px;\r\n  font-family: PingFangSC-Regular, PingFang SC;\r\n  font-weight: 400;\r\n  /*color: rgba(38, 42, 52, 1);*/\r\n  color: #888;\r\n  word-break: break-all;\r\n}\r\n.approve-title {\r\n  font-size: 32px;\r\n  font-family: PingFangSC-Regular, PingFang SC;\r\n  font-weight: 400;\r\n  color: rgba(75, 75, 75, 1);\r\n  line-height: 60px;\r\n}\r\n.approve-textarea {\r\n  background-color: #fff;\r\n}\r\n.approve-textarea /deep/ .fm-cell {\r\n  // margin-top: 60px !important;\r\n  padding: 28px 16px !important;\r\n}\r\n.approve-textarea-entrust /deep/ .fm-cell__value {\r\n  /*background: #eeeeee;*/\r\n  border: 1px solid #bbbbbb;\r\n  opacity: 0.5;\r\n  padding: 20px 40px;\r\n  overflow-y: scroll !important;\r\n  max-height: 400px;\r\n}\r\n/deep/ .fm-field--min-height .fm-field__control {\r\n  min-height: 360px;\r\n}\r\n.approve-textarea /deep/ .fm-field__word-limit {\r\n  margin-top: 0px;\r\n}\r\n.btn-area {\r\n  position: relative;\r\n  width: 100%;\r\n  margin-top: 35%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n.btn {\r\n  float: left;\r\n  font-size: 28px;\r\n  height: 90px;\r\n  line-height: 90px;\r\n  width: 280px;\r\n  text-align: center;\r\n  margin: 16px;\r\n}\r\n.general-btn {\r\n  font-size: 32px;\r\n  color: #ffffff;\r\n  background-color: #4d86ff;\r\n  border-radius: 4px;\r\n  font-family: PingFangSC-Medium;\r\n  font-weight: 500;\r\n  width: 100%;\r\n}\r\n.back-btn {\r\n  font-size: 28px;\r\n  border: 1px solid #fbc4c4;\r\n  border-radius: 2px;\r\n  color: #f56c6c;\r\n  background: #fef0f0;\r\n  width: 100%;\r\n}\r\n// ----- 退回节点对话框 start -----\r\n.reject-node-item:last-child {\r\n  margin-bottom: 32px;\r\n}\r\n.reject-node {\r\n  text-align: center;\r\n  padding-top: 48px;\r\n}\r\n.reject-node.hover {\r\n  color: #4d86ff;\r\n}\r\n// ----- 退回节点对话框 end -----\r\n</style>\r\n"]}]}