{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\PumpStationInspection\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\PumpStationInspection\\index.vue","mtime":1708928163417},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgSW5zcGVjdGlvblN0YXR1cyBmcm9tICcuL2NvbXBvbmVudHMvSW5zcGVjdGlvblN0YXR1cy52dWUnDQppbXBvcnQgU3RhdHVzQ29udGVudCBmcm9tICcuL2NvbXBvbmVudHMvU3RhdHVzQ29udGVudCcNCmltcG9ydCBJbnNwZWN0aW9uU3VibWl0IGZyb20gJy4vY29tcG9uZW50cy9JbnNwZWN0aW9uU3VibWl0LnZ1ZScNCmltcG9ydCBJbnNwZWN0aW9uTGlzdCBmcm9tICcuL2NvbXBvbmVudHMvSW5zcGVjdGlvbkxpc3QudnVlJw0KaW1wb3J0IEluc3BlY3Rpb25NYXAgZnJvbSAnLi9jb21wb25lbnRzL0luc3BlY3Rpb25NYXAudnVlJw0KaW1wb3J0IEluc3BlY3Rpb25IaWRkZW5Qb3B1cCBmcm9tICcuL2NvbXBvbmVudHMvSW5zcGVjdGlvbkhpZGRlblBvcHVwLnZ1ZScNCg0KaW1wb3J0IHsgcGF0cm9sLCBnZXRUb2tlbiwgdGlja2V0TGlzdCB9IGZyb20gJy4vYXBpJw0KZXhwb3J0IGRlZmF1bHQgew0KICBjb21wb25lbnRzOiB7DQogICAgSW5zcGVjdGlvblN0YXR1cywNCiAgICBTdGF0dXNDb250ZW50LA0KICAgIEluc3BlY3Rpb25TdWJtaXQsDQogICAgSW5zcGVjdGlvbkxpc3QsDQogICAgSW5zcGVjdGlvbk1hcCwNCiAgICBJbnNwZWN0aW9uSGlkZGVuUG9wdXAsDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHRpdGxlOiAnJywNCiAgICAgIFBhdHJvbERhdGE6IHt9LA0KICAgICAgcGF0cm9sUG9pbnRSZXN1bHRMaXN0OiBbXSwNCiAgICAgIGRpc2FibGVkOiB0cnVlLCAvL+ivt+WFiOeCueWHu+W8gOWni+aIlue7p+e7reaMiemSrg0KDQogICAgICBzdGF0dXNDb250ZW50U2hvdzogZmFsc2UsDQoNCiAgICAgIGNyZWF0ZVdvcmtVcmw6ICcnLA0KDQogICAgICBoaWRkZW5EYW5nZXJMaXN0OiBbXSwNCiAgICAgIG1vZGVsVHlwZTogJ2xpc3QnLCAvL2xpc3TliJfooajvvIxtYXDlnLDlm74NCg0KICAgICAgdHJhY2tEVE9TOiBbXSwgLy/lt6Hmo4Dlm77moIcNCg0KICAgICAgLy8g5b2T5YmN5beh5qOA5ZGY5omA5aSE5L2N572uDQogICAgICBjdXJyZW50UG9zaXRpb246IG51bGwsDQoNCiAgICAgIGFjdGl2ZUluZGV4OiAxLA0KICAgIH0NCiAgfSwNCg0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZ2V0UGF0cm9sKCkNCiAgfSwNCiAgbW91bnRlZCgpIHt9LA0KICBiZWZvcmVEZXN0cm95KCkgew0KICAgIHRoaXMuc2F2ZVBhdHJvbERhdGEoKQ0KICB9LA0KDQogIC8v6L+b5YWl5a6I5Y2rOumAmui/h+i3r+eUseinhOWImSzov5vlhaXor6Xnu4Tku7bml7booqvosIPnlKgNCiAgLy8gYXN5bmMgYmVmb3JlUm91dGVMZWF2ZSh0bywgZnJvbSwgbmV4dCkgew0KICAvLyAgIGlmICh0by5wYXRoID09PSAnL3B1bXAvaW5zcGVjdGlvbk1hbmFnZScpIHsNCiAgLy8gICAgIGF3YWl0IHRoaXMuJHJlZnMuaW5zcGVjdGlvblN1Ym1pdC5pc1Vuc3VibWl0dGVkKCkNCiAgLy8gICAgIG5leHQoKQ0KICAvLyAgIH0gZWxzZSB7DQogIC8vICAgICBuZXh0KCkgLy/mlL7ooYwNCiAgLy8gICB9DQogIC8vIH0sDQoNCiAgbWV0aG9kczogew0KICAgIC8v6L+U5Zue5beh5qOA566h55CG6aG16Z2iDQogICAgZ29Ub0luc3BlY3Rpb25NYW5hZ2UoKSB7DQogICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL3B1bXAvaW5zcGVjdGlvbk1hbmFnZScpDQogICAgfSwNCg0KICAgIC8v6I635Y+W5bel5Y2V6K+m5oOFDQogICAgYXN5bmMgY3JlYXRlV29yayhkYXRhLCB0eXBlKSB7DQogICAgICBjb25zb2xlLmxvZyhkYXRhLCB0eXBlKQ0KICAgICAgbGV0IHdvcmtPcmRlcklkTGlzdCA9IFtdDQogICAgICAvL+WNleS4quW3oeajgOeCueW3peWNlQ0KICAgICAgaWYgKHR5cGUgPT09ICdpdGVtJykgew0KICAgICAgICBkYXRhPy5wYXRyb2xJdGVtc1Jlc3VsdExpc3Q/LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICBpdGVtLndvcmtPcmRlcklkICYmIHdvcmtPcmRlcklkTGlzdC5wdXNoKGl0ZW0ud29ya09yZGVySWQpDQogICAgICAgIH0pDQogICAgICB9IGVsc2Ugew0KICAgICAgICAvL+aJgOacieW3oeajgOeCueW3peWNlQ0KICAgICAgICBkYXRhPy5wYXRyb2xQb2ludFJlc3VsdExpc3Q/LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICBpdGVtPy5wYXRyb2xJdGVtc1Jlc3VsdExpc3Q/LmZvckVhY2goKGRhdGEpID0+IHsNCiAgICAgICAgICAgIGRhdGEud29ya09yZGVySWQgJiYgd29ya09yZGVySWRMaXN0LnB1c2goZGF0YS53b3JrT3JkZXJJZCkNCiAgICAgICAgICB9KQ0KICAgICAgICB9KQ0KICAgICAgfQ0KDQogICAgICBjb25zdCB7IGFjY2Vzc1Rva2VuIH0gPSBhd2FpdCBnZXRUb2tlbih0aGlzLiRzdG9yYWdlLmdldCgnYWNjZXNzX3Rva2VuJykpDQoNCiAgICAgIGNvbnN0IHsgcmVzdWx0RGF0YSB9ID0gYXdhaXQgdGlja2V0TGlzdChhY2Nlc3NUb2tlbiwgd29ya09yZGVySWRMaXN0KQ0KICAgICAgdGhpcy5oaWRkZW5EYW5nZXJMaXN0ID0gcmVzdWx0RGF0YQ0KICAgIH0sDQoNCiAgICAvL+aYr+WQpuemgeatoui/m+WFpeW3oeajgOmhuQ0KICAgIGlzRGlzYWJsZWQoY29uZmlnKSB7DQogICAgICB0aGlzLmRpc2FibGVkID0gY29uZmlnDQogICAgfSwNCg0KICAgIC8v6I635Y+W55So5oi35beh5qOA54K5DQogICAgYXN5bmMgZ2V0UGF0cm9sKCkgew0KICAgICAgbGV0IHsgdGFza0lkIH0gPSB0aGlzLiRzdG9yZS5zdGF0ZS5wdW1wLnVybFF1ZXJ5DQoNCiAgICAgIGxldCBQYXRyb2xEYXRhDQogICAgICB0cnkgew0KICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHBhdHJvbCh0YXNrSWQpDQogICAgICAgIFBhdHJvbERhdGEgPSBkYXRhDQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBQYXRyb2xEYXRhID0gSlNPTi5wYXJzZSh0aGlzLiRzdG9yYWdlLmdldCgnUGF0cm9sRGF0YScpKQ0KICAgICAgfQ0KDQogICAgICBsZXQgeyBwYXRyb2xSb3V0ZU5hbWUsIHBhdHJvbFBvaW50UmVzdWx0TGlzdCB9ID0gUGF0cm9sRGF0YQ0KDQogICAgICB0aGlzLlBhdHJvbERhdGEgPSBQYXRyb2xEYXRhDQogICAgICB0aGlzLnBhdHJvbFBvaW50UmVzdWx0TGlzdCA9IHBhdHJvbFBvaW50UmVzdWx0TGlzdA0KICAgICAgdGhpcy50aXRsZSA9IHBhdHJvbFJvdXRlTmFtZQ0KDQogICAgICB0aGlzLmlzVW5zdWJtaXR0ZWQoKQ0KICAgIH0sDQoNCiAgICAvL+S/neWtmOW3oeajgOivpuaDheS/oeaBrw0KICAgIHNhdmVQYXRyb2xEYXRhKCkgew0KICAgICAgdGhpcy4kc3RvcmFnZS5zZXQoJ1BhdHJvbERhdGEnLCBKU09OLnN0cmluZ2lmeSh0aGlzLlBhdHJvbERhdGEpKQ0KICAgIH0sDQoNCiAgICAvL+W8ueWHuuWIt+WNoeeVjOmdog0KICAgIGhhbmRNb3ZlbWVudE5GQygpIHsNCiAgICAgIGlmICh0aGlzLmRpc2FibGVkKSByZXR1cm4NCiAgICAgIHRoaXMuJHJlZnMuaW5zcGVjdGlvbkxpc3QuaGFuZE1vdmVtZW50TkZDKCkNCiAgICB9LA0KDQogICAgLy/mo4Dmn6XmmK/lkKbmnInmnKrmj5DkuqTpobkNCiAgICBpc1Vuc3VibWl0dGVkKCkgew0KICAgICAgbGV0IHN0b3JhZ2VJdGVtRGF0YUxpc3QgPSBKU09OLnBhcnNlKHRoaXMuJHN0b3JhZ2UuZ2V0KCdwdW1wLXN0b3JhZ2VJdGVtRGF0YUxpc3QnKSkNCiAgICAgIHRoaXMucGF0cm9sUG9pbnRSZXN1bHRMaXN0Py5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4gew0KICAgICAgICBzdG9yYWdlSXRlbURhdGFMaXN0Py5mb3JFYWNoKChkYXRhKSA9PiB7DQogICAgICAgICAgaXRlbS5pZCA9PT0gZGF0YS5pZCA/ICh0aGlzLnBhdHJvbFBvaW50UmVzdWx0TGlzdFtpbmRleF0uaXNVbnN1Ym1pdHRlZCA9IHRydWUpIDogbnVsbA0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICB9LA0KDQogICAgLy/pmpDmgqPkuIrmiqXliJfooajmmL7npLoNCiAgICBhc3luYyBoaWRkZW5EYW5nZXJTaG93KGl0ZW0sIHR5cGUpIHsNCiAgICAgIGF3YWl0IHRoaXMuY3JlYXRlV29yayhpdGVtLCB0eXBlKQ0KDQogICAgICBpZiAodGhpcy5oaWRkZW5EYW5nZXJMaXN0Lmxlbmd0aCA9PT0gMCkgcmV0dXJuDQogICAgICB0aGlzLiRyZWZzLmluc3BlY3Rpb25IaWRkZW5Qb3B1cC5zaG93KCkNCiAgICB9LA0KICB9LA0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAiEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/PumpStationInspection","sourcesContent":["<template>\r\n  <div class=\"inspection\">\r\n    <fm-nav-bar :title=\"title\" left-arrow @click-left=\"goToInspectionManage()\">\r\n      <template #right>\r\n        <img\r\n          src=\"@/assets/img/pump/inspection-icon-nfc.png\"\r\n          class=\"inspection-right\"\r\n          alt=\"\"\r\n          @click=\"handMovementNFC()\"\r\n        />\r\n      </template>\r\n    </fm-nav-bar>\r\n\r\n    <!-- 状态栏 -->\r\n    <inspection-status\r\n      :PatrolData=\"PatrolData\"\r\n      @hiddenDangerClick=\"hiddenDangerShow\"\r\n      @setShowType=\"\r\n        (showType) => {\r\n          this.statusContentShow = showType\r\n        }\r\n      \"\r\n    />\r\n    <!-- 巡检状态详情信息 -->\r\n    <status-content :PatrolData=\"PatrolData\" :show=\"statusContentShow\" />\r\n\r\n    <div class=\"inspection-tabs\" v-if=\"modelType === 'list'\">\r\n      <div class=\"inspection-tabs-item\" :class=\"{ active: activeIndex === 1 }\" @click=\"activeIndex = 1\">未巡检</div>\r\n      <div class=\"inspection-tabs-item\" :class=\"{ active: activeIndex === 2 }\" @click=\"activeIndex = 2\">已巡检</div>\r\n    </div>\r\n    <div class=\"inspection-model\">\r\n      <!-- 地图模块 -->\r\n      <InspectionMap :PatrolData=\"PatrolData\" v-if=\"modelType === 'map'\" />\r\n\r\n      <!-- 巡检点列表 -->\r\n      <InspectionList\r\n        ref=\"inspectionList\"\r\n        v-if=\"modelType === 'list'\"\r\n        :disabled=\"disabled\"\r\n        :patrolStatus=\"PatrolData && PatrolData.patrolStatus\"\r\n        :patrolPointResultList=\"patrolPointResultList\"\r\n        :activeIndex='activeIndex'\r\n        @hiddenDangerClick=\"hiddenDangerShow\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 底部按钮栏 -->\r\n    <inspection-submit\r\n      ref=\"inspectionSubmit\"\r\n      :PatrolData=\"PatrolData\"\r\n      :modelType=\"modelType\"\r\n      @isDisabled=\"isDisabled\"\r\n      @modelTypeChange=\"\r\n        (newModelType) => {\r\n          modelType = newModelType\r\n        }\r\n      \"\r\n    />\r\n\r\n    <!-- 异常隐患列表弹框 -->\r\n    <inspection-hidden-popup ref=\"inspectionHiddenPopup\" :hiddenDangerList=\"hiddenDangerList\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport InspectionStatus from './components/InspectionStatus.vue'\r\nimport StatusContent from './components/StatusContent'\r\nimport InspectionSubmit from './components/InspectionSubmit.vue'\r\nimport InspectionList from './components/InspectionList.vue'\r\nimport InspectionMap from './components/InspectionMap.vue'\r\nimport InspectionHiddenPopup from './components/InspectionHiddenPopup.vue'\r\n\r\nimport { patrol, getToken, ticketList } from './api'\r\nexport default {\r\n  components: {\r\n    InspectionStatus,\r\n    StatusContent,\r\n    InspectionSubmit,\r\n    InspectionList,\r\n    InspectionMap,\r\n    InspectionHiddenPopup,\r\n  },\r\n  data() {\r\n    return {\r\n      title: '',\r\n      PatrolData: {},\r\n      patrolPointResultList: [],\r\n      disabled: true, //请先点击开始或继续按钮\r\n\r\n      statusContentShow: false,\r\n\r\n      createWorkUrl: '',\r\n\r\n      hiddenDangerList: [],\r\n      modelType: 'list', //list列表，map地图\r\n\r\n      trackDTOS: [], //巡检图标\r\n\r\n      // 当前巡检员所处位置\r\n      currentPosition: null,\r\n\r\n      activeIndex: 1,\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getPatrol()\r\n  },\r\n  mounted() {},\r\n  beforeDestroy() {\r\n    this.savePatrolData()\r\n  },\r\n\r\n  //进入守卫:通过路由规则,进入该组件时被调用\r\n  // async beforeRouteLeave(to, from, next) {\r\n  //   if (to.path === '/pump/inspectionManage') {\r\n  //     await this.$refs.inspectionSubmit.isUnsubmitted()\r\n  //     next()\r\n  //   } else {\r\n  //     next() //放行\r\n  //   }\r\n  // },\r\n\r\n  methods: {\r\n    //返回巡检管理页面\r\n    goToInspectionManage() {\r\n      this.$router.push('/pump/inspectionManage')\r\n    },\r\n\r\n    //获取工单详情\r\n    async createWork(data, type) {\r\n      console.log(data, type)\r\n      let workOrderIdList = []\r\n      //单个巡检点工单\r\n      if (type === 'item') {\r\n        data?.patrolItemsResultList?.forEach((item) => {\r\n          item.workOrderId && workOrderIdList.push(item.workOrderId)\r\n        })\r\n      } else {\r\n        //所有巡检点工单\r\n        data?.patrolPointResultList?.forEach((item) => {\r\n          item?.patrolItemsResultList?.forEach((data) => {\r\n            data.workOrderId && workOrderIdList.push(data.workOrderId)\r\n          })\r\n        })\r\n      }\r\n\r\n      const { accessToken } = await getToken(this.$storage.get('access_token'))\r\n\r\n      const { resultData } = await ticketList(accessToken, workOrderIdList)\r\n      this.hiddenDangerList = resultData\r\n    },\r\n\r\n    //是否禁止进入巡检项\r\n    isDisabled(config) {\r\n      this.disabled = config\r\n    },\r\n\r\n    //获取用户巡检点\r\n    async getPatrol() {\r\n      let { taskId } = this.$store.state.pump.urlQuery\r\n\r\n      let PatrolData\r\n      try {\r\n        const { data } = await patrol(taskId)\r\n        PatrolData = data\r\n      } catch (error) {\r\n        PatrolData = JSON.parse(this.$storage.get('PatrolData'))\r\n      }\r\n\r\n      let { patrolRouteName, patrolPointResultList } = PatrolData\r\n\r\n      this.PatrolData = PatrolData\r\n      this.patrolPointResultList = patrolPointResultList\r\n      this.title = patrolRouteName\r\n\r\n      this.isUnsubmitted()\r\n    },\r\n\r\n    //保存巡检详情信息\r\n    savePatrolData() {\r\n      this.$storage.set('PatrolData', JSON.stringify(this.PatrolData))\r\n    },\r\n\r\n    //弹出刷卡界面\r\n    handMovementNFC() {\r\n      if (this.disabled) return\r\n      this.$refs.inspectionList.handMovementNFC()\r\n    },\r\n\r\n    //检查是否有未提交项\r\n    isUnsubmitted() {\r\n      let storageItemDataList = JSON.parse(this.$storage.get('pump-storageItemDataList'))\r\n      this.patrolPointResultList?.forEach((item, index) => {\r\n        storageItemDataList?.forEach((data) => {\r\n          item.id === data.id ? (this.patrolPointResultList[index].isUnsubmitted = true) : null\r\n        })\r\n      })\r\n    },\r\n\r\n    //隐患上报列表显示\r\n    async hiddenDangerShow(item, type) {\r\n      await this.createWork(item, type)\r\n\r\n      if (this.hiddenDangerList.length === 0) return\r\n      this.$refs.inspectionHiddenPopup.show()\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.inspection {\r\n  position: relative;\r\n  height: 100%;\r\n  background: #f5f7f9;\r\n\r\n  .inspection-right {\r\n    width: 48px;\r\n    height: 48px;\r\n  }\r\n\r\n  .box-time-img-time {\r\n    width: 32px;\r\n    height: 32px;\r\n  }\r\n\r\n  .inspection-model {\r\n    overflow: scroll;\r\n    height: calc(100% - 420px);\r\n  }\r\n}\r\n\r\n.inspection-tabs {\r\n  display: flex;\r\n  font-size: 32px;\r\n  font-weight: 600;\r\n\r\n  .inspection-tabs-item {\r\n    flex: 1;\r\n    display: flex;\r\n    justify-content: center;\r\n    color: #000;\r\n    align-items: center;\r\n    padding: 10px;\r\n  }\r\n\r\n  .active {\r\n    color: #fff;\r\n    background-color: #1b67d8;\r\n  }\r\n}\r\n</style>\r\n"]}]}