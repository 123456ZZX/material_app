{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\InspectionMap.vue?vue&type=style&index=0&id=296d7ed0&scoped=true&lang=less","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\InspectionMap.vue","mtime":1708928163414},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouaW5zcGVjdGlvbi1tYXAgew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIGhlaWdodDogMTAwJTsNCiAgb3ZlcmZsb3c6IGhpZGRlbjsNCg0KICAubm90aWZ5LW5ldHdvcmsgew0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgaGVpZ2h0OiA2MHB4Ow0KICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCA3NywgNzksIDAuMik7DQogICAgYm9yZGVyLXJhZGl1czogMzhweDsNCiAgICBtYXJnaW46IDAgMzBweDsNCiAgICBmb250LXNpemU6IDI4cHg7DQogICAgY29sb3I6ICNmZjRkNGY7DQoNCiAgICAuY3Jvc3MtaWNvbiB7DQogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICByaWdodDogMjBweDsNCiAgICAgIHdpZHRoOiAyOHB4Ow0KICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgIH0NCiAgfQ0KDQogIC5tYXAtbGluZS1yZW1hcmsgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGJvdHRvbTogMzBweDsNCiAgICByaWdodDogMzBweDsNCiAgICB3aWR0aDogMTY4cHg7DQogICAgaGVpZ2h0OiA2OHB4Ow0KICAgIGZvbnQtc2l6ZTogMjhweDsNCiAgICBjb2xvcjogIzAwMDAwMDsNCiAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmOw0KICAgIGJveC1zaGFkb3c6IDBweCA4cHggMjBweCAwcHggcmdiYSgxODAsIDE5NywgMjI2LCAxKTsNCiAgICBib3JkZXItcmFkaXVzOiAzNHB4Ow0KICAgIHBhZGRpbmc6IDAgMjBweDsNCg0KICAgICY6OmFmdGVyIHsNCiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgIGNvbnRlbnQ6ICcnOw0KICAgICAgd2lkdGg6IDQwcHg7DQogICAgICBoZWlnaHQ6IDRweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiA2OHB4Ow0KICAgICAgYmFja2dyb3VuZDogIzJkN2VmZjsNCiAgICB9DQogIH0NCg0KICAudG9vbC1ib3ggew0KICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICB3aWR0aDogMS4ycmVtOw0KICAgIGhlaWdodDogYXV0bzsNCiAgICByaWdodDogMC4zcmVtOw0KICAgIGJvdHRvbTogMzUwcHg7DQoNCiAgICAucmVmcmVzaCB7DQogICAgICB3aWR0aDogMS4ycmVtOw0KICAgICAgaGVpZ2h0OiAxLjJyZW07DQogICAgICBtYXJnaW4tYm90dG9tOiAwLjU1cmVtOw0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCiAgICAgIHotaW5kZXg6IDM7DQogICAgICBib3gtc2hhZG93OiAwcmVtIDAuMjJyZW0gMC42MXJlbSAwcmVtIHJnYmEoMCwgMCwgMCwgMC4yKTsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDAuMjdyZW07DQoNCiAgICAgICYtaW1hZ2Ugew0KICAgICAgICBtYXJnaW46IDAuMThyZW07DQogICAgICAgIHdpZHRoOiAwLjgycmVtOw0KICAgICAgICBoZWlnaHQ6IDAuODJyZW07DQogICAgICB9DQogICAgfQ0KDQogICAgLnJvdXRlIHsNCiAgICAgIHdpZHRoOiAxLjJyZW07DQogICAgICBoZWlnaHQ6IDEuMnJlbTsNCiAgICAgIG1hcmdpbi1ib3R0b206IDAuNTVyZW07DQogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICAgICAgei1pbmRleDogMzsNCiAgICAgIGJveC1zaGFkb3c6IDByZW0gMC4yMnJlbSAwLjYxcmVtIDByZW0gcmdiYSgwLCAwLCAwLCAwLjIpOw0KICAgICAgYm9yZGVyLXJhZGl1czogMC4yN3JlbTsNCg0KICAgICAgJi1pbWFnZSB7DQogICAgICAgIG1hcmdpbjogMC4xOHJlbTsNCiAgICAgICAgd2lkdGg6IDAuODJyZW07DQogICAgICAgIGhlaWdodDogMC44MnJlbTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAubG9jYXRpb24gew0KICAgICAgd2lkdGg6IDEuMnJlbTsNCiAgICAgIGhlaWdodDogMS4ycmVtOw0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCiAgICAgIHotaW5kZXg6IDM7DQogICAgICBib3gtc2hhZG93OiAwcmVtIDAuMjJyZW0gMC42MXJlbSAwcmVtIHJnYmEoMCwgMCwgMCwgMC4yKTsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDYwcHg7DQoNCiAgICAgICYtaW1hZ2Ugew0KICAgICAgICBtYXJnaW46IDAuMThyZW07DQogICAgICAgIHdpZHRoOiAwLjgycmVtOw0KICAgICAgICBoZWlnaHQ6IDAuODJyZW07DQogICAgICB9DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["InspectionMap.vue"],"names":[],"mappings":";AAyNA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"InspectionMap.vue","sourceRoot":"src/views/PumpStationInspection/components","sourcesContent":["<template>\r\n  <div class=\"inspection-map\">\r\n    <div class=\"notify-network\" v-if=\"notifyShow\">\r\n      <span>网络异常，无法记录巡检轨迹！</span>\r\n      <img\r\n        src=\"@/assets/img/pump/inspection-cross.png\"\r\n        class=\"cross-icon\"\r\n        alt=\"\"\r\n        @click=\"notifyShow = false\"\r\n      />\r\n    </div>\r\n    <!-- 地图 -->\r\n    <MapComp ref=\"mymap\" :ifInspection=\"true\" @mapLoaded=\"mapLoaded\"></MapComp>\r\n    <div class=\"map-line-remark\">\r\n      <div class=\"remark-text\">轨迹记录</div>\r\n    </div>\r\n    <!-- 轨迹显示与定位功能 -->\r\n    <div class=\"tool-box\">\r\n      <div class=\"location\" @click=\"startLocation\">\r\n        <fm-image\r\n          class=\"location-image\"\r\n          :src=\"require('@/assets/img/inspection/location.png')\"\r\n        ></fm-image>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport MapComp from '@/views/inspectMap/index.vue'\r\n\r\nimport { trackList, uploadTrackList } from '../api'\r\n\r\nconst mapObj = {\r\n  map: null,\r\n  mapInstance: null,\r\n}\r\n\r\nexport default {\r\n  components: { MapComp },\r\n  props: {\r\n    //巡检状态(1:待巡检，2:巡检中，3:已完成 ，4:已终止)(手机端)\r\n    PatrolData: {\r\n      type: Object,\r\n      default: () => {},\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      statusContentShow: false,\r\n      notifyShow: false,\r\n      inspectionUrl: '/pump/inspection', //巡检列表地址\r\n      hiddenUrl: '/FormBase', //隐患工单界面\r\n\r\n      trackList: [],\r\n\r\n      currentPosition: null,\r\n    }\r\n  },\r\n\r\n  created() {\r\n    // this.setTrackList()\r\n  },\r\n\r\n  methods: {\r\n    //跳转至巡检列表页\r\n    // goTo(url) {\r\n    //   this.$router.push(url)\r\n    // },\r\n\r\n    //获取巡检点轨迹\r\n    async getTrackList() {\r\n      console.log('获取巡检路径')\r\n      let { taskId } = this.$store.state.pump.urlQuery\r\n      const { data } = await trackList(taskId)\r\n\r\n      this.trackList = data?.map((item) => {\r\n        return [item.lon, item.lat]\r\n      })\r\n\r\n      console.log(this.trackList[0])\r\n\r\n      if (this.trackList.length > 0) {\r\n        this.currentPosition = {\r\n          longitude: this.trackList[0][0],\r\n          latitude: this.trackList[0][1],\r\n        }\r\n      }\r\n\r\n      this.addLayer()\r\n    },\r\n\r\n    //添加巡检路线\r\n    addLayer() {\r\n      mapObj.map.getLayer('pump-route') && mapObj.map.removeLayer('pump-route')\r\n      mapObj.map.getSource('pump-route') && mapObj.map.removeSource('pump-route')\r\n\r\n      mapObj.map.addLayer({\r\n        id: 'pump-route',\r\n        type: 'line',\r\n        source: {\r\n          type: 'geojson',\r\n          data: {\r\n            type: 'Feature',\r\n            properties: {},\r\n            geometry: {\r\n              type: 'LineString',\r\n              coordinates: this.trackList,\r\n            },\r\n          },\r\n        },\r\n        layout: {\r\n          'line-join': 'round',\r\n          'line-cap': 'round',\r\n        },\r\n        paint: {\r\n          'line-color': '#2D7EFF',\r\n          'line-width': 2,\r\n        },\r\n      })\r\n    },\r\n\r\n    //上传巡检点列表\r\n    // async setTrackList() {\r\n    //   let { taskId } = this.$store.state.pump.urlQuery\r\n    //   let query = {\r\n    //     patrolTaskId: taskId,\r\n    //     trackDTOS: [\r\n    //       {\r\n    //         lat: 39.06075549589073,\r\n    //         lon: 115.92486101369428,\r\n    //       },\r\n    //       {\r\n    //         lat: 39.16075549589073,\r\n    //         lon: 115.92486101369428,\r\n    //       },\r\n    //     ],\r\n    //   }\r\n    //   const res = await uploadTrackList(query)\r\n    // },\r\n\r\n    //地图初始化\r\n    async mapLoaded(mapInstance) {\r\n      mapObj.mapInstance = mapInstance\r\n      mapObj.map = mapInstance.map\r\n\r\n      this.PatrolData && this.PatrolData.patrolStatus === 2\r\n        ? this.requestSingleLocation()\r\n        : await this.getTrackList()\r\n    },\r\n\r\n    //获取定位\r\n    requestSingleLocation() {\r\n      console.log('开启定位')\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.requestSingleLocation(\r\n          ['1'],\r\n          (res) => {\r\n            let { latitude, longitude } = res\r\n\r\n            let path = JSON.parse(JSON.stringify(this.$store.state.pump.pumpPath))\r\n\r\n            path.push({\r\n              lat: latitude,\r\n              lon: longitude,\r\n            })\r\n\r\n            this.trackList = path?.map((item) => {\r\n              return [item.lon, item.lat]\r\n            })\r\n\r\n            this.$store.commit('setPumpPath', path)\r\n\r\n            this.addLayer()\r\n\r\n            this.currentPosition = JSON.parse(JSON.stringify(res))\r\n            const param = {\r\n              ...this.currentPosition,\r\n            }\r\n            this.$refs.mymap.setInspUserPosition(param)\r\n          },\r\n          (err) => {\r\n            console.log('err=', err)\r\n          }\r\n        )\r\n      }\r\n    },\r\n\r\n    // 卡片定位\r\n    flyToPoint(lnglat) {\r\n      mapObj.map.flyTo({ center: lnglat, zoom: 17.5 })\r\n    },\r\n    // 开始定位\r\n    startLocation() {\r\n      if (\r\n        !this.currentPosition ||\r\n        !this.currentPosition.longitude ||\r\n        !this.currentPosition.latitude\r\n      ) {\r\n        this.$toast({\r\n          message: '获取位置失败!',\r\n          duration: 2000,\r\n        })\r\n        return\r\n      } else {\r\n        const coord = [\r\n          parseFloat(this.currentPosition.longitude),\r\n          parseFloat(this.currentPosition.latitude),\r\n        ]\r\n        this.flyToPoint(coord)\r\n      }\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.inspection-map {\r\n  position: relative;\r\n  height: 100%;\r\n  overflow: hidden;\r\n\r\n  .notify-network {\r\n    position: relative;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    height: 60px;\r\n    background: rgba(255, 77, 79, 0.2);\r\n    border-radius: 38px;\r\n    margin: 0 30px;\r\n    font-size: 28px;\r\n    color: #ff4d4f;\r\n\r\n    .cross-icon {\r\n      position: absolute;\r\n      right: 20px;\r\n      width: 28px;\r\n      height: 28px;\r\n    }\r\n  }\r\n\r\n  .map-line-remark {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    position: absolute;\r\n    bottom: 30px;\r\n    right: 30px;\r\n    width: 168px;\r\n    height: 68px;\r\n    font-size: 28px;\r\n    color: #000000;\r\n    background: #ffffff;\r\n    box-shadow: 0px 8px 20px 0px rgba(180, 197, 226, 1);\r\n    border-radius: 34px;\r\n    padding: 0 20px;\r\n\r\n    &::after {\r\n      display: inline-block;\r\n      content: '';\r\n      width: 40px;\r\n      height: 4px;\r\n      line-height: 68px;\r\n      background: #2d7eff;\r\n    }\r\n  }\r\n\r\n  .tool-box {\r\n    position: fixed;\r\n    width: 1.2rem;\r\n    height: auto;\r\n    right: 0.3rem;\r\n    bottom: 350px;\r\n\r\n    .refresh {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .route {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .location {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 60px;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}