{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PipeNetLeakDetection\\LeakDetectionMapPage.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PipeNetLeakDetection\\LeakDetectionMapPage.vue","mtime":1708928163406},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgVnVlIGZyb20gJ3Z1ZScNCmltcG9ydCBheGlvcyBmcm9tICdheGlvcycNCmltcG9ydCAqIGFzIEFwaSBmcm9tICcuL2FwaScNCmltcG9ydCBidXMgZnJvbSAnQC91dGlscy9idXMnDQppbXBvcnQgeyBFTlVNIH0gZnJvbSAnQC9zdG9yZS9TdGF0ZS9zdGF0ZVR5cGVzJw0KaW1wb3J0ICogYXMgdHVyZiBmcm9tICdAdHVyZi90dXJmJw0KaW1wb3J0IHsgYmJveCwgY2VudGVyIGFzIGdldENlbnRlciB9IGZyb20gJ0B0dXJmL3R1cmYnDQppbXBvcnQgX2Nsb25lRGVlcCBmcm9tICdsb2Rhc2gvY2xvbmVEZWVwJw0KaW1wb3J0IHsgYWRkSWNvblRvTWFwIH0gZnJvbSAnQC91dGlscy9tYXBVdGlscycNCmltcG9ydCBtYXBib3hnbCBmcm9tICdtYXBib3gtZ2wnDQppbXBvcnQgeyBUb2FzdCwgRGlhbG9nLCBOb3RpZnkgfSBmcm9tICdmYXdrZXMtbW9iaWxlLWxpYicNCmltcG9ydCBNYXBDb21wIGZyb20gJ0Avdmlld3MvaW5zcGVjdE1hcC9pbmRleC52dWUnDQppbXBvcnQgbWl4aW5zIGZyb20gJ0Avdmlld3MvaW5zcGVjdE1hcC9taXhpbnMvbWl4aW5zLmpzJw0KaW1wb3J0IGRheWpzIGZyb20gJ2RheWpzJw0KaW1wb3J0IHJlcXVlc3QgZnJvbSAnQC91dGlscy9yZXF1ZXN0Jw0KaW1wb3J0IExlYWtSZXBvcnRDYXJkSW5mbyBmcm9tICcuL0xlYWtSZXBvcnRDYXJkSW5mbycNCmltcG9ydCBQb3B1cCBmcm9tICcuL1BvcHVwLnZ1ZScNCmNvbnN0IFBvcHVwSXRlbSA9IFZ1ZS5leHRlbmQoUG9wdXApDQoNCmNvbnN0IG1hcE9iaiA9IHsNCiAgbWFwOiBudWxsLA0KICBtYXBJbnN0YW5jZTogbnVsbCwNCn0NCmxldCBwYXVzZVN0YXRlVHJhY2tQb2ludHMgPSBbXQ0KbGV0IHBhdXNlU3RhdGVQaXBlSWRMaXN0ID0gW10NCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJycsDQogIG1peGluczogW21peGluc10sDQogIGNvbXBvbmVudHM6IHsNCiAgICBNYXBDb21wLA0KICAgIExlYWtSZXBvcnRDYXJkSW5mbywNCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgaXNSZXN1bWU6IHRydWUsDQogICAgICAvLyDmt7vliqDoh7PlnLDlm77nmoTlm77niYcNCiAgICAgIGljb25zOiBbDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5rOE5ryP54K5JywNCiAgICAgICAgICB1cmw6IHJlcXVpcmUoJ0AvYXNzZXRzL2ltZy9tYXAv5rOE5ryP54K5LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgXSwNCiAgICAgIC8vIOW9k+WJjeeCueWHu+eahOS7u+WKoQ0KICAgICAgdGFza0RldGFpbDoge30sDQogICAgICAvLyDlt6Hmo4DlkZjkv6Hmga8NCiAgICAgIHVzZXJJbmZvOiB7fSwNCiAgICAgIC8vIOW3oeajgOS7u+WKoeS4i+aJgOacieW3oeajgOeuoee6vw0KICAgICAgYWxsVGFza0xpbmVzOiBbXSwNCiAgICAgIC8vIOW9k+WJjeW3oeajgOWRmOaJgOWkhOS9jee9rg0KICAgICAgY3VycmVudFBvc2l0aW9uOiBudWxsLA0KICAgICAgLy8g5piv5ZCm5byA5aeL6K6w5b2VDQogICAgICBpZlJlY29yZGluZzogZmFsc2UsDQogICAgICAvLyDova7or6LnirbmgIENCiAgICAgIHBvbGxpbmdGbGFnOiBmYWxzZSwNCiAgICAgIC8vIOaYr+WQpuS4uuafpeeci+eKtuaAgQ0KICAgICAgaXNWaWV3OiBmYWxzZSwNCiAgICAgIC8vIOaYr+WQpuS4uuW3oeajgOWRmOeZu+mZhu+8jHRydWXkuLrlt6Hmo4DlkZjnmbvlvZUNCiAgICAgIGlzSW5zcGVjdG9yTG9hZDogdHJ1ZSwNCiAgICAgIGlzT25Mb2FkOiBmYWxzZSwNCiAgICAgIC8vIOi9qOi/ueeCuQ0KICAgICAgdHJhY2tQb2ludExpc3Q6IFtdLA0KICAgICAgLy8g6L2o6L+55pe26Ze0DQogICAgICB0cmFja1BvaW50VGltZUxpc3Q6IFtdLA0KICAgICAgLy8g6LaF6YCf57q/5q61DQogICAgICBvdmVyU3BlZWRUcmFja0xpbmVMaXN0OiBbXSwNCiAgICAgIC8vIOiusOW9leW8gOWni+W3oeajgOeahOaXtumXtO+8jOeUqOS6juWIpOaWreaYr+WQpuWcqOW8gOWni+W3oeajgOeahDEwc+WGhQ0KICAgICAgc3RhcnRSZWNvcmRUaW1lcjogJycsDQogICAgICAvLyDkuIrmiqXlpLHotKXnmoTlt6Hmo4Dovajov7nngrnkvY3mlbDnu4QNCiAgICAgIHJlcG9ydEZhaWxUcmFja1BvaW50czogW10sDQogICAgICAvLyDlj7PkuIrop5LliqDlj7flvLnmoYYNCiAgICAgIHNob3dQb3BvdmVyOiBmYWxzZSwNCiAgICAgIGlmVGlwczogZmFsc2UsDQogICAgICBhY3Rpb25zOiBbDQogICAgICAgIHsNCiAgICAgICAgICB0ZXh0OiAn5LiK5oql5ryP54K5JywNCiAgICAgICAgfSwNCiAgICAgIF0sDQogICAgICBhY2Nlc3NUb2tlbjogdGhpcy4kc3RvcmFnZS5nZXQoJ2FjY2Vzc190b2tlbicpLA0KICAgICAgZm9ybVRva2VuOiAnJywNCiAgICAgIGhlYWRlcjoge30sDQogICAgICAvLyDnlKjkuo7liKTmlq3mmK/lkKbliqDovb3lrozkuIrmiqXmvI/ngrnmlbDmja4NCiAgICAgIHJlcG9ydERhdGFJc0xvYWRlZDogZmFsc2UsDQogICAgICAvLyDlrZjlgqjmvI/ngrnlt6XljZUNCiAgICAgIHByb2JsZW1EYXRhTGlzdDogW10sDQogICAgICAvLyDkuIrmiqXmmK/lkKbmmL7npLoNCiAgICAgIHJlcG9ydFNob3c6IGZhbHNlLA0KICAgICAgYWN0aXZlOiAwLA0KICAgICAgaWZFbmRUYXNrOiBmYWxzZSwNCiAgICAgIC8vIOe7k+adn+WOn+WboA0KICAgICAgc3RvcFJlYXNvbjogJycsDQogICAgICBpZkxlYXZlVGFzazogZmFsc2UsDQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIGNvbnNvbGUubG9nKCflrZjlgqjlnKjmnKzlnLDnmoTmo4DmvI/ku7vliqEnLCBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsZWFrRGV0ZWN0aW9uRGF0YScpKSkNCg0KICAgIC8vIOW9k+WJjeeCueWHu+eahOS7u+WKoe+8jOS7juacrOWcsOS4reiOt+WPlg0KICAgIHRoaXMudGFza0RldGFpbCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xlYWtEZXRlY3Rpb25EYXRhJykpLm5vd0NsaWNrVGFzaw0KICAgIC8vIOaYr+WQpuaYr+afpeeci+eKtuaAgQ0KICAgIHRoaXMuaXNWaWV3ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGVha0RldGVjdGlvbkRhdGEnKSkuaXNWaWV3DQogICAgdGhpcy51c2VySW5mbyA9IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvDQogICAgY29uc29sZS5sb2coJ3RoaXMudXNlckluZm8nLCB0aGlzLnVzZXJJbmZvKQ0KICAgIGNvbnNvbGUubG9nKCflvZPliY3ngrnlh7vnmoTku7vliqEnLCB0aGlzLnRhc2tEZXRhaWwpDQoNCiAgICBjb25zb2xlLmxvZygNCiAgICAgIHRoaXMudXNlckluZm8udXNlck5hbWUsDQogICAgICB0aGlzLnRhc2tEZXRhaWwuaW5zcGVjdG9yLA0KICAgICAgJy0tLS0tLeW3oeajgOS6uuWRmOS4juW9k+WJjeeZu+mZhui0puWPty0tLS0tLScsDQogICAgICB0aGlzLnVzZXJJbmZvLnVzZXJGdWxsbmFtZSwNCiAgICAgIHRoaXMudGFza0RldGFpbC5pbnNwZWN0b3JGdWxsTmFtZQ0KICAgICkNCg0KICAgIC8vIOW9k+W3oeajgOS6uuWRmOS4juW9k+WJjeeZu+mZhui0puWPt+S4gOiHtOaXtuaJjeiDveajgOa8jw0KICAgIGlmICgNCiAgICAgIHRoaXMudXNlckluZm8udXNlck5hbWUgIT0gdGhpcy50YXNrRGV0YWlsLmluc3BlY3RvciAmJg0KICAgICAgdGhpcy51c2VySW5mby51c2VyRnVsbG5hbWUgIT0gdGhpcy50YXNrRGV0YWlsLmluc3BlY3RvckZ1bGxOYW1lDQogICAgKSB7DQogICAgICBjb25zb2xlLmxvZygn5Lq65ZGY5LiN5LiA6Ie0JykNCiAgICAgIC8vIOaYr+WQpuS4uuW3oeajgOWRmOeZu+mZhu+8jHRydWXkuLrlt6Hmo4DlkZjnmbvlvZUNCiAgICAgIC8vIHRoaXMuaXNJbnNwZWN0b3JMb2FkID0gZmFsc2UNCiAgICB9DQogICAgLy8gaW5zcGVjdG9yOiAiY2hlbl9ib2xpbiINCiAgICAvLyBpbnNwZWN0b3JGdWxsTmFtZTogIumZiOWNmuaelyINCg0KICAgIC8vIHVzZXJGdWxsbmFtZTogIuWui+WHr+m+mSINCiAgICAvLyB1c2VyTmFtZTogInNvbmdfa2wiDQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncGF1c2UnLCB0aGlzLnBhdXNlLCBmYWxzZSkNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdyZXN1bWUnLCB0aGlzLnJlc3VtZSwgZmFsc2UpDQogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3N0YXJ0UmVjb3JkTGluZXMnLCAnZW5kJykNCiAgICAvLyBjb25zdCBpZCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xlYWtEZXRlY3Rpb25EYXRhJykpLnRhc2tJZA0KICAgIC8vIGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tJywgaWQpDQogICAgLy8gdGhpcy5nZXRUYXNrQnlJZChpZCkNCiAgICAvLyB0aGlzLmdldFRyYWNrUmVjb3Jkc0J5SWQoaWQpDQogICAgLy8gdGhpcy5nZXRBcHBJbnNwRGF0YShpZCkNCiAgICAvLyAhKGZ1bmN0aW9uIGNvbXB1dGVkUG9zaXRpb24oKSB7DQogICAgLy8gICBsZXQgZ2FwVGltZXIgPSAxMA0KICAgIC8vICAgaWYgKHRoYXQuY3VycmVudFBvc2l0aW9uKSB7DQogICAgLy8gICAgIC8vIOiuoeeul+W9k+WJjeaXtumXtOS4juW9k+WJjeaPkuS7tui/lOWbnueahOaXtumXtOeahOmXtOmalA0KICAgIC8vICAgICBsZXQgZ2FwID0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gbmV3IERhdGUodGhhdC5jdXJyZW50UG9zaXRpb24ubG9jVGltZSkuZ2V0VGltZSgpKSAvIDEwMDANCiAgICAvLyAgICAgLy8g5aaC5p6c6Ze06ZqU5pe26Ze05aSn5LqO5p+Q5LiA5YC877yM5YiZ6K+05piO5ZyoZ2FwVGltZXLml7bpl7TlhoXmsqHmnInmlLbliLDmnaXoh6rmj5Lku7bnmoTmlrDngrnkvY0NCiAgICAvLyAgICAgaWYgKGdhcCA+IGdhcFRpbWVyKSB7DQogICAgLy8gICAgICAgLy8g5byA5ZCv5o+Q56S6DQogICAgLy8gICAgICAgLy8gTm90aWZ5Lndhcm5pbmcoeyBtZXNzYWdlOiAn5b2T5YmNR1BT5L+h5Y+36L6D5byxLOS9jee9ruWSjOi9qOi/ueabtOaWsOWPr+iDvee8k+aFoicsIGR1cmF0aW9uOiA1MDAwIH0pDQogICAgLy8gICAgICAgbGV0IHQgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAvLyAgICAgICAgIC8vIOaPkOekuue7k+adn++8jOW5tuW8gOWni+S4i+asoeiwg+eUqA0KICAgIC8vICAgICAgICAgY29tcHV0ZWRQb3NpdGlvbigpDQogICAgLy8gICAgICAgfSwgMTUwMDApDQogICAgLy8gICAgIH0gZWxzZSB7DQogICAgLy8gICAgICAgLy8g5byA5aeL5LiL5qyh6LCD55SoDQogICAgLy8gICAgICAgbGV0IHQgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAvLyAgICAgICAgIGNvbXB1dGVkUG9zaXRpb24oKQ0KICAgIC8vICAgICAgIH0sIDEwMDAwKQ0KICAgIC8vICAgICB9DQogICAgLy8gICB9IGVsc2Ugew0KICAgIC8vICAgICAvLyBOb3RpZnkud2FybmluZyh7IG1lc3NhZ2U6ICflvZPliY1HUFPml6Dkv6EnLCBkdXJhdGlvbjogNTAwMCB9KQ0KICAgIC8vICAgICBsZXQgdCA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgIC8vICAgICAgIGNvbXB1dGVkUG9zaXRpb24oKQ0KICAgIC8vICAgICB9LCAxMDAwMCkNCiAgICAvLyAgIH0NCiAgICAvLyB9KSgpDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyDmt7Hmi7fotJ0NCiAgICBkZWVwQ2xvbmUoZGF0YSkgew0KICAgICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpDQogICAgfSwNCiAgICBwYXVzZSgpIHsNCiAgICAgIGNvbnNvbGUubG9nKCfov5vlhaXlkI7lj7AnKQ0KICAgICAgaWYgKHRoaXMuaWZSZWNvcmRpbmcgJiYgdGhpcy5pc1Jlc3VtZSkgew0KICAgICAgICB0aGlzLmlzUmVzdW1lID0gZmFsc2UNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlc3VtZSgpIHsNCiAgICAgIGNvbnNvbGUubG9nKCfov5vlhaXliY3lj7AnKQ0KICAgICAgaWYgKHRoaXMuaWZSZWNvcmRpbmcpIHsNCiAgICAgICAgdGhpcy5pc1Jlc3VtZSA9IHRydWUNCiAgICAgICAgcGF1c2VTdGF0ZVRyYWNrUG9pbnRzLmxlbmd0aCA+IDAgJiYNCiAgICAgICAgICB0aGlzLnVwTG9hZFBhdXNlU3RhdGVUcmFja1BvaW50cyh0aGlzLmRlZXBDbG9uZShwYXVzZVN0YXRlVHJhY2tQb2ludHMpKQ0KICAgICAgICBwYXVzZVN0YXRlUGlwZUlkTGlzdC5sZW5ndGggPiAwICYmDQogICAgICAgICAgdGhpcy51cExvYWRQYXVzZVN0YXRlUGlwZUlkTGlzdCh0aGlzLmRlZXBDbG9uZShwYXVzZVN0YXRlUGlwZUlkTGlzdCkpDQogICAgICB9DQogICAgfSwNCiAgICB1cExvYWRQYXVzZVN0YXRlVHJhY2tQb2ludHMoZGF0YSkgew0KICAgICAgLy8gYXBw5re75Yqg5LiK5Lyg5aSx6LSl54K555qE566h572R5qOA5ryP6L2o6L+5DQogICAgICBBcGkuaW5zcGVjdGlvblRyYWNrKGRhdGEpDQogICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCflkI7lj7Dlt6Hmo4Dovajov7nooaXlhYXngrnkvY3kuIrkvKDmiJDlip8nKQ0KICAgICAgICAgICAgcGF1c2VTdGF0ZVRyYWNrUG9pbnRzLnNwbGljZSgwLCBkYXRhLmxlbmd0aCkgLy8g56e76Zmk5LiK5Lyg5oiQ5Yqf55qE54K55L2N44CC6YG/5YWN6YeN5aSN5LiK5LygDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCflkI7lj7Dlt6Hmo4Dovajov7nooaXlhYXngrnkvY3kuIrkvKDlvILluLgnKQ0KICAgICAgICAgICAgdGhpcy5yZXBvcnRGYWlsVHJhY2tQb2ludHMucHVzaCguLi5kYXRhKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKChlcnIpID0+IHsNCiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIHRoaXMudXBMb2FkUGF1c2VTdGF0ZVRyYWNrUG9pbnRzKGRhdGEpDQogICAgICAgICAgfSwgNSAqIDEwMDApDQogICAgICAgIH0pDQogICAgfSwNCiAgICB1cExvYWRQYXVzZVN0YXRlUGlwZUlkTGlzdChkYXRhKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIC8vIGFwcOa3u+WKoOeuoee9keajgOa8j+iusOW9lQ0KICAgICAgQXBpLnJlY29yZEluc3BMaW5lKGRhdGEpDQogICAgICAgIC50aGVuKGFzeW5jIChyZXMpID0+IHsNCiAgICAgICAgICBpZiAocmVzLnN0YXR1cykgew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ+WQjuWPsOW3oeajgOeuoee6v+ihpeWFheaVsOaNruS4iuS8oOaIkOWKnycpDQogICAgICAgICAgICBwYXVzZVN0YXRlUGlwZUlkTGlzdC5zcGxpY2UoMCwgZGF0YS5sZW5ndGgpIC8vIOenu+mZpOS4iuS8oOaIkOWKn+eahOaVsOaNruOAgumBv+WFjemHjeWkjeS4iuS8oA0KICAgICAgICAgICAgLy8g5qC55o2uSUTmn6Xor6LlvZPliY3mo4DmvI/ku7vliqENCiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IEFwaS5nZXRJbnNwTGVha1Rhc2tEZXRhaWwoew0KICAgICAgICAgICAgICBpZDogSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGVha0RldGVjdGlvbkRhdGEnKSkudGFza0lkLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfmoLnmja5JROafpeivouW9k+WJjeajgOa8j+S7u+WKoScsIHJlcykNCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7DQogICAgICAgICAgICAgIHRoYXQudGFza0RldGFpbCA9IHJlcy5kYXRhDQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoYXQuJHJlZnMubXltYXAudXBsb2FkRmlsZWRQaXBlSWRMaXN0LnB1c2goLi4uZGF0YSkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7DQogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICB0aGlzLnVwTG9hZFBhdXNlU3RhdGVQaXBlSWRMaXN0KGRhdGEpDQogICAgICAgICAgfSwgNSAqIDEwMDApDQogICAgICAgIH0pDQogICAgfSwNCiAgICAvLyDliankvZnml7bpl7QNCiAgICBnZXRSZXN0VGltZSh0aW1lKSB7DQogICAgICByZXR1cm4gdGltZSA/IG5ldyBEYXRlKHRpbWUpLmdldFRpbWUoKSAtIG5ldyBEYXRlKCkuZ2V0VGltZSgpIDogMA0KICAgIH0sDQogICAgLy8g6KaG55uW546H6K6h566XDQogICAgY2hhbmdlVG9SYXRlKGNvdmVyYWdlKSB7DQogICAgICBpZiAoY292ZXJhZ2UgIT0gbnVsbCAmJiB0eXBlb2YgKGNvdmVyYWdlICogMSkgPT0gJ251bWJlcicpIHsNCiAgICAgICAgcmV0dXJuIGNvdmVyYWdlICsgJyUnDQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gJzAlJw0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5Zyw5Zu+5Yid5aeL5YyWDQogICAgYXN5bmMgbWFwTG9hZGVkKG1hcEluc3RhbmNlKSB7DQogICAgICBtYXBPYmoubWFwSW5zdGFuY2UgPSBtYXBJbnN0YW5jZQ0KICAgICAgbWFwT2JqLm1hcCA9IG1hcEluc3RhbmNlLm1hcA0KICAgICAgLy8g5re75Yqg6LW354K557uI54K55Zu+54mHDQogICAgICB0aGlzLmFkZE1hcEltZygpDQogICAgICBhd2FpdCBhZGRJY29uVG9NYXAobWFwT2JqLm1hcCwgdGhpcy5pY29ucykNCiAgICAgIC8vIOa3u+WKoOS7u+WKoeiMg+WbtOOAgeeuoee6v+WbvuWxgnNvdXJjZeOAgWxheWVyDQogICAgICB0aGlzLmFkZFNvdXJjZUxheWVyKCkNCg0KICAgICAgLy/kv67mlLnkvpvmsLTljoLlm77moIcNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ21hcF93YXRlcndvcmsnLCAnaWNvbi1pbWFnZScsICfkvpvmsLTljoInKQ0KICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnbWFwX3dhdGVyd29yaycsICdpY29uLXNpemUnLCAwLjYpDQogICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdtYXBfc3VwcGx5X3B1bXAnLCAnaWNvbi1pbWFnZScsICfnu5nmsLTliqDljovms7Xnq5knKQ0KICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnbWFwX3N1cHBseV9wdW1wJywgJ2ljb24tc2l6ZScsIDAuNikNCiAgICAgIC8vIOmakOiXj+WFreawtOWQiOS4gOm7mOiupOWbvuWxgg0KICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgncmRfbWFwX2NvbWInLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9tYW5ob2xlJywgJ3Zpc2liaWxpdHknLCAnbm9uZScpDQogICAgICAvLyDmsaHmsLTnm7jlhbMNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9kcmFpbnBpcGVfd3NfYmlnJywgJ3Zpc2liaWxpdHknLCAnbm9uZScpDQogICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdyZF9tYXBfZHJhaW5waXBlX3dzX2JpZ19kaXJlY3Rpb24nLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9kcmFpbnBpcGVfd3Nfc21hbGwnLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9kcmFpbnBpcGVfd3Nfc21hbGxfZGlyZWN0aW9uJywgJ3Zpc2liaWxpdHknLCAnbm9uZScpDQogICAgICAvLyDpm6jmsLTnm7jlhbMNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9kcmFpbnBpcGVfeXNfYmlnJywgJ3Zpc2liaWxpdHknLCAnbm9uZScpDQogICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdyZF9tYXBfZHJhaW5waXBlX3lzX2JpZ19kaXJlY3Rpb24nLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9kcmFpbnBpcGVfeXNfc21hbGwnLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9kcmFpbnBpcGVfeXNfc21hbGxfZGlyZWN0aW9uJywgJ3Zpc2liaWxpdHknLCAnbm9uZScpDQogICAgICAvLyDmmL7npLrkvpvmsLTnrqHnur/lm77lsYINCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ21hcF9zdXBwbHlfcGlwZV9kaXN0cmlidXRlJywgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpDQogICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdtYXBfc3VwcGx5X3BpcGVfY2lyY3VsYXRpbmcnLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ21hcF9zdXBwbHlfcGlwZV9kZWxpdmVyeScsICd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKQ0KICAgICAgLy8gbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSggIjExMTExMTExMTExMTExMTExMTExMTExMTEiLCAidmlzaWJpbGl0eSIsICJ2aXNpYmxlIiApOw0KICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnbWFwX3dhdGVyd29yaycsICd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKQ0KICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnbWFwX3N1cHBseV9wdW1wJywgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpDQogICAgICAvLyBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCAiMTExMTExMTExMTExMTExMTExMTExMTExMSIsICJ2aXNpYmlsaXR5IiwgInZpc2libGUiICk7DQogICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdtYXBfc3VwcGx5X3ZhbHZlJywgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpDQogICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdtYXBfc3VwcGx5X2ZpcmVoeWRyYW50JywgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpDQoNCiAgICAgIC8vIOa3u+WKoOS7u+WKoeiMg+WbtOOAgeeuoee6v+WbvuWxgg0KICAgICAgYXdhaXQgdGhpcy5hZGRUYXNrUmFuZ2VBbmRMaW5lcygpDQogICAgICAvLyDpl67popjkuIrmiqXmjqXlj6MNCiAgICAgIGF3YWl0IHRoaXMuZ2V0UHJvYmxlbURhdGFMaXN0KCkNCiAgICAgIC8vIHRoaXMuZ2V0VGFza0J5SWQoaWQpDQoNCiAgICAgIC8vIOW3oeajgOS6uuWRmHNvdXJjZeW3sua3u+WKoA0KDQogICAgICAvLyDorr7nva7lt6Hmo4DlkZjkvY3nva4NCiAgICAgIC8vIHRoaXMuJHJlZnMubXltYXAuc2V0SW5zcFVzZXJQb3NpdGlvbih7DQogICAgICAvLyAgIGxvbmdpdHVkZTogMTE1LjkyOTg3MDc4MDEzNjM1LA0KICAgICAgLy8gICBsYXRpdHVkZTogMzkuMDYyMDYyODM2OTkwMDY2LA0KICAgICAgLy8gfSkNCg0KICAgICAgLy8g5beh5qOA5qih5ouf77yM54K55Ye75Zyw5Zu+5qih5ouf6LWw5YqoDQogICAgICAvLyBtYXBPYmoubWFwLm9uKCdjbGljaycsIChlKSA9PiB7DQogICAgICAvLyAgIGNvbnNvbGUubG9nKCfngrnlh7vlnLDlm74nLCBlLmxuZ0xhdCkNCiAgICAgIC8vICAgdGhpcy5jdXJyZW50UG9zaXRpb24gPSB7DQogICAgICAvLyAgICAgbG9uZ2l0dWRlOiBlLmxuZ0xhdC5sbmcsDQogICAgICAvLyAgICAgbGF0aXR1ZGU6IGUubG5nTGF0LmxhdCwNCiAgICAgIC8vICAgfQ0KICAgICAgLy8gICAvLyB7DQogICAgICAvLyAgIC8vICAgbG5nOiAxMTUuOTIxMDE4NjYyNzE1MDMsDQogICAgICAvLyAgIC8vICAgbGF0OiAzOS4wNjEzNzkyOTkxMjQxMywNCiAgICAgIC8vICAgLy8gfSkNCiAgICAgIC8vIH0pDQogICAgICAvLyB0aGlzLmN1cnJlbnRQb3NpdGlvbiA9IHsNCiAgICAgIC8vICAgbG9uZ2l0dWRlOiAnMTE1LjkwNDU3Njk3Nzc5MjA5JywNCiAgICAgIC8vICAgbGF0aXR1ZGU6ICczOS4wNDU2NzE4ODM4ODg5ODYnLA0KICAgICAgLy8gfQ0KICAgICAgLy8g5Lq65ZGY5a6a5L2NDQogICAgICBpZiAodHlwZW9mIHl1YW5jaHUgIT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAucmVxdWVzdFNpbmdsZUxvY2F0aW9uKA0KICAgICAgICAgIFsnMSddLA0KICAgICAgICAgIChyZXMpID0+IHsNCiAgICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXMpKQ0KICAgICAgICAgICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAgICAgICAgIC4uLnRoaXMuY3VycmVudFBvc2l0aW9uLA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy4kcmVmcy5teW1hcC5zZXRJbnNwVXNlclBvc2l0aW9uKHBhcmFtKQ0KICAgICAgICAgIH0sDQogICAgICAgICAgKGVycikgPT4gew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycikNCiAgICAgICAgICB9DQogICAgICAgICkNCiAgICAgIH0NCiAgICAgIGNvbnNvbGUubG9nKCd0aGlzLmN1cnJlbnRQb3NpdGlvbicsIHRoaXMuY3VycmVudFBvc2l0aW9uKQ0KICAgIH0sDQogICAgLy8g5qC55o2u6YCf5bqm5pS55Y+Y5beh5qOA566h57q/6aKc6ImyDQogICAgYXN5bmMgY2hhbmdlSW5zcExpbmVTb3VyY2VCeVNwZWVkKHBvc2l0aW9uKSB7DQogICAgICBjb25zdCBjb29yZCA9IFtwYXJzZUZsb2F0KHBvc2l0aW9uLmxvbmdpdHVkZSksIHBhcnNlRmxvYXQocG9zaXRpb24ubGF0aXR1ZGUpXQ0KICAgICAgY29uc3QgcG9pbnQgPSB0dXJmLnBvaW50KGNvb3JkKQ0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3QgdGhhdCA9IHRoaXMNCiAgICAgICAgbGV0IHRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICAgIGlmIChtYXBPYmoubWFwLmdldFNvdXJjZSgnaW5zcFVzZXInKSAmJiBtYXBPYmoubWFwLmlzU291cmNlTG9hZGVkKCdpbnNwVXNlcicpKSB7DQogICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVyKQ0KICAgICAgICAgICAgaWYgKHRydWUpIHsNCiAgICAgICAgICAgICAgLy8g5pS55Y+Y5ZGo5Zu06KaB57Sg55qE54q25oCBDQogICAgICAgICAgICAgIGxldCBidWZmZXJlZCA9IHR1cmYuYnVmZmVyKHBvaW50LCAwLjAxNSwgeyB1bml0OiAna2lsb21ldGVycycgfSkNCiAgICAgICAgICAgICAgdGhhdC5jaGFuZ2VJbnNwTGluZVN0YXRlKGJ1ZmZlcmVkKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSwgMTAwKQ0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICBjb25zb2xlLmxvZyhlKQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g6K6+572u5beh5qOA566h57q/5Li65bey5beh5qOADQogICAgY2hhbmdlSW5zcExpbmVTdGF0ZShnZW9tZXRyeSkgew0KICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICAvLyDlsIblnLDnkIblnZDmoIfns7vovazljJbkuLrlsY/luZXlnZDmoIfns7sNCiAgICAgIGZ1bmN0aW9uIGdlb1RyYW5zVG9QaXhlbChnZW9tKSB7DQogICAgICAgIGNvbnN0IHBvbHlnb25Cb3ggPSB0dXJmLmJib3goZ2VvbSkNCiAgICAgICAgY29uc3Qgc291dGhXZXN0ID0gW3BvbHlnb25Cb3hbMF0sIHBvbHlnb25Cb3hbMV1dDQogICAgICAgIGNvbnN0IG5vcnRoRWFzdCA9IFtwb2x5Z29uQm94WzJdLCBwb2x5Z29uQm94WzNdXQ0KICAgICAgICBsZXQgc291dGhXZXN0UG9pbnRQaXhlbCA9IG1hcE9iai5tYXAucHJvamVjdChzb3V0aFdlc3QpDQogICAgICAgIGxldCBub3J0aEVhc3RQb2ludFBpeGVsID0gbWFwT2JqLm1hcC5wcm9qZWN0KG5vcnRoRWFzdCkNCiAgICAgICAgLy8g5aKe5aSnYmJveOeahOafpeivouiMg+WbtA0KICAgICAgICBzb3V0aFdlc3RQb2ludFBpeGVsID0gW3NvdXRoV2VzdFBvaW50UGl4ZWwueCAtIDUwLCBzb3V0aFdlc3RQb2ludFBpeGVsLnkgKyA1MF0NCiAgICAgICAgbm9ydGhFYXN0UG9pbnRQaXhlbCA9IFtub3J0aEVhc3RQb2ludFBpeGVsLnggKyA1MCwgbm9ydGhFYXN0UG9pbnRQaXhlbC55IC0gNTBdDQogICAgICAgIHJldHVybiBbc291dGhXZXN0UG9pbnRQaXhlbCwgbm9ydGhFYXN0UG9pbnRQaXhlbF0NCiAgICAgIH0NCiAgICAgIC8vIOWvueavj+S4quWIkuWIhuWHuuadpeeahGJib3jov5vooYzlpITnkIYNCiAgICAgIGFzeW5jIGZ1bmN0aW9uIGNodW5rKGdlb20pIHsNCiAgICAgICAgLy8gbGV0IHdhc0xvYWRlZCA9IGZhbHNlOw0KICAgICAgICAvLyBpZiAod2FzTG9hZGVkKSByZXR1cm47DQogICAgICAgIGNvbnNvbGUubG9nKCdnZW9UcmFuc1RvUGl4ZWwoZ2VvbSknLCBnZW9UcmFuc1RvUGl4ZWwoZ2VvbSkpDQogICAgICAgIC8vIOafpeivouWxj+W5leiMg+WbtOWGheS4reS7u+WKoeiMg+WbtOWGheeahOeuoee6v+WbvuWxgu+8iOe6ouiJsuaIluiAhee7v+iJsu+8iQ0KICAgICAgICBjb25zdCBib3hGZWF0dXJlcyA9IG1hcE9iai5tYXAucXVlcnlSZW5kZXJlZEZlYXR1cmVzKGdlb1RyYW5zVG9QaXhlbChnZW9tKSwgew0KICAgICAgICAgIGxheWVyczogWydkZXRlY3Rpb25QaXBlTGF5ZXInXSwNCiAgICAgICAgfSkNCiAgICAgICAgY29uc29sZS5sb2coYm94RmVhdHVyZXMsICdib3hGZWF0dXJlcycpDQoNCiAgICAgICAgLy8g5a2Y5YKo566h57q/5LiO55yf5a6e55qE6IyD5Zu055u45Lqk5LiU5rKh5pyJ6KKr5beh5qOA6L+H55qE566h57q/DQogICAgICAgIGxldCB0ZW1wUGlwZUxpc3QgPSBbXQ0KICAgICAgICBib3hGZWF0dXJlcy5mb3JFYWNoKChmZWF0KSA9PiB7DQogICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIC8vIGNvbnN0IHJlc3VsdCA9IHR1cmYuaW50ZXJzZWN0KGZlYXQuZ2VvbWV0cnksIGdlb21ldHJ5KTsNCiAgICAgICAgICAgIC8vIOWmguaenOS4pOS4quWHoOS9leWbvuW9oueahOS6pOeCueS4uuepuumbhu+8jOWImei/lOWbnihUUlVFKeOAgg0KICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdHVyZi5ib29sZWFuRGlzam9pbnQoZmVhdC5nZW9tZXRyeSwgZ2VvbWV0cnkpDQogICAgICAgICAgICBjb25zb2xlLmxvZygNCiAgICAgICAgICAgICAgJ+eCueS4juiMg+WbtOaYr+WQpuebuOS6pC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScsDQogICAgICAgICAgICAgIHJlc3VsdCwNCiAgICAgICAgICAgICAgZmVhdC5nZW9tZXRyeSwNCiAgICAgICAgICAgICAgZ2VvbWV0cnkNCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIC8vIOWmguaenOafpeWHuueahOimgee0oOS4juecn+WunueahOiMg+WbtOebuOS6pOS4lOayoeacieiiq+W3oeajgOi/h++8jOWImeaUueWPmOWFtueKtuaAge+8jOW5tuiusOW9leWFtuWFs+mUruWtlw0KICAgICAgICAgICAgaWYgKCFyZXN1bHQgJiYgIWZlYXQuc3RhdGUuaXNJbnNwKSB7DQogICAgICAgICAgICAgIG1hcE9iai5tYXAuc2V0RmVhdHVyZVN0YXRlKA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgIHNvdXJjZTogZmVhdC5zb3VyY2UsDQogICAgICAgICAgICAgICAgICBpZDogZmVhdC5pZCwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsgaXNJbnNwOiB0cnVlIH0NCiAgICAgICAgICAgICAgKQ0KDQogICAgICAgICAgICAgIGlmICghdGVtcFBpcGVMaXN0Lm1hcCgoaXQpID0+IGl0LnBpcGVJZCkuaW5jbHVkZXMoZmVhdC5pZCkpIHsNCiAgICAgICAgICAgICAgICBsZXQgZGF0ZSA9IHRoYXQuJGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJykNCiAgICAgICAgICAgICAgICB0ZW1wUGlwZUxpc3QucHVzaCh7DQogICAgICAgICAgICAgICAgICBwb3J0YWxJZDogdGhhdC50YXNrRGV0YWlsLnBvcnRhbElkLA0KICAgICAgICAgICAgICAgICAgaW5zcERhdGU6IGRhdGUsIC8vIOW3oeajgOaXpeacnw0KICAgICAgICAgICAgICAgICAgcGlwZUlkOiBmZWF0LmlkLCAvLyDnrqHnur9pZA0KICAgICAgICAgICAgICAgICAgZXh0MzogJ+S+m+awtCcsDQogICAgICAgICAgICAgICAgICBwaXBlTGVuZ3RoOiBmZWF0LnByb3BlcnRpZXNbJ2xlbmd0aCddIHx8IDAsIC8vIOeuoee6v+mVv+W6pg0KICAgICAgICAgICAgICAgICAgdGFza0lkOiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsZWFrRGV0ZWN0aW9uRGF0YScpKS50YXNrSWQsIC8vIOS7u+WKoWlkDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIGlmICh0aGF0LmlzUmVzdW1lKSB7DQogICAgICAgICAgdGVtcFBpcGVMaXN0Lmxlbmd0aCA+IDAgJiYNCiAgICAgICAgICAgIC8vIGFwcOa3u+WKoOeuoee9keajgOa8j+iusOW9lQ0KICAgICAgICAgICAgQXBpLnJlY29yZEluc3BMaW5lKHRlbXBQaXBlTGlzdCkudGhlbihhc3luYyAocmVzKSA9PiB7DQogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+euoee6v+S4iuS8oOaIkOWKnycpDQogICAgICAgICAgICAgICAgLy8g5qC55o2uSUTmn6Xor6LlvZPliY3mo4DmvI/ku7vliqENCiAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBBcGkuZ2V0SW5zcExlYWtUYXNrRGV0YWlsKHsNCiAgICAgICAgICAgICAgICAgIGlkOiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsZWFrRGV0ZWN0aW9uRGF0YScpKS50YXNrSWQsDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5qC55o2uSUTmn6Xor6LlvZPliY3mo4DmvI/ku7vliqEnLCByZXMpDQogICAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICAgICAgICAgIHRoYXQudGFza0RldGFpbCA9IHJlcy5kYXRhDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIGJ1cy4kZW1pdCgndXBkYXRlRGF0YScpDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+S4iuS8oOWksei0peeahHRlbXBQaXBlTGlzdDogJywgdGVtcFBpcGVMaXN0KQ0KICAgICAgICAgICAgICAgIC8vIOS4iuS8oOWksei0peeahOW3suW3oeajgOeuoee6v2lkDQogICAgICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC51cGxvYWRGaWxlZFBpcGVJZExpc3QucHVzaCguLi50ZW1wUGlwZUxpc3QpDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGVtcFBpcGVMaXN0Lmxlbmd0aCA+IDAgJiYgcGF1c2VTdGF0ZVBpcGVJZExpc3QucHVzaCguLi50ZW1wUGlwZUxpc3QpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGZ1bmN0aW9uIGNiKGZlYXR1cmVzKSB7DQogICAgICAgIGlmIChmZWF0dXJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBjaHVuayhmZWF0dXJlcy5zaGlmdCgpKQ0KICAgICAgICAgICAgY2IoZmVhdHVyZXMpDQogICAgICAgICAgfSwgMTAwKQ0KICAgICAgICB9DQogICAgICB9DQogICAgICBjYihbZ2VvbWV0cnldKQ0KICAgIH0sDQogICAgLy8g5re75Yqg5Lu75Yqh6IyD5Zu044CB566h57q/5Zu+5bGCDQogICAgYXN5bmMgYWRkVGFza1JhbmdlQW5kTGluZXMoKSB7DQogICAgICAvLyDmoLnmja5JROafpeivouW9k+WJjeajgOa8j+S7u+WKoQ0KICAgICAgY29uc3QgcmVzRGF0YTEgPSBhd2FpdCBBcGkuZ2V0SW5zcExlYWtUYXNrRGV0YWlsKHsgaWQ6IHRoaXMudGFza0RldGFpbC5pZCB9KQ0KICAgICAgLy8g5b2T5YmN54K55Ye755qE5Lu75Yqh77yM5LuO5o6l5Y+j5Lit6I635Y+WDQogICAgICB0aGlzLnRhc2tEZXRhaWwgPSByZXNEYXRhMT8uZGF0YSB8fCB7fQ0KICAgICAgdGhpcy50YXNrRGV0YWlsLnRhc2tUeXBlID0gJ+S6uuW3oScNCiAgICAgIGNvbnNvbGUubG9nKCfmoLnmja5JROafpeivouW9k+WJjeajgOa8j+S7u+WKoScsIHRoaXMudGFza0RldGFpbCkNCiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgLy8g5re75Yqg6IyD5Zu05Zu+5bGC5bm25a6a5L2NDQogICAgICB0aGlzLnNldERldGVjdGlvblJhbmdlRGF0YShKU09OLnBhcnNlKHRoaXMudGFza0RldGFpbC5nZW9tKSkNCg0KICAgICAgLy8g5YiG6aG15p+l6K+i566h572R5bey5qOA5ryP6K6w5b2VDQogICAgICBjb25zdCByZXNEYXRhMiA9IGF3YWl0IEFwaS5nZXRIYXNJbnNwTGVha1BpcGUoew0KICAgICAgICB0YXNrSWQ6IHRoaXMudGFza0RldGFpbC5pZCwNCiAgICAgICAgcGFnZTogMSwNCiAgICAgICAgc2l6ZTogOTk5OTksDQogICAgICB9KQ0KICAgICAgbGV0IGhhc0luc3BQaXBlID0gW10NCiAgICAgIGlmIChyZXNEYXRhMi5zdGF0dXMpIHsNCiAgICAgICAgaGFzSW5zcFBpcGUgPSByZXNEYXRhMi5kYXRhLnJlY29yZHMubWFwKChpdGVtKSA9PiBpdGVtLnBpcGVJZCkNCiAgICAgICAgY29uc29sZS5sb2coJ+WIhumhteafpeivoueuoee9keW3suajgOa8j+iusOW9lScsIHJlc0RhdGEyLmRhdGEucmVjb3JkcykNCiAgICAgIH0NCg0KICAgICAgLy8g5qC55o2u5Lu75Yqh6IyD5Zu05p+l6K+i566h57q/5pWw5o2uDQogICAgICBsZXQgcGFyYW1zID0gew0KICAgICAgICBiaXpUeXBlOiAn5L6b5rC0JywNCiAgICAgICAgZGV2VHlwZTogJ+euoee6vycsDQogICAgICAgIGdlb21TdHI6IHRoaXMudGFza0RldGFpbC5nZW9tLA0KICAgICAgICBwYWdlTnVtOiAxLA0KICAgICAgICBwYWdlU2l6ZTogOTk5OTksDQogICAgICB9DQogICAgICBhd2FpdCBBcGkuZ2V0QWxsTGVha0xpbmVzKHBhcmFtcykudGhlbigocmVzKSA9PiB7DQogICAgICAgIGNvbnNvbGUubG9nKCflt6Hmo4Dku7vliqHkuIvmiYDmnInlt6Hmo4DnrqHnur8nLCByZXMpDQogICAgICAgIGlmIChyZXMuc3RhdHVzICYmIHJlcy5kYXRhLmxpc3QubGVuZ3RoID4gMCkgew0KICAgICAgICAgIC8vIOW3oeajgOS7u+WKoeS4i+aJgOacieW3oeajgOeuoee6vw0KICAgICAgICAgIHRoaXMuYWxsVGFza0xpbmVzID0gW10NCiAgICAgICAgICByZXMuZGF0YS5saXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgIGlmIChoYXNJbnNwUGlwZS5pbmNsdWRlcyhpdGVtLmlkKSkgew0KICAgICAgICAgICAgICAvLyDlt6Hmo4Dku7vliqHkuIvmiYDmnInlt6Hmo4DnrqHnur8t5bey5beh5qOADQogICAgICAgICAgICAgIHRoaXMuYWxsVGFza0xpbmVzLnB1c2goew0KICAgICAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJywNCiAgICAgICAgICAgICAgICBpZDogaXRlbS5pZCwNCiAgICAgICAgICAgICAgICBnZW9tZXRyeTogSlNPTi5wYXJzZShpdGVtLmdlb20pLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsNCiAgICAgICAgICAgICAgICAgIGlzSW5zcDogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgIC4uLml0ZW0sDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgbWFwT2JqLm1hcC5zZXRGZWF0dXJlU3RhdGUoDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgc291cmNlOiAnZGV0ZWN0aW9uUGlwZScsDQogICAgICAgICAgICAgICAgICBpZDogaXRlbS5pZCwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgIC8vIOW3suW3oeajgO+8jOe7v+iJsg0KICAgICAgICAgICAgICAgICAgaXNJbnNwOiB0cnVlLA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgLy8g5beh5qOA5Lu75Yqh5LiL5omA5pyJ5beh5qOA566h57q/LeacquW3oeajgA0KICAgICAgICAgICAgICB0aGlzLmFsbFRhc2tMaW5lcy5wdXNoKHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgICAgICAgaWQ6IGl0ZW0uaWQsDQogICAgICAgICAgICAgICAgZ2VvbWV0cnk6IEpTT04ucGFyc2UoaXRlbS5nZW9tKSwNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7DQogICAgICAgICAgICAgICAgICBpc0luc3A6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgLi4uaXRlbSwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICBtYXBPYmoubWFwLnNldEZlYXR1cmVTdGF0ZSgNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICBzb3VyY2U6ICdkZXRlY3Rpb25QaXBlJywNCiAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkLA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgLy8g5pyq5beh5qOA77yM57qi6ImyDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgaXNJbnNwOiBmYWxzZSwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICAgIC8vIOa3u+WKoOiMg+WbtOWGheeuoee6v+WbvuWxgg0KICAgICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCdkZXRlY3Rpb25QaXBlJykuc2V0RGF0YSh7DQogICAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgICAgZmVhdHVyZXM6IHRoaXMuYWxsVGFza0xpbmVzLA0KICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyDmt7vliqDku7vliqHojIPlm7TjgIHnrqHnur/lm77lsYJzb3VyY2XjgIFsYXllcg0KICAgIGFkZFNvdXJjZUxheWVyKCkgew0KICAgICAgLy8g6IyD5Zu06Z2i5Y+K6L655qGGDQogICAgICBtYXBPYmoubWFwLmFkZFNvdXJjZSgnZGV0ZWN0aW9uUmFuZ2UnLCB7DQogICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgZGF0YTogew0KICAgICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICB9LA0KICAgICAgfSkNCiAgICAgIG1hcE9iai5tYXAuYWRkTGF5ZXIoew0KICAgICAgICBpZDogJ2RldGVjdGlvblJhbmdlTGF5ZXJfZmlsbCcsDQogICAgICAgIHNvdXJjZTogJ2RldGVjdGlvblJhbmdlJywNCiAgICAgICAgdHlwZTogJ2ZpbGwnLA0KICAgICAgICBwYWludDogew0KICAgICAgICAgICdmaWxsLWNvbG9yJzogJyMzMkM1RkYnLA0KICAgICAgICAgICdmaWxsLW9wYWNpdHknOiAwLjEsDQogICAgICAgIH0sDQogICAgICB9KQ0KICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgIGlkOiAnZGV0ZWN0aW9uUmFuZ2VMYXllcl9saW5lJywNCiAgICAgICAgc291cmNlOiAnZGV0ZWN0aW9uUmFuZ2UnLA0KICAgICAgICB0eXBlOiAnbGluZScsDQogICAgICAgIHBhaW50OiB7DQogICAgICAgICAgJ2xpbmUtY29sb3InOiAnIzMyQzVGRicsDQogICAgICAgICAgJ2xpbmUtd2lkdGgnOiAyLA0KICAgICAgICAgICdsaW5lLWRhc2hhcnJheSc6IFs0LCA0XSwNCiAgICAgICAgfSwNCiAgICAgIH0pDQoNCiAgICAgIC8vIOiMg+WbtOWGheeuoee6vw0KICAgICAgbWFwT2JqLm1hcC5hZGRTb3VyY2UoJ2RldGVjdGlvblBpcGUnLCB7DQogICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgZGF0YTogew0KICAgICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICB9LA0KICAgICAgfSkNCiAgICAgIG1hcE9iai5tYXAuYWRkTGF5ZXIoDQogICAgICAgIHsNCiAgICAgICAgICBpZDogJ2RldGVjdGlvblBpcGVMYXllcicsDQogICAgICAgICAgc291cmNlOiAnZGV0ZWN0aW9uUGlwZScsDQogICAgICAgICAgdHlwZTogJ2xpbmUnLA0KICAgICAgICAgIHBhaW50OiB7DQogICAgICAgICAgICAnbGluZS1jb2xvcic6IFsNCiAgICAgICAgICAgICAgJ2Nhc2UnLA0KICAgICAgICAgICAgICBbJ2Jvb2xlYW4nLCBbJ2ZlYXR1cmUtc3RhdGUnLCAnaXNJbnNwJ10sIGZhbHNlXSwNCiAgICAgICAgICAgICAgJyM0NEJBNUEnLA0KICAgICAgICAgICAgICAnI0ZGMDAwMCcsDQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgJ2xpbmUtd2lkdGgnOiAzLA0KICAgICAgICAgIH0sDQogICAgICAgIH0sDQogICAgICAgICdyZF9tYXBfb3V0ZmFsbCcNCiAgICAgICkNCiAgICB9LA0KICAgIC8vIOa3u+WKoOiMg+WbtOWbvuWxguW5tuWumuS9jQ0KICAgIHNldERldGVjdGlvblJhbmdlRGF0YShyYW5nZSkgew0KICAgICAgbGV0IGJib3ggPSB0dXJmLmJib3goew0KICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICBmZWF0dXJlczogW3R1cmYucG9seWdvbihyYW5nZS5jb29yZGluYXRlcyldLA0KICAgICAgfSkNCiAgICAgIGlmIChtYXBPYmoubWFwICYmIG1hcE9iai5tYXAuZ2V0U291cmNlKCdkZXRlY3Rpb25SYW5nZScpKSB7DQogICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCdkZXRlY3Rpb25SYW5nZScpLnNldERhdGEocmFuZ2UpDQogICAgICAgIG1hcE9iai5tYXAuZml0Qm91bmRzKGJib3gsIHsNCiAgICAgICAgICBwYWRkaW5nOiB7IHRvcDogMTAsIGJvdHRvbTogMjUsIGxlZnQ6IDE1LCByaWdodDogNSB9LA0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5Y+W5raI56a75byADQogICAgY2FuY2VsTGVhdmUoKSB7DQogICAgICB0aGlzLmlmTGVhdmVUYXNrID0gZmFsc2UNCiAgICB9LA0KICAgIC8vIOehruiupOemu+W8gA0KICAgIGNvbmZpcm1MZWF2ZSgpIHsNCiAgICAgIHRoaXMuaWZMZWF2ZVRhc2sgPSBmYWxzZQ0KICAgICAgdGhpcy5lbmRSZWNvcmQoJ2xlYXZlJykNCiAgICB9LA0KICAgIC8vIOi/lOWbnuS7u+WKoemhtQ0KICAgIGdvQmFja1RvVGFzaygpIHsNCiAgICAgIGlmICh0aGlzLmlmUmVjb3JkaW5nKSB7DQogICAgICAgIC8vIOW9k+WJjeato+WcqOW3oeajgOS4reaXtu+8jOi/lOWbnuS7u+WKoemhteaXtuaPkOekuuaYr+WQpuemu+W8gOivpeS7u+WKoQ0KICAgICAgICB0aGlzLmlmTGVhdmVUYXNrID0gdHJ1ZQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g6Zeu6aKY5LiK5oqlDQogICAgYXN5bmMgZ2V0UHJvYmxlbURhdGFMaXN0KCkgew0KICAgICAgLy8g6I635Y+WaGVhZGVy77yM5p+l6K+i5bel5Y2V55SoDQogICAgICBhd2FpdCBheGlvcyh7DQogICAgICAgIHVybDogcHJvY2Vzcy5lbnYuVlVFX0FQUF9USElSRF9SRVFVRVNUX1VSTCArICcvbWFpbi91c2VyQ2VudGVyQXBpL3Nzby90b2tlbkJ5VG9rZW4nLA0KICAgICAgICBtZXRob2Q6ICdwb3N0JywNCiAgICAgICAgcGFyYW1zOiB7DQogICAgICAgICAgdG9rZW46IHRoaXMuYWNjZXNzVG9rZW4sDQogICAgICAgIH0sDQogICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmFzaWMgYjNWMGQyOXlhenAzY0djeU1ESXcnLA0KICAgICAgICB9LA0KICAgICAgfSkudGhlbigocmVzKSA9PiB7DQogICAgICAgIGlmIChyZXMuc3RhdHVzID09IDIwMCkgew0KICAgICAgICAgIHRoaXMuZm9ybVRva2VuID0gcmVzLmRhdGEucmVzdWx0RGF0YS50b2tlbg0KICAgICAgICAgIHRoaXMuaGVhZGVyID0gew0KICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywNCiAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIHRoaXMuZm9ybVRva2VuLA0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICAgIC8vIOWtmOWCqOa8j+eCueW3peWNlQ0KICAgICAgdGhpcy5wcm9ibGVtRGF0YUxpc3QgPSBbXQ0KICAgICAgbGV0IHBhcmFtcyA9IHsNCiAgICAgICAgc3lzQ29kZTogJ291dHdvcmsnLA0KICAgICAgICAvLyBmb3JtVmFsdWU6ICJ7XCJ0YXNrSWRcIjpcIjE2MTEwMjk3NTg2OTc1NDE2MzRcIn0iMTYxMTAyOTc1ODY5NzU0MTYzNA0KICAgICAgICAvLyDlj6rmmL7npLrku7vliqHlhbPogZTnmoTkuIrmiqXmvI/ngrkNCiAgICAgICAgZXh0UGFyYW06IHsNCiAgICAgICAgICB0YXNrSWQ6IHRoaXMudGFza0RldGFpbC5pZCwgLy8g5Lu75YqhaWQNCiAgICAgICAgfSwNCiAgICAgICAgcGFnZTogew0KICAgICAgICAgIGN1cnJlbnQ6IDEsDQogICAgICAgICAgc2l6ZTogMTAwMDAsDQogICAgICAgIH0sDQogICAgICAgIHR5cGVMaXN0OiBbJ2psZ2QnXSwNCiAgICAgIH0NCiAgICAgIGF3YWl0IGF4aW9zKHsNCiAgICAgICAgdXJsOg0KICAgICAgICAgIHByb2Nlc3MuZW52LlZVRV9BUFBfVEhJUkRfUkVRVUVTVF9VUkwgKw0KICAgICAgICAgICcvbWFpbi9vdXR3b3JrYXBpL3RpY2tldFN0YXRpc3RpY0NsaWVudC9nZXRUaWNrZXRMaXN0JywgLy8g5omA5pyJ55qEDQogICAgICAgIG1ldGhvZDogJ3Bvc3QnLA0KICAgICAgICBkYXRhOiBwYXJhbXMsDQogICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVyLA0KICAgICAgfSkudGhlbigocmVzKSA9PiB7DQogICAgICAgIGlmIChyZXMuc3RhdHVzID09IDIwMCAmJiByZXMuZGF0YSAhPSBudWxsKSB7DQogICAgICAgICAgdGhpcy5wcm9ibGVtRGF0YUxpc3QgPSByZXMuZGF0YT8ucmVzdWx0RGF0YT8ucmVjb3JkcyB8fCBbXQ0KICAgICAgICAgIGNvbnNvbGUubG9nKCfmo4DmvI/lt6XljZVyZWNvcmRzJywgdGhpcy5wcm9ibGVtRGF0YUxpc3QpDQogICAgICAgICAgdGhpcy5hZGRZb3VyTGF5ZXIodGhpcy5wcm9ibGVtRGF0YUxpc3QsICfms4TmvI/ngrknKQ0KICAgICAgICAgIC8vIOeUqOS6juWIpOaWreaYr+WQpuWKoOi9veWujOS4iuaKpea8j+eCueaVsOaNrg0KICAgICAgICAgIHRoaXMucmVwb3J0RGF0YUlzTG9hZGVkID0gdHJ1ZQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g5Zyo5Zyw5Zu+5LiK5re75Yqg5rOE5ryP54K5DQogICAgYWRkWW91ckxheWVyKHBvaW50TGlzdCwgaWQpIHsNCiAgICAgIGNvbnN0IHNvdXJjZURhdGEgPSB7DQogICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgIGZlYXR1cmVzOiBwb2ludExpc3QubWFwKChpKSA9PiB7DQogICAgICAgICAgbGV0IGxsID0gbnVsbA0KICAgICAgICAgIGlmICh0eXBlb2YgaS5mb3JtVmFsdWUudGlja2V0QWRkcmVzcyA9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgbGwgPSBKU09OLnBhcnNlKEpTT04ucGFyc2UoaS5mb3JtVmFsdWUudGlja2V0QWRkcmVzcykucG9pbnQpDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxsID0gaS5mb3JtVmFsdWUudGlja2V0QWRkcmVzcy5wb2ludA0KICAgICAgICAgIH0NCg0KICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgICAgICB0eXBlOiAnUG9pbnQnLA0KICAgICAgICAgICAgICBjb29yZGluYXRlczogW2xsLmxuZywgbGwubGF0XSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBwcm9wZXJ0aWVzOiBpLA0KICAgICAgICAgIH0NCiAgICAgICAgfSksDQogICAgICB9DQogICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoaWQpKSB7DQogICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKGlkKS5zZXREYXRhKHNvdXJjZURhdGEpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcigNCiAgICAgICAgew0KICAgICAgICAgIGlkOiBpZCwNCiAgICAgICAgICB0eXBlOiAnc3ltYm9sJywNCiAgICAgICAgICBzb3VyY2U6IHsNCiAgICAgICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgICAgIGRhdGE6IHNvdXJjZURhdGEsDQogICAgICAgICAgfSwNCiAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICdpY29uLWltYWdlJzogaWQsDQogICAgICAgICAgICAnaWNvbi1zaXplJzogMC43LA0KICAgICAgICAgICAgLy8g5Zu+5qCH5by65Yi25YWo6YOo5pi+56S6DQogICAgICAgICAgICAnaWNvbi1pZ25vcmUtcGxhY2VtZW50JzogdHJ1ZSwNCiAgICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJywNCiAgICAgICAgICB9LA0KICAgICAgICAgIC8vIG1pbnpvb206IDEzLA0KICAgICAgICB9LA0KICAgICAgICAnJw0KICAgICAgKQ0KICAgICAgLy8g6byg5qCH54K55Ye7DQogICAgICAvLyBtYXBPYmoubWFwLm9uKCdjbGljaycsIGlkLCB0aGlzLmhhbmRsZU1vdXNlQ2xpY2spDQogICAgfSwNCiAgICAvLyDkuIrmiqXms4TmvI/ngrkNCiAgICByZXBvcnRDbGljaygpIHsNCiAgICAgIC8vIOeUqOS6juWIpOaWreaYr+WQpuWKoOi9veWujOS4iuaKpea8j+eCueaVsOaNrg0KICAgICAgaWYgKHRoaXMucmVwb3J0RGF0YUlzTG9hZGVkKSB7DQogICAgICAgIHRoaXMucmVwb3J0U2hvdyA9IHRydWUNCiAgICAgICAgLy8gbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnZXZlbnRQb2ludHNMYXllcicsICd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgVG9hc3QubG9hZGluZyh7DQogICAgICAgICAgbWVzc2FnZTogJ+S4iuaKpeaVsOaNruWKoOi9veS4reOAguOAguOAgicsDQogICAgICAgICAgbG9hZGluZ1R5cGU6ICdzcGlubmVyJywNCiAgICAgICAgICBkdXJhdGlvbjogMTUwMCwNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgfSwNCiAgICBoYW5kbGVDbG9zZSgpIHsNCiAgICAgIC8vIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ2V2ZW50UG9pbnRzTGF5ZXInLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICB9LA0KICAgIC8vIOeCueWHu+S4iuaKpea8j+eCueWKoOWPtw0KICAgIG9uU2VsZWN0KHZhbCkgew0KICAgICAgaWYgKHRoaXMuaXNWaWV3KSB7DQogICAgICAgIFRvYXN0KHsNCiAgICAgICAgICBtZXNzYWdlOiAn6K+l5beh5qOA5Lu75Yqh5bey57uT5p2fJywNCiAgICAgICAgICBkdXJhdGlvbjogJzE1MDAnLA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIHRoaXMuaWZUaXBzID0gdHJ1ZQ0KICAgICAgLy8g6ZqQ6JeP5o6J6IyD5Zu05Zu+5bGCDQogICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdkZXRlY3Rpb25SYW5nZUxheWVyX2ZpbGwnLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgIG1hcE9iai5tYXAub24oJ2NsaWNrJywgdGhpcy5zZWxlY3RSZXBvcnRQb2ludCkNCiAgICB9LA0KICAgIC8vIOS4iuaKpea8j+eCuQ0KICAgIGFzeW5jIHNlbGVjdFJlcG9ydFBvaW50KGUpIHsNCiAgICAgIGxldCBmZWF0dXJlcyA9IG1hcE9iai5tYXAucXVlcnlSZW5kZXJlZEZlYXR1cmVzKGUucG9pbnQpDQogICAgICBjb25zb2xlLmxvZygn5p+l6K+i5Yiw55qE5Zu+5bGC5pWw5o2uJywgZmVhdHVyZXMpDQogICAgICBsZXQgcHJvcGVydGllc0FyciA9IFtdDQogICAgICBwcm9wZXJ0aWVzQXJyID0gZmVhdHVyZXMuZmlsdGVyKChpdGVtKSA9PiB7DQogICAgICAgIC8vIOetm+mAieWHuuS+m+awtOeahOWbvuWxgg0KICAgICAgICByZXR1cm4gaXRlbS5sYXllci5pZCA9PSAnbWFwX3N1cHBseV9waXBlX2Rpc3RyaWJ1dGUnDQogICAgICB9KQ0KICAgICAgLy8gY29uc29sZS5sb2coJ+S4iuaKpea8j+eCueeCueWHu+WcsOWbvicsIGZlYXR1cmVzLCBwcm9wZXJ0aWVzQXJyKQ0KDQogICAgICAvLyDnrZvpgInlh7rljLnphY3nmoTnrKzkuIDkuKrnrqHnur/lhYPntKANCiAgICAgIGxldCBvbmVQcm9wZXJ0aWVzID0gbnVsbA0KICAgICAgbGV0IHBvcA0KICAgICAgbGV0IG1hcmtlcg0KDQogICAgICBjb25zdCBzcmMgPSByZXF1aXJlKGBAL2Fzc2V0cy9pbWcvbGVnZW5kL+S6i+S7tuS4iuaKpS5wbmdgKQ0KICAgICAgLy8g5aaC5p6c5a2Y5ZyoaWTkuLpldmVudE9ial9vbmXnmoTlhYPntKDvvIzliJnliKDpmaTmraTlhYPntKDph43mlrDliJvlu7rvvIzkv53mjIHlhajlsYDlj6rmnInkuIDkuKrmraTlhYPntKANCiAgICAgIGxldCBjdXJyZW50RWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2ZW50T2JqX29uZScpDQogICAgICBpZiAoY3VycmVudEVsZSkgew0KICAgICAgICBjdXJyZW50RWxlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY3VycmVudEVsZSkNCiAgICAgIH0NCiAgICAgIGxldCBlbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQ0KICAgICAgZWxlLmlubmVySFRNTCA9IGANCiAgICAgICAgICAgIDxpbWcgaWQ9ImV2ZW50T2JqX29uZSIgc3JjPSIke3NyY30iIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+DQogICAgICAgICAgYA0KICAgICAgbWFya2VyID0gbWFwT2JqLm1hcEluc3RhbmNlLm5ld01hcmtlcih7DQogICAgICAgIGVsZW1lbnQ6IGVsZSwNCiAgICAgIH0pDQogICAgICBtYXJrZXINCiAgICAgICAgLnNldExuZ0xhdChlLmxuZ0xhdCkNCiAgICAgICAgLnNldFBvcHVwKA0KICAgICAgICAgIG1hcE9iai5tYXBJbnN0YW5jZQ0KICAgICAgICAgICAgLm5ld1BvcHVwKHsgb2Zmc2V0OiBbMCwgLTddLCBjbG9zZUJ1dHRvbjogZmFsc2UgfSkNCiAgICAgICAgICAgIC5zZXRIVE1MKGA8ZGl2IGlkPSJkZXZpY2VEZXRhaWwiPjwvZGl2PmApDQogICAgICAgICkNCiAgICAgICAgLmFkZFRvKG1hcE9iai5tYXApDQoNCiAgICAgIGlmICh0aGlzLmlmVGlwcykgew0KICAgICAgICB0aGlzLmlmVGlwcyA9IGZhbHNlDQogICAgICB9DQoNCiAgICAgIGlmIChwcm9wZXJ0aWVzQXJyLmxlbmd0aCA+IDApIHsNCiAgICAgICAgb25lUHJvcGVydGllcyA9IHByb3BlcnRpZXNBcnJbMF0NCiAgICAgICAgY29uc29sZS5sb2coJ+etm+mAieWHuuWMuemFjeeahOesrOS4gOS4queuoee6v+WFg+e0oCcsIG9uZVByb3BlcnRpZXMsIGUubG5nTGF0KQ0KDQogICAgICAgIHBvcCA9IG5ldyBQb3B1cEl0ZW0oew0KICAgICAgICAgIHByb3BzRGF0YTogew0KICAgICAgICAgICAgZGV2aWNlQ29kZTogb25lUHJvcGVydGllcy5wcm9wZXJ0aWVzLnN0YXJ0X2NvZGUsDQogICAgICAgICAgICBmdW46IGdvVG9EZXRhaWwsDQogICAgICAgICAgICBpc0RldmljZTogdHJ1ZSwNCiAgICAgICAgICAgIC8vIHR5cGU6IHR5cGUsDQogICAgICAgICAgfSwNCiAgICAgICAgfSkNCiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgIHBvcC4kbW91bnQoJyNkZXZpY2VEZXRhaWwnKQ0KICAgICAgICB9KQ0KICAgICAgICBtYXJrZXIudG9nZ2xlUG9wdXAoKQ0KDQogICAgICAgIGxldCB0aGF0XyA9IHRoaXMNCiAgICAgICAgLy8g6L+b5YWl5bel5Y2V6K+m5oOF6aG1DQogICAgICAgIGZ1bmN0aW9uIGdvVG9EZXRhaWwoKSB7DQogICAgICAgICAgdGhhdF8uJHJvdXRlci5wdXNoKHsNCiAgICAgICAgICAgIG5hbWU6ICdMZWFrRGV0ZWN0aW9uRm9ybScsDQogICAgICAgICAgICBxdWVyeTogew0KICAgICAgICAgICAgICB0YXNrSWQ6IHRoYXRfLnRhc2tEZXRhaWwuaWQsIC8vIOS7u+WKoWlkDQogICAgICAgICAgICAgIHByb3BlcnRpZXM6IG9uZVByb3BlcnRpZXMucHJvcGVydGllcywNCiAgICAgICAgICAgICAgbG5nTGF0OiBlLmxuZ0xhdCwNCiAgICAgICAgICAgICAgaWQ6IGZhbHNlLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBwb3AgPSBuZXcgUG9wdXBJdGVtKHsNCiAgICAgICAgICBwcm9wc0RhdGE6IHsNCiAgICAgICAgICAgIGRldmljZUNvZGU6ICcnLA0KICAgICAgICAgICAgZnVuOiBnb1RvRGV0YWlsTG5nTGF0LA0KICAgICAgICAgICAgaXNEZXZpY2U6IGZhbHNlLA0KICAgICAgICAgICAgbG5nOiBlLmxuZ0xhdC5sbmcsDQogICAgICAgICAgICBsYXQ6IGUubG5nTGF0LmxhdCwNCiAgICAgICAgICB9LA0KICAgICAgICB9KQ0KICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgcG9wLiRtb3VudCgnI2RldmljZURldGFpbCcpDQogICAgICAgIH0pDQogICAgICAgIG1hcmtlci50b2dnbGVQb3B1cCgpDQoNCiAgICAgICAgbGV0IHRoYXRfID0gdGhpcw0KICAgICAgICAvLyDov5vlhaXlt6XljZXor6bmg4XpobUNCiAgICAgICAgZnVuY3Rpb24gZ29Ub0RldGFpbExuZ0xhdCgpIHsNCiAgICAgICAgICB0aGF0Xy4kcm91dGVyLnB1c2goew0KICAgICAgICAgICAgbmFtZTogJ0xlYWtEZXRlY3Rpb25Gb3JtJywNCiAgICAgICAgICAgIHF1ZXJ5OiB7DQogICAgICAgICAgICAgIHRhc2tJZDogdGhhdF8udGFza0RldGFpbC5pZCwgLy8g5Lu75YqhaWQNCiAgICAgICAgICAgICAgcHJvcGVydGllczoge30sDQogICAgICAgICAgICAgIGxuZ0xhdDogZS5sbmdMYXQsDQogICAgICAgICAgICAgIGlkOiBmYWxzZSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5byA5aeL6K6w5b2VIOS4iuS8oOi1t+eCueaIkOWKn+WQjuaJjei/m+WFpeW3oeajgOi/h+eoiw0KICAgIHN0YXJ0SW5zcFJlY29yZCgpIHsNCiAgICAgIGlmICh0aGlzLmlzVmlldykgew0KICAgICAgICBUb2FzdCh7DQogICAgICAgICAgbWVzc2FnZTogJ+ivpeW3oeajgOS7u+WKoeW3sue7k+adnycsDQogICAgICAgICAgZHVyYXRpb246IDE1MDAsDQogICAgICAgIH0pDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgLy8g5rWL6K+VDQogICAgICAvLyB0aGlzLmNoYW5nZUluc3BMaW5lU291cmNlQnlTcGVlZCh7DQogICAgICAvLyAgIGxvbmdpdHVkZTogMTE1LjkxMTg3MDE4ODUsDQogICAgICAvLyAgIGxhdGl0dWRlOiAzOS4wNTU2NDY4MTgwDQogICAgICAvLyB9KQ0KICAgICAgaWYgKCF0aGlzLmN1cnJlbnRQb3NpdGlvbiB8fCAhdGhpcy5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlKSB7DQogICAgICAgIFRvYXN0Lndhcm5pbmcoew0KICAgICAgICAgIG1lc3NhZ2U6ICflvZPliY1HUFPkv6Hlj7flvLHvvIzor7fnqI3lkI7lsJ3or5UnLA0KICAgICAgICAgIGR1cmF0aW9uOiAyMDAwLA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIC8vIOS/ruaUueacquW3oeajgCgwKeS7u+WKoeeKtuaAgeiHs+W3oeajgOS4rSgxKQ0KICAgICAgaWYgKA0KICAgICAgICBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsZWFrRGV0ZWN0aW9uRGF0YScpKS5pc05ldyAmJg0KICAgICAgICB0aGlzLnRhc2tEZXRhaWwudGFza1N0YXR1cyA9PSAwDQogICAgICApIHsNCiAgICAgICAgdGhpcy5zdGFydE9yRW5kVGFza1JlY29yZCgxKQ0KICAgICAgfQ0KICAgICAgLy8g5riF6Zmk57yT5a2Y55qE6L2o6L+55pWw5o2uDQogICAgICB0aGlzLmNsZWFyQnVmZmVyVHJhY2soKQ0KICAgICAgbGV0IHRvYXN0ID0gVG9hc3QubG9hZGluZyh7DQogICAgICAgIG1lc3NhZ2U6ICfnqIvluo/lkK/liqjkuK0nLA0KICAgICAgICBsb2FkaW5nVHlwZTogJ3NwaW5uZXInLA0KICAgICAgICBkdXJhdGlvbjogMCwNCiAgICAgICAgZm9yYmlkQ2xpY2s6IHRydWUsDQogICAgICB9KQ0KICAgICAgLy8g57uY5Yi26LW35aeL54K5DQogICAgICB0aGlzLmRyYXdTdGFydFBvaW50KCkNCiAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgIGlmIChyZXMpIHsNCiAgICAgICAgICAgIHRvYXN0LmNsb3NlKCkNCiAgICAgICAgICAgIFRvYXN0LmluZm8oew0KICAgICAgICAgICAgICBtZXNzYWdlOiAn5byA5aeL6K6w5b2VJywNCiAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDAsDQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgLy8g6L2u6K+i54q25oCBDQogICAgICAgICAgICB0aGlzLnBvbGxpbmdGbGFnID0gdHJ1ZQ0KICAgICAgICAgICAgLy8g5piv5ZCm5byA5aeL6K6w5b2VDQogICAgICAgICAgICB0aGlzLmlmUmVjb3JkaW5nID0gdHJ1ZQ0KICAgICAgICAgICAgLy8gdGhpcy5zdGFydExvY2F0aW9uKCkNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzdGFydFJlY29yZExpbmVzJywgJ3N0YXJ0JykNCiAgICAgICAgICAgIC8vIOW8gOWni+i9ruivog0KICAgICAgICAgICAgdGhpcy5wb2xsaW5nKCkNCiAgICAgICAgICAgIC8vIOiusOW9leW8gOWni+W3oeajgOeahOaXtumXtO+8jOeUqOS6juWIpOaWreaYr+WQpuWcqOW8gOWni+W3oeajgOeahDEwc+WGhQ0KICAgICAgICAgICAgdGhpcy5zdGFydFJlY29yZFRpbWVyID0gbmV3IERhdGUoKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBUb2FzdC5lcnJvcih7DQogICAgICAgICAgICAgIG1lc3NhZ2U6ICfmjqXlj6PlvILluLjvvIzml6Dms5XlvIDlp4vku7vliqEnLA0KICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMCwNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKGVycikNCiAgICAgICAgICBUb2FzdC5lcnJvcih7DQogICAgICAgICAgICBtZXNzYWdlOiAn572R57uc54q25oCB5byC5bi477yM5q2j5Zyo6YeN6K+VJywNCiAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwLA0KICAgICAgICAgIH0pDQogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICB0aGlzLmRyYXdTdGFydFBvaW50KCkNCiAgICAgICAgICB9LCA1MDAwKQ0KICAgICAgICB9KQ0KICAgIH0sDQogICAgLy8g57uT5p2f6K6w5b2VDQogICAgZW5kUmVjb3JkKHR5cGUpIHsNCiAgICAgIGxldCBkaWZmID0gTWF0aC5mbG9vcigobmV3IERhdGUoKSAtIHRoaXMuc3RhcnRSZWNvcmRUaW1lcikgLyAxMDAwKQ0KICAgICAgaWYgKGRpZmYgPD0gMTApIHsNCiAgICAgICAgVG9hc3QuaW5mbyh7DQogICAgICAgICAgbWVzc2FnZTogYOe7k+adn+WkquW/q+S6hizor7ckezEwIC0gZGlmZn3np5LlkI7lho3or5VgLA0KICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIHRoaXMuZW5kUmVjb3JkQ29uZmlybSh0eXBlKQ0KICAgIH0sDQogICAgLy8g57uT5p2f6K6w5b2V56Gu6K6kDQogICAgZW5kUmVjb3JkQ29uZmlybSh0eXBlKSB7DQogICAgICB0aGlzLmRyYXdFbmRQb2ludCh0eXBlKQ0KICAgIH0sDQogICAgLy8g57uY5Yi257uI5q2i54K5DQogICAgYXN5bmMgZHJhd0VuZFBvaW50KHR5cGUpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgaWYgKHRoYXQuY3VycmVudFBvc2l0aW9uICE9IG51bGwpIHsNCiAgICAgICAgbGV0IGxhc3RQb2ludCA9IHRoYXQudHJhY2tQb2ludExpc3RbdGhhdC50cmFja1BvaW50TGlzdC5sZW5ndGggLSAxXQ0KICAgICAgICBsZXQgY3VycmVudFBvaW50ID0gW3RoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwgdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGVdDQogICAgICAgIGxldCBkaXN0YW5jZSA9IE51bWJlcih0aGF0LkdldERpc3RhbmNlKGxhc3RQb2ludCwgY3VycmVudFBvaW50KSkgKiAxMDAwDQogICAgICAgIGxldCB0b2FzdCA9IFRvYXN0LmxvYWRpbmcoew0KICAgICAgICAgIG1lc3NhZ2U6ICfnqIvluo/lhbPpl63kuK0nLA0KICAgICAgICAgIGxvYWRpbmdUeXBlOiAnc3Bpbm5lcicsDQogICAgICAgICAgZHVyYXRpb246IDAsDQogICAgICAgICAgZm9yYmlkQ2xpY2s6IHRydWUsDQogICAgICAgIH0pDQogICAgICAgIC8vIOiusOW9lee7iOatoueCuQ0KICAgICAgICB0aGF0DQogICAgICAgICAgLnBvc3RUcmFja0RhdGFfUG9pbnQoDQogICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRMaXN0W3RoYXQudHJhY2tQb2ludExpc3QubGVuZ3RoIC0gMV0sDQogICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdFt0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5sZW5ndGggLSAxXSwNCiAgICAgICAgICAgIGRpc3RhbmNlDQogICAgICAgICAgKQ0KICAgICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICAgIGlmIChyZXMpIHsNCiAgICAgICAgICAgICAgdG9hc3QuY2xvc2UoKQ0KICAgICAgICAgICAgICBUb2FzdC5pbmZvKHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAn5pqC5YGc5oiQ5YqfJywNCiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwMCwNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB5dWFuY2h1ICE9ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAuc3RvcFJlcXVlc3RMb2NhdGlvbnMoKQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHRoYXQudHJhY2tQb2ludExpc3QucHVzaChbDQogICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlLA0KICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlLA0KICAgICAgICAgICAgICBdKQ0KICAgICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5wdXNoKHRoYXQuY3VycmVudFBvc2l0aW9uLmxvY1RpbWUpDQogICAgICAgICAgICAgIGxldCBqc29uUG9pbnQgPSB7DQogICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LA0KICAgICAgICAgICAgICAgIGdlb21ldHJ5OiB7DQogICAgICAgICAgICAgICAgICB0eXBlOiAnUG9pbnQnLA0KICAgICAgICAgICAgICAgICAgY29vcmRpbmF0ZXM6IFt0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUsIHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlXSwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGxldCBqc29uUG9pbnRGZWF0dXJlQ29sbGVjdGlvbiA9IHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgICAgICAgIGZlYXR1cmVzOiBbanNvblBvaW50XSwNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ2VuZFBvaW50U291cmNlX25vdycpKSB7DQogICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ2VuZFBvaW50U291cmNlX25vdycpLnNldERhdGEoanNvblBvaW50RmVhdHVyZUNvbGxlY3Rpb24pDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRTb3VyY2UoJ2VuZFBvaW50U291cmNlX25vdycsIHsNCiAgICAgICAgICAgICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgICAgICAgICAgIGRhdGE6IGpzb25Qb2ludEZlYXR1cmVDb2xsZWN0aW9uLA0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ2VuZFBvaW50TGF5ZXJfbm93JykpIHsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmFkZExheWVyKA0KICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZDogJ2VuZFBvaW50TGF5ZXJfbm93JywNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NpcmNsZScsDQogICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ2VuZFBvaW50U291cmNlX25vdycsDQogICAgICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgICAgICdjaXJjbGUtc29ydC1rZXknOiA1LA0KICAgICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJywNCiAgICAgICAgICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgcGFpbnQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAnY2lyY2xlLXJhZGl1cyc6IDMsDQogICAgICAgICAgICAgICAgICAgICAgJ2NpcmNsZS1zdHJva2Utd2lkdGgnOiA1LA0KICAgICAgICAgICAgICAgICAgICAgICdjaXJjbGUtc3Ryb2tlLWNvbG9yJzogJyNhZGRkNTInLA0KICAgICAgICAgICAgICAgICAgICAgICdjaXJjbGUtY29sb3InOiAnd2hpdGUnLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICdpbnNwVXNlckxheWVyJw0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIC8vIOihpeWFhXRyYWNrbGluZQ0KICAgICAgICAgICAgICBsZXQganNvbkxpbmUgPSB7DQogICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LA0KICAgICAgICAgICAgICAgIGdlb21ldHJ5OiB7DQogICAgICAgICAgICAgICAgICB0eXBlOiAnTGluZVN0cmluZycsDQogICAgICAgICAgICAgICAgICBjb29yZGluYXRlczogdGhhdC50cmFja1BvaW50TGlzdCwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGxldCBqc29uTGluZUZlYXR1cmVDb2xsZWN0aW9uID0gew0KICAgICAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgICAgICAgICAgZmVhdHVyZXM6IFtqc29uTGluZV0sDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgndHJhY2tMaW5lU291cmNlX25vdycpLnNldERhdGEoanNvbkxpbmVGZWF0dXJlQ29sbGVjdGlvbikNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmFkZFNvdXJjZSgndHJhY2tMaW5lU291cmNlX25vdycsIHsNCiAgICAgICAgICAgICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgICAgICAgICAgIGRhdGE6IGpzb25MaW5lRmVhdHVyZUNvbGxlY3Rpb24sDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRMYXllcigndHJhY2tMaW5lTGF5ZXJfbm93JykpIHsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmFkZExheWVyKA0KICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBpZDogJ3RyYWNrTGluZUxheWVyX25vdycsDQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaW5lJywNCiAgICAgICAgICAgICAgICAgICAgc291cmNlOiAndHJhY2tMaW5lU291cmNlX25vdycsDQogICAgICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgICAgICdsaW5lLWNhcCc6ICdyb3VuZCcsDQogICAgICAgICAgICAgICAgICAgICAgJ2xpbmUtam9pbic6ICdyb3VuZCcsDQogICAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgICAgIC8vIHZpc2liaWxpdHk6ICJub25lIg0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBwYWludDogew0KICAgICAgICAgICAgICAgICAgICAgICdsaW5lLWNvbG9yJzogJyNhZGRkNTInLA0KICAgICAgICAgICAgICAgICAgICAgICdsaW5lLXdpZHRoJzogNSwNCiAgICAgICAgICAgICAgICAgICAgICAnbGluZS1vcGFjaXR5JzogMC44LA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICdpbnNwVXNlckxheWVyJw0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAvLyDmt7vliqDnu4jngrnlm77niYcNCiAgICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ2VuZFBvaW50X2xhYmVsJykpIHsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmFkZExheWVyKHsNCiAgICAgICAgICAgICAgICAgIGlkOiAnZW5kUG9pbnRfbGFiZWwnLA0KICAgICAgICAgICAgICAgICAgdHlwZTogJ3N5bWJvbCcsDQogICAgICAgICAgICAgICAgICBzb3VyY2U6ICdlbmRQb2ludFNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgICAgICAgbGF5b3V0OiB7DQogICAgICAgICAgICAgICAgICAgICdzeW1ib2wtcGxhY2VtZW50JzogJ3BvaW50JywNCiAgICAgICAgICAgICAgICAgICAgJ2ljb24taW1hZ2UnOiAnZW5kX3BvaW50JywNCiAgICAgICAgICAgICAgICAgICAgJ2ljb24tc2l6ZSc6IDAuNiwNCiAgICAgICAgICAgICAgICAgICAgJ2ljb24tb2Zmc2V0JzogWzAsIC0zNV0sDQogICAgICAgICAgICAgICAgICAgICdpY29uLWFsbG93LW92ZXJsYXAnOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXNvcnQta2V5JzogMiwNCiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAvLyDkuIrkvKDkuYvliY3kuIrkvKDlpLHotKXnmoTngrnkvY0NCiAgICAgICAgICAgICAgdGhhdC5yZXBvcnRGYWlsVHJhY2tQb2ludHMubGVuZ3RoID4gMCAmJiB0aGF0LnBvc3RGYWlsVHJhY2tEYXRhKCkNCiAgICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC51cGxvYWRGaWxlZFBpcGVJZExpc3QubGVuZ3RoID4gMCAmJg0KICAgICAgICAgICAgICAgIC8vIGFwcOa3u+WKoOeuoee9keajgOa8j+iusOW9lQ0KICAgICAgICAgICAgICAgIEFwaS5yZWNvcmRJbnNwTGluZSh0aGF0LiRyZWZzLm15bWFwLnVwbG9hZEZpbGVkUGlwZUlkTGlzdCkudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn566h57q/6KGl5YWF5LiK5Lyg5oiQ5YqfJykNCiAgICAgICAgICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC51cGxvYWRGaWxlZFBpcGVJZExpc3QgPSBbXQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIGlmICh0eXBlID09ICdlbmQnKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zdGFydE9yRW5kVGFza1JlY29yZCgyKSAvLyDlt7Llt6Hmo4DnirbmgIEgJzInDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhpcy5wb2xsaW5nRmxhZyA9IGZhbHNlDQogICAgICAgICAgICAgICAgdGhpcy5pZlJlY29yZGluZyA9IGZhbHNlDQogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3N0YXJ0UmVjb3JkTGluZXMnLCAnZW5kJykNCiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSAncGF1c2UnKSB7DQogICAgICAgICAgICAgICAgICBUb2FzdC5zdWNjZXNzKHsNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ+aaguWBnOaIkOWKnycsDQogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwLA0KICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgIC8vIOWIt+aWsOS7u+WKoQ0KICAgICAgICAgICAgICAgICAgdGhpcy5yZWZyZXNoVGFzaygpDQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09ICdsZWF2ZScpIHsNCiAgICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIFRvYXN0LmVycm9yKHsNCiAgICAgICAgICAgICAgICBtZXNzYWdlOiB0eXBlID09ICdlbmQnID8gJ+e7k+adn+Wksei0pScgOiAn5pqC5YGc5aSx6LSlJywNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbGV0IHR5cGUgPSB0eXBlDQogICAgICAgIGxldCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIHRoYXQuZHJhd0VuZFBvaW50KHR5cGUpDQogICAgICAgIH0sIDEwMDApDQogICAgICB9DQogICAgfSwNCiAgICAvLyDliLfmlrDku7vliqENCiAgICByZWZyZXNoVGFzaygpIHsNCiAgICAgIC8vIGxldCBpZHMgPSBbXQ0KICAgICAgLy8gdGhpcy5rZXlEZXRhaWxMaXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgIC8vICAgaWYgKGl0ZW0uZW5nSW5mb0RUTykgew0KICAgICAgLy8gICAgIGlkcy5wdXNoKGl0ZW0uZW5nSW5mb0RUTy5lbmdJZCkNCiAgICAgIC8vICAgfQ0KICAgICAgLy8gfSkNCiAgICAgIC8vIG1hcE9iai5tYXBJbnN0YW5jZSAmJiB0aGlzLiRyZWZzLm15bWFwLnJlbW92ZUtleVBvaW50TWFya2VyKGlkcykNCiAgICAgIGNvbnN0IGlkID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGVha0RldGVjdGlvbkRhdGEnKSkudGFza0lkDQogICAgICAvLyDmt7vliqDku7vliqHojIPlm7TjgIHnrqHnur/lm77lsYINCiAgICAgIHRoaXMuYWRkVGFza1JhbmdlQW5kTGluZXMoKQ0KICAgICAgLy8gYXdhaXQgdGhpcy5nZXRBcHBJbnNwRGF0YShpZCkNCiAgICB9LA0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgIC8vIOeKtuaAge+8iDDmnKrlvIDlp4sgMeaJp+ihjOS4rSAy5bey5a6M5oiQ77yJDQogICAgc3RhcnRPckVuZFRhc2tSZWNvcmQoc3RhdHVzKSB7DQogICAgICBsZXQgZGF0YSA9IHsNCiAgICAgICAgcGxhbklkOiB0aGlzLnRhc2tEZXRhaWwucGxhbklkLCAvLyDorqHliJJpZA0KICAgICAgICB0YXNrTmFtZTogdGhpcy50YXNrRGV0YWlsLnRhc2tOYW1lLCAvLyDku7vliqHlkI0NCiAgICAgICAgdGFza1N0YXR1czogc3RhdHVzLCAvLyDnirbmgIHvvIgw5pyq5byA5aeLIDHmiafooYzkuK0gMuW3suWujOaIkO+8iQ0KICAgICAgICBpZDogdGhpcy50YXNrRGV0YWlsLmlkLCAvLyDku7vliqFpZA0KICAgICAgICBleHQxOiBzdGF0dXMgPT0gMiA/IHRoaXMuc3RvcFJlYXNvbiA6ICcnLCAvLyDnu5PmnZ/ljp/lm6ANCiAgICAgIH0NCiAgICAgIGlmIChzdGF0dXMgPT0gMSkgew0KICAgICAgICAvLyDku7vliqHlvIDlp4vml7bpl7QNCiAgICAgICAgZGF0YS50YXNrU3RhcnRUaW1lID0gdGhpcy4kZGF5anMoKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKQ0KICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gMikgew0KICAgICAgICAvLyDku7vliqHnu5PmnZ/ml7bpl7QNCiAgICAgICAgZGF0YS50YXNrRW5kVGltZSA9IHRoaXMuJGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJykNCiAgICAgIH0NCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgQXBpLmNoYW5nZVRhc2tTdGF0dXMoZGF0YSkudGhlbigocmVzKSA9PiB7DQogICAgICAgIGlmIChyZXMuc3RhdHVzKSB7DQogICAgICAgICAgaWYgKHN0YXR1cyA9PSAyKSB7DQogICAgICAgICAgICBUb2FzdC5zdWNjZXNzKHsNCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+e7k+adn+aIkOWKnycsDQogICAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwLA0KICAgICAgICAgICAgICBvbkNsb3NlOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgdGhhdC5wb2xsaW5nRmxhZyA9IGZhbHNlDQogICAgICAgICAgICAgICAgdGhhdC5pZlJlY29yZGluZyA9IGZhbHNlDQogICAgICAgICAgICAgICAgLy8gYnVzLiRvZmYoJ3VwZGF0ZURhdGEnKQ0KICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzdGFydFJlY29yZExpbmVzJywgJ2VuZCcpDQogICAgICAgICAgICAgICAgdGhhdC5pc1ZpZXcgPSB0cnVlDQogICAgICAgICAgICAgICAgdGhhdC4kcm91dGVyLmdvKC0xKQ0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKHN0YXR1cyA9PSAyKSB7DQogICAgICAgICAgICBUb2FzdC5lcnJvcih7DQogICAgICAgICAgICAgIG1lc3NhZ2U6ICfnu5PmnZ/lpLHotKUsIOato+WcqOmHjeivlScsDQogICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAwLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICBhc3luYyBwb3N0RmFpbFRyYWNrRGF0YSgpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgLy8gYXBw5re75Yqg5LiK5Lyg5aSx6LSl54K555qE566h572R5qOA5ryP6L2o6L+5DQogICAgICBhd2FpdCBBcGkuaW5zcGVjdGlvblRyYWNrKHRoYXQucmVwb3J0RmFpbFRyYWNrUG9pbnRzKQ0KICAgICAgICAudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygn6L2o6L+55a2Y5YKo5oiQ5YqfJykNCiAgICAgICAgICAgIHRoYXQucmVwb3J0RmFpbFRyYWNrUG9pbnRzID0gW10NCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7DQogICAgICAgICAgY29uc29sZS5sb2coJ+W3oeajgOi9qOi/ueWtmOWCqOWksei0pe+8micgKyBlcnIpDQogICAgICAgIH0pDQogICAgfSwNCiAgICAvLyDmuIXpmaTnvJPlrZjnmoTovajov7nmlbDmja4NCiAgICBjbGVhckJ1ZmZlclRyYWNrKCkgew0KICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICB0aGF0LmlzUmVzdW1lID0gdHJ1ZQ0KICAgICAgLy8g5piv5ZCm5byA5aeL6K6w5b2VDQogICAgICB0aGF0LmlmUmVjb3JkaW5nID0gZmFsc2UNCiAgICAgIC8vIOW9k+WJjeW3oeajgOWRmOaJgOWkhOS9jee9rg0KICAgICAgdGhhdC5jdXJyZW50UG9zaXRpb24gPSBudWxsDQogICAgICAvLyDmlbDnu4TlvZLpm7YNCiAgICAgIC8vIOi9qOi/ueeCuQ0KICAgICAgdGhhdC50cmFja1BvaW50TGlzdCA9IFtdDQogICAgICAvLyDovajov7nml7bpl7QNCiAgICAgIHRoYXQudHJhY2tQb2ludFRpbWVMaXN0ID0gW10NCiAgICAgIC8vIOi2hemAn+e6v+autQ0KICAgICAgdGhhdC5vdmVyU3BlZWRUcmFja0xpbmVMaXN0ID0gW10NCiAgICAgIHBhdXNlU3RhdGVUcmFja1BvaW50cyA9IFtdDQogICAgICBwYXVzZVN0YXRlUGlwZUlkTGlzdCA9IFtdDQogICAgICAvL+aVsOaNrua6kOa4heepug0KICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKS5zZXREYXRhKHsNCiAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgIGZlYXR1cmVzOiBbXSwNCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldFNvdXJjZSgndHJhY2tMaW5lU291cmNlX292ZXJTcGVlZCcpKSB7DQogICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfb3ZlclNwZWVkJykuc2V0RGF0YSh7DQogICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICBmZWF0dXJlczogW10sDQogICAgICAgIH0pDQogICAgICB9DQogICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93Jykuc2V0RGF0YSh7DQogICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICBmZWF0dXJlczogW10sDQogICAgICAgIH0pDQogICAgICB9DQoNCiAgICAgIGlmIChtYXBPYmoubWFwLmdldFNvdXJjZSgnZW5kUG9pbnRTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ2VuZFBvaW50U291cmNlX25vdycpLnNldERhdGEoew0KICAgICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5re75Yqg6LW354K557uI54K55Zu+54mHDQogICAgYWRkTWFwSW1nKCkgew0KICAgICAgbWFwT2JqLm1hcC5sb2FkSW1hZ2UoDQogICAgICAgIHJlcXVpcmUoJ0Bhc3NldHMvaW1nL2luc3BlY3Rpb24vd2hpdGVfYXJyb3dfcmlnaHQucG5nJyksDQogICAgICAgIGZ1bmN0aW9uIChlcnJvciwgaW1hZ2UpIHsNCiAgICAgICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yDQogICAgICAgICAgaWYgKCFtYXBPYmoubWFwLmhhc0ltYWdlKCdhcnJvd0ljb24nKSkgew0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRJbWFnZSgnYXJyb3dJY29uJywgaW1hZ2UsIHt9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgKQ0KICAgICAgbWFwT2JqLm1hcC5sb2FkSW1hZ2UoDQogICAgICAgIHJlcXVpcmUoJ0Bhc3NldHMvaW1nL2luc3BlY3Rpb24vaWNvbl9zdGFydGluZ19wb2ludC5wbmcnKSwNCiAgICAgICAgZnVuY3Rpb24gKGVycm9yLCBpbWFnZSkgew0KICAgICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3INCiAgICAgICAgICBpZiAoIW1hcE9iai5tYXAuaGFzSW1hZ2UoJ3N0YXJ0X3BvaW50JykpIHsNCiAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkSW1hZ2UoJ3N0YXJ0X3BvaW50JywgaW1hZ2UsIHt9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgKQ0KICAgICAgbWFwT2JqLm1hcC5sb2FkSW1hZ2UoDQogICAgICAgIHJlcXVpcmUoJ0Bhc3NldHMvaW1nL2luc3BlY3Rpb24vaWNvbl9hdF9lbmQucG5nJyksDQogICAgICAgIGZ1bmN0aW9uIChlcnJvciwgaW1hZ2UpIHsNCiAgICAgICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yDQogICAgICAgICAgaWYgKCFtYXBPYmoubWFwLmhhc0ltYWdlKCdlbmRfcG9pbnQnKSkgew0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRJbWFnZSgnZW5kX3BvaW50JywgaW1hZ2UsIHt9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgKQ0KICAgIH0sDQogICAgLy8g57uY5Yi26LW35aeL54K5DQogICAgZHJhd1N0YXJ0UG9pbnQoKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgIGlmICh0eXBlb2YgeXVhbmNodSAhPSAndW5kZWZpbmVkJykgew0KICAgICAgICAgIHl1YW5jaHUubG9jYXRpb25BTWFwLnJlcXVlc3RTaW5nbGVMb2NhdGlvbigNCiAgICAgICAgICAgIFsnMSddLA0KICAgICAgICAgICAgKHJlcykgPT4gew0KICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzKSkNCiAgICAgICAgICAgICAgLy8gcmVzDQogICAgICAgICAgICAgIC8vIHsNCiAgICAgICAgICAgICAgLy8gICBhY2N1cmFjeTogJycsLy/lrprkvY3nsr7luqbvvIhBbmRyb2lk6L+U5Zue77yJDQogICAgICAgICAgICAgIC8vICAgYWRkcmVzczogJ+a1meaxn+ecgeadreW3nuW4guS9meadreWMuuaZuua6oui3r+mdoOi/keS4reWbvSjmna3lt54p5Lq65bel5pm66IO95bCP6ZWHJywvL++8iOiLpeivt+axguWbnumAhuWcsOeQhuS9jee9ruS/oeaBr+WImei/lOWbnu+8iQ0KICAgICAgICAgICAgICAvLyAgIGxhdGl0dWRlOiAnMzAuMjcwNjQ2OTcyNjU2MjUxNycsLy/vvIjlv4Xov5Tlm57vvIkNCiAgICAgICAgICAgICAgLy8gICBsb25naXR1ZGU6ICcxMTkuOTY1ODY4MDU1NTU1NTYwNScsLy/vvIjlv4Xov5Tlm57vvIkNCiAgICAgICAgICAgICAgLy8gICBsb2NUaW1lOiAnMjAyMi0wMy0wOSAwOTo0NToxOScsLy/vvIjlv4Xov5Tlm57vvIkNCiAgICAgICAgICAgICAgLy8gICBsb2NUeXBlOiAnJywvL+WumuS9jeaooeW8j++8iEFuZHJvaWTov5Tlm57vvIkNCiAgICAgICAgICAgICAgLy8gfQ0KICAgICAgICAgICAgICBjb25zdCBwYXJhbSA9IHsNCiAgICAgICAgICAgICAgICAuLi50aGF0LmN1cnJlbnRQb3NpdGlvbiwNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAvLyDorr7nva7lt6Hmo4DkurrlkZjkvY3nva7lubbnm5HlkKzorr7lpIfml4vovazkuovku7bvvIznu5nkurrlkZjlm77moIfml4vovazop5LluqbotYvlgLwNCiAgICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC5zZXRJbnNwVXNlclBvc2l0aW9uKHBhcmFtKQ0KICAgICAgICAgICAgICBpZiAodGhhdC5jdXJyZW50UG9zaXRpb24gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGxldCByZWNvcmREYXRhID0gW10NCiAgICAgICAgICAgICAgICByZWNvcmREYXRhLnB1c2goew0KICAgICAgICAgICAgICAgICAgdGFza0lkOiB0aGF0LnRhc2tEZXRhaWwuaWQsIC8vIOS7u+WKoWlkDQogICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHRoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwNCiAgICAgICAgICAgICAgICAgIGxhdGl0dWRlOiB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZSwNCiAgICAgICAgICAgICAgICAgIGluc3BUaW1lOiB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb2NUaW1lLCAvLyDlhbfkvZPlt6Hmo4Dml7bpl7QNCiAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAwLCAvLyDovajov7nplb/luqYg56ys5LiA5Liq54K56Led56a75Li6MA0KICAgICAgICAgICAgICAgICAgaW5zcERhdGU6IHRoYXQuY3VycmVudFBvc2l0aW9uLmxvY1RpbWUsIC8vIOW3oeajgOaXpeacnw0KICAgICAgICAgICAgICAgICAgaW5zcGVjdG9yOiB0aGF0LnVzZXJJbmZvLnVzZXJGdWxsTmFtZSwNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIC8vIGFwcOa3u+WKoOeuoee9keajgOa8j+i9qOi/uQ0KICAgICAgICAgICAgICAgIEFwaS5pbnNwZWN0aW9uVHJhY2socmVjb3JkRGF0YSkNCiAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgICAgICAgICAgICAgICAgLy8g5L2/55So5LiK5oql54K55L2N5L2c5Li66LW354K5DQogICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+i1t+Wni+eCueWtmOWCqOaIkOWKnycpDQogICAgICAgICAgICAgICAgICAgICAgdGhhdC50cmFja1BvaW50TGlzdC5wdXNoKFsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlLA0KICAgICAgICAgICAgICAgICAgICAgIF0pDQogICAgICAgICAgICAgICAgICAgICAgdGhhdC50cmFja1BvaW50VGltZUxpc3QucHVzaCh0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb2NUaW1lKQ0KICAgICAgICAgICAgICAgICAgICAgIGxldCBqc29uUG9pbnQgPSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGdlb21ldHJ5OiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQb2ludCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBbDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGpzb25Qb2ludEZlYXR1cmVDb2xsZWN0aW9uID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzOiBbanNvblBvaW50XSwNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCdzdGFydFBvaW50U291cmNlX25vdycpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtYXBPYmoubWFwDQogICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldERhdGEoanNvblBvaW50RmVhdHVyZUNvbGxlY3Rpb24pDQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkU291cmNlKCdzdGFydFBvaW50U291cmNlX25vdycsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2dlb2pzb24nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBqc29uUG9pbnRGZWF0dXJlQ29sbGVjdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBPYmoubWFwLmdldExheWVyKCdzdGFydFBvaW50TGF5ZXJfbm93JykpIHsNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcigNCiAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnc3RhcnRQb2ludExheWVyX25vdycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NpcmNsZScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiAnc3RhcnRQb2ludFNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NpcmNsZS1zb3J0LWtleSc6IDUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhaW50OiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2lyY2xlLXJhZGl1cyc6IDMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2lyY2xlLXN0cm9rZS13aWR0aCc6IDUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2lyY2xlLXN0cm9rZS1jb2xvcic6ICcjMkE4M0U2JywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaXJjbGUtY29sb3InOiAnd2hpdGUnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICdpbnNwVXNlckxheWVyJw0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAvLyDmt7vliqDotbfngrnlm77niYcNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRMYXllcignc3RhcnRQb2ludF9sYWJlbCcpKSB7DQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkTGF5ZXIoew0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3N0YXJ0UG9pbnRfbGFiZWwnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3ltYm9sJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiAnc3RhcnRQb2ludFNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXBsYWNlbWVudCc6ICdwb2ludCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24taW1hZ2UnOiAnc3RhcnRfcG9pbnQnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpY29uLXNpemUnOiAwLjYsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24tb2Zmc2V0JzogWzAsIC0zNV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24tYWxsb3ctb3ZlcmxhcCc6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5bWJvbC1zb3J0LWtleSc6IDIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZpc2liaWxpdHk6ICJub25lIg0KICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKQ0KICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIChlcnIpID0+IHsNCiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICApDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyDova7or6IgY3VycmVudFBvc2l0aW9u77yM57uY5Yi26L2o6L+557q/DQogICAgcG9sbGluZygpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgLy8g6L2u6K+i54q25oCBDQogICAgICBpZiAodGhhdC5wb2xsaW5nRmxhZykgew0KICAgICAgICBpZiAodHlwZW9mIHl1YW5jaHUgIT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICB5dWFuY2h1LmxvY2F0aW9uQU1hcC5yZXF1ZXN0TG9jYXRpb25zKA0KICAgICAgICAgICAgLy8g5beh5qOA5a6a5pe26Ze06ZqU77ya5Y2V5L2N56eSIDN+NjAg77yI5b+F5aGr5Y+C5pWw77yJDQogICAgICAgICAgICBbJzMnLCAnMScsICcyMCcsICcxMDAnLCAnMCcsIHRydWVdLA0KICAgICAgICAgICAgKHJlcykgPT4gew0KICAgICAgICAgICAgICAvLyByZXMNCiAgICAgICAgICAgICAgLy8gew0KICAgICAgICAgICAgICAvLyAgIGFjY3VyYWN5OiAnJywvL+WumuS9jeeyvuW6pu+8iEFuZHJvaWTov5Tlm57vvIkNCiAgICAgICAgICAgICAgLy8gICBhZGRyZXNzOiAn5rWZ5rGf55yB5p2t5bee5biC5L2Z5p2t5Yy65pm65rqi6Lev6Z2g6L+R5Lit5Zu9KOadreW3ninkurrlt6Xmmbrog73lsI/plYcnLC8v77yI6Iul6K+35rGC5Zue6YCG5Zyw55CG5L2N572u5L+h5oGv5YiZ6L+U5Zue77yJDQogICAgICAgICAgICAgIC8vICAgbGF0aXR1ZGU6ICczMC4yNzA2NDY5NzI2NTYyNTE3JywvL++8iOW/hei/lOWbnu+8iQ0KICAgICAgICAgICAgICAvLyAgIGxvbmdpdHVkZTogJzExOS45NjU4NjgwNTU1NTU1NjA1JywvL++8iOW/hei/lOWbnu+8iQ0KICAgICAgICAgICAgICAvLyAgIGxvY1RpbWU6ICcyMDIyLTAzLTA5IDA5OjQ1OjE5JywvL++8iOW/hei/lOWbnu+8iQ0KICAgICAgICAgICAgICAvLyAgIGxvY1R5cGU6ICcnLC8v5a6a5L2N5qih5byP77yIQW5kcm9pZOi/lOWbnu+8iQ0KICAgICAgICAgICAgICAvLyB9DQogICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXMpKQ0KICAgICAgICAgICAgICAvLyBzZXRJbnRlcnZhbCgoKSA9PiB7DQogICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uID0gT2JqZWN0LmFzc2lnbih0aGF0LmN1cnJlbnRQb3NpdGlvbiwgew0KICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogMCwNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgLy8g6L+H5ruk57yT5a2Y5a6a5L2N5pWw5o2uDQogICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb2NUeXBlICE9ICdTQU1FX1JFUScgJiYNCiAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb2NUeXBlICE9ICdGSVhfQ0FDSEUnDQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIGxldCBsYXN0UG9pbnQgPSB0aGF0LnRyYWNrUG9pbnRMaXN0W3RoYXQudHJhY2tQb2ludExpc3QubGVuZ3RoIC0gMV0NCiAgICAgICAgICAgICAgICBsZXQgY3VycmVudFBvaW50ID0gW3RoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwgdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGVdDQogICAgICAgICAgICAgICAgLy8g6K6h566X6LW354K557uI54K56Led56a7DQogICAgICAgICAgICAgICAgbGV0IGRpc3RhbmNlID0gTnVtYmVyKHRoYXQuR2V0RGlzdGFuY2UobGFzdFBvaW50LCBjdXJyZW50UG9pbnQpKSAqIDEwMDANCg0KICAgICAgICAgICAgICAgIC8vIOiusOW9lei/h+eoi+eCuQ0KICAgICAgICAgICAgICAgIHRoYXQNCiAgICAgICAgICAgICAgICAgIC5wb3N0VHJhY2tEYXRhX1BvaW50KA0KICAgICAgICAgICAgICAgICAgICAvLyDmnIDlkI7kuIDkuKrngrnvvIzmnIDlkI7kuIDkuKrngrnlr7nlupTnmoTml7bpl7TvvIzmnIDlkI7kuKTngrnkuYvpl7TnmoTot53nprsNCiAgICAgICAgICAgICAgICAgICAgdGhhdC50cmFja1BvaW50TGlzdFt0aGF0LnRyYWNrUG9pbnRMaXN0Lmxlbmd0aCAtIDFdLA0KICAgICAgICAgICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdFt0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5sZW5ndGggLSAxXSwNCiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UNCiAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcykgew0KICAgICAgICAgICAgICAgICAgICAgIC8vIOi9qOi/ueeCueaVsOe7hOWtmOWCqOW9k+WJjeWumuS9jeeCuQ0KICAgICAgICAgICAgICAgICAgICAgIHRoYXQudHJhY2tQb2ludExpc3QucHVzaChbDQogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUsDQogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZSwNCiAgICAgICAgICAgICAgICAgICAgICBdKQ0KICAgICAgICAgICAgICAgICAgICAgIC8vIOi9qOi/ueeCueWvueW6lOaXtumXtOaVsOe7hOWtmOWCqOW9k+WJjeWumuS9jeeCueaXtumXtA0KICAgICAgICAgICAgICAgICAgICAgIHRoYXQudHJhY2tQb2ludFRpbWVMaXN0LnB1c2godGhhdC5jdXJyZW50UG9zaXRpb24ubG9jVGltZSkNCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIOW3oeajgOS6uuWRmOWbvuagh+S9jee9ruabtOaWsA0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvb3JkID0gWw0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdCh0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdCh0aGF0LmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZSksDQogICAgICAgICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50ID0gdHVyZi5wb2ludChjb29yZCkNCiAgICAgICAgICAgICAgICAgICAgICBtYXBPYmoubWFwSW5zdGFuY2Uuc2V0U291cmNlRGF0YSgnaW5zcFVzZXInLCB7DQogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXM6IFtwb2ludF0sDQogICAgICAgICAgICAgICAgICAgICAgfSkNCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIOi9qOi/ueeCueaVsOe7hOaehOmAoOS4tOaXtue6v+WbvuWxgg0KICAgICAgICAgICAgICAgICAgICAgIGxldCBqc29uTGluZSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJywNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgZ2VvbWV0cnk6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0xpbmVTdHJpbmcnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb29yZGluYXRlczogdGhhdC50cmFja1BvaW50TGlzdCwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGxldCBqc29uTGluZUZlYXR1cmVDb2xsZWN0aW9uID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzOiBbanNvbkxpbmVdLA0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbWFwT2JqLm1hcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldERhdGEoanNvbkxpbmVGZWF0dXJlQ29sbGVjdGlvbikNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnLCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToganNvbkxpbmVGZWF0dXJlQ29sbGVjdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBPYmoubWFwLmdldExheWVyKCd0cmFja0xpbmVMYXllcl9ub3cnKSkgew0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmFkZExheWVyKA0KICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICd0cmFja0xpbmVMYXllcl9ub3cnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaW5lJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6ICd0cmFja0xpbmVTb3VyY2Vfbm93JywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsaW5lLWNhcCc6ICdyb3VuZCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGluZS1qb2luJzogJ3JvdW5kJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsaW5lLXNvcnQta2V5JzogMSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZpc2liaWxpdHk6ICJub25lIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFpbnQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsaW5lLWNvbG9yJzogJyNhZGRkNTInLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xpbmUtd2lkdGgnOiA1LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xpbmUtb3BhY2l0eSc6IDAuOCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5zcFVzZXJMYXllcicNCiAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgLy8g5Y+z566t5aS05Zu+5qCHDQogICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ3RyYWNrTGluZUxheWVyX2Fycm93JykpIHsNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcigNCiAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAndHJhY2tMaW5lTGF5ZXJfYXJyb3cnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzeW1ib2wnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ3RyYWNrTGluZVNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5bWJvbC1wbGFjZW1lbnQnOiAnbGluZScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXNwYWNpbmcnOiAyMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpY29uLWltYWdlJzogJ2Fycm93SWNvbicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaWNvbi1zaXplJzogMC41LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24tYWxsb3ctb3ZlcmxhcCc6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXNvcnQta2V5JzogMywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5zcFVzZXJMYXllcicNCiAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgLy8g5pS55Y+Y566h57q/6aKc6ImyDQogICAgICAgICAgICAgICAgICAgICAgdGhhdC5jaGFuZ2VJbnNwTGluZVNvdXJjZUJ5U3BlZWQodGhhdC5jdXJyZW50UG9zaXRpb24pDQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICAuLi50aGF0LmN1cnJlbnRQb3NpdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC5zZXRJbnNwVXNlclBvc2l0aW9uKHBhcmFtKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIC8vIH0sIDMwMDApDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgKGVycikgPT4gew0KICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5a6a5L2N5aSx6LSl77yM6ZSZ6K+v5Y6f5ZugJywgZXJyKQ0KICAgICAgICAgICAgICAvLyBUb2FzdC5lcnJvcih7DQogICAgICAgICAgICAgIC8vICAgbWVzc2FnZTogJ2VycicgKyBlcnIsDQogICAgICAgICAgICAgIC8vICAgZHVyYXRpb246IDIwMDAsDQogICAgICAgICAgICAgIC8vIH0pDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICB9DQogICAgICAgIC8vIHRoaXMudXBsb2FkSW5zcFJvdXRlKCkNCiAgICAgIH0NCiAgICB9LA0KICAgIEdldERpc3RhbmNlKGNvb3JkQXJyYXkxLCBjb29yZEFycmF5Mikgew0KICAgICAgbGV0IGxuZzEgPSBjb29yZEFycmF5MVswXQ0KICAgICAgbGV0IGxhdDEgPSBjb29yZEFycmF5MVsxXQ0KICAgICAgbGV0IGxuZzIgPSBjb29yZEFycmF5MlswXQ0KICAgICAgbGV0IGxhdDIgPSBjb29yZEFycmF5MlsxXQ0KICAgICAgbGV0IHJhZExhdDEgPSAobGF0MSAqIE1hdGguUEkpIC8gMTgwLjANCiAgICAgIGxldCByYWRMYXQyID0gKGxhdDIgKiBNYXRoLlBJKSAvIDE4MC4wDQogICAgICBsZXQgYSA9IHJhZExhdDEgLSByYWRMYXQyDQogICAgICBsZXQgYiA9IChsbmcxICogTWF0aC5QSSkgLyAxODAuMCAtIChsbmcyICogTWF0aC5QSSkgLyAxODAuMA0KICAgICAgbGV0IHMgPQ0KICAgICAgICAyICoNCiAgICAgICAgTWF0aC5hc2luKA0KICAgICAgICAgIE1hdGguc3FydCgNCiAgICAgICAgICAgIE1hdGgucG93KE1hdGguc2luKGEgLyAyKSwgMikgKw0KICAgICAgICAgICAgICBNYXRoLmNvcyhyYWRMYXQxKSAqIE1hdGguY29zKHJhZExhdDIpICogTWF0aC5wb3coTWF0aC5zaW4oYiAvIDIpLCAyKQ0KICAgICAgICAgICkNCiAgICAgICAgKQ0KICAgICAgcyA9IHMgKiA2Mzc4LjEzNyAvLyBFQVJUSF9SQURJVVM7DQogICAgICBzID0gTWF0aC5yb3VuZChzICogMTAwMDApIC8gMTAwMDANCiAgICAgIHJldHVybiBzDQogICAgfSwNCiAgICAvLyDljZXngrkt5ZCO56uv6K6w5b2V6L2o6L+55pWw5o2uDQogICAgcG9zdFRyYWNrRGF0YV9Qb2ludChwb2ludERhdGEsIHRpbWVEYXRhLCBkaXN0YW5jZSkgew0KICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICAgIGZvciAobGV0IHAgPSAwOyBwIDwgcG9pbnREYXRhLmxlbmd0aDsgcCsrKSB7DQogICAgICAgICAgcG9pbnREYXRhW3BdID0gTnVtYmVyKHBvaW50RGF0YVtwXSkNCiAgICAgICAgfQ0KICAgICAgICBsZXQgZGF0ZV9ub3cgPSBkYXlqcygpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcycpDQogICAgICAgIGxldCByZWNvcmREYXRhID0gW10NCiAgICAgICAgcmVjb3JkRGF0YS5wdXNoKHsNCiAgICAgICAgICB0YXNrSWQ6IHRoYXQudGFza0RldGFpbC5pZCwNCiAgICAgICAgICBpbnNwRGF0ZTogdGltZURhdGEsIC8vIOW3oeajgOaXpeacnw0KICAgICAgICAgIGluc3BUaW1lOiBkYXRlX25vdywgLy8g5YW35L2T5beh5qOA5pe26Ze0DQogICAgICAgICAgZGlzdGFuY2UsIC8vIOi9qOi/uemVv+W6pg0KICAgICAgICAgIGluc3BlY3RvcjogdGhhdC51c2VySW5mby51c2VyRnVsbG5hbWUsIC8vIOW3oeajgOWRmA0KICAgICAgICAgIGxvbmdpdHVkZTogcG9pbnREYXRhWzBdLA0KICAgICAgICAgIGxhdGl0dWRlOiBwb2ludERhdGFbMV0sDQogICAgICAgIH0pDQogICAgICAgIGlmICh0aGF0LmlzUmVzdW1lKSB7DQogICAgICAgICAgLy8gYXBw5re75Yqg566h572R5qOA5ryP6L2o6L+5DQogICAgICAgICAgYXdhaXQgQXBpLmluc3BlY3Rpb25UcmFjayhyZWNvcmREYXRhKS50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICAgIGlmIChyZXMgJiYgcmVzLnN0YXR1cykgew0KICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6L2o6L+55a2Y5YKo5oiQ5YqfJywgcmVjb3JkRGF0YSkNCiAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgLy8g5LiK5Lyg5aSx6LSl55qE54K55L2N77yM5pqC5pe25a2Y5ZyoYXBw56uvDQogICAgICAgICAgICAgIHRoYXQucmVwb3J0RmFpbFRyYWNrUG9pbnRzLnB1c2gocmVjb3JkRGF0YSkNCiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RoYXQucmVwb3J0RmFpbFRyYWNrUG9pbnRzOiAnLCB0aGF0LnJlcG9ydEZhaWxUcmFja1BvaW50cykNCiAgICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHBhdXNlU3RhdGVUcmFja1BvaW50cy5wdXNoKC4uLnJlY29yZERhdGEpDQogICAgICAgICAgcmVzb2x2ZSh0cnVlKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g5byA5aeL5a6a5L2NDQogICAgc3RhcnRMb2NhdGlvbigpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAucmVxdWVzdFNpbmdsZUxvY2F0aW9uKA0KICAgICAgICBbJzEnXSwNCiAgICAgICAgKHJlcykgPT4gew0KICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXMpKQ0KICAgICAgICAgIGNvbnN0IHBhcmFtID0gew0KICAgICAgICAgICAgLi4udGhhdC5jdXJyZW50UG9zaXRpb24sDQogICAgICAgICAgfQ0KICAgICAgICAgIHRoYXQuJHJlZnMubXltYXAuc2V0SW5zcFVzZXJQb3NpdGlvbihwYXJhbSkNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICAhdGhhdC5jdXJyZW50UG9zaXRpb24gfHwNCiAgICAgICAgICAgICF0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUgfHwNCiAgICAgICAgICAgICF0aGF0LmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZQ0KICAgICAgICAgICkgew0KICAgICAgICAgICAgVG9hc3QuZXJyb3Ioew0KICAgICAgICAgICAgICBtZXNzYWdlOiAn6I635Y+W5L2N572u5aSx6LSlIScsDQogICAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zdCBjb29yZCA9IFsNCiAgICAgICAgICAgICAgcGFyc2VGbG9hdCh0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUpLA0KICAgICAgICAgICAgICBwYXJzZUZsb2F0KHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlKSwNCiAgICAgICAgICAgIF0NCiAgICAgICAgICAgIHRoYXQuZmx5VG9Qb2ludChjb29yZCkNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIChlcnIpID0+IHsNCiAgICAgICAgICBjb25zb2xlLmxvZygnZXJyJywgZXJyKQ0KICAgICAgICB9DQogICAgICApDQogICAgfSwNCiAgICAvLyDlt6Hmo4DkurrlkZjlrprkvY0NCiAgICBmbHlUb1BvaW50KGxuZ2xhdCkgew0KICAgICAgbWFwT2JqLm1hcC5mbHlUbyh7IGNlbnRlcjogbG5nbGF0LCB6b29tOiAxNy41IH0pDQogICAgfSwNCiAgICAvLyDnu5PmnZ/ku7vliqENCiAgICBhc3luYyBlbmRUYXNrKCkgew0KICAgICAgaWYgKHRoaXMuaXNWaWV3KSB7DQogICAgICAgIFRvYXN0KHsNCiAgICAgICAgICBtZXNzYWdlOiAn6K+l5beh5qOA5Lu75Yqh5bey57uT5p2fJywNCiAgICAgICAgICBkdXJhdGlvbjogMTUwMCwNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICAvLyBidXMuJG9mZigndXBkYXRlRGF0YScpDQogICAgICAvLyDmt7vliqDku7vliqHojIPlm7TjgIHnrqHnur/lm77lsYINCiAgICAgIGF3YWl0IHRoaXMuYWRkVGFza1JhbmdlQW5kTGluZXMoKQ0KICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgIGxldCBoYXNJbnNwS3AgPSB0aGlzLnRhc2tEZXRhaWw/LmNvbXBsZXRpb24uc3BsaXQoJ3wnKVswXSB8fCAwDQogICAgICAgIGxldCBhbGxJbnNwS3AgPSB0aGlzLnRhc2tEZXRhaWw/LmNvbXBsZXRpb24uc3BsaXQoJ3wnKVsxXSB8fCAwDQogICAgICAgIGlmIChhbGxJbnNwS3AgLSBoYXNJbnNwS3AgPT0gMCAmJiB0aGlzLnRhc2tEZXRhaWwuY292ZXJhZ2UuaW5jbHVkZXMoJzEwMCcpKSB7DQogICAgICAgICAgdGhpcy5lbmRSZWNvcmRDb25maXJtKCdlbmQnKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vIOe7k+adn+S7u+WKoeaXtuWIpOaWreaYr+WQpuW3sue7j+WujOaIkOW3oeajgO+8jOWmguaenOayoeWujOaIkOWwseaPkOekuuaYr+WQpumAgOWHug0KICAgICAgICAgIHRoaXMuaWZFbmRUYXNrID0gdHJ1ZQ0KICAgICAgICB9DQogICAgICB9LCAxMDApDQogICAgfSwNCiAgICAvLyDnu6fnu63ku7vliqENCiAgICBjb250aW51ZVRhc2soKSB7DQogICAgICB0aGlzLnN0b3BSZWFzb24gPSAnJw0KICAgICAgdGhpcy5pZkVuZFRhc2sgPSBmYWxzZQ0KICAgIH0sDQogICAgLy8g5Lit5q2i5Lu75YqhDQogICAgc3RvcFRhc2soKSB7DQogICAgICBpZiAodGhpcy5zdG9wUmVhc29uID09ICcnKSB7DQogICAgICAgIFRvYXN0Lndhcm5pbmcoew0KICAgICAgICAgIG1lc3NhZ2U6ICfor7fovpPlhaXnu4jmraLljp/lm6AnLA0KICAgICAgICAgIGR1cmF0aW9uOiAxNTAwLA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIHRoaXMuaWZFbmRUYXNrID0gZmFsc2UNCiAgICAgIHRoaXMuZW5kUmVjb3JkQ29uZmlybSgnZW5kJykNCiAgICB9LA0KICAgIC8vIOajgOa8j+W3peWNlei/m+WFpeivpuaDhemhtQ0KICAgIHRvRGV0YWlsUGFuZWwoY2FyZERldGFpbCkgew0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goew0KICAgICAgICBuYW1lOiAnTGVha0RldGVjdGlvbkZvcm0nLA0KICAgICAgICBxdWVyeTogew0KICAgICAgICAgIGlkOiBjYXJkRGV0YWlsLmlkLA0KICAgICAgICB9LA0KICAgICAgfSkNCiAgICB9LA0KICB9LA0KDQogIGJlZm9yZURlc3Ryb3koKSB7DQogICAgVG9hc3QuY2xlYXIoKQ0KICAgIHRoaXMucG9sbGluZ0ZsYWcgPSBmYWxzZQ0KICAgIHRoaXMuY2xlYXJCdWZmZXJUcmFjaygpDQogICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncGF1c2UnLCB0aGlzLnBhdXNlKQ0KICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc3VtZScsIHRoaXMucmVzdW1lKQ0KICAgIGlmICh0eXBlb2YgeXVhbmNodSAhPSAndW5kZWZpbmVkJykgew0KICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAuc3RvcFJlcXVlc3RMb2NhdGlvbnMoKQ0KICAgIH0NCiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnc3RhcnRSZWNvcmRMaW5lcycpDQogIH0sDQp9DQo="},{"version":3,"sources":["LeakDetectionMapPage.vue"],"names":[],"mappings":";AAuMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LeakDetectionMapPage.vue","sourceRoot":"src/views/PipeNetLeakDetection","sourcesContent":["<template>\r\n  <div class=\"MapPage\">\r\n    <fm-nav-bar\r\n      left-arrow\r\n      :title=\"taskDetail.taskName\"\r\n      @click-left=\"goBackToTask\"\r\n      @click-right=\"onSelect\"\r\n    >\r\n      <template #right>\r\n        <template>\r\n          <i\r\n            v-if=\"!isView && isInspectorLoad\"\r\n            class=\"fm-icon fm-icon-plus\"\r\n            style=\"font-size: 18px\"\r\n          ></i>\r\n        </template>\r\n      </template>\r\n    </fm-nav-bar>\r\n    <!--  -->\r\n    <div class=\"mapContainer\">\r\n      <MapComp ref=\"mymap\" :ifInspection=\"true\" @mapLoaded=\"mapLoaded\"></MapComp>\r\n    </div>\r\n    <!--  -->\r\n    <div class=\"start-record\" v-if=\"!isView && isInspectorLoad\">\r\n      <img\r\n        v-if=\"!ifRecording\"\r\n        :src=\"require('@/assets/img/inspection/.png')\"\r\n        @click=\"startInspRecord\"\r\n      />\r\n      <img v-else :src=\"require('@/assets/img/inspection/.png')\" @click=\"endRecord('pause')\" />\r\n    </div>\r\n    <!--  -->\r\n    <!--  -->\r\n    <div class=\"controlCard\" v-if=\"!isView && isInspectorLoad\">\r\n      <div class=\"controlContent\">\r\n        <div class=\"infoContent\">\r\n          <div class=\"endControl\">\r\n            <div class=\"leftText\">\r\n              <img :src=\"require('@/assets/img/inspection/.png')\" />\r\n              <fm-count-down\r\n                style=\"margin: auto\"\r\n                :time=\"getRestTime(taskDetail.taskEndTime)\"\r\n                format=\"DDHH\"\r\n              />\r\n            </div>\r\n            <div class=\"rightButton\">\r\n              <fm-button v-show=\"ifRecording\" class=\"endBtn\" round @click=\"endTask\"></fm-button>\r\n            </div>\r\n          </div>\r\n          <div class=\"bottomSide\">\r\n            <div class=\"block\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ changeToRate(taskDetail.coverage) }}\r\n                </div>\r\n              </div>\r\n              <div class=\"nameStyle\" style=\"font-size: 14px\"></div>\r\n            </div>\r\n            <div class=\"block\" @click=\"reportClick\" style=\"cursor: pointer\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ problemDataList.length }}\r\n                </div>\r\n              </div>\r\n              <div class=\"nameStyle\" style=\"font-size: 14px\"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!--  -->\r\n    <div class=\"viewCard\" v-if=\"isView || !isInspectorLoad\">\r\n      <div class=\"controlContent\">\r\n        <div class=\"infoContent\">\r\n          <div class=\"bottomSide\">\r\n            <div class=\"block\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ changeToRate(taskDetail.coverage) }}\r\n                </div>\r\n              </div>\r\n              <div class=\"nameStyle\" style=\"font-size: 14px\"></div>\r\n            </div>\r\n            <div class=\"block\" @click=\"reportClick\" style=\"cursor: pointer\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ problemDataList.length }}\r\n                </div>\r\n              </div>\r\n              <div class=\"nameStyle\" style=\"font-size: 14px\"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!--  -->\r\n    <div class=\"tool-box\">\r\n      <!--  -->\r\n      <!-- <div class=\"refresh\" @click=\"resetMapView\">\r\n        <fm-image class=\"refresh-image\" :src=\"require('@/assets/img/inspection/reset.png')\"></fm-image>\r\n      </div>\r\n      <div class=\"route\" @click=\"showRoute\">\r\n        <fm-image\r\n          v-if=\"isShowRoute\"\r\n          class=\"route-image\"\r\n          :src=\"require('@/assets/img/inspection/route2.png')\"\r\n        ></fm-image>\r\n        <fm-image v-else class=\"route-image\" :src=\"require('@/assets/img/inspection/route.png')\"></fm-image>\r\n      </div> -->\r\n      <div class=\"location\" @click=\"startLocation\">\r\n        <fm-image\r\n          class=\"location-image\"\r\n          :src=\"require('@/assets/img/inspection/location.png')\"\r\n        ></fm-image>\r\n      </div>\r\n    </div>\r\n    <fm-popup\r\n      :visible.sync=\"reportShow\"\r\n      @close=\"handleClose\"\r\n      round\r\n      position=\"bottom\"\r\n      :overlay-style=\"{ background: 'rgba(0, 0, 0, 0.1)' }\"\r\n      :style=\"{ height: '50%' }\"\r\n    >\r\n      <fm-tabs v-model=\"active\" swipeable style=\"height: 100%\">\r\n        <fm-tab label=\"\">\r\n          <div v-for=\"(item, index) in problemDataList\" :key=\"index\">\r\n            <LeakReportCardInfo\r\n              :cardInfo=\"item\"\r\n              @toDetailPanel=\"toDetailPanel\"\r\n              @flyToPoint=\"flyToPoint\"\r\n            >\r\n            </LeakReportCardInfo>\r\n          </div>\r\n        </fm-tab>\r\n      </fm-tabs>\r\n    </fm-popup>\r\n    <!--  -->\r\n    <div v-show=\"ifTips\" class=\"tip-tools\">\r\n      <img :src=\"require('@/assets/img/tips.png')\" class=\"tipImg\" />\r\n      <div class=\"context\"></div>\r\n    </div>\r\n    <fm-overlay :show=\"ifEndTask\" z-index=\"4\">\r\n      <div class=\"confirm-tip\">\r\n        <div class=\"content\">\r\n          <div class=\"icon\">\r\n            <img\r\n              :src=\"require('@/assets/img/inspection/.png')\"\r\n              width=\"60\"\r\n              style=\"margin: auto\"\r\n            />\r\n          </div>\r\n          <!--  -->\r\n          <div class=\"info\">\r\n            <span>{{ `` }}</span>\r\n          </div>\r\n          <div class=\"input\">\r\n            <fm-field\r\n              v-model=\"stopReason\"\r\n              placeholder=\"\"\r\n              rows=\"3\"\r\n              autosize\r\n              type=\"textarea\"\r\n              maxlength=\"200\"\r\n              show-word-limit\r\n            ></fm-field>\r\n          </div>\r\n        </div>\r\n        <div class=\"confirm_btn\">\r\n          <div class=\"btn1 btn2\" @click=\"continueTask\"></div>\r\n          <div class=\"btn1\" @click=\"stopTask\"></div>\r\n        </div>\r\n      </div>\r\n    </fm-overlay>\r\n    <fm-overlay :show=\"ifLeaveTask\" z-index=\"4\">\r\n      <!--  -->\r\n      <div class=\"confirm-tip\" style=\"height: 29%\">\r\n        <div class=\"content\">\r\n          <div class=\"icon\">\r\n            <img\r\n              :src=\"require('@/assets/img/inspection/.png')\"\r\n              width=\"60\"\r\n              style=\"margin: auto\"\r\n            />\r\n          </div>\r\n          <div class=\"info\">\r\n            <span>{{ `` }}</span>\r\n          </div>\r\n        </div>\r\n        <div class=\"confirm_btn\">\r\n          <div class=\"btn1 btn2\" @click=\"cancelLeave\"></div>\r\n          <div class=\"btn1\" @click=\"confirmLeave\"></div>\r\n        </div>\r\n      </div>\r\n    </fm-overlay>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Vue from 'vue'\r\nimport axios from 'axios'\r\nimport * as Api from './api'\r\nimport bus from '@/utils/bus'\r\nimport { ENUM } from '@/store/State/stateTypes'\r\nimport * as turf from '@turf/turf'\r\nimport { bbox, center as getCenter } from '@turf/turf'\r\nimport _cloneDeep from 'lodash/cloneDeep'\r\nimport { addIconToMap } from '@/utils/mapUtils'\r\nimport mapboxgl from 'mapbox-gl'\r\nimport { Toast, Dialog, Notify } from 'fawkes-mobile-lib'\r\nimport MapComp from '@/views/inspectMap/index.vue'\r\nimport mixins from '@/views/inspectMap/mixins/mixins.js'\r\nimport dayjs from 'dayjs'\r\nimport request from '@/utils/request'\r\nimport LeakReportCardInfo from './LeakReportCardInfo'\r\nimport Popup from './Popup.vue'\r\nconst PopupItem = Vue.extend(Popup)\r\n\r\nconst mapObj = {\r\n  map: null,\r\n  mapInstance: null,\r\n}\r\nlet pauseStateTrackPoints = []\r\nlet pauseStatePipeIdList = []\r\nexport default {\r\n  name: '',\r\n  mixins: [mixins],\r\n  components: {\r\n    MapComp,\r\n    LeakReportCardInfo,\r\n  },\r\n  data() {\r\n    return {\r\n      isResume: true,\r\n      // \r\n      icons: [\r\n        {\r\n          name: '',\r\n          url: require('@/assets/img/map/.png'),\r\n        },\r\n      ],\r\n      // \r\n      taskDetail: {},\r\n      // \r\n      userInfo: {},\r\n      // \r\n      allTaskLines: [],\r\n      // \r\n      currentPosition: null,\r\n      // \r\n      ifRecording: false,\r\n      // \r\n      pollingFlag: false,\r\n      // \r\n      isView: false,\r\n      // true\r\n      isInspectorLoad: true,\r\n      isOnLoad: false,\r\n      // \r\n      trackPointList: [],\r\n      // \r\n      trackPointTimeList: [],\r\n      // \r\n      overSpeedTrackLineList: [],\r\n      // 10s\r\n      startRecordTimer: '',\r\n      // \r\n      reportFailTrackPoints: [],\r\n      // \r\n      showPopover: false,\r\n      ifTips: false,\r\n      actions: [\r\n        {\r\n          text: '',\r\n        },\r\n      ],\r\n      accessToken: this.$storage.get('access_token'),\r\n      formToken: '',\r\n      header: {},\r\n      // \r\n      reportDataIsLoaded: false,\r\n      // \r\n      problemDataList: [],\r\n      // \r\n      reportShow: false,\r\n      active: 0,\r\n      ifEndTask: false,\r\n      // \r\n      stopReason: '',\r\n      ifLeaveTask: false,\r\n    }\r\n  },\r\n  created() {\r\n    console.log('', JSON.parse(localStorage.getItem('leakDetectionData')))\r\n\r\n    // \r\n    this.taskDetail = JSON.parse(localStorage.getItem('leakDetectionData')).nowClickTask\r\n    // \r\n    this.isView = JSON.parse(localStorage.getItem('leakDetectionData')).isView\r\n    this.userInfo = this.$store.state.userInfo\r\n    console.log('this.userInfo', this.userInfo)\r\n    console.log('', this.taskDetail)\r\n\r\n    console.log(\r\n      this.userInfo.userName,\r\n      this.taskDetail.inspector,\r\n      '------------',\r\n      this.userInfo.userFullname,\r\n      this.taskDetail.inspectorFullName\r\n    )\r\n\r\n    // \r\n    if (\r\n      this.userInfo.userName != this.taskDetail.inspector &&\r\n      this.userInfo.userFullname != this.taskDetail.inspectorFullName\r\n    ) {\r\n      console.log('')\r\n      // true\r\n      // this.isInspectorLoad = false\r\n    }\r\n    // inspector: \"chen_bolin\"\r\n    // inspectorFullName: \"\"\r\n\r\n    // userFullname: \"\"\r\n    // userName: \"song_kl\"\r\n  },\r\n  mounted() {\r\n    document.addEventListener('pause', this.pause, false)\r\n    document.addEventListener('resume', this.resume, false)\r\n    localStorage.setItem('startRecordLines', 'end')\r\n    // const id = JSON.parse(localStorage.getItem('leakDetectionData')).taskId\r\n    // console.log('----------------------', id)\r\n    // this.getTaskById(id)\r\n    // this.getTrackRecordsById(id)\r\n    // this.getAppInspData(id)\r\n    // !(function computedPosition() {\r\n    //   let gapTimer = 10\r\n    //   if (that.currentPosition) {\r\n    //     // \r\n    //     let gap = (new Date().getTime() - new Date(that.currentPosition.locTime).getTime()) / 1000\r\n    //     // gapTimer\r\n    //     if (gap > gapTimer) {\r\n    //       // \r\n    //       // Notify.warning({ message: 'GPS,', duration: 5000 })\r\n    //       let t = setTimeout(() => {\r\n    //         // \r\n    //         computedPosition()\r\n    //       }, 15000)\r\n    //     } else {\r\n    //       // \r\n    //       let t = setTimeout(() => {\r\n    //         computedPosition()\r\n    //       }, 10000)\r\n    //     }\r\n    //   } else {\r\n    //     // Notify.warning({ message: 'GPS', duration: 5000 })\r\n    //     let t = setTimeout(() => {\r\n    //       computedPosition()\r\n    //     }, 10000)\r\n    //   }\r\n    // })()\r\n  },\r\n  methods: {\r\n    // \r\n    deepClone(data) {\r\n      return JSON.parse(JSON.stringify(data))\r\n    },\r\n    pause() {\r\n      console.log('')\r\n      if (this.ifRecording && this.isResume) {\r\n        this.isResume = false\r\n      }\r\n    },\r\n    resume() {\r\n      console.log('')\r\n      if (this.ifRecording) {\r\n        this.isResume = true\r\n        pauseStateTrackPoints.length > 0 &&\r\n          this.upLoadPauseStateTrackPoints(this.deepClone(pauseStateTrackPoints))\r\n        pauseStatePipeIdList.length > 0 &&\r\n          this.upLoadPauseStatePipeIdList(this.deepClone(pauseStatePipeIdList))\r\n      }\r\n    },\r\n    upLoadPauseStateTrackPoints(data) {\r\n      // app\r\n      Api.inspectionTrack(data)\r\n        .then((res) => {\r\n          if (res && res.status) {\r\n            console.log('')\r\n            pauseStateTrackPoints.splice(0, data.length) // \r\n          } else {\r\n            console.log('')\r\n            this.reportFailTrackPoints.push(...data)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          setTimeout(() => {\r\n            this.upLoadPauseStateTrackPoints(data)\r\n          }, 5 * 1000)\r\n        })\r\n    },\r\n    upLoadPauseStatePipeIdList(data) {\r\n      let that = this\r\n      // app\r\n      Api.recordInspLine(data)\r\n        .then(async (res) => {\r\n          if (res.status) {\r\n            console.log('')\r\n            pauseStatePipeIdList.splice(0, data.length) // \r\n            // ID\r\n            const res = await Api.getInspLeakTaskDetail({\r\n              id: JSON.parse(localStorage.getItem('leakDetectionData')).taskId,\r\n            })\r\n            console.log('ID', res)\r\n            if (res.status) {\r\n              that.taskDetail = res.data\r\n            }\r\n          } else {\r\n            that.$refs.mymap.uploadFiledPipeIdList.push(...data)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          setTimeout(() => {\r\n            this.upLoadPauseStatePipeIdList(data)\r\n          }, 5 * 1000)\r\n        })\r\n    },\r\n    // \r\n    getRestTime(time) {\r\n      return time ? new Date(time).getTime() - new Date().getTime() : 0\r\n    },\r\n    // \r\n    changeToRate(coverage) {\r\n      if (coverage != null && typeof (coverage * 1) == 'number') {\r\n        return coverage + '%'\r\n      } else {\r\n        return '0%'\r\n      }\r\n    },\r\n    // \r\n    async mapLoaded(mapInstance) {\r\n      mapObj.mapInstance = mapInstance\r\n      mapObj.map = mapInstance.map\r\n      // \r\n      this.addMapImg()\r\n      await addIconToMap(mapObj.map, this.icons)\r\n      // sourcelayer\r\n      this.addSourceLayer()\r\n\r\n      //\r\n      mapObj.map.setLayoutProperty('map_waterwork', 'icon-image', '')\r\n      mapObj.map.setLayoutProperty('map_waterwork', 'icon-size', 0.6)\r\n      mapObj.map.setLayoutProperty('map_supply_pump', 'icon-image', '')\r\n      mapObj.map.setLayoutProperty('map_supply_pump', 'icon-size', 0.6)\r\n      // \r\n      mapObj.map.setLayoutProperty('rd_map_comb', 'visibility', 'none')\r\n      mapObj.map.setLayoutProperty('rd_map_manhole', 'visibility', 'none')\r\n      // \r\n      mapObj.map.setLayoutProperty('rd_map_drainpipe_ws_big', 'visibility', 'none')\r\n      mapObj.map.setLayoutProperty('rd_map_drainpipe_ws_big_direction', 'visibility', 'none')\r\n      mapObj.map.setLayoutProperty('rd_map_drainpipe_ws_small', 'visibility', 'none')\r\n      mapObj.map.setLayoutProperty('rd_map_drainpipe_ws_small_direction', 'visibility', 'none')\r\n      // \r\n      mapObj.map.setLayoutProperty('rd_map_drainpipe_ys_big', 'visibility', 'none')\r\n      mapObj.map.setLayoutProperty('rd_map_drainpipe_ys_big_direction', 'visibility', 'none')\r\n      mapObj.map.setLayoutProperty('rd_map_drainpipe_ys_small', 'visibility', 'none')\r\n      mapObj.map.setLayoutProperty('rd_map_drainpipe_ys_small_direction', 'visibility', 'none')\r\n      // \r\n      mapObj.map.setLayoutProperty('map_supply_pipe_distribute', 'visibility', 'visible')\r\n      mapObj.map.setLayoutProperty('map_supply_pipe_circulating', 'visibility', 'visible')\r\n      mapObj.map.setLayoutProperty('map_supply_pipe_delivery', 'visibility', 'visible')\r\n      // mapObj.map.setLayoutProperty( \"1111111111111111111111111\", \"visibility\", \"visible\" );\r\n      mapObj.map.setLayoutProperty('map_waterwork', 'visibility', 'visible')\r\n      mapObj.map.setLayoutProperty('map_supply_pump', 'visibility', 'visible')\r\n      // mapObj.map.setLayoutProperty( \"1111111111111111111111111\", \"visibility\", \"visible\" );\r\n      mapObj.map.setLayoutProperty('map_supply_valve', 'visibility', 'visible')\r\n      mapObj.map.setLayoutProperty('map_supply_firehydrant', 'visibility', 'visible')\r\n\r\n      // \r\n      await this.addTaskRangeAndLines()\r\n      // \r\n      await this.getProblemDataList()\r\n      // this.getTaskById(id)\r\n\r\n      // source\r\n\r\n      // \r\n      // this.$refs.mymap.setInspUserPosition({\r\n      //   longitude: 115.92987078013635,\r\n      //   latitude: 39.062062836990066,\r\n      // })\r\n\r\n      // \r\n      // mapObj.map.on('click', (e) => {\r\n      //   console.log('', e.lngLat)\r\n      //   this.currentPosition = {\r\n      //     longitude: e.lngLat.lng,\r\n      //     latitude: e.lngLat.lat,\r\n      //   }\r\n      //   // {\r\n      //   //   lng: 115.92101866271503,\r\n      //   //   lat: 39.06137929912413,\r\n      //   // })\r\n      // })\r\n      // this.currentPosition = {\r\n      //   longitude: '115.90457697779209',\r\n      //   latitude: '39.045671883888986',\r\n      // }\r\n      // \r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.requestSingleLocation(\r\n          ['1'],\r\n          (res) => {\r\n            this.currentPosition = JSON.parse(JSON.stringify(res))\r\n            const param = {\r\n              ...this.currentPosition,\r\n            }\r\n            this.$refs.mymap.setInspUserPosition(param)\r\n          },\r\n          (err) => {\r\n            console.log('err', err)\r\n          }\r\n        )\r\n      }\r\n      console.log('this.currentPosition', this.currentPosition)\r\n    },\r\n    // \r\n    async changeInspLineSourceBySpeed(position) {\r\n      const coord = [parseFloat(position.longitude), parseFloat(position.latitude)]\r\n      const point = turf.point(coord)\r\n      try {\r\n        const that = this\r\n        let timer = setInterval(function () {\r\n          if (mapObj.map.getSource('inspUser') && mapObj.map.isSourceLoaded('inspUser')) {\r\n            clearInterval(timer)\r\n            if (true) {\r\n              // \r\n              let buffered = turf.buffer(point, 0.015, { unit: 'kilometers' })\r\n              that.changeInspLineState(buffered)\r\n            }\r\n          }\r\n        }, 100)\r\n      } catch (e) {\r\n        console.log(e)\r\n      }\r\n    },\r\n    // \r\n    changeInspLineState(geometry) {\r\n      let that = this\r\n      // \r\n      function geoTransToPixel(geom) {\r\n        const polygonBox = turf.bbox(geom)\r\n        const southWest = [polygonBox[0], polygonBox[1]]\r\n        const northEast = [polygonBox[2], polygonBox[3]]\r\n        let southWestPointPixel = mapObj.map.project(southWest)\r\n        let northEastPointPixel = mapObj.map.project(northEast)\r\n        // bbox\r\n        southWestPointPixel = [southWestPointPixel.x - 50, southWestPointPixel.y + 50]\r\n        northEastPointPixel = [northEastPointPixel.x + 50, northEastPointPixel.y - 50]\r\n        return [southWestPointPixel, northEastPointPixel]\r\n      }\r\n      // bbox\r\n      async function chunk(geom) {\r\n        // let wasLoaded = false;\r\n        // if (wasLoaded) return;\r\n        console.log('geoTransToPixel(geom)', geoTransToPixel(geom))\r\n        // \r\n        const boxFeatures = mapObj.map.queryRenderedFeatures(geoTransToPixel(geom), {\r\n          layers: ['detectionPipeLayer'],\r\n        })\r\n        console.log(boxFeatures, 'boxFeatures')\r\n\r\n        // \r\n        let tempPipeList = []\r\n        boxFeatures.forEach((feat) => {\r\n          try {\r\n            // const result = turf.intersect(feat.geometry, geometry);\r\n            // (TRUE)\r\n            const result = turf.booleanDisjoint(feat.geometry, geometry)\r\n            console.log(\r\n              '------------------------------------',\r\n              result,\r\n              feat.geometry,\r\n              geometry\r\n            )\r\n            // \r\n            if (!result && !feat.state.isInsp) {\r\n              mapObj.map.setFeatureState(\r\n                {\r\n                  source: feat.source,\r\n                  id: feat.id,\r\n                },\r\n                { isInsp: true }\r\n              )\r\n\r\n              if (!tempPipeList.map((it) => it.pipeId).includes(feat.id)) {\r\n                let date = that.$dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n                tempPipeList.push({\r\n                  portalId: that.taskDetail.portalId,\r\n                  inspDate: date, // \r\n                  pipeId: feat.id, // id\r\n                  ext3: '',\r\n                  pipeLength: feat.properties['length'] || 0, // \r\n                  taskId: JSON.parse(localStorage.getItem('leakDetectionData')).taskId, // id\r\n                })\r\n              }\r\n            }\r\n          } catch (error) {\r\n            console.log(error)\r\n          }\r\n        })\r\n        if (that.isResume) {\r\n          tempPipeList.length > 0 &&\r\n            // app\r\n            Api.recordInspLine(tempPipeList).then(async (res) => {\r\n              if (res.status) {\r\n                console.log('')\r\n                // ID\r\n                const res = await Api.getInspLeakTaskDetail({\r\n                  id: JSON.parse(localStorage.getItem('leakDetectionData')).taskId,\r\n                })\r\n                console.log('ID', res)\r\n                if (res.status) {\r\n                  that.taskDetail = res.data\r\n                }\r\n                // bus.$emit('updateData')\r\n              } else {\r\n                console.log('tempPipeList: ', tempPipeList)\r\n                // id\r\n                that.$refs.mymap.uploadFiledPipeIdList.push(...tempPipeList)\r\n              }\r\n            })\r\n        } else {\r\n          tempPipeList.length > 0 && pauseStatePipeIdList.push(...tempPipeList)\r\n        }\r\n      }\r\n      function cb(features) {\r\n        if (features.length > 0) {\r\n          setTimeout(() => {\r\n            chunk(features.shift())\r\n            cb(features)\r\n          }, 100)\r\n        }\r\n      }\r\n      cb([geometry])\r\n    },\r\n    // \r\n    async addTaskRangeAndLines() {\r\n      // ID\r\n      const resData1 = await Api.getInspLeakTaskDetail({ id: this.taskDetail.id })\r\n      // \r\n      this.taskDetail = resData1?.data || {}\r\n      this.taskDetail.taskType = ''\r\n      console.log('ID', this.taskDetail)\r\n      // ---------------------------------------------------------------------------------------\r\n      // \r\n      this.setDetectionRangeData(JSON.parse(this.taskDetail.geom))\r\n\r\n      // \r\n      const resData2 = await Api.getHasInspLeakPipe({\r\n        taskId: this.taskDetail.id,\r\n        page: 1,\r\n        size: 99999,\r\n      })\r\n      let hasInspPipe = []\r\n      if (resData2.status) {\r\n        hasInspPipe = resData2.data.records.map((item) => item.pipeId)\r\n        console.log('', resData2.data.records)\r\n      }\r\n\r\n      // \r\n      let params = {\r\n        bizType: '',\r\n        devType: '',\r\n        geomStr: this.taskDetail.geom,\r\n        pageNum: 1,\r\n        pageSize: 99999,\r\n      }\r\n      await Api.getAllLeakLines(params).then((res) => {\r\n        console.log('', res)\r\n        if (res.status && res.data.list.length > 0) {\r\n          // \r\n          this.allTaskLines = []\r\n          res.data.list.forEach((item) => {\r\n            if (hasInspPipe.includes(item.id)) {\r\n              // -\r\n              this.allTaskLines.push({\r\n                type: 'Feature',\r\n                id: item.id,\r\n                geometry: JSON.parse(item.geom),\r\n                properties: {\r\n                  isInsp: true,\r\n                  ...item,\r\n                },\r\n              })\r\n              mapObj.map.setFeatureState(\r\n                {\r\n                  source: 'detectionPipe',\r\n                  id: item.id,\r\n                },\r\n                {\r\n                  // \r\n                  isInsp: true,\r\n                }\r\n              )\r\n            } else {\r\n              // -\r\n              this.allTaskLines.push({\r\n                type: 'Feature',\r\n                id: item.id,\r\n                geometry: JSON.parse(item.geom),\r\n                properties: {\r\n                  isInsp: false,\r\n                  ...item,\r\n                },\r\n              })\r\n              mapObj.map.setFeatureState(\r\n                {\r\n                  source: 'detectionPipe',\r\n                  id: item.id,\r\n                },\r\n                // \r\n                {\r\n                  isInsp: false,\r\n                }\r\n              )\r\n            }\r\n          })\r\n          // \r\n          mapObj.map.getSource('detectionPipe').setData({\r\n            type: 'FeatureCollection',\r\n            features: this.allTaskLines,\r\n          })\r\n        }\r\n      })\r\n    },\r\n    // sourcelayer\r\n    addSourceLayer() {\r\n      // \r\n      mapObj.map.addSource('detectionRange', {\r\n        type: 'geojson',\r\n        data: {\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        },\r\n      })\r\n      mapObj.map.addLayer({\r\n        id: 'detectionRangeLayer_fill',\r\n        source: 'detectionRange',\r\n        type: 'fill',\r\n        paint: {\r\n          'fill-color': '#32C5FF',\r\n          'fill-opacity': 0.1,\r\n        },\r\n      })\r\n      mapObj.map.addLayer({\r\n        id: 'detectionRangeLayer_line',\r\n        source: 'detectionRange',\r\n        type: 'line',\r\n        paint: {\r\n          'line-color': '#32C5FF',\r\n          'line-width': 2,\r\n          'line-dasharray': [4, 4],\r\n        },\r\n      })\r\n\r\n      // \r\n      mapObj.map.addSource('detectionPipe', {\r\n        type: 'geojson',\r\n        data: {\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        },\r\n      })\r\n      mapObj.map.addLayer(\r\n        {\r\n          id: 'detectionPipeLayer',\r\n          source: 'detectionPipe',\r\n          type: 'line',\r\n          paint: {\r\n            'line-color': [\r\n              'case',\r\n              ['boolean', ['feature-state', 'isInsp'], false],\r\n              '#44BA5A',\r\n              '#FF0000',\r\n            ],\r\n            'line-width': 3,\r\n          },\r\n        },\r\n        'rd_map_outfall'\r\n      )\r\n    },\r\n    // \r\n    setDetectionRangeData(range) {\r\n      let bbox = turf.bbox({\r\n        type: 'FeatureCollection',\r\n        features: [turf.polygon(range.coordinates)],\r\n      })\r\n      if (mapObj.map && mapObj.map.getSource('detectionRange')) {\r\n        mapObj.map.getSource('detectionRange').setData(range)\r\n        mapObj.map.fitBounds(bbox, {\r\n          padding: { top: 10, bottom: 25, left: 15, right: 5 },\r\n        })\r\n      }\r\n    },\r\n    // \r\n    cancelLeave() {\r\n      this.ifLeaveTask = false\r\n    },\r\n    // \r\n    confirmLeave() {\r\n      this.ifLeaveTask = false\r\n      this.endRecord('leave')\r\n    },\r\n    // \r\n    goBackToTask() {\r\n      if (this.ifRecording) {\r\n        // \r\n        this.ifLeaveTask = true\r\n      } else {\r\n        this.$router.go(-1)\r\n      }\r\n    },\r\n    // \r\n    async getProblemDataList() {\r\n      // header\r\n      await axios({\r\n        url: process.env.VUE_APP_THIRD_REQUEST_URL + '/main/userCenterApi/sso/tokenByToken',\r\n        method: 'post',\r\n        params: {\r\n          token: this.accessToken,\r\n        },\r\n        headers: {\r\n          Authorization: 'Basic b3V0d29yazp3cGcyMDIw',\r\n        },\r\n      }).then((res) => {\r\n        if (res.status == 200) {\r\n          this.formToken = res.data.resultData.token\r\n          this.header = {\r\n            'Content-Type': 'application/json',\r\n            Authorization: 'Bearer ' + this.formToken,\r\n          }\r\n        }\r\n      })\r\n      // \r\n      this.problemDataList = []\r\n      let params = {\r\n        sysCode: 'outwork',\r\n        // formValue: \"{\\\"taskId\\\":\\\"1611029758697541634\\\"}\"1611029758697541634\r\n        // \r\n        extParam: {\r\n          taskId: this.taskDetail.id, // id\r\n        },\r\n        page: {\r\n          current: 1,\r\n          size: 10000,\r\n        },\r\n        typeList: ['jlgd'],\r\n      }\r\n      await axios({\r\n        url:\r\n          process.env.VUE_APP_THIRD_REQUEST_URL +\r\n          '/main/outworkapi/ticketStatisticClient/getTicketList', // \r\n        method: 'post',\r\n        data: params,\r\n        headers: this.header,\r\n      }).then((res) => {\r\n        if (res.status == 200 && res.data != null) {\r\n          this.problemDataList = res.data?.resultData?.records || []\r\n          console.log('records', this.problemDataList)\r\n          this.addYourLayer(this.problemDataList, '')\r\n          // \r\n          this.reportDataIsLoaded = true\r\n        }\r\n      })\r\n    },\r\n    // \r\n    addYourLayer(pointList, id) {\r\n      const sourceData = {\r\n        type: 'FeatureCollection',\r\n        features: pointList.map((i) => {\r\n          let ll = null\r\n          if (typeof i.formValue.ticketAddress == 'string') {\r\n            ll = JSON.parse(JSON.parse(i.formValue.ticketAddress).point)\r\n          } else {\r\n            ll = i.formValue.ticketAddress.point\r\n          }\r\n\r\n          return {\r\n            type: 'Feature',\r\n            geometry: {\r\n              type: 'Point',\r\n              coordinates: [ll.lng, ll.lat],\r\n            },\r\n            properties: i,\r\n          }\r\n        }),\r\n      }\r\n      if (mapObj.map.getSource(id)) {\r\n        mapObj.map.getSource(id).setData(sourceData)\r\n        return\r\n      }\r\n      mapObj.map.addLayer(\r\n        {\r\n          id: id,\r\n          type: 'symbol',\r\n          source: {\r\n            type: 'geojson',\r\n            data: sourceData,\r\n          },\r\n          layout: {\r\n            'icon-image': id,\r\n            'icon-size': 0.7,\r\n            // \r\n            'icon-ignore-placement': true,\r\n            visibility: 'visible',\r\n          },\r\n          // minzoom: 13,\r\n        },\r\n        ''\r\n      )\r\n      // \r\n      // mapObj.map.on('click', id, this.handleMouseClick)\r\n    },\r\n    // \r\n    reportClick() {\r\n      // \r\n      if (this.reportDataIsLoaded) {\r\n        this.reportShow = true\r\n        // mapObj.map.setLayoutProperty('eventPointsLayer', 'visibility', 'visible')\r\n      } else {\r\n        Toast.loading({\r\n          message: '',\r\n          loadingType: 'spinner',\r\n          duration: 1500,\r\n        })\r\n        return\r\n      }\r\n    },\r\n    handleClose() {\r\n      // mapObj.map.setLayoutProperty('eventPointsLayer', 'visibility', 'none')\r\n    },\r\n    // \r\n    onSelect(val) {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '',\r\n          duration: '1500',\r\n        })\r\n        return\r\n      }\r\n      this.ifTips = true\r\n      // \r\n      mapObj.map.setLayoutProperty('detectionRangeLayer_fill', 'visibility', 'none')\r\n      mapObj.map.on('click', this.selectReportPoint)\r\n    },\r\n    // \r\n    async selectReportPoint(e) {\r\n      let features = mapObj.map.queryRenderedFeatures(e.point)\r\n      console.log('', features)\r\n      let propertiesArr = []\r\n      propertiesArr = features.filter((item) => {\r\n        // \r\n        return item.layer.id == 'map_supply_pipe_distribute'\r\n      })\r\n      // console.log('', features, propertiesArr)\r\n\r\n      // \r\n      let oneProperties = null\r\n      let pop\r\n      let marker\r\n\r\n      const src = require(`@/assets/img/legend/.png`)\r\n      // ideventObj_one\r\n      let currentEle = document.getElementById('eventObj_one')\r\n      if (currentEle) {\r\n        currentEle.parentNode.removeChild(currentEle)\r\n      }\r\n      let ele = document.createElement('div')\r\n      ele.innerHTML = `\r\n            <img id=\"eventObj_one\" src=\"${src}\" width=\"40\" height=\"40\">\r\n          `\r\n      marker = mapObj.mapInstance.newMarker({\r\n        element: ele,\r\n      })\r\n      marker\r\n        .setLngLat(e.lngLat)\r\n        .setPopup(\r\n          mapObj.mapInstance\r\n            .newPopup({ offset: [0, -7], closeButton: false })\r\n            .setHTML(`<div id=\"deviceDetail\"></div>`)\r\n        )\r\n        .addTo(mapObj.map)\r\n\r\n      if (this.ifTips) {\r\n        this.ifTips = false\r\n      }\r\n\r\n      if (propertiesArr.length > 0) {\r\n        oneProperties = propertiesArr[0]\r\n        console.log('', oneProperties, e.lngLat)\r\n\r\n        pop = new PopupItem({\r\n          propsData: {\r\n            deviceCode: oneProperties.properties.start_code,\r\n            fun: goToDetail,\r\n            isDevice: true,\r\n            // type: type,\r\n          },\r\n        })\r\n        this.$nextTick(() => {\r\n          pop.$mount('#deviceDetail')\r\n        })\r\n        marker.togglePopup()\r\n\r\n        let that_ = this\r\n        // \r\n        function goToDetail() {\r\n          that_.$router.push({\r\n            name: 'LeakDetectionForm',\r\n            query: {\r\n              taskId: that_.taskDetail.id, // id\r\n              properties: oneProperties.properties,\r\n              lngLat: e.lngLat,\r\n              id: false,\r\n            },\r\n          })\r\n        }\r\n      } else {\r\n        pop = new PopupItem({\r\n          propsData: {\r\n            deviceCode: '',\r\n            fun: goToDetailLngLat,\r\n            isDevice: false,\r\n            lng: e.lngLat.lng,\r\n            lat: e.lngLat.lat,\r\n          },\r\n        })\r\n        this.$nextTick(() => {\r\n          pop.$mount('#deviceDetail')\r\n        })\r\n        marker.togglePopup()\r\n\r\n        let that_ = this\r\n        // \r\n        function goToDetailLngLat() {\r\n          that_.$router.push({\r\n            name: 'LeakDetectionForm',\r\n            query: {\r\n              taskId: that_.taskDetail.id, // id\r\n              properties: {},\r\n              lngLat: e.lngLat,\r\n              id: false,\r\n            },\r\n          })\r\n        }\r\n      }\r\n    },\r\n    //  \r\n    startInspRecord() {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '',\r\n          duration: 1500,\r\n        })\r\n        return\r\n      }\r\n      // \r\n      // this.changeInspLineSourceBySpeed({\r\n      //   longitude: 115.9118701885,\r\n      //   latitude: 39.0556468180\r\n      // })\r\n      if (!this.currentPosition || !this.currentPosition.longitude) {\r\n        Toast.warning({\r\n          message: 'GPS',\r\n          duration: 2000,\r\n        })\r\n        return\r\n      }\r\n      // (0)(1)\r\n      if (\r\n        JSON.parse(localStorage.getItem('leakDetectionData')).isNew &&\r\n        this.taskDetail.taskStatus == 0\r\n      ) {\r\n        this.startOrEndTaskRecord(1)\r\n      }\r\n      // \r\n      this.clearBufferTrack()\r\n      let toast = Toast.loading({\r\n        message: '',\r\n        loadingType: 'spinner',\r\n        duration: 0,\r\n        forbidClick: true,\r\n      })\r\n      // \r\n      this.drawStartPoint()\r\n        .then((res) => {\r\n          if (res) {\r\n            toast.close()\r\n            Toast.info({\r\n              message: '',\r\n              duration: 1500,\r\n            })\r\n            // \r\n            this.pollingFlag = true\r\n            // \r\n            this.ifRecording = true\r\n            // this.startLocation()\r\n            localStorage.setItem('startRecordLines', 'start')\r\n            // \r\n            this.polling()\r\n            // 10s\r\n            this.startRecordTimer = new Date()\r\n          } else {\r\n            Toast.error({\r\n              message: '',\r\n              duration: 2000,\r\n            })\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n          Toast.error({\r\n            message: '',\r\n            duration: 2000,\r\n          })\r\n          setTimeout(() => {\r\n            this.drawStartPoint()\r\n          }, 5000)\r\n        })\r\n    },\r\n    // \r\n    endRecord(type) {\r\n      let diff = Math.floor((new Date() - this.startRecordTimer) / 1000)\r\n      if (diff <= 10) {\r\n        Toast.info({\r\n          message: `,${10 - diff}`,\r\n          duration: 1000,\r\n        })\r\n        return\r\n      }\r\n      this.endRecordConfirm(type)\r\n    },\r\n    // \r\n    endRecordConfirm(type) {\r\n      this.drawEndPoint(type)\r\n    },\r\n    // \r\n    async drawEndPoint(type) {\r\n      let that = this\r\n      if (that.currentPosition != null) {\r\n        let lastPoint = that.trackPointList[that.trackPointList.length - 1]\r\n        let currentPoint = [that.currentPosition.longitude, that.currentPosition.latitude]\r\n        let distance = Number(that.GetDistance(lastPoint, currentPoint)) * 1000\r\n        let toast = Toast.loading({\r\n          message: '',\r\n          loadingType: 'spinner',\r\n          duration: 0,\r\n          forbidClick: true,\r\n        })\r\n        // \r\n        that\r\n          .postTrackData_Point(\r\n            that.trackPointList[that.trackPointList.length - 1],\r\n            that.trackPointTimeList[that.trackPointTimeList.length - 1],\r\n            distance\r\n          )\r\n          .then((res) => {\r\n            if (res) {\r\n              toast.close()\r\n              Toast.info({\r\n                message: '',\r\n                duration: 1000,\r\n              })\r\n              if (typeof yuanchu != 'undefined') {\r\n                yuanchu.locationAMap.stopRequestLocations()\r\n              }\r\n              that.trackPointList.push([\r\n                that.currentPosition.longitude,\r\n                that.currentPosition.latitude,\r\n              ])\r\n              that.trackPointTimeList.push(that.currentPosition.locTime)\r\n              let jsonPoint = {\r\n                type: 'Feature',\r\n                properties: {},\r\n                geometry: {\r\n                  type: 'Point',\r\n                  coordinates: [that.currentPosition.longitude, that.currentPosition.latitude],\r\n                },\r\n              }\r\n              let jsonPointFeatureCollection = {\r\n                type: 'FeatureCollection',\r\n                features: [jsonPoint],\r\n              }\r\n              if (mapObj.map.getSource('endPointSource_now')) {\r\n                mapObj.map.getSource('endPointSource_now').setData(jsonPointFeatureCollection)\r\n              } else {\r\n                mapObj.map.addSource('endPointSource_now', {\r\n                  type: 'geojson',\r\n                  data: jsonPointFeatureCollection,\r\n                })\r\n              }\r\n              if (mapObj.map.getLayer('endPointLayer_now')) {\r\n              } else {\r\n                mapObj.map.addLayer(\r\n                  {\r\n                    id: 'endPointLayer_now',\r\n                    type: 'circle',\r\n                    source: 'endPointSource_now',\r\n                    layout: {\r\n                      'circle-sort-key': 5,\r\n                      visibility: 'visible',\r\n                      // visibility: \"none\"\r\n                    },\r\n                    paint: {\r\n                      'circle-radius': 3,\r\n                      'circle-stroke-width': 5,\r\n                      'circle-stroke-color': '#addd52',\r\n                      'circle-color': 'white',\r\n                    },\r\n                  },\r\n                  'inspUserLayer'\r\n                )\r\n              }\r\n\r\n              // trackline\r\n              let jsonLine = {\r\n                type: 'Feature',\r\n                properties: {},\r\n                geometry: {\r\n                  type: 'LineString',\r\n                  coordinates: that.trackPointList,\r\n                },\r\n              }\r\n              let jsonLineFeatureCollection = {\r\n                type: 'FeatureCollection',\r\n                features: [jsonLine],\r\n              }\r\n              if (mapObj.map.getSource('trackLineSource_now')) {\r\n                mapObj.map.getSource('trackLineSource_now').setData(jsonLineFeatureCollection)\r\n              } else {\r\n                mapObj.map.addSource('trackLineSource_now', {\r\n                  type: 'geojson',\r\n                  data: jsonLineFeatureCollection,\r\n                })\r\n              }\r\n              if (mapObj.map.getLayer('trackLineLayer_now')) {\r\n              } else {\r\n                mapObj.map.addLayer(\r\n                  {\r\n                    id: 'trackLineLayer_now',\r\n                    type: 'line',\r\n                    source: 'trackLineSource_now',\r\n                    layout: {\r\n                      'line-cap': 'round',\r\n                      'line-join': 'round',\r\n                      visibility: 'visible',\r\n                      // visibility: \"none\"\r\n                    },\r\n                    paint: {\r\n                      'line-color': '#addd52',\r\n                      'line-width': 5,\r\n                      'line-opacity': 0.8,\r\n                    },\r\n                  },\r\n                  'inspUserLayer'\r\n                )\r\n              }\r\n              // \r\n              if (mapObj.map.getLayer('endPoint_label')) {\r\n              } else {\r\n                mapObj.map.addLayer({\r\n                  id: 'endPoint_label',\r\n                  type: 'symbol',\r\n                  source: 'endPointSource_now',\r\n                  layout: {\r\n                    'symbol-placement': 'point',\r\n                    'icon-image': 'end_point',\r\n                    'icon-size': 0.6,\r\n                    'icon-offset': [0, -35],\r\n                    'icon-allow-overlap': true,\r\n                    'symbol-sort-key': 2,\r\n                    visibility: 'visible',\r\n                    // visibility: \"none\"\r\n                  },\r\n                })\r\n              }\r\n              // \r\n              that.reportFailTrackPoints.length > 0 && that.postFailTrackData()\r\n              that.$refs.mymap.uploadFiledPipeIdList.length > 0 &&\r\n                // app\r\n                Api.recordInspLine(that.$refs.mymap.uploadFiledPipeIdList).then((res) => {\r\n                  if (res.status) {\r\n                    console.log('')\r\n                    that.$refs.mymap.uploadFiledPipeIdList = []\r\n                  }\r\n                })\r\n              if (type == 'end') {\r\n                this.startOrEndTaskRecord(2) //  '2'\r\n              } else {\r\n                this.pollingFlag = false\r\n                this.ifRecording = false\r\n                localStorage.setItem('startRecordLines', 'end')\r\n                if (type == 'pause') {\r\n                  Toast.success({\r\n                    message: '',\r\n                    duration: 2000,\r\n                  })\r\n                  // \r\n                  this.refreshTask()\r\n                } else if (type == 'leave') {\r\n                  this.$router.go(-1)\r\n                }\r\n              }\r\n            } else {\r\n              Toast.error({\r\n                message: type == 'end' ? '' : '',\r\n              })\r\n            }\r\n          })\r\n      } else {\r\n        let type = type\r\n        let timer = setTimeout(() => {\r\n          that.drawEndPoint(type)\r\n        }, 1000)\r\n      }\r\n    },\r\n    // \r\n    refreshTask() {\r\n      // let ids = []\r\n      // this.keyDetailList.forEach((item) => {\r\n      //   if (item.engInfoDTO) {\r\n      //     ids.push(item.engInfoDTO.engId)\r\n      //   }\r\n      // })\r\n      // mapObj.mapInstance && this.$refs.mymap.removeKeyPointMarker(ids)\r\n      const id = JSON.parse(localStorage.getItem('leakDetectionData')).taskId\r\n      // \r\n      this.addTaskRangeAndLines()\r\n      // await this.getAppInspData(id)\r\n    },\r\n    // ------------------------------------------------------------------------------------------------------------\r\n    // 0 1 2\r\n    startOrEndTaskRecord(status) {\r\n      let data = {\r\n        planId: this.taskDetail.planId, // id\r\n        taskName: this.taskDetail.taskName, // \r\n        taskStatus: status, // 0 1 2\r\n        id: this.taskDetail.id, // id\r\n        ext1: status == 2 ? this.stopReason : '', // \r\n      }\r\n      if (status == 1) {\r\n        // \r\n        data.taskStartTime = this.$dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n      } else if (status == 2) {\r\n        // \r\n        data.taskEndTime = this.$dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n      }\r\n      let that = this\r\n      Api.changeTaskStatus(data).then((res) => {\r\n        if (res.status) {\r\n          if (status == 2) {\r\n            Toast.success({\r\n              message: '',\r\n              duration: 2000,\r\n              onClose: () => {\r\n                that.pollingFlag = false\r\n                that.ifRecording = false\r\n                // bus.$off('updateData')\r\n                localStorage.setItem('startRecordLines', 'end')\r\n                that.isView = true\r\n                that.$router.go(-1)\r\n              },\r\n            })\r\n          }\r\n        } else {\r\n          if (status == 2) {\r\n            Toast.error({\r\n              message: ', ',\r\n              duration: 1500,\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    async postFailTrackData() {\r\n      let that = this\r\n      // app\r\n      await Api.inspectionTrack(that.reportFailTrackPoints)\r\n        .then((res) => {\r\n          if (res && res.status) {\r\n            console.log('')\r\n            that.reportFailTrackPoints = []\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log('' + err)\r\n        })\r\n    },\r\n    // \r\n    clearBufferTrack() {\r\n      let that = this\r\n      that.isResume = true\r\n      // \r\n      that.ifRecording = false\r\n      // \r\n      that.currentPosition = null\r\n      // \r\n      // \r\n      that.trackPointList = []\r\n      // \r\n      that.trackPointTimeList = []\r\n      // \r\n      that.overSpeedTrackLineList = []\r\n      pauseStateTrackPoints = []\r\n      pauseStatePipeIdList = []\r\n      //\r\n      if (mapObj.map.getSource('trackLineSource_now')) {\r\n        mapObj.map.getSource('trackLineSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n      if (mapObj.map.getSource('trackLineSource_overSpeed')) {\r\n        mapObj.map.getSource('trackLineSource_overSpeed').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n      if (mapObj.map.getSource('startPointSource_now')) {\r\n        mapObj.map.getSource('startPointSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n\r\n      if (mapObj.map.getSource('endPointSource_now')) {\r\n        mapObj.map.getSource('endPointSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n    },\r\n    // \r\n    addMapImg() {\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/white_arrow_right.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('arrowIcon')) {\r\n            mapObj.map.addImage('arrowIcon', image, {})\r\n          }\r\n        }\r\n      )\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/icon_starting_point.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('start_point')) {\r\n            mapObj.map.addImage('start_point', image, {})\r\n          }\r\n        }\r\n      )\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/icon_at_end.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('end_point')) {\r\n            mapObj.map.addImage('end_point', image, {})\r\n          }\r\n        }\r\n      )\r\n    },\r\n    // \r\n    drawStartPoint() {\r\n      let that = this\r\n      return new Promise(function (resolve, reject) {\r\n        if (typeof yuanchu != 'undefined') {\r\n          yuanchu.locationAMap.requestSingleLocation(\r\n            ['1'],\r\n            (res) => {\r\n              that.currentPosition = JSON.parse(JSON.stringify(res))\r\n              // res\r\n              // {\r\n              //   accuracy: '',//Android\r\n              //   address: '()',//\r\n              //   latitude: '30.2706469726562517',//\r\n              //   longitude: '119.9658680555555605',//\r\n              //   locTime: '2022-03-09 09:45:19',//\r\n              //   locType: '',//Android\r\n              // }\r\n              const param = {\r\n                ...that.currentPosition,\r\n              }\r\n              // \r\n              that.$refs.mymap.setInspUserPosition(param)\r\n              if (that.currentPosition != null) {\r\n                let recordData = []\r\n                recordData.push({\r\n                  taskId: that.taskDetail.id, // id\r\n                  longitude: that.currentPosition.longitude,\r\n                  latitude: that.currentPosition.latitude,\r\n                  inspTime: that.currentPosition.locTime, // \r\n                  distance: 0, //  0\r\n                  inspDate: that.currentPosition.locTime, // \r\n                  inspector: that.userInfo.userFullName,\r\n                })\r\n                // app\r\n                Api.inspectionTrack(recordData)\r\n                  .then((res) => {\r\n                    if (res && res.status) {\r\n                      // \r\n                      console.log('')\r\n                      that.trackPointList.push([\r\n                        that.currentPosition.longitude,\r\n                        that.currentPosition.latitude,\r\n                      ])\r\n                      that.trackPointTimeList.push(that.currentPosition.locTime)\r\n                      let jsonPoint = {\r\n                        type: 'Feature',\r\n                        properties: {},\r\n                        geometry: {\r\n                          type: 'Point',\r\n                          coordinates: [\r\n                            that.currentPosition.longitude,\r\n                            that.currentPosition.latitude,\r\n                          ],\r\n                        },\r\n                      }\r\n                      let jsonPointFeatureCollection = {\r\n                        type: 'FeatureCollection',\r\n                        features: [jsonPoint],\r\n                      }\r\n                      if (mapObj.map.getSource('startPointSource_now')) {\r\n                        mapObj.map\r\n                          .getSource('startPointSource_now')\r\n                          .setData(jsonPointFeatureCollection)\r\n                      } else {\r\n                        mapObj.map.addSource('startPointSource_now', {\r\n                          type: 'geojson',\r\n                          data: jsonPointFeatureCollection,\r\n                        })\r\n                      }\r\n                      if (mapObj.map.getLayer('startPointLayer_now')) {\r\n                      } else {\r\n                        mapObj.map.addLayer(\r\n                          {\r\n                            id: 'startPointLayer_now',\r\n                            type: 'circle',\r\n                            source: 'startPointSource_now',\r\n                            layout: {\r\n                              'circle-sort-key': 5,\r\n                              visibility: 'visible',\r\n                              // visibility: \"none\"\r\n                            },\r\n                            paint: {\r\n                              'circle-radius': 3,\r\n                              'circle-stroke-width': 5,\r\n                              'circle-stroke-color': '#2A83E6',\r\n                              'circle-color': 'white',\r\n                            },\r\n                          },\r\n                          'inspUserLayer'\r\n                        )\r\n                      }\r\n                      // \r\n                      if (mapObj.map.getLayer('startPoint_label')) {\r\n                      } else {\r\n                        mapObj.map.addLayer({\r\n                          id: 'startPoint_label',\r\n                          type: 'symbol',\r\n                          source: 'startPointSource_now',\r\n                          layout: {\r\n                            'symbol-placement': 'point',\r\n                            'icon-image': 'start_point',\r\n                            'icon-size': 0.6,\r\n                            'icon-offset': [0, -35],\r\n                            'icon-allow-overlap': true,\r\n                            'symbol-sort-key': 2,\r\n                            visibility: 'visible',\r\n                            // visibility: \"none\"\r\n                          },\r\n                        })\r\n                      }\r\n                      resolve(true)\r\n                    } else {\r\n                      resolve(false)\r\n                    }\r\n                  })\r\n                  .catch((err) => {\r\n                    reject(err)\r\n                  })\r\n              }\r\n            },\r\n            (err) => {\r\n              console.log('err', err)\r\n            }\r\n          )\r\n        }\r\n      })\r\n    },\r\n    //  currentPosition\r\n    polling() {\r\n      let that = this\r\n      // \r\n      if (that.pollingFlag) {\r\n        if (typeof yuanchu != 'undefined') {\r\n          yuanchu.locationAMap.requestLocations(\r\n            //  3~60 \r\n            ['3', '1', '20', '100', '0', true],\r\n            (res) => {\r\n              // res\r\n              // {\r\n              //   accuracy: '',//Android\r\n              //   address: '()',//\r\n              //   latitude: '30.2706469726562517',//\r\n              //   longitude: '119.9658680555555605',//\r\n              //   locTime: '2022-03-09 09:45:19',//\r\n              //   locType: '',//Android\r\n              // }\r\n              that.currentPosition = JSON.parse(JSON.stringify(res))\r\n              // setInterval(() => {\r\n              that.currentPosition = Object.assign(that.currentPosition, {\r\n                direction: 0,\r\n              })\r\n              // \r\n              if (\r\n                that.currentPosition.locType != 'SAME_REQ' &&\r\n                that.currentPosition.locType != 'FIX_CACHE'\r\n              ) {\r\n                let lastPoint = that.trackPointList[that.trackPointList.length - 1]\r\n                let currentPoint = [that.currentPosition.longitude, that.currentPosition.latitude]\r\n                // \r\n                let distance = Number(that.GetDistance(lastPoint, currentPoint)) * 1000\r\n\r\n                // \r\n                that\r\n                  .postTrackData_Point(\r\n                    // \r\n                    that.trackPointList[that.trackPointList.length - 1],\r\n                    that.trackPointTimeList[that.trackPointTimeList.length - 1],\r\n                    distance\r\n                  )\r\n                  .then((res) => {\r\n                    if (res) {\r\n                      // \r\n                      that.trackPointList.push([\r\n                        that.currentPosition.longitude,\r\n                        that.currentPosition.latitude,\r\n                      ])\r\n                      // \r\n                      that.trackPointTimeList.push(that.currentPosition.locTime)\r\n\r\n                      // \r\n                      const coord = [\r\n                        parseFloat(that.currentPosition.longitude),\r\n                        parseFloat(that.currentPosition.latitude),\r\n                      ]\r\n                      const point = turf.point(coord)\r\n                      mapObj.mapInstance.setSourceData('inspUser', {\r\n                        type: 'FeatureCollection',\r\n                        features: [point],\r\n                      })\r\n\r\n                      // \r\n                      let jsonLine = {\r\n                        type: 'Feature',\r\n                        properties: {},\r\n                        geometry: {\r\n                          type: 'LineString',\r\n                          coordinates: that.trackPointList,\r\n                        },\r\n                      }\r\n                      let jsonLineFeatureCollection = {\r\n                        type: 'FeatureCollection',\r\n                        features: [jsonLine],\r\n                      }\r\n                      if (mapObj.map.getSource('trackLineSource_now')) {\r\n                        mapObj.map\r\n                          .getSource('trackLineSource_now')\r\n                          .setData(jsonLineFeatureCollection)\r\n                      } else {\r\n                        mapObj.map.addSource('trackLineSource_now', {\r\n                          type: 'geojson',\r\n                          data: jsonLineFeatureCollection,\r\n                        })\r\n                      }\r\n                      if (mapObj.map.getLayer('trackLineLayer_now')) {\r\n                      } else {\r\n                        mapObj.map.addLayer(\r\n                          {\r\n                            id: 'trackLineLayer_now',\r\n                            type: 'line',\r\n                            source: 'trackLineSource_now',\r\n                            layout: {\r\n                              'line-cap': 'round',\r\n                              'line-join': 'round',\r\n                              'line-sort-key': 1,\r\n                              visibility: 'visible',\r\n                              // visibility: \"none\"\r\n                            },\r\n                            paint: {\r\n                              'line-color': '#addd52',\r\n                              'line-width': 5,\r\n                              'line-opacity': 0.8,\r\n                            },\r\n                          },\r\n                          'inspUserLayer'\r\n                        )\r\n                      }\r\n                      // \r\n                      if (mapObj.map.getLayer('trackLineLayer_arrow')) {\r\n                      } else {\r\n                        mapObj.map.addLayer(\r\n                          {\r\n                            id: 'trackLineLayer_arrow',\r\n                            type: 'symbol',\r\n                            source: 'trackLineSource_now',\r\n                            layout: {\r\n                              'symbol-placement': 'line',\r\n                              'symbol-spacing': 20,\r\n                              'icon-image': 'arrowIcon',\r\n                              'icon-size': 0.5,\r\n                              'icon-allow-overlap': true,\r\n                              'symbol-sort-key': 3,\r\n                              visibility: 'visible',\r\n                            },\r\n                          },\r\n                          'inspUserLayer'\r\n                        )\r\n                      }\r\n                      // \r\n                      that.changeInspLineSourceBySpeed(that.currentPosition)\r\n                      const param = {\r\n                        ...that.currentPosition,\r\n                      }\r\n                      that.$refs.mymap.setInspUserPosition(param)\r\n                    }\r\n                  })\r\n              }\r\n              // }, 3000)\r\n            },\r\n            (err) => {\r\n              console.log('', err)\r\n              // Toast.error({\r\n              //   message: 'err' + err,\r\n              //   duration: 2000,\r\n              // })\r\n            }\r\n          )\r\n        }\r\n        // this.uploadInspRoute()\r\n      }\r\n    },\r\n    GetDistance(coordArray1, coordArray2) {\r\n      let lng1 = coordArray1[0]\r\n      let lat1 = coordArray1[1]\r\n      let lng2 = coordArray2[0]\r\n      let lat2 = coordArray2[1]\r\n      let radLat1 = (lat1 * Math.PI) / 180.0\r\n      let radLat2 = (lat2 * Math.PI) / 180.0\r\n      let a = radLat1 - radLat2\r\n      let b = (lng1 * Math.PI) / 180.0 - (lng2 * Math.PI) / 180.0\r\n      let s =\r\n        2 *\r\n        Math.asin(\r\n          Math.sqrt(\r\n            Math.pow(Math.sin(a / 2), 2) +\r\n              Math.cos(radLat1) * Math.cos(radLat2) * Math.pow(Math.sin(b / 2), 2)\r\n          )\r\n        )\r\n      s = s * 6378.137 // EARTH_RADIUS;\r\n      s = Math.round(s * 10000) / 10000\r\n      return s\r\n    },\r\n    // -\r\n    postTrackData_Point(pointData, timeData, distance) {\r\n      return new Promise(async (resolve, reject) => {\r\n        let that = this\r\n        for (let p = 0; p < pointData.length; p++) {\r\n          pointData[p] = Number(pointData[p])\r\n        }\r\n        let date_now = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n        let recordData = []\r\n        recordData.push({\r\n          taskId: that.taskDetail.id,\r\n          inspDate: timeData, // \r\n          inspTime: date_now, // \r\n          distance, // \r\n          inspector: that.userInfo.userFullname, // \r\n          longitude: pointData[0],\r\n          latitude: pointData[1],\r\n        })\r\n        if (that.isResume) {\r\n          // app\r\n          await Api.inspectionTrack(recordData).then((res) => {\r\n            if (res && res.status) {\r\n              console.log('', recordData)\r\n              resolve(true)\r\n            } else {\r\n              // app\r\n              that.reportFailTrackPoints.push(recordData)\r\n              console.log('that.reportFailTrackPoints: ', that.reportFailTrackPoints)\r\n              resolve(false)\r\n            }\r\n          })\r\n        } else {\r\n          pauseStateTrackPoints.push(...recordData)\r\n          resolve(true)\r\n        }\r\n      })\r\n    },\r\n    // \r\n    startLocation() {\r\n      let that = this\r\n      yuanchu.locationAMap.requestSingleLocation(\r\n        ['1'],\r\n        (res) => {\r\n          that.currentPosition = JSON.parse(JSON.stringify(res))\r\n          const param = {\r\n            ...that.currentPosition,\r\n          }\r\n          that.$refs.mymap.setInspUserPosition(param)\r\n          if (\r\n            !that.currentPosition ||\r\n            !that.currentPosition.longitude ||\r\n            !that.currentPosition.latitude\r\n          ) {\r\n            Toast.error({\r\n              message: '!',\r\n              duration: 2000,\r\n            })\r\n            return\r\n          } else {\r\n            const coord = [\r\n              parseFloat(that.currentPosition.longitude),\r\n              parseFloat(that.currentPosition.latitude),\r\n            ]\r\n            that.flyToPoint(coord)\r\n          }\r\n        },\r\n        (err) => {\r\n          console.log('err', err)\r\n        }\r\n      )\r\n    },\r\n    // \r\n    flyToPoint(lnglat) {\r\n      mapObj.map.flyTo({ center: lnglat, zoom: 17.5 })\r\n    },\r\n    // \r\n    async endTask() {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '',\r\n          duration: 1500,\r\n        })\r\n        return\r\n      }\r\n      // bus.$off('updateData')\r\n      // \r\n      await this.addTaskRangeAndLines()\r\n      setTimeout(() => {\r\n        let hasInspKp = this.taskDetail?.completion.split('|')[0] || 0\r\n        let allInspKp = this.taskDetail?.completion.split('|')[1] || 0\r\n        if (allInspKp - hasInspKp == 0 && this.taskDetail.coverage.includes('100')) {\r\n          this.endRecordConfirm('end')\r\n        } else {\r\n          // \r\n          this.ifEndTask = true\r\n        }\r\n      }, 100)\r\n    },\r\n    // \r\n    continueTask() {\r\n      this.stopReason = ''\r\n      this.ifEndTask = false\r\n    },\r\n    // \r\n    stopTask() {\r\n      if (this.stopReason == '') {\r\n        Toast.warning({\r\n          message: '',\r\n          duration: 1500,\r\n        })\r\n        return\r\n      }\r\n      this.ifEndTask = false\r\n      this.endRecordConfirm('end')\r\n    },\r\n    // \r\n    toDetailPanel(cardDetail) {\r\n      this.$router.push({\r\n        name: 'LeakDetectionForm',\r\n        query: {\r\n          id: cardDetail.id,\r\n        },\r\n      })\r\n    },\r\n  },\r\n\r\n  beforeDestroy() {\r\n    Toast.clear()\r\n    this.pollingFlag = false\r\n    this.clearBufferTrack()\r\n    document.removeEventListener('pause', this.pause)\r\n    document.removeEventListener('resume', this.resume)\r\n    if (typeof yuanchu != 'undefined') {\r\n      yuanchu.locationAMap.stopRequestLocations()\r\n    }\r\n    localStorage.removeItem('startRecordLines')\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.MapPage {\r\n  background-color: #ffffff !important;\r\n  height: 100%;\r\n\r\n  // \r\n  /deep/.fm-nav-bar__content {\r\n    background-color: #ffffff;\r\n  }\r\n\r\n  /deep/.fm-nav-bar__title {\r\n    color: #191919 !important;\r\n  }\r\n\r\n  /deep/ .fm-nav-bar .fm-icon {\r\n    color: #191919 !important;\r\n  }\r\n\r\n  .mapContainer {\r\n    height: calc(100%);\r\n    width: 100%;\r\n    // background-color: rgb(97, 40, 255);\r\n  }\r\n\r\n  .start-record {\r\n    position: absolute;\r\n    z-index: 3;\r\n    left: 50%;\r\n    bottom: 235px;\r\n    transform: translate(-50%, 0);\r\n\r\n    img {\r\n      width: 140px;\r\n      height: 140px;\r\n    }\r\n  }\r\n\r\n  .controlCard {\r\n    width: 100%;\r\n    height: 328px;\r\n    position: absolute;\r\n    bottom: 0;\r\n    background-image: url('~@/assets/img/inspection/controlBg.png');\r\n    background-repeat: no-repeat;\r\n    background-size: 100%;\r\n\r\n    .controlContent {\r\n      margin: 50px 30px 0;\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      .infoContent {\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-around;\r\n        margin-bottom: 24px;\r\n\r\n        .endControl {\r\n          display: flex;\r\n          justify-content: space-between;\r\n          align-items: center;\r\n\r\n          .leftText {\r\n            width: 27%;\r\n            display: flex;\r\n            justify-content: space-around;\r\n            align-items: center;\r\n\r\n            img {\r\n              width: 32px;\r\n              height: 32px;\r\n              margin: auto;\r\n            }\r\n\r\n            /deep/.fm-count-down {\r\n              font-size: 24px;\r\n              color: #306cc8;\r\n            }\r\n          }\r\n\r\n          .rightButton {\r\n            display: flex;\r\n\r\n            .endBtn {\r\n              font-size: 24px;\r\n              width: 120px;\r\n              height: 60px;\r\n              background: #ffffff;\r\n              color: #306cc8;\r\n            }\r\n          }\r\n        }\r\n\r\n        .bottomSide {\r\n          width: 100%;\r\n          display: flex;\r\n          margin-top: 24px;\r\n          justify-content: space-between;\r\n\r\n          .block {\r\n            text-align: center;\r\n            width: 330px;\r\n            height: 160px;\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            background: rgba(27, 103, 216, 0.05);\r\n            border-radius: 16px;\r\n            // margin: 0 20px;\r\n\r\n            .rate {\r\n              width: 100%;\r\n              height: 50%;\r\n              display: flex;\r\n              align-items: center;\r\n              margin: auto;\r\n              font-size: 48px;\r\n              font-family: Helvetica-Bold, Helvetica;\r\n              font-weight: bold;\r\n              color: #306cc8;\r\n\r\n              .centerStyle {\r\n                margin: auto;\r\n                display: flex;\r\n                align-items: center;\r\n                font-size: 38px;\r\n                font-family: Helvetica-Bold, Helvetica;\r\n                font-weight: bold;\r\n              }\r\n            }\r\n\r\n            .nameStyle {\r\n              font-size: 14px;\r\n              font-family: PingFangSC-Regular, PingFang SC;\r\n              font-weight: 400;\r\n              color: #555555;\r\n              width: 100%;\r\n              height: 33%;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .viewCard {\r\n    width: 100%;\r\n    height: 260px;\r\n    position: absolute;\r\n    bottom: 0;\r\n    background: #ffffff;\r\n    box-shadow: 0px 0px 18px 0px rgba(104, 115, 127, 0.18);\r\n\r\n    .controlContent {\r\n      margin: 32px 30px 0;\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      .infoContent {\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-around;\r\n        margin-bottom: 24px;\r\n\r\n        .bottomSide {\r\n          width: 100%;\r\n          display: flex;\r\n          margin-top: 24px;\r\n          justify-content: space-around;\r\n\r\n          .block {\r\n            text-align: center;\r\n            width: 330px;\r\n            height: 160px;\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            background: rgba(27, 103, 216, 0.05);\r\n            border-radius: 16px;\r\n            // margin: 0 20px;\r\n\r\n            .rate {\r\n              width: 100%;\r\n              height: 50%;\r\n              display: flex;\r\n              align-items: center;\r\n              margin: auto;\r\n              font-size: 48px;\r\n              font-family: Helvetica-Bold, Helvetica;\r\n              font-weight: bold;\r\n              color: #306cc8;\r\n\r\n              .centerStyle {\r\n                margin: auto;\r\n                display: flex;\r\n                align-items: center;\r\n                font-size: 38px;\r\n                font-family: Helvetica-Bold, Helvetica;\r\n                font-weight: bold;\r\n              }\r\n            }\r\n\r\n            .nameStyle {\r\n              font-size: 14px;\r\n              font-family: PingFangSC-Regular, PingFang SC;\r\n              font-weight: 400;\r\n              color: #555555;\r\n              width: 100%;\r\n              height: 33%;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .tool-box {\r\n    position: fixed;\r\n    width: 1.2rem;\r\n    height: auto;\r\n    right: 0.3rem;\r\n    bottom: 350px;\r\n\r\n    .refresh {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .route {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .location {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 60px;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n  }\r\n\r\n  .confirm-tip {\r\n    width: 80%;\r\n    height: 44%;\r\n    margin: auto;\r\n    background: #ffffff;\r\n    border-radius: 16px;\r\n    margin: 50% auto;\r\n\r\n    /deep/.content {\r\n      height: calc(100% - 164px);\r\n      padding: 32px;\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      .icon {\r\n        width: 100%;\r\n        height: 100px;\r\n        display: flex;\r\n        margin: 24px 0 28px;\r\n      }\r\n\r\n      .info {\r\n        height: auto;\r\n        font-size: 28px;\r\n        font-family: PingFangSC-Regular, PingFang SC;\r\n        font-weight: 400;\r\n        color: #555555;\r\n        line-height: 40px;\r\n        text-align: center;\r\n      }\r\n    }\r\n\r\n    /deep/.confirm_btn {\r\n      width: 100%;\r\n      height: 100px;\r\n      display: flex;\r\n\r\n      .btn1 {\r\n        width: 50%;\r\n        height: 100%;\r\n        border-top: 1px solid #dcdee3;\r\n        font-size: 32px;\r\n        font-family: PingFangSC-Regular, PingFang SC;\r\n        font-weight: 400;\r\n        color: #333333;\r\n        line-height: 100px;\r\n        text-align: center;\r\n      }\r\n\r\n      .btn2 {\r\n        border-right: 1px solid #dcdee3;\r\n      }\r\n    }\r\n  }\r\n\r\n  .tip-tools {\r\n    position: fixed;\r\n    display: flex;\r\n    top: 15%;\r\n    left: 200px;\r\n    border-radius: 16px;\r\n    padding: 24px;\r\n    background: #ffffff;\r\n    box-shadow: 0px 10px 18px 0px rgba(0, 0, 0, 0.06);\r\n    border: 2px solid rgba(23, 144, 254, 0.6);\r\n\r\n    .tipImg {\r\n      width: 32px;\r\n      height: 32px;\r\n      margin-right: 16px;\r\n    }\r\n\r\n    .context {\r\n      font-size: 24px;\r\n      font-family: MicrosoftYaHei;\r\n      color: #1b67d8;\r\n      line-height: 31px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}