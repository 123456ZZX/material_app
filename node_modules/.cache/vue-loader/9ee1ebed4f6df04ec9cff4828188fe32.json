{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\FormCenter\\index.vue?vue&type=style&index=0&id=316d1894&scoped=true&lang=less","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\FormCenter\\index.vue","mtime":1705912800023},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoqIHsNCiAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCg0KLm1haW4tY29udGFpbmVyIHsNCiAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgaGVpZ2h0OiAxMDAlOw0KICBkaXNwbGF5OiBmbGV4Ow0KICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KfQ0KDQouY29tcG9uZW50LA0KLmN1cy1mb3JtIHsNCiAgaGVpZ2h0OiBjYWxjKDEwMCUgLSAxMjJweCAtIGVudihzYWZlLWFyZWEtaW5zZXQtYm90dG9tKSk7DQogIGhlaWdodDogY2FsYygxMDAlIC0gMTIycHggLSBjb25zdGFudChzYWZlLWFyZWEtaW5zZXQtYm90dG9tKSk7DQogIG92ZXJmbG93LXk6IGF1dG87DQogIGZsZXg6IDE7DQp9DQoNCi8vIOihqOWNleW6lemDqOWuieWFqOWMug0KLnRhc2stZGV0YWlsLWZvcm0gew0KICBwYWRkaW5nLWJvdHRvbTogY29uc3RhbnQoc2FmZS1hcmVhLWluc2V0LWJvdHRvbSk7IC8qIOWFvOWuuSBpT1MgPCAxMS4yICovDQogIHBhZGRpbmctYm90dG9tOiBlbnYoc2FmZS1hcmVhLWluc2V0LWJvdHRvbSk7IC8qIOWFvOWuuSBpT1MgPj0gMTEuMiAqLw0KfQ0KDQovZGVlcC8uZm0tZmllbGQtLWRpc2FibGVkIC5mbS1maWVsZF9fbGFiZWwgew0KICBjb2xvcjogIzAwMDsNCn0NCg0KL2RlZXAvIC5mbS1jZWxsLWdyb3VwX190aXRsZSB7DQogIGNvbG9yOiAjMDAwOw0KfQ0KLmZpZWxkLWF0dGFjaG1lbnQgew0KICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAvZGVlcC8gLmZtLWZpZWxkX19jb250cm9sLS1yaWdodCB7DQogICAganVzdGlmeS1jb250ZW50OiBmbGV4LXN0YXJ0Ow0KICB9DQp9DQoNCi5idXR0b25zIHsNCiAgZGlzcGxheTogZmxleDsNCiAgcGFkZGluZzogMThweCAzMHB4Ow0KICBwb3NpdGlvbjogZml4ZWQ7DQogIGxlZnQ6IDA7DQogIHJpZ2h0OiAwOw0KICBib3R0b206IDA7DQogIGhlaWdodDogY2FsYygxMjJweCArIGNvbnN0YW50KHNhZmUtYXJlYS1pbnNldC1ib3R0b20pKTsNCiAgaGVpZ2h0OiBjYWxjKDEyMnB4ICsgZW52KHNhZmUtYXJlYS1pbnNldC1ib3R0b20pKTsNCn0NCi5idXR0b24gew0KICBmbGV4OiAxOw0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgLnNhdmVEcmFmdCB7DQogICAgYm9yZGVyLXJhZGl1czogMTBweDsNCiAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmOw0KICAgIGNvbG9yOiAjMDI3YWZmOw0KICB9DQoNCiAgLnN1Ym1pdCB7DQogICAgYm9yZGVyLXJhZGl1czogMTBweDsNCiAgICBiYWNrZ3JvdW5kOiAjMDI3YWZmOw0KICAgIG1hcmdpbi1sZWZ0OiAyM3B4Ow0KICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA6RA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/FormCenter","sourcesContent":["<template>\r\n  <div class=\"main-container\">\r\n    <fm-nav-bar :title=\"formName\" left-text=\"\" right-text=\"\" left-arrow @click-left=\"goBack\" />\r\n    <fm-tabs line-width=\"80px\" @tab-click=\"tabclick\" v-if=\"type != 'add'\">\r\n      <fm-tab v-for=\"(item, index) in tabTitles\" :label=\"item\" :key=\"index\"></fm-tab>\r\n    </fm-tabs>\r\n    <!-- 从业务模块发起时只显示表单详情和暂存、提交 -->\r\n    <div v-if=\"type == 'add'\" class=\"component\">\r\n      <!-- style=\"height: calc(100% - 108px); overflow: auto\" -->\r\n      <component\r\n        class=\"cus-form\"\r\n        ref=\"formTemp\"\r\n        v-bind:is=\"dynamicForm\"\r\n        @setFormName=\"setFormName\"\r\n        @setModelKey=\"setModelKey\"\r\n        @setEntityName=\"setEntityName\"\r\n        @setService=\"setService\"\r\n        @setPreSaveValidateProps=\"setPreSaveValidateProps\"\r\n        @setFormData=\"setFormData\"\r\n        @setDetailParamList=\"setDetailParamList\"\r\n      ></component>\r\n      <div class=\"buttons\" v-if=\"type == 'add' || (type == 'execute' && flowList.length === 1)\">\r\n        <div class=\"button\" v-for=\"item in buttonList\" :key=\"item.type\">\r\n          <fm-button\r\n            block\r\n            type=\"primary\"\r\n            native-type=\"submit\"\r\n            @click=\"onAction(item)\"\r\n            :class=\"[item.type]\"\r\n            >{{ item.text }}</fm-button\r\n          >\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- 任务待办打开时 -->\r\n    <div v-else style=\"height: calc(100% - 88px); overflow: auto\">\r\n      <div v-show=\"tab == 0\" class=\"content-container\">\r\n        <component\r\n          ref=\"formTemp\"\r\n          v-bind:is=\"dynamicForm\"\r\n          @setFormName=\"setFormName\"\r\n          @setModelKey=\"setModelKey\"\r\n          @setEntityName=\"setEntityName\"\r\n          @setService=\"setService\"\r\n          @setPreSaveValidateProps=\"setPreSaveValidateProps\"\r\n          @setFormData=\"setFormData\"\r\n          @setDetailParamList=\"setDetailParamList\"\r\n          class=\"task-detail-form\"\r\n        ></component>\r\n      </div>\r\n      <div v-show=\"tab == 1\" class=\"content-container\">\r\n        <flow-entrust v-if=\"type == 'flowView'\" :formData=\"formData\"></flow-entrust>\r\n        <flow-timeline :taskId=\"taskId\" :bizId=\"bizId\" v-else></flow-timeline>\r\n      </div>\r\n      <div v-show=\"tab == 2\" class=\"content-container\">\r\n        <flow-approval\r\n          :submitURL=\"service.submit\"\r\n          :entityName=\"entityName\"\r\n          :formData=\"formData\"\r\n          :detailParamList=\"detailParamList\"\r\n          :modelKey=\"flowData.modelKey\"\r\n          :checkRules=\"checkRules\"\r\n          :beforeSubmit=\"beforeSubmit\"\r\n          :aftereReject=\"aftereReject\"\r\n          :afterSubmit=\"afterSubmit\"\r\n        >\r\n        </flow-approval>\r\n      </div>\r\n      <div v-show=\"tab == 3\" class=\"content-container\">\r\n        <flow-entrust :formData=\"formData\"></flow-entrust>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { CURRENT_ROW } from '@/store/State/stateTypes'\r\nimport flowApproval from './components/FlowApproval'\r\nimport flowEntrust from './components/FlowEntrust'\r\nimport flowTimeline from './components/FlowTimeline'\r\nimport { submitForm } from './api'\r\nimport { Tab, Tabs, NavBar, Field, Button, Toast } from 'fawkes-mobile-lib'\r\nexport default {\r\n  name: 'FormCenter',\r\n  components: {\r\n    flowApproval,\r\n    flowEntrust,\r\n    flowTimeline,\r\n    [Tab.name]: Tab,\r\n    [Tabs.name]: Tabs,\r\n    [NavBar.name]: NavBar,\r\n    [Field.name]: Field,\r\n    [Button.name]: Button,\r\n    [Toast.name]: Toast,\r\n  },\r\n  data() {\r\n    return {\r\n      type: this.$route.params.type,\r\n      formKey: this.$route.params.formKey, // 表单键值\r\n      bizId: this.$route.params.bizId,\r\n      taskId: this.$route.params.taskId,\r\n      taskKey: this.$route.params.taskKey,\r\n      dynamicForm: '',\r\n      isDisabled: false,\r\n      tabTitles: [],\r\n      detailParamList: [], // 需提交的明细表数据\r\n      tab: 0,\r\n      entityName: '', // 业务表的实体类名\r\n      service: {}, //提交地址和初始化地址\r\n      formName: '', //表单名称\r\n      flowData: {\r\n        modelKey: '', //流程键值\r\n      },\r\n      // 移动端发起时提供的按钮\r\n      buttonList: [\r\n        {\r\n          type: 'saveDraft',\r\n          text: '暂存',\r\n          code: 'SAVEDRAFT',\r\n          customCode: 'SAVEDRAFT',\r\n        },\r\n        {\r\n          type: 'submit',\r\n          text: '提交',\r\n          code: 'SUBMIT',\r\n          customCode: 'SUBMIT',\r\n        },\r\n      ],\r\n      formData: {},\r\n    }\r\n  },\r\n  watch: {},\r\n  computed: {\r\n    row() {\r\n      // 页面中使用row来指代当前记录\r\n      return this.$store.state[CURRENT_ROW]\r\n    },\r\n    lang() {\r\n      if (this.$storage.get('i18nLocale') == 'zh') {\r\n        return 'zh-CN'\r\n      } else {\r\n        return 'en'\r\n      }\r\n    },\r\n  },\r\n  created() {},\r\n  mounted() {\r\n    this.initForm()\r\n    if (this.type == 'execute') {\r\n      this.tabTitles = ['详情', '流转', '审批', '委托']\r\n    } else if (this.type == 'view') {\r\n      this.tabTitles = ['详情', '流转']\r\n    } else {\r\n      this.tabTitles = ['详情', '委托']\r\n    }\r\n    this.isDisabled = true\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      this.$router.go(-1)\r\n    },\r\n    // 非空校验方法\r\n    checkRules() {\r\n      // 业务表单提供校验方法\r\n      if (this.$refs.formTemp.validator) {\r\n        return this.$refs.formTemp.validator()\r\n      } else {\r\n        return true\r\n      }\r\n    },\r\n    // 提交流程前钩子函数\r\n    beforeSubmit() {\r\n      this.$refs.formTemp?.beforeSubmit()\r\n    },\r\n    // 提交流程后的操作\r\n    afterSubmit() {},\r\n    // 表单退回之后的操作\r\n    aftereReject() {},\r\n    tabclick(val) {\r\n      this.tab = val\r\n    },\r\n    // 动态获取FormCenter下的对应的流程表单组件\r\n    initForm() {\r\n      const reqs = require.context('@/views/FormCenter', true, /index\\.vue/, 'lazy')\r\n      reqs.keys().forEach((key) => {\r\n        // 此处检测模块的文件夹名和formkey匹配时忽略大小，创建formkey时最好使用帕斯卡命名法\r\n        if (RegExp(`\\\\/${this.formKey}\\\\/`, 'i').test(key)) {\r\n          reqs(key).then((res) => {\r\n            this.dynamicForm = res.default\r\n          })\r\n        }\r\n      })\r\n    },\r\n    setFormName(formName) {\r\n      this.formName = formName\r\n    },\r\n    setModelKey(modelKey) {\r\n      this.flowData.modelKey = modelKey\r\n    },\r\n    setEntityName(entityName) {\r\n      this.entityName = entityName\r\n    },\r\n    setService(service) {\r\n      this.service = service\r\n    },\r\n    setPreSaveValidateProps(props) {\r\n      this.preSaveValidateProps = props\r\n    },\r\n    setFormData(formData) {\r\n      this.formData = formData\r\n    },\r\n    setDetailParamList(detailParamList) {\r\n      this.detailParamList = detailParamList\r\n    },\r\n    onAction(item) {\r\n      // 暂存不需要校验，直接保存\r\n      if (item.type == 'saveDraft') {\r\n        this.handleAction(item)\r\n      } else {\r\n        // 表单统一使用form的ref值\r\n        if (this.$refs.formTemp.$refs.form) {\r\n          this.$refs.formTemp.$refs.form\r\n            .validate()\r\n            .then(() => {\r\n              this.handleCustomValidator(item)\r\n            })\r\n            .catch(() => {\r\n              Toast('表单校验未通过')\r\n            })\r\n        } else {\r\n          //未定义form的引用值时\r\n          this.handleCustomValidator()\r\n        }\r\n      }\r\n    },\r\n    handleCustomValidator(item) {\r\n      if (typeof this.$refs.formTemp.validator === 'function') {\r\n        if (this.$refs.formTemp.validator()) {\r\n          this.handleAction(item)\r\n        }\r\n      } else {\r\n        // 没有自定义的表单校验规则，直接提交\r\n        this.handleAction(item)\r\n      }\r\n    },\r\n    handleAction(item) {\r\n      if (typeof this.$refs.formTemp.beforeSubmit === 'function') {\r\n        this.$refs.formTemp.beforeSubmit()\r\n      }\r\n      let form = {\r\n        entityName: this.entityName,\r\n        entityObject: this.formData,\r\n        formProcessParam: this.useProcess(item),\r\n        detailParamList: this.detailParamList,\r\n      }\r\n      submitForm(this.service.submit, form).then((res) => {\r\n        if (res.status) {\r\n          Toast('提交成功')\r\n          setTimeout(() => {\r\n            this.$router.go(-1)\r\n          }, 1000)\r\n        } else {\r\n          Toast(res.message)\r\n        }\r\n      })\r\n    },\r\n    // 获取流程参数信息\r\n    useProcess(buttonInfo) {\r\n      return {\r\n        modelKey: this.flowData.modelKey,\r\n        bizId: this.bizId,\r\n        processInstanceId: this.processInstanceId,\r\n        formKey: this.formKey,\r\n        stageFlag: buttonInfo.type === 'saveDraft' ? 1 : 0,\r\n        variable: this.formData,\r\n        taskId: this.taskId,\r\n        approval: buttonInfo.type === 'saveDraft' ? 'stage' : '',\r\n        comment: this.comment,\r\n        targetKey: buttonInfo.targetKey,\r\n      }\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n* {\r\n  box-sizing: border-box;\r\n}\r\n\r\n.main-container {\r\n  overflow: hidden;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.component,\r\n.cus-form {\r\n  height: calc(100% - 122px - env(safe-area-inset-bottom));\r\n  height: calc(100% - 122px - constant(safe-area-inset-bottom));\r\n  overflow-y: auto;\r\n  flex: 1;\r\n}\r\n\r\n// 表单底部安全区\r\n.task-detail-form {\r\n  padding-bottom: constant(safe-area-inset-bottom); /* 兼容 iOS < 11.2 */\r\n  padding-bottom: env(safe-area-inset-bottom); /* 兼容 iOS >= 11.2 */\r\n}\r\n\r\n/deep/.fm-field--disabled .fm-field__label {\r\n  color: #000;\r\n}\r\n\r\n/deep/ .fm-cell-group__title {\r\n  color: #000;\r\n}\r\n.field-attachment {\r\n  flex-direction: column;\r\n  /deep/ .fm-field__control--right {\r\n    justify-content: flex-start;\r\n  }\r\n}\r\n\r\n.buttons {\r\n  display: flex;\r\n  padding: 18px 30px;\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  height: calc(122px + constant(safe-area-inset-bottom));\r\n  height: calc(122px + env(safe-area-inset-bottom));\r\n}\r\n.button {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  .saveDraft {\r\n    border-radius: 10px;\r\n    background: #ffffff;\r\n    color: #027aff;\r\n  }\r\n\r\n  .submit {\r\n    border-radius: 10px;\r\n    background: #027aff;\r\n    margin-left: 23px;\r\n  }\r\n}\r\n</style>\r\n"]}]}