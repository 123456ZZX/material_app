{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\InspectionList.vue?vue&type=style&index=0&id=73f07bdc&scoped=true&lang=less","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\InspectionList.vue","mtime":1708928163413},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouaW5zcGVjdGlvbi1saXN0IHsNCiAgcGFkZGluZzogMzBweDsNCn0NCg0KLmluc3BlY3Rpb24tbGlzdC1pdGVtIHsNCiAgZGlzcGxheTogZmxleDsNCiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBtYXJnaW4tYm90dG9tOiAyMnB4Ow0KDQogIC5saXN0LWl0ZW0taWNvbiB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIGZsZXgtc2hyaW5rOiAwOw0KICAgIHdpZHRoOiA1NnB4Ow0KICAgIGhlaWdodDogNTZweDsNCiAgICBsaW5lLWhlaWdodDogNjBweDsNCiAgICBmb250LXNpemU6IDIwcHg7DQogICAgY29sb3I6ICNmZmZmZmY7DQogICAgYmFja2dyb3VuZDogIzJkN2VmZjsNCiAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgbWFyZ2luLXJpZ2h0OiAzMHB4Ow0KICB9DQoNCiAgLmxpc3QtaXRlbS1ib3ggew0KICAgIHdpZHRoOiA2MTJweDsNCiAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmOw0KICAgIGJveC1zaGFkb3c6IDBweCA0cHggMTZweCAwcHggcmdiYSgxMDQsIDExNSwgMTI3LCAwLjA2KTsNCiAgICBib3JkZXItcmFkaXVzOiAxMnB4Ow0KICAgIGZvbnQtc2l6ZTogMjRweDsNCiAgICBjb2xvcjogIzE5MTkxOTsNCiAgICBwYWRkaW5nOiAyNHB4IDMwcHg7DQoNCiAgICAuaXRlbS1ib3gtdGl0bGUgew0KICAgICAgZm9udC1zaXplOiAyOHB4Ow0KICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICBtYXJnaW4tYm90dG9tOiAzMHB4Ow0KICAgIH0NCg0KICAgIC5pdGVtLWJveC1hcmVhIHsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogICAgICBtYXJnaW4tYm90dG9tOiAzMHB4Ow0KDQogICAgICBzcGFuIHsNCiAgICAgICAgZmxleDogMTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAuaXRlbS1ib3gtdGltZSB7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgIGNvbG9yOiAjNTU1Ow0KDQogICAgICAuYm94LXRpbWUtaXRlbSB7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQoNCiAgICAgICAgLm5mYy1pbWcgew0KICAgICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICAuYm94LXRpbWUgew0KICAgICAgICBtYXJnaW46IDAgMTJweDsNCiAgICAgIH0NCg0KICAgICAgLmJveC10aW1lLWltZy1uZmMgew0KICAgICAgICB3aWR0aDogNThweDsNCiAgICAgICAgaGVpZ2h0OiAyNHB4Ow0KICAgICAgfQ0KDQogICAgICAuYm94LXRpbWUtaW1nLXdhcm5pbmcgew0KICAgICAgICB3aWR0aDogMzJweDsNCiAgICAgICAgaGVpZ2h0OiAyOHB4Ow0KICAgICAgICBtYXJnaW4tcmlnaHQ6IDEycHg7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgLmlzVW5zdWJtaXR0ZWQgew0KICAgIGNvbG9yOiAjZmY0ZDRmOw0KICAgIG1hcmdpbi1sZWZ0OiA4cHg7DQogIH0NCn0NCg=="},{"version":3,"sources":["InspectionList.vue"],"names":[],"mappings":";AAqQA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"InspectionList.vue","sourceRoot":"src/views/PumpStationInspection/components","sourcesContent":["<template>\r\n  <div class=\"inspection-list\">\r\n    <div\r\n      class=\"inspection-list-item\"\r\n      v-for=\"(item, index) in tableList\"\r\n      :key=\"item.id\"\r\n      @click=\"goToInspectionItem(InspectionItemUrl, item)\"\r\n    >\r\n      <div\r\n        class=\"list-item-icon\"\r\n        :style=\"{\r\n          background: getInspectionStatusTypeColor(\r\n            item.patrolStatus === '未巡' ? 0 : getReportHiddenDangerNum(index) === 0 ? 1 : 2\r\n          ),\r\n        }\"\r\n      >\r\n        {{ item.patrolStatus === '未巡' ? '未巡' : '已巡' }}\r\n      </div>\r\n      <div class=\"list-item-box\">\r\n        <div class=\"item-box-title\">{{ item.patrolPointName }}</div>\r\n        <div class=\"item-box-area\">\r\n          <span>厂站：{{ item.pumpName }}</span>\r\n          <span> 区域：{{ item.areaLocation }}</span>\r\n        </div>\r\n        <div class=\"item-box-time\">\r\n          <div class=\"box-time-item\">\r\n            <img src=\"@/assets/img/pump/inspection-time.png\" class=\"box-time-img-time\" alt=\"\" />\r\n            <span class=\"box-time\" v-if=\"!item.isUnsubmitted\">\r\n              {{ item.checkTime ? item.checkTime : '未开始' }}</span\r\n            >\r\n            <span class=\"isUnsubmitted\" v-if=\"item.isUnsubmitted\">未提交</span>\r\n            <div v-if=\"item.nfcCardNo\" class=\"nfc-img\">\r\n              <img\r\n                v-if=\"!item.signMethod\"\r\n                src=\"@/assets/img/pump/inspection-nfc2.png\"\r\n                class=\"box-time-img-nfc\"\r\n                alt=\"\"\r\n                @click.stop=\"selectCause(index)\"\r\n              />\r\n              <img\r\n                v-if=\"item.signMethod === 'NFC'\"\r\n                src=\"@/assets/img/pump/inspection-nfc.png\"\r\n                class=\"box-time-img-nfc\"\r\n                alt=\"\"\r\n              />\r\n              <img\r\n                v-if=\"item.signMethod && item.signMethod !== 'NFC'\"\r\n                src=\"@/assets/img/pump/inspection-nfc1.png\"\r\n                class=\"box-time-img-nfc\"\r\n                alt=\"\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div class=\"box-time-item\" v-if=\"item.reportHiddenDangerNum > 0\">\r\n            <img\r\n              src=\"@/assets/img/pump/inspection-warning.png\"\r\n              class=\"box-time-img-warning\"\r\n              alt=\"\"\r\n              @click.stop=\"hiddenDangerShow(item)\"\r\n            />\r\n            <span style=\"color: #ff9429\">{{ getReportHiddenDangerNum(index) }}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <fm-popup :visible.sync=\"popupShow\" position=\"bottom\" :style=\"{ height: '30%' }\">\r\n      <fm-picker\r\n        title=\"请选择未刷卡原因\"\r\n        show-toolbar\r\n        :columns=\"columns\"\r\n        @confirm=\"onConfirm\"\r\n        @cancel=\"onCancel\"\r\n      />\r\n    </fm-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { patrolEdit } from '../api'\r\nexport default {\r\n  name: 'InspectionList',\r\n  props: {\r\n    //巡检状态(1:待巡检，2:巡检中，3:已完成 ，4:已终止)(手机端)\r\n    patrolPointResultList: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    patrolStatus: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n\r\n    activeIndex: {\r\n      type: Number,\r\n      default: 1,\r\n    },\r\n\r\n    disabled: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n  },\r\n  watch: {\r\n    activeIndex: {\r\n      handler(newData) {\r\n        const config = newData === 1 ? '未巡' : '已巡'\r\n        this.tableList = this.patrolPointResultList.filter(({ patrolStatus }) => {\r\n          return config === patrolStatus\r\n        })\r\n      },\r\n      immediate: true,\r\n    },\r\n    patrolPointResultList: {\r\n      handler(newData) {\r\n        const config = this.activeIndex === 1 ? '未巡' : '已巡'\r\n        this.tableList = newData.filter(({ patrolStatus }) => {\r\n          return config === patrolStatus\r\n        })\r\n      },\r\n      deep: true,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      InspectionItemUrl: '/pump/inspection-item',\r\n      inspectionPointStatusType: 0, //0未巡，1已巡正常，2已巡异常\r\n      popupShow: false,\r\n      NFCIndex: -1,\r\n      columns: ['标签损坏', '未贴标签', '其它'],\r\n      tableList: [],\r\n    }\r\n  },\r\n\r\n  async created() {},\r\n\r\n  methods: {\r\n    //跳转巡检点页面\r\n    async goToInspectionItem(url,  item) {\r\n      if (this.disabled && this.patrolStatus !== 3) return\r\n      if (item.nfcCardNo && !item.signMethod) return\r\n\r\n      const { taskId } = this.$store.state.pump.urlQuery\r\n\r\n      let patrolPointResultList = this.patrolPointResultList\r\n      let index = 0\r\n      patrolPointResultList.forEach((data,i)=>{\r\n        if(data.id === item.id)\r\n          index = i\r\n      })\r\n\r\n      if (!item.patrolItemsResultList) {\r\n        patrolPointResultList[index].patrolStatus = '已巡'\r\n        let query = {\r\n          id: taskId,\r\n          patrolPointResultList,\r\n        }\r\n        const res = await patrolEdit(query)\r\n        this.$parent.getPatrol()\r\n      }\r\n\r\n      this.$store.commit('setUrlQuery', {\r\n        taskId,\r\n        index,\r\n      })\r\n      this.$router.push(url)\r\n    },\r\n\r\n    //隐患列表展示\r\n    hiddenDangerShow(item) {\r\n      this.$emit('hiddenDangerClick', item, 'item')\r\n    },\r\n\r\n    //弹出刷卡界面\r\n    handMovementNFC() {\r\n      console.log('执行NFC')\r\n      let isFindNFC = false\r\n      let code = undefined\r\n      if (typeof yuanchu != 'undefined') {\r\n        //异步事件\r\n        yuanchu.nfc.nfcScan((res) => {\r\n          code = res\r\n\r\n          // alert(code)\r\n\r\n          //匹配到对应的NFC并进入巡检项\r\n          this.patrolPointResultList?.filter(async (item, index) => {\r\n            console.log(item.nfcCardNo)\r\n            if (item.nfcCardNo === code) {\r\n              this.NFCIndex = index\r\n              this.onConfirm('NFC')\r\n\r\n              isFindNFC = true\r\n              this.goToInspectionItem(this.InspectionItemUrl, item)\r\n            } else {\r\n              console.log(111)\r\n            }\r\n          })\r\n\r\n          isFindNFC ? this.$toast('匹配成功') : this.$toast('匹配失败')\r\n        })\r\n      }\r\n    },\r\n\r\n    //手动NFC-标签损坏、未贴标签、其它\r\n    selectCause(index) {\r\n      this.NFCIndex = index\r\n      this.popupShow = true\r\n    },\r\n\r\n    //手动NFC确认\r\n    async onConfirm(e) {\r\n      try {\r\n        let patrolPointResultList = this.patrolPointResultList\r\n        patrolPointResultList[this.NFCIndex].signMethod = e\r\n        let query = {\r\n          id: this.$store.state.pump.urlQuery.taskId,\r\n          patrolPointResultList,\r\n        }\r\n        const res = await patrolEdit(query)\r\n\r\n        this.$parent.getPatrol()\r\n      } catch (error) {\r\n        console.log(error)\r\n        this.$toast('更新失败')\r\n      }\r\n\r\n      this.popupShow = false\r\n    },\r\n    //手动NFC取消\r\n    onCancel() {\r\n      this.$toast('取消')\r\n      this.popupShow = false\r\n    },\r\n\r\n    //获取异常上报工单数量\r\n    getReportHiddenDangerNum(index) {\r\n      let sum = 0\r\n      this.patrolPointResultList[index].patrolItemsResultList?.forEach((item) => {\r\n        item.workOrderId ? sum++ : null\r\n      })\r\n      return sum\r\n    },\r\n\r\n    //巡检点图标颜色\r\n    //0未巡，1已巡正常，2已巡异常\r\n    getInspectionStatusTypeColor(type) {\r\n      switch (type) {\r\n        case 0:\r\n          return '#2D7EFF'\r\n        case 1:\r\n          return '#40BB5A'\r\n        case 2:\r\n          return '#FF3546'\r\n      }\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.inspection-list {\r\n  padding: 30px;\r\n}\r\n\r\n.inspection-list-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 22px;\r\n\r\n  .list-item-icon {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    flex-shrink: 0;\r\n    width: 56px;\r\n    height: 56px;\r\n    line-height: 60px;\r\n    font-size: 20px;\r\n    color: #ffffff;\r\n    background: #2d7eff;\r\n    border-radius: 50%;\r\n    margin-right: 30px;\r\n  }\r\n\r\n  .list-item-box {\r\n    width: 612px;\r\n    background: #ffffff;\r\n    box-shadow: 0px 4px 16px 0px rgba(104, 115, 127, 0.06);\r\n    border-radius: 12px;\r\n    font-size: 24px;\r\n    color: #191919;\r\n    padding: 24px 30px;\r\n\r\n    .item-box-title {\r\n      font-size: 28px;\r\n      font-weight: bold;\r\n      margin-bottom: 30px;\r\n    }\r\n\r\n    .item-box-area {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-bottom: 30px;\r\n\r\n      span {\r\n        flex: 1;\r\n      }\r\n    }\r\n\r\n    .item-box-time {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      color: #555;\r\n\r\n      .box-time-item {\r\n        display: flex;\r\n        align-items: center;\r\n\r\n        .nfc-img {\r\n          display: flex;\r\n          align-items: center;\r\n        }\r\n      }\r\n\r\n      .box-time {\r\n        margin: 0 12px;\r\n      }\r\n\r\n      .box-time-img-nfc {\r\n        width: 58px;\r\n        height: 24px;\r\n      }\r\n\r\n      .box-time-img-warning {\r\n        width: 32px;\r\n        height: 28px;\r\n        margin-right: 12px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .isUnsubmitted {\r\n    color: #ff4d4f;\r\n    margin-left: 8px;\r\n  }\r\n}\r\n</style>\r\n"]}]}