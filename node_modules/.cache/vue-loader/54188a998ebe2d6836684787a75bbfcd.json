{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\inspectionManage\\daily-task.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\inspectionManage\\daily-task.vue","mtime":1705912915829},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgYnVzIGZyb20gJy4uLy4uL3ZpZXdzL2luc3BlY3RNYXAvdXRpbHMvQnVzLmpzJw0KaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJw0KaW1wb3J0IGRheWpzIGZyb20gJ2RheWpzJw0KaW1wb3J0IE1hcENvbXAgZnJvbSAnLi4vLi4vdmlld3MvaW5zcGVjdE1hcC9pbmRleC52dWUnDQppbXBvcnQga2V5UG9pbnRMaXN0IGZyb20gJy4va2V5cG9pbnQtbGlzdC52dWUnDQppbXBvcnQgcmVxdWVzdCBmcm9tICdAL3V0aWxzL3JlcXVlc3QnDQppbXBvcnQgKiBhcyBhcGkgZnJvbSAnLi9hcGknDQppbXBvcnQgeyBUb2FzdCwgRGlhbG9nIH0gZnJvbSAnZmF3a2VzLW1vYmlsZS1saWInDQppbXBvcnQgKiBhcyB0dXJmIGZyb20gJ0B0dXJmL3R1cmYnDQppbXBvcnQgVXBsb2FkZXIgZnJvbSAnQC9jb21wb25lbnRzL3VwbG9hZC9VcGxvYWRlci52dWUnDQppbXBvcnQgcHJvYmxlbUNhcmRJbmZvIGZyb20gJy4vcHJvYmxlbUNhcmRJbmZvJzsNCmltcG9ydCBBUEkgZnJvbSAiQC9jb21tb24vY29uZmlnLmpzIjsNCmNvbnN0IG1hcE9iaiA9IHsNCiAgbWFwOiBudWxsLA0KICBtYXBJbnN0YW5jZTogbnVsbCwNCn0NCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ2RhaWx5LXRhc2snLA0KICBjb21wb25lbnRzOiB7DQogICAgTWFwQ29tcCwNCiAgICBrZXlQb2ludExpc3QsDQogICAgVXBsb2FkZXIsDQogICAgcHJvYmxlbUNhcmRJbmZvLA0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBpZlRpcHM6IGZhbHNlLA0KICAgICAgcmVwb3J0RGF0YUlzTG9hZGVkOiBmYWxzZSwNCiAgICAgIC8vIOW3oeajgOS7u+WKoeS4i+aJgOacieW3oeajgOeuoee6vw0KICAgICAgYWxsVGFza0xpbmVzOiBbXSwNCiAgICAgIGlzVmlldzogdHJ1ZSwNCiAgICAgIGFjdGl2ZTogMCwNCiAgICAgIGRldmljZU5hbWU6ICcnLA0KICAgICAgaGFzU2lnbkluOiBmYWxzZSwNCiAgICAgIHNob3dQb3BvdmVyOiBmYWxzZSwNCiAgICAgIGFjdGlvbnM6IFsNCiAgICAgICAgew0KICAgICAgICAgIHRleHQ6ICfpl67popjkuIrmiqUnLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgdGV4dDogJ+iuvuaWvee8uumZtycsDQogICAgICAgIH0sDQogICAgICBdLA0KICAgICAgY3VycmVudFJhdGU6IDAsDQogICAgICAvLyDmjqfliLblhbPplK7ngrnliJfooajmmL7pmpANCiAgICAgIHBvaW50TGlzdFNob3c6IGZhbHNlLA0KICAgICAgLy8g5YWo5bGA5Y+R5aOw5Ye95pWwDQogICAgICAvLyDorrDlvZXlvIDlp4vlt6Hmo4DnmoTml7bpl7TvvIznlKjkuo7liKTmlq3mmK/lkKblnKjlvIDlp4vlt6Hmo4DnmoQxMHPlhoUNCiAgICAgIHN0YXJ0UmVjb3JkVGltZXI6ICcnLA0KICAgICAgbmF2YmFyVGl0bGU6ICfml6XluLjku7vliqEnLA0KICAgICAgLy8g5LiK5oql5aSx6LSl55qE5beh5qOA6L2o6L+554K55L2N5pWw57uEDQogICAgICByZXBvcnRGYWlsVHJhY2tQb2ludHM6IFtdLA0KICAgICAgaXNTaG93Um91dGU6IHRydWUsDQogICAgICBpbnNwQnVzaW5lc3NUeXBlOiAnJywNCiAgICAgIHJlY29yZERhdGE6IFtdLA0KICAgICAgLy8g5b2T5YmN5beh5qOA5ZGY5omA5aSE5L2N572uDQogICAgICBjdXJyZW50UG9zaXRpb246IG51bGwsDQogICAgICBsaW5lczogW10sDQogICAgICAvLyDlt6Hmo4DlkZjkv6Hmga8NCiAgICAgIHVzZXJJbmZvOiB7fSwNCiAgICAgIGlmUmVjb3JkaW5nOiBmYWxzZSwNCiAgICAgIGVuZFJlY29yZFNob3c6IGZhbHNlLA0KICAgICAgc2VsZWN0RXZlbnRUeXBlOiBmYWxzZSwNCiAgICAgIGV2ZW50VHlwZUxpc3Q6IFtdLA0KICAgICAgc2lnblNob3c6IGZhbHNlLA0KICAgICAgYXR0YWNobWVudDogJycsDQogICAgICBzaWduRm9ybTogew0KICAgICAgICBkZXZpY2VTdGF0dXM6ICcxJywNCiAgICAgICAgaW5zcEltYWdlc0xpc3Q6IFtdLA0KICAgICAgICByZW1hcms6ICcnLA0KICAgICAgICBpc1JlcG9ydDogJycsDQogICAgICAgIHRhc2tJZDogJycsDQogICAgICAgIHBvaW50SWQ6ICcnLA0KICAgICAgfSwNCiAgICAgIHRhc2tEZXRhaWw6IHsNCiAgICAgICAgY292ZXJhZ2U6ICcwLzAnLA0KICAgICAgICByZXBvcnRSYXRlOiAnMC8wJywNCiAgICAgICAgcGxhbkVuZFRpbWU6ICcnLA0KICAgICAgfSwNCiAgICAgIGVuZ0luZm9EVE86IHt9LA0KICAgICAgdGFza1Jlc3RUaW1lOiAwLA0KICAgICAgcmVwb3J0Rm9vdGVyU2hvdzogZmFsc2UsDQogICAgICBmZWF0dXJlOiB7fSwNCiAgICAgIHBsYW5EZXRhaWw6IHt9LA0KICAgICAgLy8g55So5LqO5Zyw5Zu+5Lit5pi+56S66IyD5Zu05ZKM5YWz6ZSu54K5DQogICAgICBpbnNwUmFuZ2VMaXN0OiBbXSwNCiAgICAgIHJhbmdlTGlzdDogW10sDQogICAgICBrZXlEZXRhaWxMaXN0OiBbXSwNCiAgICAgIGlzUnVuTGlzdDogWw0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+ato+W4uCcsDQogICAgICAgICAgdmFsdWU6ICcxJywNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICflvILluLgnLA0KICAgICAgICAgIHZhbHVlOiAnMCcsDQogICAgICAgIH0sDQogICAgICBdLA0KICAgICAgcmVwb3J0Q2hvc2U6IFsNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICfpl67popjkuIrmiqUnLA0KICAgICAgICAgIHZhbHVlOiAn6Zeu6aKY5LiK5oqlJywNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICfmlrDlop7nvLrpmbcnLA0KICAgICAgICAgIHZhbHVlOiAn5paw5aKe57y66Zm3JywNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICfml6DpnIDkuIrmiqUnLA0KICAgICAgICAgIHZhbHVlOiAn5peg6ZyA5LiK5oqlJywNCiAgICAgICAgfSwNCiAgICAgIF0sDQogICAgICBydWxlczogew0KICAgICAgfSwNCiAgICAgIHByZXZpZXdVUkw6ICcvc3lzLXN0b3JhZ2UvZG93bmxvYWRfaW1hZ2U/ZjhzPScsDQogICAgICB1cGltZ1ByZXZpZXc6IFtdLA0KICAgICAgaGVhZGVyczoge30sDQogICAgICB1cmw6IHsNCiAgICAgICAgLy8g5pys6aG16Z2i5L2/55So5Yiw55qEdXJsDQogICAgICAgIHVwbG9hZEZpbGU6ICdzeXMtc3RvcmFnZS91cGxvYWQnLA0KICAgICAgICBmaW5kRmlsZTogJ2VjaWRpLWNtcC9maWxlL2NtcEZpbGVHcm91cC9maW5kRmlsZXNCeUdyb3VwSWQnLA0KICAgICAgfSwNCiAgICAgIHBvbGxpbmdGbGFnOiBmYWxzZSwNCiAgICAgIHBvbGxpbmdHYXBUaW1lOiAzLA0KICAgICAgdHJhY2tQb2ludExpc3Q6IFtdLA0KICAgICAgdHJhY2tQb2ludFRpbWVMaXN0OiBbXSwNCiAgICAgIG92ZXJTcGVlZFRyYWNrTGluZUxpc3Q6IFtdLA0KICAgICAgdHJhY2tMb2NhdGlvbl9zdGFydDogJycsDQogICAgICB0cmFja0xvY2F0aW9uX2VuZDogJycsDQogICAgICBzaG93VmlzaWJsZTogZmFsc2UsDQogICAgICBpc01hc2s6IGZhbHNlLCAvL+aYr+WQpuaYvuekuumBrue9qeWxgg0KICAgICAgcmVwb3J0U2hvdzogZmFsc2UsIC8vIOmXrumimOS4iuaKpemdouadv+aYvuekug0KICAgICAgYWNjZXNzVG9rZW46IHRoaXMuJHN0b3JhZ2UuZ2V0KCdhY2Nlc3NfdG9rZW4nKSwNCiAgICAgIGhlYWRlcjoge30sDQogICAgICBmb3JtVG9rZW46ICcnLA0KICAgICAgLy8g6Zeu6aKY5LiK5oqlbGlzdA0KICAgICAgcHJvYmxlbURhdGFMaXN0MTogW10sDQogICAgICAvLyDorr7mlr3nvLrpmbdsaXN0DQogICAgICBwcm9ibGVtRGF0YUxpc3QyOiBbXQ0KICAgIH0NCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICAvLyDojrflj5bpl67popjkuIrmiqXlkozorr7mlr3nvLrpmbfmlbDmja4NCiAgICB0aGlzLmdldENhcmRMaXN0RGF0YSgpDQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdGhpcy51c2VySW5mbyA9IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvDQogICAgY29uc29sZS5sb2coJ3RoaXMudXNlckluZm86ICcsIHRoaXMudXNlckluZm8pOw0KICAgIHRoaXMuaXNTdGFydCA9IGZhbHNlDQogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3N0YXJ0UmVjb3JkTGluZXMnLCAnZW5kJykNCiAgICB0aGlzLm5hdmJhclRpdGxlID0gJ+aXpeW4uOS7u+WKoScNCiAgICBidXMuJG9uKCdzdGFydFNpZ25JbicsIChmZWF0dXJlKSA9PiB7DQogICAgICB0aGlzLnN0YXJ0U2lnbkluKGZlYXR1cmUpDQogICAgfSkNCiAgICB0aGlzLmlzVmlldyA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmlzVmlldw0KICAgIGNvbnN0IGlkID0gdGhpcy4kcm91dGUucXVlcnkudGFza0lkDQogICAgdGhpcy5nZXRUYXNrQnlJZChpZCkNCiAgICB0aGlzLmdldFRyYWNrUmVjb3Jkc0J5SWQoaWQpDQogICAgLy8gdGhpcy5nZXRBcHBJbnNwRGF0YShpZCkNCiAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAhKGZ1bmN0aW9uIGNvbXB1dGVkUG9zaXRpb24oKSB7DQogICAgICBsZXQgZ2FwVGltZXIgPSAxMA0KICAgICAgaWYgKHRoYXQuY3VycmVudFBvc2l0aW9uKSB7DQogICAgICAgIC8vIOiuoeeul+W9k+WJjeaXtumXtOS4juW9k+WJjeaPkuS7tui/lOWbnueahOaXtumXtOeahOmXtOmalA0KICAgICAgICBsZXQgZ2FwID0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gbmV3IERhdGUodGhhdC5jdXJyZW50UG9zaXRpb24ubG9jVGltZSkuZ2V0VGltZSgpKSAvIDEwMDANCiAgICAgICAgLy8g5aaC5p6c6Ze06ZqU5pe26Ze05aSn5LqO5p+Q5LiA5YC877yM5YiZ6K+05piO5ZyoZ2FwVGltZXLml7bpl7TlhoXmsqHmnInmlLbliLDmnaXoh6rmj5Lku7bnmoTmlrDngrnkvY0NCiAgICAgICAgaWYgKGdhcCA+IGdhcFRpbWVyKSB7DQogICAgICAgICAgLy8g5byA5ZCv5o+Q56S6DQogICAgICAgICAgLy8gTm90aWZ5Lndhcm5pbmcoeyBtZXNzYWdlOiAn5b2T5YmNR1BT5L+h5Y+36L6D5byxLOS9jee9ruWSjOi9qOi/ueabtOaWsOWPr+iDvee8k+aFoicsIGR1cmF0aW9uOiA1MDAwIH0pDQogICAgICAgICAgbGV0IHQgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIC8vIOaPkOekuue7k+adn++8jOW5tuW8gOWni+S4i+asoeiwg+eUqA0KICAgICAgICAgICAgY29tcHV0ZWRQb3NpdGlvbigpDQogICAgICAgICAgfSwgMTUwMDApDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgLy8g5byA5aeL5LiL5qyh6LCD55SoDQogICAgICAgICAgbGV0IHQgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIGNvbXB1dGVkUG9zaXRpb24oKQ0KICAgICAgICAgIH0sIDEwMDAwKQ0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvLyBOb3RpZnkud2FybmluZyh7IG1lc3NhZ2U6ICflvZPliY1HUFPml6Dkv6EnLCBkdXJhdGlvbjogNTAwMCB9KQ0KICAgICAgICBsZXQgdCA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIGNvbXB1dGVkUG9zaXRpb24oKQ0KICAgICAgICB9LCAxMDAwMCkNCiAgICAgIH0NCiAgICB9KSgpDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyDojrflj5bpl67popjkuIrmiqXlkozorr7mlr3nvLrpmbfmlbDmja4NCiAgICBnZXRDYXJkTGlzdERhdGEoKSB7DQogICAgICAvLyDojrflj5ZoZWFkZXLvvIzmn6Xor6Llt6XljZXnlKgNCiAgICAgIGF4aW9zKHsNCiAgICAgICAgdXJsOiBBUEkuVlVFX0FQUF9XUEdfVVJMICsgJy9tYWluL3VzZXJDZW50ZXJBcGkvc3NvL3Rva2VuQnlUb2tlbicsDQogICAgICAgIG1ldGhvZDogJ3Bvc3QnLA0KICAgICAgICBwYXJhbXM6IHsNCiAgICAgICAgICB0b2tlbjogdGhpcy5hY2Nlc3NUb2tlbiwNCiAgICAgICAgfSwNCiAgICAgICAgaGVhZGVyczogew0KICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCYXNpYyBiM1YwZDI5eWF6cDNjR2N5TURJdycsDQogICAgICAgIH0sDQogICAgICB9KS50aGVuKChyZXMpID0+IHsNCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT0gMjAwKSB7DQogICAgICAgICAgdGhpcy5mb3JtVG9rZW4gPSByZXMuZGF0YS5yZXN1bHREYXRhLnRva2VuDQogICAgICAgICAgdGhpcy5oZWFkZXIgPSB7DQogICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLA0KICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgdGhpcy5mb3JtVG9rZW4sDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g6Zeu6aKY5LiK5oqlKHNtYWxsVHlwZTogJ2Fibm9ybWFsX2luZm9ybScp44CB6K6+5pa957y66Zm3KHNtYWxsVHlwZTogImRlZmVjdCIp5L2/55So5ZCM5LiA5o6l5Y+jDQogICAgYXN5bmMgZ2V0UHJvYmxlbURhdGFMaXN0KHBhcmFtcykgew0KICAgICAgdGhpcy5wcm9ibGVtRGF0YUxpc3QxID0gW10NCiAgICAgIHRoaXMucHJvYmxlbURhdGFMaXN0MiA9IFtdDQoNCiAgICAgIGxldCBjb21tb25QYXJhbXMgPSBPYmplY3QuYXNzaWduKHsNCiAgICAgICAgc3lzQ29kZTogJ291dHdvcmsnLA0KICAgICAgICAvLyB0b2tlbjogdGhpcy5hY2Nlc3NUb2tlbiwNCiAgICAgICAgcGFnZTogew0KICAgICAgICAgIGN1cnJlbnQ6IDEsDQogICAgICAgICAgc2l6ZTogOTk5OTksIC8vIOafpeWFqOmDqA0KICAgICAgICB9DQogICAgICB9LCBwYXJhbXMpDQogICAgICAvLyDpl67popjkuIrmiqUNCiAgICAgIGxldCBwYXJhbXMxID0gew0KICAgICAgICAuLi5jb21tb25QYXJhbXMsDQogICAgICAgIHNtYWxsVHlwZTogJ2Fibm9ybWFsX2luZm9ybScNCiAgICAgIH0NCiAgICAgIC8vIOiuvuaWvee8uumZtw0KICAgICAgbGV0IHBhcmFtczIgPSB7DQogICAgICAgIC4uLmNvbW1vblBhcmFtcywNCiAgICAgICAgc21hbGxUeXBlOiAnZGVmZWN0Jw0KICAgICAgfQ0KICAgICAgbGV0IHByb2JsZW1Qb2ludEZlYXR1cmVzID0gW10NCiAgICAgIC8vIOmXrumimOS4iuaKpQ0KICAgICAgYXdhaXQgdGhpcy5nZXRBeGlvc0RhdGEocGFyYW1zMSwgdGhpcy5wcm9ibGVtRGF0YUxpc3QxKQ0KICAgICAgLy8g6K6+5pa957y66Zm3DQogICAgICBhd2FpdCB0aGlzLmdldEF4aW9zRGF0YShwYXJhbXMyLCB0aGlzLnByb2JsZW1EYXRhTGlzdDIpDQogICAgICBsZXQgYWxsUHJvYmxlbSA9IHRoaXMucHJvYmxlbURhdGFMaXN0MS5jb25jYXQodGhpcy5wcm9ibGVtRGF0YUxpc3QyKQ0KICAgICAgYWxsUHJvYmxlbS5mb3JFYWNoKGl0ID0+IHsNCiAgICAgICAgcHJvYmxlbVBvaW50RmVhdHVyZXMucHVzaCh7DQogICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLA0KICAgICAgICAgIGdlb21ldHJ5OiB7DQogICAgICAgICAgICB0eXBlOiAnUG9pbnQnLA0KICAgICAgICAgICAgY29vcmRpbmF0ZXM6IGl0LmxuZ2xhdA0KICAgICAgICAgIH0sDQogICAgICAgICAgcHJvcGVydGllczogew0KICAgICAgICAgICAgaWQ6IGl0LmlkLA0KICAgICAgICAgICAgdGl0bGU6IGl0LnRpdGxlDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICAgIHRoaXMuJHJlZnMubXltYXAuYWRkSW5zcEV2ZW50TGF5ZXIocHJvYmxlbVBvaW50RmVhdHVyZXMpDQogICAgICB0aGlzLnJlcG9ydERhdGFJc0xvYWRlZCA9IHRydWUNCiAgICB9LA0KICAgIGdldEF4aW9zRGF0YShwYXJhbXMsIHByb2JsZW1EYXRhTGlzdCkgew0KICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgYXhpb3Moew0KICAgICAgICAgIHVybDogQVBJLlZVRV9BUFBfV1BHX1VSTCArICcvbWFpbi9vdXR3b3JrYXBpL3RpY2tldFN0YXRpc3RpY0NsaWVudC9nZXRUaWNrZXRMaXN0JywNCiAgICAgICAgICBtZXRob2Q6ICdwb3N0JywNCiAgICAgICAgICBkYXRhOiBwYXJhbXMsDQogICAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXIsDQogICAgICAgIH0pLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09IDIwMCkgew0KICAgICAgICAgICAgcmVzLmRhdGEucmVzdWx0RGF0YS5yZWNvcmRzLmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgcHJvYmxlbURhdGFMaXN0LnB1c2goew0KICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkLCAvLyDlt6XljZVJRA0KICAgICAgICAgICAgICAgIHRpdGxlOiBpdGVtLnRpdGxlLCAvLyDlt6XljZXmoIfpopgNCiAgICAgICAgICAgICAgICB0aWNrZXRTdGF0dXNOYW1lOiBpdGVtLnRpY2tldFN0YXR1c05hbWUsDQogICAgICAgICAgICAgICAgaGFuZGxlVHlwZTogaXRlbS5mb3JtVmFsdWUuaGFuZGxlVHlwZSwgLy8g5o+P6L+wDQogICAgICAgICAgICAgICAgY3JlYXRlQnlOYW1lOiBpdGVtLmNyZWF0ZUJ5TmFtZSwgLy8g5Yib5bu65Lq6DQogICAgICAgICAgICAgICAgY3JlYXRlVGltZTogaXRlbS5jcmVhdGVUaW1lLnN1YnN0cmluZygwLCAxMCksIC8vIOWIm+W7uuaXtumXtA0KICAgICAgICAgICAgICAgIGRlZmVjdEZyb206IGl0ZW0uZm9ybVZhbHVlLmRlZmVjdEZyb20sDQogICAgICAgICAgICAgICAgZmF1bHRUeXBlczogaXRlbS5mb3JtVmFsdWUuZmF1bHRUeXBlcywNCiAgICAgICAgICAgICAgICBmaWxlVXJsOiBpdGVtLmZvcm1WYWx1ZT8uaGFuZGxlSW1ncz8uWzBdPy5maWxlVXJsLA0KICAgICAgICAgICAgICAgIC8vIOWbvueJh+WcsOWdgA0KICAgICAgICAgICAgICAgIHVybDogaXRlbS5mb3JtVmFsdWU/LmZpbGVzPy5bMF0/LnVybCwNCiAgICAgICAgICAgICAgICAvLyDlj5HnlJ/nu4/nuqzluqYNCiAgICAgICAgICAgICAgICBsbmdsYXQ6IFtpdGVtLmFwcGVhbExuZywgaXRlbS5hcHBlYWxMYXRdLA0KICAgICAgICAgICAgICAgIGRldmljZV90eXBlOiBpdGVtLmZvcm1WYWx1ZT8uZGV2aWNlX3R5cGUgfHwgW10sDQogICAgICAgICAgICAgICAgcXVlc3Rpb25EZXNjcmliZTogaXRlbS5mb3JtVmFsdWUucXVlc3Rpb25EZXNjcmliZSwNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICByZXNvbHZlKCkNCiAgICAgICAgICB9DQogICAgICAgICAgLy8gcHJvYmxlbURhdGFMaXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAvLyAgIC8vIGNvbnNvbGUubG9nKCflm77niYflnLDlnYAnLCBpdGVtLnVybCkNCiAgICAgICAgICAvLyB9KQ0KICAgICAgICB9KQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOmXrumimOS4iuaKpeeCueWHu+agh+mimOOAgeiuvuaWvee8uumZt+eCueWHu+WNoeeJh+i/m+WFpeivpuaDhemhtQ0KICAgIHRvRGV0YWlsUGFuZWwoY2FyZERldGFpbCkgew0KICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPQ0KICAgICAgICAnaHR0cDovLzE3Mi4yMC43OS43MC9vdXR3b3JrQXBwLyMvcGFnZXMvdGlja2V0L2RldGFpbC9pbmRleD9pZD0nICsNCiAgICAgICAgY2FyZERldGFpbC5pZCArDQogICAgICAgICcmc3lzQ29kZT1vdXR3b3JrJyArDQogICAgICAgICcmdG9rZW49JyArDQogICAgICAgIHRoaXMuZm9ybVRva2VuDQogICAgfSwNCiAgICAvLyDljaHniYflrprkvY0NCiAgICBmbHlUb1BvaW50KGxuZ2xhdCkgew0KICAgICAgbWFwT2JqLm1hcC5mbHlUbyh7IGNlbnRlcjogbG5nbGF0LCB6b29tOiAxNy41IH0pDQogICAgfSwNCiAgICAvLyDkuIrmiqUNCiAgICByZXBvcnRDbGljaygpIHsNCiAgICAgIGlmICh0aGlzLnJlcG9ydERhdGFJc0xvYWRlZCkgew0KICAgICAgICB0aGlzLnJlcG9ydFNob3cgPSB0cnVlDQogICAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ2V2ZW50UG9pbnRzTGF5ZXInLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIFRvYXN0KHsNCiAgICAgICAgICBtZXNzYWdlOiAn5LiK5oql5pWw5o2u5Yqg6L295Lit44CC44CC44CCJywNCiAgICAgICAgICBkdXJhdGlvbjogMTUwMA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICB9LA0KICAgIGhhbmRsZUNsb3NlKCkgew0KICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnZXZlbnRQb2ludHNMYXllcicsICd2aXNpYmlsaXR5JywgJ25vbmUnKQ0KICAgIH0sDQogICAgZmlsZUNoYW5nZShmaWxlKSB7DQogICAgICB0aGlzLnNpZ25Gb3JtLmluc3BJbWFnZXNMaXN0ID0gW10NCiAgICAgIGZpbGUuZmlsZUxpc3QuZm9yRWFjaChpdCA9PiB7DQogICAgICAgIHRoaXMuc2lnbkZvcm0uaW5zcEltYWdlc0xpc3QucHVzaCgNCiAgICAgICAgICB7DQogICAgICAgICAgICBmaWxlSWQ6IGl0LnJlc3BvbnNlLmdyb3VwVG9rZW4sDQogICAgICAgICAgICBpbWFnZXNOYW1lOiBpdC51cmwNCiAgICAgICAgICB9DQogICAgICAgICkNCiAgICAgIH0pDQogICAgICBjb25zb2xlLmxvZyh0aGlzLnNpZ25Gb3JtKQ0KICAgIH0sDQogICAgYXN5bmMgZW5kVGFzaygpIHsNCiAgICAgIGlmICh0aGlzLmlzVmlldykgew0KICAgICAgICBUb2FzdCh7DQogICAgICAgICAgbWVzc2FnZTogJ+ivpeW3oeajgOS7u+WKoeW3sue7k+adnycsDQogICAgICAgICAgZHVyYXRpb246IDE1MDANCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICBhd2FpdCB0aGlzLmdldFRhc2tCeUlkKHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZCkNCiAgICAgIGxldCBoYXNJbnNwS3AgPSB0aGlzLmNoYW5nZVRvSW5zcENvdW50KHRoaXMudGFza0RldGFpbC5yZXBvcnRSYXRlKQ0KICAgICAgbGV0IGFsbEluc3BLcCA9IHRoaXMuY2hhbmdlVG9BbGxJbnNwQ291bnQodGhpcy50YXNrRGV0YWlsLnJlcG9ydFJhdGUpDQogICAgICBEaWFsb2cuY29uZmlybSh7DQogICAgICAgIHRpdGxlOiAn5o+Q56S6JywNCiAgICAgICAgbWVzc2FnZTogYOaCqOi/mOaciSR7YWxsSW5zcEtwIC0gaGFzSW5zcEtwfeS4quWFs+mUrueCueacquaJk+WNoe+8jOehruWumue7k+adn+W3oeajgOS7u+WKoe+8n2AsDQogICAgICB9KQ0KICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgdGhpcy5lbmRSZWNvcmRDb25maXJtKCd0YXNrJykNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICB0aGlzLmVuZFJlY29yZENhbmNlbCgpDQogICAgICAgIH0pDQogICAgfSwNCiAgICBvcGVuUG9wdXAoKSB7DQogICAgICB0aGlzLnNob3dQb3BvdmVyID0gdHJ1ZQ0KICAgIH0sDQogICAgb25TZWxlY3QodmFsKSB7DQogICAgICBpZiAodGhpcy5pc1ZpZXcpIHsNCiAgICAgICAgVG9hc3Qoew0KICAgICAgICAgIG1lc3NhZ2U6ICfor6Xlt6Hmo4Dku7vliqHlt7Lnu5PmnZ8nLA0KICAgICAgICAgIGR1cmF0aW9uOiAnMTUwMCcNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICAvLyBUb2FzdCh7DQogICAgICAvLyAgIG1lc3NhZ2U6ICfor7flnKjlnLDlm77kuIrpgInmi6norr7mlr3miJbogIXngrnkvY0nLA0KICAgICAgLy8gICBkdXJhdGlvbjogMTUwMA0KICAgICAgLy8gfSk7DQogICAgICB0aGlzLmlmVGlwcyA9IHRydWUNCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICB0aGlzLmlmVGlwcyA9IGZhbHNlDQogICAgICB9LCAyNTAwKQ0KICAgICAgbWFwT2JqLm1hcC5vZmYoJ2NsaWNrJywgJ2tleXBvaW50c0xheWVyJywgdGhpcy4kcmVmcy5teW1hcC5zaWduSW5CdWZmZXIpDQogICAgICB2YWwudGV4dCA9PSAn6Zeu6aKY5LiK5oqlJyA/IG1hcE9iai5tYXAub24oJ2NsaWNrJywgdGhpcy5zZWxlY3RSZXBvcnRQb2ludCkgOiBtYXBPYmoubWFwLm9uKCdjbGljaycsIHRoaXMuc2VsZWN0Rmxhd1BvaW50KQ0KICAgIH0sDQogICAgc2VsZWN0UmVwb3J0UG9pbnQoZSkgew0KICAgICAgbGV0IGZlYXR1cmVzID0gbWFwT2JqLm1hcC5xdWVyeVJlbmRlcmVkRmVhdHVyZXMoZS5wb2ludCkNCiAgICAgIGNvbnNvbGUubG9nKGZlYXR1cmVzKQ0KICAgICAgaWYgKGZlYXR1cmVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgaWYgKA0KICAgICAgICBmZWF0dXJlc1swXS5zb3VyY2UgIT0gImluc3BVc2VyIiANCiAgICAgICAgJiYgZmVhdHVyZXNbMF0uc291cmNlICE9ICJpbml0SW5zcExpbmVTb3VyY2UiIA0KICAgICAgICAmJiBmZWF0dXJlc1swXS5zb3VyY2UgIT0gImtleXBvaW50cyIgDQogICAgICAgICYmKGZlYXR1cmVzWzBdLmdlb21ldHJ5LnR5cGUgPT09ICJQb2ludCIpDQogICAgICAgICkgew0KICAgICAgICB0aGlzLiRyZWZzLm15bWFwLmFkZEV2ZW50T2JqTWFya2VyKGZlYXR1cmVzWzBdLCAnZXZlbnQnLCB7IGdyaWRJZDogdGhpcy5wbGFuRGV0YWlsLmdyaWRJZCwgZ3JpZE5hbWU6IHRoaXMucGxhbkRldGFpbC5ncmlkTmFtZSB9KTsNCiAgICAgICAgfSBlbHNlIGlmIChmZWF0dXJlcy5sZW5ndGggPiAxIA0KICAgICAgICAgICYmIGZlYXR1cmVzWzFdLnNvdXJjZSAhPSJldmVudFBvaW50cyIgDQogICAgICAgICAgJiYgZmVhdHVyZXNbMV0uc291cmNlICE9ICJpbnNwVXNlciIgDQogICAgICAgICAgJiYgZmVhdHVyZXNbMV0uc291cmNlICE9ICJrZXlwb2ludHMiIA0KICAgICAgICAgICYmIChmZWF0dXJlc1sxXS5nZW9tZXRyeS50eXBlID09PSAiUG9pbnQiKQ0KICAgICAgICAgICkgew0KICAgICAgICAgIHRoaXMuJHJlZnMubXltYXAuYWRkRXZlbnRPYmpNYXJrZXIoZmVhdHVyZXNbMV0sICdldmVudCcsIHsgZ3JpZElkOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZElkLCBncmlkTmFtZTogdGhpcy5wbGFuRGV0YWlsLmdyaWROYW1lIH0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBtYXBPYmoubWFwLm9uKCdjbGljaycsICdrZXlwb2ludHNMYXllcicsIHRoaXMuJHJlZnMubXltYXAuc2lnbkluQnVmZmVyKQ0KICAgICAgbWFwT2JqLm1hcC5vZmYoJ2NsaWNrJywgdGhpcy5zZWxlY3RSZXBvcnRQb2ludCkNCiAgICB9LA0KICAgIHNlbGVjdEZsYXdQb2ludChlKSB7DQogICAgICBsZXQgZmVhdHVyZXMgPSBtYXBPYmoubWFwLnF1ZXJ5UmVuZGVyZWRGZWF0dXJlcyhlLnBvaW50KQ0KICAgICAgY29uc29sZS5sb2coZmVhdHVyZXMpDQogICAgICBpZiAoZmVhdHVyZXMubGVuZ3RoID4gMCkgew0KICAgICAgICBpZiAoDQogICAgICAgIGZlYXR1cmVzWzBdLnNvdXJjZSAhPSJldmVudFBvaW50cyINCiAgICAgICAgJiYgZmVhdHVyZXNbMF0uc291cmNlICE9ICJpbnNwVXNlciIgDQogICAgICAgICYmIGZlYXR1cmVzWzBdLnNvdXJjZSAhPSAiaW5pdEluc3BMaW5lU291cmNlIiANCiAgICAgICAgJiYgZmVhdHVyZXNbMF0uc291cmNlICE9ICJrZXlwb2ludHMiIA0KICAgICAgICAmJihmZWF0dXJlc1swXS5nZW9tZXRyeS50eXBlID09PSAiUG9pbnQiKQ0KICAgICAgICApIHsNCiAgICAgICAgdGhpcy4kcmVmcy5teW1hcC5hZGRFdmVudE9iak1hcmtlcihmZWF0dXJlc1swXSwgJ2ZsYXcnLCB7IGdyaWRJZDogdGhpcy5wbGFuRGV0YWlsLmdyaWRJZCwgZ3JpZE5hbWU6IHRoaXMucGxhbkRldGFpbC5ncmlkTmFtZSB9KTsNCiAgICAgICAgfSBlbHNlIGlmIChmZWF0dXJlcy5sZW5ndGggPiAxIA0KICAgICAgICAgICYmIGZlYXR1cmVzWzFdLnNvdXJjZSAhPSJldmVudFBvaW50cyINCiAgICAgICAgICAmJiBmZWF0dXJlc1sxXS5zb3VyY2UgIT0gImluc3BVc2VyIiANCiAgICAgICAgICAmJiBmZWF0dXJlc1sxXS5zb3VyY2UgIT0gImtleXBvaW50cyINCiAgICAgICAgICAmJiAoZmVhdHVyZXNbMV0uZ2VvbWV0cnkudHlwZSA9PT0gIlBvaW50IikNCiAgICAgICAgICApIHsNCiAgICAgICAgICB0aGlzLiRyZWZzLm15bWFwLmFkZEV2ZW50T2JqTWFya2VyKGZlYXR1cmVzWzFdLCAnZmxhdycsIHsgZ3JpZElkOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZElkLCBncmlkTmFtZTogdGhpcy5wbGFuRGV0YWlsLmdyaWROYW1lIH0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBtYXBPYmoubWFwLm9uKCdjbGljaycsICdrZXlwb2ludHNMYXllcicsIHRoaXMuJHJlZnMubXltYXAuc2lnbkluQnVmZmVyKQ0KICAgICAgbWFwT2JqLm1hcC5vZmYoJ2NsaWNrJywgdGhpcy5zZWxlY3RGbGF3UG9pbnQpDQogICAgfSwNCiAgICBnZXRSZXN0VGltZSh0aW1lKSB7DQogICAgICByZXR1cm4gdGltZSA/IG5ldyBEYXRlKHRpbWUpLmdldFRpbWUoKSAtIG5ldyBEYXRlKCkuZ2V0VGltZSgpIDogMA0KICAgIH0sDQogICAgY2hhbmdlVG9JbnNwQ291bnQocmVwb3J0UmF0ZSkgew0KICAgICAgaWYgKHJlcG9ydFJhdGUuaW5jbHVkZXMoJy8nKSkgew0KICAgICAgICByZXR1cm4gTnVtYmVyKHJlcG9ydFJhdGUuc3BsaXQoJy8nKVswXSkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAwDQogICAgICB9DQogICAgfSwNCiAgICBjaGFuZ2VUb0FsbEluc3BDb3VudChyZXBvcnRSYXRlKSB7DQogICAgICBpZiAocmVwb3J0UmF0ZS5pbmNsdWRlcygnLycpKSB7DQogICAgICAgIHJldHVybiBOdW1iZXIocmVwb3J0UmF0ZS5zcGxpdCgnLycpWzFdKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIDANCiAgICAgIH0NCiAgICB9LA0KICAgIGNoYW5nZVRvUmF0ZShjb3ZlcmFnZSkgew0KICAgICAgaWYgKGNvdmVyYWdlLmluY2x1ZGVzKCcvJykpIHsNCiAgICAgICAgbGV0IGluc3AgPSBOdW1iZXIoY292ZXJhZ2Uuc3BsaXQoJy8nKVswXSkNCiAgICAgICAgbGV0IHVuaW5zcCA9IE51bWJlcihjb3ZlcmFnZS5zcGxpdCgnLycpWzFdKQ0KICAgICAgICBpZiAodW5pbnNwKSB7DQogICAgICAgICAgcmV0dXJuICgoaW5zcCAvIHVuaW5zcCkgKiAxMDApLnRvRml4ZWQoMikgKyAnJScNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gJzAlJw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gJzAlJw0KICAgICAgfQ0KICAgIH0sDQogICAgbWFwTG9hZGVkKG1hcEluc3RhbmNlKSB7DQogICAgICBjb25zb2xlLmxvZygnbWFwTG9hZGVkZGRkZGRkZCcpDQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIG1hcE9iai5tYXBJbnN0YW5jZSA9IG1hcEluc3RhbmNlDQogICAgICBtYXBPYmoubWFwID0gbWFwSW5zdGFuY2UubWFwDQogICAgICAvLyB0aGlzLiRyZWZzLm15bWFwLnNldEluc3BVc2VyUG9zaXRpb24oew0KICAgICAgLy8gICBsb25naXR1ZGU6IDExNS44NTQ1NjMsDQogICAgICAvLyAgIGxhdGl0dWRlOiAzOS4wNDM0MDcNCiAgICAgIC8vIH0pDQogICAgICB5dWFuY2h1LmxvY2F0aW9uQU1hcC5yZXF1ZXN0U2luZ2xlTG9jYXRpb24oDQogICAgICAgIFsnMSddLA0KICAgICAgICAocmVzKSA9PiB7DQogICAgICAgICAgdGhhdC5jdXJyZW50UG9zaXRpb24gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcykpDQogICAgICAgICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAgICAgICAuLi50aGF0LmN1cnJlbnRQb3NpdGlvbiwNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy4kcmVmcy5teW1hcC5zZXRJbnNwVXNlclBvc2l0aW9uKHBhcmFtKQ0KICAgICAgICB9LA0KICAgICAgICAoZXJyKSA9PiB7DQogICAgICAgICAgY29uc29sZS5sb2coJ2Vycj0nLCBlcnIpDQogICAgICAgIH0NCiAgICAgICkNCiAgICB9LA0KICAgIC8vIOWIt+aWsOWcsOWbvg0KICAgIHJlZnJlc2hNYXAoKSB7DQogICAgICB0cnkgew0KICAgICAgICB0aGlzLmNsZWFyQnVmZmVyVHJhY2soKQ0KICAgICAgICAvLyDmuIXnqbrmiYDmnInnmoRwb3B1cA0KICAgICAgICBsZXQgY2xhc3NOYW1lcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ21hcGJveGdsLXBvcHVwLWFuY2hvci1ib3R0b20nKQ0KICAgICAgICBmb3IgKGxldCBpID0gY2xhc3NOYW1lcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgew0KICAgICAgICAgIGlmIChjbGFzc05hbWVzW2ldICE9IG51bGwpIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZXNbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjbGFzc05hbWVzW2ldKQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyDmuIXnqbrmiYDmnInlhbPplK7ngrltYXJrZXINCiAgICAgICAgbGV0IGlkcyA9IFtdDQogICAgICAgIHRoaXMua2V5RGV0YWlsTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgaWYgKGl0ZW0uZW5nSW5mb0RUTykgew0KICAgICAgICAgICAgaWRzLnB1c2goaXRlbS5lbmdJbmZvRFRPLmVuZ0lkKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgbWFwT2JqLm1hcEluc3RhbmNlICYmIHRoaXMuJHJlZnMubXltYXAucmVtb3ZlS2V5UG9pbnRNYXJrZXIoaWRzKQ0KICAgICAgICAvLyDmuIXnqbrlt6Hmo4DojIPlm7Tlm77lsYINCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3JhbmdlU291cmNlJykgJiYNCiAgICAgICAgICBtYXBPYmoubWFwSW5zdGFuY2Uuc2V0U291cmNlRGF0YSgncmFuZ2VTb3VyY2UnLCB7DQogICAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICAgIH0pDQogICAgICAgIC8vIOa4heepuuW3oeajgOeuoee6v+WbvuWxgg0KICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgnaW5pdEluc3BMaW5lU291cmNlJykgJiYNCiAgICAgICAgICBtYXBPYmoubWFwSW5zdGFuY2Uuc2V0U291cmNlRGF0YSgnaW5pdEluc3BMaW5lU291cmNlJywgew0KICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgIGZlYXR1cmVzOiBbXSwNCiAgICAgICAgICB9KQ0KICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgndW5JbnNwTGluZVNvdXJjZScpICYmDQogICAgICAgICAgbWFwT2JqLm1hcEluc3RhbmNlLnNldFNvdXJjZURhdGEoJ3VuSW5zcExpbmVTb3VyY2UnLCB7DQogICAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICAgIH0pDQogICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCdpbnNwTGluZVNvdXJjZScpICYmDQogICAgICAgICAgbWFwT2JqLm1hcEluc3RhbmNlLnNldFNvdXJjZURhdGEoJ2luc3BMaW5lU291cmNlJywgew0KICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgIGZlYXR1cmVzOiBbXSwNCiAgICAgICAgICB9KQ0KICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgnaW5zcFVzZXJMaW5lU291cmNlJykgJiYNCiAgICAgICAgICBtYXBPYmoubWFwSW5zdGFuY2Uuc2V0U291cmNlRGF0YSgnaW5zcFVzZXJMaW5lU291cmNlJywgew0KICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgIGZlYXR1cmVzOiBbXSwNCiAgICAgICAgICB9KQ0KICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgnaW5zcFVzZXInKSAmJg0KICAgICAgICAgIG1hcE9iai5tYXBJbnN0YW5jZS5zZXRTb3VyY2VEYXRhKCdpbnNwVXNlcicsIHsNCiAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgICAgICBmZWF0dXJlczogW10sDQogICAgICAgICAgfSkNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ2J1ZmZlcmVkJykgJiYNCiAgICAgICAgICBtYXBPYmoubWFwSW5zdGFuY2Uuc2V0U291cmNlRGF0YSgnYnVmZmVyZWQnLCB7DQogICAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICAgIH0pDQogICAgICAgIC8vIOWmguaenOWtmOWcqOS6i+S7tuWbvuWxgu+8jOWwseenu+mZpOivpeWbvuWxgg0KICAgICAgICBtYXBPYmoubWFwLmdldExheWVyKCdldmVudFBvaW50c0xheWVyJykgJiYgbWFwT2JqLm1hcC5yZW1vdmVMYXllcignZXZlbnRQb2ludHNMYXllcicpDQogICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCdldmVudFBvaW50cycpICYmIG1hcE9iai5tYXAucmVtb3ZlU291cmNlKCdldmVudFBvaW50cycpDQogICAgICAgIHRoaXMuJHJlZnMubXltYXAucmVtb3ZlRXZlbnRPYmpNYXJrZXIoKQ0KICAgICAgICB0aGlzLiRyZWZzLm15bWFwLnJlbW92ZVJhbmdlTVZUKCkNCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5Yi35paw5Lu75YqhDQogICAgcmVmcmVzaFRhc2soKSB7DQogICAgICAvLyBsZXQgaWRzID0gW10NCiAgICAgIC8vIHRoaXMua2V5RGV0YWlsTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAvLyAgIGlmIChpdGVtLmVuZ0luZm9EVE8pIHsNCiAgICAgIC8vICAgICBpZHMucHVzaChpdGVtLmVuZ0luZm9EVE8uZW5nSWQpDQogICAgICAvLyAgIH0NCiAgICAgIC8vIH0pDQogICAgICAvLyBtYXBPYmoubWFwSW5zdGFuY2UgJiYgdGhpcy4kcmVmcy5teW1hcC5yZW1vdmVLZXlQb2ludE1hcmtlcihpZHMpDQogICAgICBjb25zdCBpZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZA0KICAgICAgdGhpcy5nZXRUYXNrQnlJZChpZCwgJ3JlZnJlc2gnKQ0KICAgICAgLy8gYXdhaXQgdGhpcy5nZXRBcHBJbnNwRGF0YShpZCkNCiAgICB9LA0KICAgIGFzeW5jIGdldFRyYWNrUmVjb3Jkc0J5SWQoaWQpIHsNCiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3Qoew0KICAgICAgICB1cmw6ICcveGFzdy1waXBlLW9wZXJhdGlvbi9pbnNwVGFzay90cmFjaycsDQogICAgICAgIG1ldGhvZDogJ2dldCcsDQogICAgICAgIHBhcmFtczogeyBpZCwgcGFnZU51bTogMSwgcGFnZVNpemU6IDk5OTkgfSwNCiAgICAgIH0pDQogICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMpIHsNCiAgICAgICAgY29uc29sZS5sb2cocmVzKQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5qC55o2u5Lu75YqhaWTojrflj5blt6Hmo4DnirblhrUNCiAgICBhc3luYyBnZXRUYXNrQnlJZChpZCwgdHlwZT1udWxsKSB7DQogICAgICBUb2FzdC5sb2FkaW5nKHsNCiAgICAgICAgbWVzc2FnZTogJ+WcsOWbvuWKoOi9veS4rS4uLicsDQogICAgICAgIGZvcmJpZENsaWNrOiB0cnVlLA0KICAgICAgfSkNCiAgICAgIHRoaXMuaXNNYXNrID0gdHJ1ZQ0KICAgICAgLy8gYXdhaXQgdGhpcy5wb3N0QXBwRGF0YShpZCk7DQogICAgICAvLyDlpITnkIblt7Llt6Hmo4DnrqHnur/nmoTmjqXlj6MNCiAgICAgIGNvbnN0IHJlY29yZExpbmVzID0gYXdhaXQgYXBpLnJlY29yZGVkUGlwZUxpbmUoew0KICAgICAgICB0YXNrSWQ6IGlkLA0KICAgICAgICBwYWdlOiAxLA0KICAgICAgICBzaXplOiA5OTk5DQogICAgICB9KQ0KICAgICAgdGhpcy5saW5lcyA9IFtdDQogICAgICBpZiAocmVjb3JkTGluZXMuc3RhdHVzKSB7DQogICAgICAgIHRoaXMubGluZXMgPSByZWNvcmRMaW5lcy5kYXRhLnJlY29yZHMubWFwKChpdGVtKSA9PiBpdGVtLnBpcGVJZCkNCiAgICAgIH0NCiAgICAgIHRoaXMucmVwb3J0Rm9vdGVyU2hvdyA9IGZhbHNlIC8vIOS6i+S7tuS4iuaKpeW8ueeql+W8gOWFsw0KICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdCh7DQogICAgICAgIHVybDogJy94YXN3LXBpcGUtb3BlcmF0aW9uL2luc3BUYXNrL2dldEJ5SWQnLA0KICAgICAgICBtZXRob2Q6ICdnZXQnLA0KICAgICAgICBwYXJhbXM6IHsgaWQgfSwNCiAgICAgIH0pDQogICAgICAvLyBsZXQgcG9pbnQgPSB0dXJmLnBvaW50KFsxMTUuODU0NTQ2LCAzOS4wNDM0MTVdKQ0KICAgICAgLy8gdGhpcy4kcmVmcy5teW1hcC5kcmF3QnVmZmVyKHBvaW50LCA1KQ0KICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgIHRoaXMudGFza0RldGFpbCA9IHJlcy5kYXRhLmluc3BUYXNrDQogICAgICAgIHRoaXMucGxhbkRldGFpbCA9IHJlcy5kYXRhLmluc3BQbGFuDQogICAgICAgIHRoaXMuaW5zcFJhbmdlTGlzdCA9IHJlcy5kYXRhLmRldGFpbExpc3QubWFwKChyYW5nZSkgPT4gew0KICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICB0YXNrSWQ6IGlkLA0KICAgICAgICAgICAgLi4ucmFuZ2UsDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAvLyDkv67mlLnmnKrlt6Hmo4AoMCnku7vliqHnirbmgIHoh7Plt6Hmo4DkuK0oMSkNCiAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnF1ZXJ5LmlzTmV3ICYmIHRoaXMudGFza0RldGFpbC50YXNrU3RhdHVzICE9IDEpIHsNCiAgICAgICAgICB0aGlzLnN0cmF0T3JFbmRUYXNrUmVjb3JkKDEpDQogICAgICAgIH0NCiAgICAgICAgaWYgKHR5cGUgIT0gJ3JlZnJlc2gnKSB7DQogICAgICAgICAgY29uc3QgYWxsVGFza0xpbmVzID0gYXdhaXQgYXBpLmdldEFsbFRhc2tMaW5lcyh7DQogICAgICAgICAgICBkZXZUeXBlOiAn566h57q/JywNCiAgICAgICAgICAgIGdyaWRJZDogdGhpcy5wbGFuRGV0YWlsLmdyaWRJZCwNCiAgICAgICAgICAgIHBhZ2VOdW06IDEsDQogICAgICAgICAgICBwYWdlU2l6ZTogOTk5OTkNCiAgICAgICAgICB9KQ0KICAgICAgICAgIGlmIChhbGxUYXNrTGluZXMuc3RhdHVzKSB7DQogICAgICAgICAgICBhbGxUYXNrTGluZXMuZGF0YS5saXN0LmZvckVhY2goaXRlbSA9PiB7DQogICAgICAgICAgICAgIHRoaXMuYWxsVGFza0xpbmVzLnB1c2goew0KICAgICAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJywNCiAgICAgICAgICAgICAgICBpZDogaXRlbS5pZCwNCiAgICAgICAgICAgICAgICBnZW9tZXRyeTogSlNPTi5wYXJzZShpdGVtLmdlb20pLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsNCiAgICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkLA0KICAgICAgICAgICAgICAgICAgbGVuZ3RoOiBpdGVtWydsZW5ndGgnXQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICB0aGlzLiRyZWZzLm15bWFwLnNldEFsbEluc3BMaW5lU291cmNlKHRoaXMuYWxsVGFza0xpbmVzKQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBrcFJlcyA9IGF3YWl0IHJlcXVlc3Qoew0KICAgICAgICAgIHVybDogJy94YXN3LXBpcGUtb3BlcmF0aW9uL2luc3BUYXNrL3BvaW50JywNCiAgICAgICAgICBtZXRob2Q6ICdnZXQnLA0KICAgICAgICAgIHBhcmFtczogeyBpZCwgZ3JpZElkOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZElkLCBwYWdlTnVtOiAxLCBwYWdlU2l6ZTogOTk5OSwgYml6U2NvcGU6IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tUeXBlIH0sDQogICAgICAgIH0pDQogICAgICAgIHRoaXMua2V5RGV0YWlsTGlzdCA9IFtdDQogICAgICAgIGlmIChrcFJlcyAmJiBrcFJlcy5zdGF0dXMpIHsNCiAgICAgICAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKGtwUmVzLmRhdGEpDQogICAgICAgICAga2V5cy5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgICB0aGlzLmtleURldGFpbExpc3QucHVzaCguLi5rcFJlcy5kYXRhW2l0ZW1dLmxpc3QpDQogICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgICBsZXQgY29tcGxldGlvbiA9IHRoaXMuY2hhbmdlVG9SYXRlKHRoaXMudGFza0RldGFpbC5jb3ZlcmFnZSkNCiAgICAgICAgdGhpcy5uYXZiYXJUaXRsZSA9IHRoaXMudGFza0RldGFpbC50YXNrTmFtZQ0KICAgICAgICB0cnkgew0KICAgICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzDQogICAgICAgICAgbGV0IHRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gMzBz5ZCO5Y+W5raIDQogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcikNCiAgICAgICAgICAgIH0sIDMwMDAwKQ0KICAgICAgICAgICAgaWYgKHRoYXQuJHJlZnMubXltYXAuaXNPbkxvYWRlZCgpKSB7DQogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpDQogICAgICAgICAgICAgIHRoYXQuJHJlZnMubXltYXAuYWRkS2V5UG9pbnRzKHRoYXQua2V5RGV0YWlsTGlzdCkNCiAgICAgICAgICAgICAgaWYgKHR5cGUgIT0gJ3JlZnJlc2gnKSB7DQogICAgICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC5hZGRSYW5nZUxpc3QodGhhdC5pbnNwUmFuZ2VMaXN0KQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHsNCiAgICAgICAgICAgICAgICBleHRQYXJhbTogew0KICAgICAgICAgICAgICAgICAgdGFza19pZDogdGhhdC4kcm91dGUucXVlcnkudGFza0lkDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIC8vIHRoYXQuZ2V0RXZlbnRBbGwocGFyYW1zKTsNCiAgICAgICAgICAgICAgLy8g6Zeu6aKY5LiK5oql44CB6K6+5pa957y66Zm35o6l5Y+jDQogICAgICAgICAgICAgIHRoYXQuZ2V0UHJvYmxlbURhdGFMaXN0KHBhcmFtcykNCiAgICAgICAgICAgICAgLy8gbGV0IHJlc2xpbmVzID0gdGhhdC5saW5lcy5jb25jYXQodGhhdC5yZWNvcmREYXRhKTsNCiAgICAgICAgICAgICAgLy8g5Zu+5bGC5Zue5pi+5pa55byP5pS55Y+YDQogICAgICAgICAgICAgIHRoYXQuJHJlZnMubXltYXAuYWRkSW5zcFJlY29yZFRpbGVMaW5lU291cmNlKHRoYXQubGluZXMsIGNvbXBsZXRpb24pDQogICAgICAgICAgICAgIGlmICghdGhhdC5jdXJyZW50UG9zaXRpb24pIHJldHVybg0KICAgICAgICAgICAgICBjb25zdCBwYXJhbSA9IHsNCiAgICAgICAgICAgICAgICAuLi50aGF0LmN1cnJlbnRQb3NpdGlvbiwNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB0aGF0LiRyZWZzLm15bWFwLnNldEluc3BVc2VyUG9zaXRpb24ocGFyYW0pDQogICAgICAgICAgICB9DQogICAgICAgICAgfSwgNTAwKQ0KICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgY29uc29sZS5sb2coZSkNCiAgICAgICAgICBpZiAodGhpcy5pc01hc2spIHsNCiAgICAgICAgICAgIHRoaXMuaXNNYXNrID0gZmFsc2UNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGlmICh0aGlzLmlzTWFzaykgew0KICAgICAgICAgIHRoaXMuaXNNYXNrID0gZmFsc2UNCiAgICAgICAgfQ0KICAgICAgICBUb2FzdCh7DQogICAgICAgICAgbWVzc2FnZTogJ+e9kee7nOeKtuaAgei+g+W3ru+8jOWKoOi9veS7u+WKoeWksei0pScsDQogICAgICAgICAgaWNvbjogJ3dhcm4nLA0KICAgICAgICAgIGR1cmF0aW9uOiAzMDAwLA0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g6I635Y+W5LuOYXBw56uv5Lyg5p2l55qE5pWw5o2uDQogICAgcG9zdEFwcERhdGEoaWQpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsNCiAgICAgICAgLyoqIDIwMjEvOS8yMiDlj5bmtojnvJPlrZjlnKhhcHDnq6/nmoTmlbDmja7kuIrmiqUNCiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhhdC4kYXBpLnBvc3RBY3Rpb24oIi9vcHMtaW5zcGVjdGlvbi9hcGkvaW5zcGVjdGlvblJlY29yZE11bHRpcGxlIiwgdGhhdC5yZWNvcmREYXRhKTsNCiAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZygi5LiK5oql57yT5a2Y5ZyoYXBw55qE5pWw5o2uIik7DQogICAgICAgIH07DQogICAgICAgICovDQogICAgICAgIGlmICh0aGF0LnJlcG9ydEZhaWxUcmFja1BvaW50cy5sZW5ndGggPD0gMCkgew0KICAgICAgICAgIHJlc29sdmUoKQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHJlc3VsdDIgPSBhd2FpdCBpbnNwZWN0aW9uVHJhY2tNdWx0aXBsZSh0aGF0LnJlcG9ydEZhaWxUcmFja1BvaW50cykNCiAgICAgICAgaWYgKHJlc3VsdDIgJiYgcmVzdWx0Mi5zdGF0dXMpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZygn5LiK5oql57yT5a2Y5ZyoYXBw56uv55qE6L2o6L+554K55pWw5o2uJykNCiAgICAgICAgICBsZXQgcmVzZXRUcmFja1BvaW50cyA9IFtdDQogICAgICAgICAgdGhhdC5yZXBvcnRGYWlsVHJhY2tQb2ludHMgPSByZXNldFRyYWNrUG9pbnRzDQogICAgICAgICAgdW5pV2ViVmlldy5wb3N0TWVzc2FnZSh7DQogICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgIGFjdGlvbjogJ3NhdmVUcmFja1BvaW50cycsDQogICAgICAgICAgICAgIHRyYWNrRGF0YTogSlNPTi5zdHJpbmdpZnkocmVzZXRUcmFja1BvaW50cyksDQogICAgICAgICAgICAgIHRhc2tJZDogaWQsDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgICAgcmVzb2x2ZSgpDQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g6I635Y+W5beh5qOA5LqL5Lu2DQogICAgYXN5bmMgZ2V0RXZlbnRBbGwocGFyYW1zKSB7DQogICAgICBjb25zdCByZXMgPSBhd2FpdCBpbnNwZWN0aW9uRXZlbnRBbGwocGFyYW1zKQ0KICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgIGxldCBmZWF0dXJlcyA9IFtdDQogICAgICAgIHJlcy5kYXRhLmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICBpZiAoaXRlbS5ldmVudEl0ZW1UZXh0KSB7DQogICAgICAgICAgICBjb25zdCBnZW9tID0gSlNPTi5wYXJzZShpdGVtLmV2ZW50SXRlbVRleHQpDQogICAgICAgICAgICBsZXQgZmVhdHVyZSA9IHsNCiAgICAgICAgICAgICAgZ2VvbWV0cnk6IGdlb20udHlwZSA9PT0gJ0ZlYXR1cmUnID8gZ2VvbS5nZW9tZXRyeSA6IGdlb20sDQogICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy4kc2V0KGZlYXR1cmUsICdnZW9tZXRyeScsIHRoaXMuY29tcHV0ZUNlbnRlcihmZWF0dXJlLmdlb21ldHJ5KSkNCiAgICAgICAgICAgIHRoaXMuJHNldChmZWF0dXJlLCAnaWQnLCBpdGVtLmlkKQ0KICAgICAgICAgICAgdGhpcy4kc2V0KGZlYXR1cmUucHJvcGVydGllcywgJ2V2ZW50VHlwZScsIGl0ZW0uZXZlbnRUeXBlKQ0KICAgICAgICAgICAgLy8gdGhpcy4kc2V0KGZlYXR1cmUsICJldmVudFR5cGUiLCBpdGVtLmV2ZW50VHlwZSk7DQogICAgICAgICAgICAvLyB0aGlzLiRyZWZzLm15bWFwLmFkZEluc3BFdmVudE1hcmtlcihmZWF0dXJlKTsNCiAgICAgICAgICAgIGZlYXR1cmVzLnB1c2goZmVhdHVyZSkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIHRoaXMuJHJlZnMubXltYXAuYWRkSW5zcEV2ZW50TGF5ZXIoZmVhdHVyZXMpDQogICAgICB9DQogICAgfSwNCiAgICAvLyDojrflj5bkuovku7bnsbvlnosNCiAgICBnZXRFdmVudFR5cGVMaXN0KCkgew0KICAgICAgZ2V0RXZlbnRUeXBlTGlzdCgpDQogICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICB0aGlzLmV2ZW50VHlwZUxpc3QgPSByZXMuZGF0YS5zb25zLm1hcCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0uY29kZSwNCiAgICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubmFtZSwNCiAgICAgICAgICAgICAgY2hpbGRyZW46IGl0ZW0uc29ucy5tYXAoKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0uY29kZSwNCiAgICAgICAgICAgICAgICAgIGxhYmVsOiBpdGVtLm5hbWUsDQogICAgICAgICAgICAgICAgICBjaGlsZHJlbjogaXRlbS5zb25zLm1hcCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtLmNvZGUsDQogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSksDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKCkgPT4gew0KICAgICAgICAgIFRvYXN0KHsNCiAgICAgICAgICAgIG1lc3NhZ2U6ICflrZflhbjliqDovb3lpLHotKUnLA0KICAgICAgICAgIH0pDQogICAgICAgIH0pDQogICAgfSwNCiAgICAvLyDova7or6IgY3VycmVudFBvc2l0aW9u77yM57uY5Yi26L2o6L+557q/DQogICAgcG9sbGluZygpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgaWYgKHRoYXQucG9sbGluZ0ZsYWcpIHsNCiAgICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAucmVxdWVzdExvY2F0aW9ucygNCiAgICAgICAgICBbJzUnLCAnMScsICcxMCcsICczMCcsICcwJywgdHJ1ZV0sDQogICAgICAgICAgKHJlcykgPT4gew0KICAgICAgICAgICAgdGhhdC5jdXJyZW50UG9zaXRpb24gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcykpDQogICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbiA9IE9iamVjdC5hc3NpZ24odGhhdC5jdXJyZW50UG9zaXRpb24sIHsNCiAgICAgICAgICAgICAgZGlyZWN0aW9uOiAwDQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgaWYgKCF0aGF0LmN1cnJlbnRQb3NpdGlvbikgew0KICAgICAgICAgICAgICBUb2FzdCh7DQogICAgICAgICAgICAgICAgbWVzc2FnZTogJ+W9k+WJjUdQU+S/oeWPt+W8sScsDQogICAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDANCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIHRoYXQudHJhY2tQb2ludExpc3QubGVuZ3RoICE9IDAgJiYNCiAgICAgICAgICAgICAgdGhhdC50cmFja1BvaW50TGlzdFt0aGF0LnRyYWNrUG9pbnRMaXN0Lmxlbmd0aCAtIDFdWzBdICE9DQogICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlICYmDQogICAgICAgICAgICAgIHRoYXQudHJhY2tQb2ludExpc3RbdGhhdC50cmFja1BvaW50TGlzdC5sZW5ndGggLSAxXVsxXSAhPQ0KICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgLy8g5paw5LiA5qyh6L2u6K+i55qE5b2T5YmN5pe26Ze0DQogICAgICAgICAgICAgIGxldCBkYXRlX25vdyA9IGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJykNCiAgICAgICAgICAgICAgLy8g5LiK5qyh5pyA5ZCO55qE54K55L2NDQogICAgICAgICAgICAgIGxldCBsYXN0UG9pbnQgPSB0aGF0LnRyYWNrUG9pbnRMaXN0W3RoYXQudHJhY2tQb2ludExpc3QubGVuZ3RoIC0gMV0NCiAgICAgICAgICAgICAgLy8g5b2T5YmN54K55L2NDQogICAgICAgICAgICAgIGxldCBjdXJyZW50UG9pbnQgPSBbdGhhdC5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlLCB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZV0NCiAgICAgICAgICAgICAgbGV0IGRpc3RhbmNlID0gKE51bWJlcih0aGF0LkdldERpc3RhbmNlKGxhc3RQb2ludCwgY3VycmVudFBvaW50KSkpICogMTAwMA0KICAgICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRMaXN0LnB1c2goWw0KICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwNCiAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZQ0KICAgICAgICAgICAgICBdKQ0KICAgICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5wdXNoKGRhdGVfbm93KQ0KICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGF0LnRyYWNrUG9pbnRMaXN0LCB0aGlzLnRyYWNrUG9pbnRUaW1lTGlzdCkNCg0KICAgICAgICAgICAgICAvLyDmnoTpgKDkuLTml7bnur/lr7nosaENCiAgICAgICAgICAgICAgbGV0IGpzb25MaW5lID0gew0KICAgICAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJywNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSwNCiAgICAgICAgICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgICAgICAgICAgdHlwZTogJ0xpbmVTdHJpbmcnLA0KICAgICAgICAgICAgICAgICAgY29vcmRpbmF0ZXM6IHRoYXQudHJhY2tQb2ludExpc3QsDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBjb29yZCA9IFtwYXJzZUZsb2F0KHRoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSksIHBhcnNlRmxvYXQodGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGUpXTsNCiAgICAgICAgICAgICAgY29uc3QgcG9pbnQgPSB0dXJmLnBvaW50KGNvb3JkKTsNCiAgICAgICAgICAgICAgbWFwT2JqLm1hcEluc3RhbmNlLnNldFNvdXJjZURhdGEoImluc3BVc2VyIiwgew0KICAgICAgICAgICAgICAgIHR5cGU6ICJGZWF0dXJlQ29sbGVjdGlvbiIsDQogICAgICAgICAgICAgICAgZmVhdHVyZXM6IFtwb2ludF0NCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgbGV0IGpzb25MaW5lRmVhdHVyZUNvbGxlY3Rpb24gPSB7DQogICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgICAgICBmZWF0dXJlczogW2pzb25MaW5lXSwNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKSkgew0KICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93Jykuc2V0RGF0YShqc29uTGluZUZlYXR1cmVDb2xsZWN0aW9uKQ0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkU291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93Jywgew0KICAgICAgICAgICAgICAgICAgdHlwZTogJ2dlb2pzb24nLA0KICAgICAgICAgICAgICAgICAgZGF0YToganNvbkxpbmVGZWF0dXJlQ29sbGVjdGlvbiwNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChtYXBPYmoubWFwLmdldExheWVyKCd0cmFja0xpbmVMYXllcl9ub3cnKSkgew0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkTGF5ZXIoew0KICAgICAgICAgICAgICAgICAgaWQ6ICd0cmFja0xpbmVMYXllcl9ub3cnLA0KICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpbmUnLA0KICAgICAgICAgICAgICAgICAgc291cmNlOiAndHJhY2tMaW5lU291cmNlX25vdycsDQogICAgICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2xpbmUtY2FwJzogJ3JvdW5kJywNCiAgICAgICAgICAgICAgICAgICAgJ2xpbmUtam9pbic6ICdyb3VuZCcsDQogICAgICAgICAgICAgICAgICAgICdsaW5lLXNvcnQta2V5JzogMSwNCiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICBwYWludDogew0KICAgICAgICAgICAgICAgICAgICAnbGluZS1jb2xvcic6ICcjYWRkZDUyJywNCiAgICAgICAgICAgICAgICAgICAgJ2xpbmUtd2lkdGgnOiA1LA0KICAgICAgICAgICAgICAgICAgICAnbGluZS1vcGFjaXR5JzogMC44LA0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9LCAnaW5zcFVzZXJMYXllcicpDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbGV0IHBhcmFtID0gew0KICAgICAgICAgICAgICAgIC4uLnRoYXQuY3VycmVudFBvc2l0aW9uLA0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIC8vIHRoYXQuJHJlZnMubXltYXAuc2V0SW5zcFVzZXJQb3NpdGlvbihwYXJhbSkNCiAgICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ3RyYWNrTGluZUxheWVyX2Fycm93JykpIHsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmFkZExheWVyKHsNCiAgICAgICAgICAgICAgICAgIGlkOiAndHJhY2tMaW5lTGF5ZXJfYXJyb3cnLA0KICAgICAgICAgICAgICAgICAgdHlwZTogJ3N5bWJvbCcsDQogICAgICAgICAgICAgICAgICBzb3VyY2U6ICd0cmFja0xpbmVTb3VyY2Vfbm93JywNCiAgICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXBsYWNlbWVudCc6ICdsaW5lJywNCiAgICAgICAgICAgICAgICAgICAgJ3N5bWJvbC1zcGFjaW5nJzogMjAsDQogICAgICAgICAgICAgICAgICAgICdpY29uLWltYWdlJzogJ2Fycm93SWNvbicsDQogICAgICAgICAgICAgICAgICAgICdpY29uLXNpemUnOiAwLjUsDQogICAgICAgICAgICAgICAgICAgICdpY29uLWFsbG93LW92ZXJsYXAnOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXNvcnQta2V5JzogMywNCiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSwgJ2luc3BVc2VyTGF5ZXInKQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIC8vIOaUueWPmOeuoee6v+minOiJsg0KICAgICAgICAgICAgICB0aGF0LiRyZWZzLm15bWFwLmNoYW5nZUluc3BMaW5lU291cmNlQnlTcGVlZCh0aGF0LmN1cnJlbnRQb3NpdGlvbikNCiAgICAgICAgICAgICAgLy8g6K6w5b2V6L+H56iL54K5DQogICAgICAgICAgICAgIHRoYXQucG9zdFRyYWNrRGF0YV9Qb2ludCgNCiAgICAgICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRMaXN0W3RoYXQudHJhY2tQb2ludExpc3QubGVuZ3RoIC0gMV0sDQogICAgICAgICAgICAgICAgdGhhdC50cmFja1BvaW50VGltZUxpc3RbdGhhdC50cmFja1BvaW50VGltZUxpc3QubGVuZ3RoIC0gMV0sDQogICAgICAgICAgICAgICAgZGlzdGFuY2UNCiAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgVG9hc3Qoew0KICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICflvZPliY1HUFPkv6Hlj7flvLEs5peg5rOV6I635Y+W5pyA5paw5a6a5L2N5pWw5o2uJywNCiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTUwMA0KICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0sDQogICAgICAgICAgKGVycikgPT4gew0KICAgICAgICAgICAgVG9hc3Qoew0KICAgICAgICAgICAgICBtZXNzYWdlOiAnZXJyJyArIGVyciwNCiAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgKQ0KICAgICAgICAvLyB0aGlzLnVwbG9hZEluc3BSb3V0ZSgpDQogICAgICB9DQogICAgfSwNCiAgICAvLyDnu5jliLbotoXpgJ/nur/mrrUNCiAgICBkcmF3T3ZlclNwZWVkVHJhY2sobGFzdFBvaW50LCBjdXJyZW50UG9pbnQsIGdhcFRpbWUgPSAzKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIGlmICgodGhhdC5HZXREaXN0YW5jZShsYXN0UG9pbnQsIGN1cnJlbnRQb2ludCkgKiAxMDAwKSAvIGdhcFRpbWUgPiAxMCkgew0KICAgICAgICB0aGF0Lm92ZXJTcGVlZFRyYWNrTGluZUxpc3QucHVzaChbbGFzdFBvaW50LCBjdXJyZW50UG9pbnRdKQ0KICAgICAgICBsZXQgb3ZlclNwZWVkVHJhY2tMaW5lQ29sbGVjdGlvbiA9IHsNCiAgICAgICAgICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgcHJvcGVydGllczoge30sDQogICAgICAgICAgZ2VvbWV0cnk6IHsNCiAgICAgICAgICAgIHR5cGU6ICdNdWx0aUxpbmVTdHJpbmcnLA0KICAgICAgICAgICAgY29vcmRpbmF0ZXM6IHRoYXQub3ZlclNwZWVkVHJhY2tMaW5lTGlzdCwNCiAgICAgICAgICB9LA0KICAgICAgICB9DQogICAgICAgIGxldCBvdmVyU3BlZWRUcmFja0xpbmVGZWF0dXJlQ29sbGVjdGlvbiA9IHsNCiAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgIGZlYXR1cmVzOiBbb3ZlclNwZWVkVHJhY2tMaW5lQ29sbGVjdGlvbl0sDQogICAgICAgIH0NCiAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfb3ZlclNwZWVkJykpIHsNCiAgICAgICAgICBtYXBPYmoubWFwDQogICAgICAgICAgICAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfb3ZlclNwZWVkJykNCiAgICAgICAgICAgIC5zZXREYXRhKG92ZXJTcGVlZFRyYWNrTGluZUZlYXR1cmVDb2xsZWN0aW9uKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1hcE9iai5tYXAuYWRkU291cmNlKCd0cmFja0xpbmVTb3VyY2Vfb3ZlclNwZWVkJywgew0KICAgICAgICAgICAgdHlwZTogJ2dlb2pzb24nLA0KICAgICAgICAgICAgZGF0YTogb3ZlclNwZWVkVHJhY2tMaW5lRmVhdHVyZUNvbGxlY3Rpb24sDQogICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRMYXllcigndHJhY2tMaW5lTGF5ZXJfb3ZlclNwZWVkJykpIHsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtYXBPYmoubWFwLmFkZExheWVyKHsNCiAgICAgICAgICAgIGlkOiAndHJhY2tMaW5lTGF5ZXJfb3ZlclNwZWVkJywNCiAgICAgICAgICAgIHR5cGU6ICdsaW5lJywNCiAgICAgICAgICAgIHNvdXJjZTogJ3RyYWNrTGluZVNvdXJjZV9vdmVyU3BlZWQnLA0KICAgICAgICAgICAgbGF5b3V0OiB7DQogICAgICAgICAgICAgICdsaW5lLWNhcCc6ICdyb3VuZCcsDQogICAgICAgICAgICAgICdsaW5lLWpvaW4nOiAncm91bmQnLA0KICAgICAgICAgICAgICAnbGluZS1zb3J0LWtleSc6IDIsDQogICAgICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJywNCiAgICAgICAgICAgICAgLy8gdmlzaWJpbGl0eTogIm5vbmUiDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcGFpbnQ6IHsNCiAgICAgICAgICAgICAgJ2xpbmUtY29sb3InOiAnI0ZGQjEzQicsDQogICAgICAgICAgICAgICdsaW5lLXdpZHRoJzogNSwNCiAgICAgICAgICAgICAgJ2xpbmUtb3BhY2l0eSc6IDEsDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOe7mOWItui1t+Wni+eCuQ0KICAgIGRyYXdTdGFydFBvaW50KCkgew0KICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgew0KICAgICAgICB5dWFuY2h1LmxvY2F0aW9uQU1hcC5yZXF1ZXN0U2luZ2xlTG9jYXRpb24oDQogICAgICAgICAgWycxJ10sDQogICAgICAgICAgKHJlcykgPT4gew0KICAgICAgICAgICAgdGhhdC5jdXJyZW50UG9zaXRpb24gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcykpDQogICAgICAgICAgICBjb25zdCBwYXJhbSA9IHsNCiAgICAgICAgICAgICAgLi4udGhhdC5jdXJyZW50UG9zaXRpb24sDQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGF0LiRyZWZzLm15bWFwLnNldEluc3BVc2VyUG9zaXRpb24ocGFyYW0pDQogICAgICAgICAgfSwNCiAgICAgICAgICAoZXJyKSA9PiB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyPScsIGVycikNCiAgICAgICAgICB9DQogICAgICAgICkNCiAgICAgICAgaWYgKHRoYXQuY3VycmVudFBvc2l0aW9uICE9IG51bGwpIHsNCiAgICAgICAgICAvLyDkuLTml7borrDlvZXotbflp4vngrnlkozotbflp4vml7bpl7QNCiAgICAgICAgICBsZXQgcG9zaXRpb24gPSB0aGF0LmN1cnJlbnRQb3NpdGlvbg0KICAgICAgICAgIGxldCB0ZW1wUG9pbnRMaXN0ID0gW10NCiAgICAgICAgICB0ZW1wUG9pbnRMaXN0LnB1c2goW3Bvc2l0aW9uLmxvbmdpdHVkZSwgcG9zaXRpb24ubGF0aXR1ZGVdKQ0KICAgICAgICAgIGxldCBkYXRlX25vdyA9IGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJykNCiAgICAgICAgICAvLyDov5vooYznrKzkuIDkuKrngrnkvY3kuIrmiqUNCiAgICAgICAgICBsZXQgcG9pbnREYXRhID0gdGVtcFBvaW50TGlzdFt0ZW1wUG9pbnRMaXN0Lmxlbmd0aCAtIDFdDQoNCiAgICAgICAgICAvLyDnu4/nuqzluqbmlbDlrZfljJYNCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCA8IHBvaW50RGF0YS5sZW5ndGg7IHArKykgew0KICAgICAgICAgICAgcG9pbnREYXRhW3BdID0gTnVtYmVyKHBvaW50RGF0YVtwXSkNCiAgICAgICAgICB9DQogICAgICAgICAgbGV0IHJlY29yZERhdGEgPSBbXQ0KICAgICAgICAgIHJlY29yZERhdGEucHVzaCh7DQogICAgICAgICAgICB0YXNrSWQ6IHRoYXQudGFza0RldGFpbC5pZCwgLy8g5Lu75YqhaWQNCiAgICAgICAgICAgIGxvbmdpdHVkZTogcG9pbnREYXRhWzBdLA0KICAgICAgICAgICAgbGF0aXR1ZGU6IHBvaW50RGF0YVsxXSwNCiAgICAgICAgICAgIGluc3BUaW1lOiBkYXRlX25vdywNCiAgICAgICAgICAgIGRpc3RhbmNlOiAwLCAvLyDnrKzkuIDkuKrngrnot53nprvkuLowDQogICAgICAgICAgICBpbnNwRGF0ZTogZGF0ZV9ub3csDQogICAgICAgICAgICBpbnNwZWN0b3I6IHRoYXQudXNlckluZm8udXNlckZ1bGxOYW1lLA0KICAgICAgICAgIH0pDQogICAgICAgICAgLy8g5L2/55So5LiK5oql54K55L2N5L2c5Li66LW354K5DQogICAgICAgICAgdGhhdC50cmFja1BvaW50TGlzdC5wdXNoKFtwb3NpdGlvbi5sb25naXR1ZGUsIHBvc2l0aW9uLmxhdGl0dWRlXSkNCiAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5wdXNoKGRhdGVfbm93KQ0KICAgICAgICAgIC8vIGxldCBqc29uUG9pbnQgPSB7DQogICAgICAgICAgLy8gICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgLy8gICBwcm9wZXJ0aWVzOiB7fSwNCiAgICAgICAgICAvLyAgIGdlb21ldHJ5OiB7DQogICAgICAgICAgLy8gICAgIHR5cGU6ICdQb2ludCcsDQogICAgICAgICAgLy8gICAgIGNvb3JkaW5hdGVzOiBbcG9zaXRpb24ubG9uZ2l0dWRlLCBwb3NpdGlvbi5sYXRpdHVkZV0sDQogICAgICAgICAgLy8gICB9LA0KICAgICAgICAgIC8vIH0NCiAgICAgICAgICAvLyBsZXQganNvblBvaW50RmVhdHVyZUNvbGxlY3Rpb24gPSB7DQogICAgICAgICAgLy8gICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgIC8vICAgZmVhdHVyZXM6IFtqc29uUG9pbnRdLA0KICAgICAgICAgIC8vIH0NCiAgICAgICAgICAvLyBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgICAvLyAgIG1hcE9iai5tYXANCiAgICAgICAgICAvLyAgICAgLmdldFNvdXJjZSgnc3RhcnRQb2ludFNvdXJjZV9ub3cnKQ0KICAgICAgICAgIC8vICAgICAuc2V0RGF0YShqc29uUG9pbnRGZWF0dXJlQ29sbGVjdGlvbikNCiAgICAgICAgICAvLyB9IGVsc2Ugew0KICAgICAgICAgIC8vICAgbWFwT2JqLm1hcC5hZGRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93Jywgew0KICAgICAgICAgIC8vICAgICB0eXBlOiAnZ2VvanNvbicsDQogICAgICAgICAgLy8gICAgIGRhdGE6IGpzb25Qb2ludEZlYXR1cmVDb2xsZWN0aW9uLA0KICAgICAgICAgIC8vICAgfSkNCiAgICAgICAgICAvLyB9DQogICAgICAgICAgLy8gaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ3N0YXJ0UG9pbnRMYXllcl9ub3cnKSkgew0KICAgICAgICAgIC8vIH0gZWxzZSB7DQogICAgICAgICAgLy8gICBtYXBPYmoubWFwLmFkZExheWVyKHsNCiAgICAgICAgICAvLyAgICAgaWQ6ICdzdGFydFBvaW50TGF5ZXJfbm93JywNCiAgICAgICAgICAvLyAgICAgdHlwZTogJ2NpcmNsZScsDQogICAgICAgICAgLy8gICAgIHNvdXJjZTogJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93JywNCiAgICAgICAgICAvLyAgICAgbGF5b3V0OiB7DQogICAgICAgICAgLy8gICAgICAgJ2NpcmNsZS1zb3J0LWtleSc6IDUsDQogICAgICAgICAgLy8gICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgIC8vICAgICAgIC8vIHZpc2liaWxpdHk6ICJub25lIg0KICAgICAgICAgIC8vICAgICB9LA0KICAgICAgICAgIC8vICAgICBwYWludDogew0KICAgICAgICAgIC8vICAgICAgICdjaXJjbGUtcmFkaXVzJzogMywNCiAgICAgICAgICAvLyAgICAgICAnY2lyY2xlLXN0cm9rZS13aWR0aCc6IDUsDQogICAgICAgICAgLy8gICAgICAgJ2NpcmNsZS1zdHJva2UtY29sb3InOiAnIzJBODNFNicsDQogICAgICAgICAgLy8gICAgICAgJ2NpcmNsZS1jb2xvcic6ICd3aGl0ZScsDQogICAgICAgICAgLy8gICAgIH0sDQogICAgICAgICAgLy8gICB9KQ0KICAgICAgICAgIC8vIH0NCiAgICAgICAgICAvLyAvLyBsYWJlbA0KICAgICAgICAgIC8vIGlmIChtYXBPYmoubWFwLmdldExheWVyKCdzdGFydFBvaW50X2xhYmVsJykpIHsNCiAgICAgICAgICAvLyB9IGVsc2Ugew0KICAgICAgICAgIC8vICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgICAgLy8gICAgIGlkOiAnc3RhcnRQb2ludF9sYWJlbCcsDQogICAgICAgICAgLy8gICAgIHR5cGU6ICdzeW1ib2wnLA0KICAgICAgICAgIC8vICAgICBzb3VyY2U6ICdzdGFydFBvaW50U291cmNlX25vdycsDQogICAgICAgICAgLy8gICAgIGxheW91dDogew0KICAgICAgICAgIC8vICAgICAgICdzeW1ib2wtcGxhY2VtZW50JzogJ3BvaW50JywNCiAgICAgICAgICAvLyAgICAgICAnaWNvbi1pbWFnZSc6ICdzdGFydF9wb2ludCcsDQogICAgICAgICAgLy8gICAgICAgJ2ljb24tc2l6ZSc6IDAuNiwNCiAgICAgICAgICAvLyAgICAgICAnaWNvbi1vZmZzZXQnOiBbMCwgLTM1XSwNCiAgICAgICAgICAvLyAgICAgICAnaWNvbi1hbGxvdy1vdmVybGFwJzogdHJ1ZSwNCiAgICAgICAgICAvLyAgICAgICAnc3ltYm9sLXNvcnQta2V5JzogMiwNCiAgICAgICAgICAvLyAgICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZScsDQogICAgICAgICAgLy8gICAgICAgLy8gdmlzaWJpbGl0eTogIm5vbmUiDQogICAgICAgICAgLy8gICAgIH0sDQogICAgICAgICAgLy8gICB9KQ0KICAgICAgICAgIC8vIH0NCiAgICAgICAgICAvLyByZXNvbHZlKHRydWUpDQogICAgICAgICAgYXdhaXQgYXBpDQogICAgICAgICAgICAuaW5zcGVjdGlvblRyYWNrKHJlY29yZERhdGEpDQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgICAgIGlmIChyZXMgJiYgcmVzLnN0YXR1cykgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfovajov7nlrZjlgqjmiJDlip8nKQ0KICAgICAgICAgICAgICAgIC8vIOS9v+eUqOS4iuaKpeeCueS9jeS9nOS4uui1t+eCuQ0KICAgICAgICAgICAgICAgIC8vIHRoYXQudHJhY2tQb2ludExpc3QucHVzaChbDQogICAgICAgICAgICAgICAgLy8gICBwb3NpdGlvbi5sb25naXR1ZGUsDQogICAgICAgICAgICAgICAgLy8gICBwb3NpdGlvbi5sYXRpdHVkZQ0KICAgICAgICAgICAgICAgIC8vIF0pOw0KICAgICAgICAgICAgICAgIC8vIHRoYXQudHJhY2tQb2ludFRpbWVMaXN0LnB1c2goZGF0ZV9ub3cpOw0KICAgICAgICAgICAgICAgIGxldCBqc29uUG9pbnQgPSB7DQogICAgICAgICAgICAgICAgICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSwNCiAgICAgICAgICAgICAgICAgIGdlb21ldHJ5OiB7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQb2ludCcsDQogICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBbcG9zaXRpb24ubG9uZ2l0dWRlLCBwb3NpdGlvbi5sYXRpdHVkZV0sDQogICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsZXQganNvblBvaW50RmVhdHVyZUNvbGxlY3Rpb24gPSB7DQogICAgICAgICAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgICAgICAgICAgZmVhdHVyZXM6IFtqc29uUG9pbnRdLA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCdzdGFydFBvaW50U291cmNlX25vdycpLnNldERhdGEoanNvblBvaW50RmVhdHVyZUNvbGxlY3Rpb24pDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkU291cmNlKCdzdGFydFBvaW50U291cmNlX25vdycsIHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2dlb2pzb24nLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBqc29uUG9pbnRGZWF0dXJlQ29sbGVjdGlvbiwNCiAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXBPYmoubWFwLmdldExheWVyKCdzdGFydFBvaW50TGF5ZXJfbm93JykpIHsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgICAgICAgICAgICAgIGlkOiAnc3RhcnRQb2ludExheWVyX25vdycsDQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaXJjbGUnLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2U6ICdzdGFydFBvaW50U291cmNlX25vdycsDQogICAgICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgICAgICdjaXJjbGUtc29ydC1rZXknOiA1LA0KICAgICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJywNCiAgICAgICAgICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgcGFpbnQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAnY2lyY2xlLXJhZGl1cyc6IDMsDQogICAgICAgICAgICAgICAgICAgICAgJ2NpcmNsZS1zdHJva2Utd2lkdGgnOiA1LA0KICAgICAgICAgICAgICAgICAgICAgICdjaXJjbGUtc3Ryb2tlLWNvbG9yJzogJyMyQTgzRTYnLA0KICAgICAgICAgICAgICAgICAgICAgICdjaXJjbGUtY29sb3InOiAnd2hpdGUnLA0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgfSwgJ2luc3BVc2VyTGF5ZXInKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBsYWJlbA0KICAgICAgICAgICAgICAgIGlmIChtYXBPYmoubWFwLmdldExheWVyKCdzdGFydFBvaW50X2xhYmVsJykpIHsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgICAgICAgICAgICAgIGlkOiAnc3RhcnRQb2ludF9sYWJlbCcsDQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzeW1ib2wnLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2U6ICdzdGFydFBvaW50U291cmNlX25vdycsDQogICAgICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgICAgICdzeW1ib2wtcGxhY2VtZW50JzogJ3BvaW50JywNCiAgICAgICAgICAgICAgICAgICAgICAnaWNvbi1pbWFnZSc6ICdzdGFydF9wb2ludCcsDQogICAgICAgICAgICAgICAgICAgICAgJ2ljb24tc2l6ZSc6IDAuNiwNCiAgICAgICAgICAgICAgICAgICAgICAnaWNvbi1vZmZzZXQnOiBbMCwgLTM1XSwNCiAgICAgICAgICAgICAgICAgICAgICAnaWNvbi1hbGxvdy1vdmVybGFwJzogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXNvcnQta2V5JzogMiwNCiAgICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZScsDQogICAgICAgICAgICAgICAgICAgICAgLy8gdmlzaWJpbGl0eTogIm5vbmUiDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIui9qOi/ueWtmOWCqOWksei0pSIpOw0KICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygi6L2o6L+55a2Y5YKo5aSx6LSlZXJyIiwgZXJyKTsNCiAgICAgICAgICAgICAgcmVqZWN0KGVycikNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyDnu5jliLbnu4jmraLngrkNCiAgICBhc3luYyBkcmF3RW5kUG9pbnQodHlwZSA9IG51bGwpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAuc3RvcFJlcXVlc3RMb2NhdGlvbnMoKQ0KICAgICAgaWYgKHRoYXQuY3VycmVudFBvc2l0aW9uICE9IG51bGwpIHsNCiAgICAgICAgbGV0IGxhc3RQb2ludCA9IHRoYXQudHJhY2tQb2ludExpc3RbdGhhdC50cmFja1BvaW50TGlzdC5sZW5ndGggLSAxXQ0KICAgICAgICBsZXQgY3VycmVudFBvaW50ID0gW3RoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwgdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGVdDQogICAgICAgIGxldCBkaXN0YW5jZSA9IChOdW1iZXIodGhhdC5HZXREaXN0YW5jZShsYXN0UG9pbnQsIGN1cnJlbnRQb2ludCkpKSAqIDEwMDANCiAgICAgICAgdGhhdC50cmFja1BvaW50TGlzdC5wdXNoKFt0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUsIHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlXSkNCiAgICAgICAgbGV0IGRhdGVfbm93ID0gZGF5anMoKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKQ0KICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5wdXNoKGRhdGVfbm93KQ0KICAgICAgICBsZXQganNvblBvaW50ID0gew0KICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJywNCiAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSwNCiAgICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgICAgdHlwZTogJ1BvaW50JywNCiAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBbdGhhdC5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlLCB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZV0sDQogICAgICAgICAgfSwNCiAgICAgICAgfQ0KICAgICAgICBsZXQganNvblBvaW50RmVhdHVyZUNvbGxlY3Rpb24gPSB7DQogICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICBmZWF0dXJlczogW2pzb25Qb2ludF0sDQogICAgICAgIH0NCiAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCdlbmRQb2ludFNvdXJjZV9ub3cnKSkgew0KICAgICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCdlbmRQb2ludFNvdXJjZV9ub3cnKS5zZXREYXRhKGpzb25Qb2ludEZlYXR1cmVDb2xsZWN0aW9uKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1hcE9iai5tYXAuYWRkU291cmNlKCdlbmRQb2ludFNvdXJjZV9ub3cnLCB7DQogICAgICAgICAgICB0eXBlOiAnZ2VvanNvbicsDQogICAgICAgICAgICBkYXRhOiBqc29uUG9pbnRGZWF0dXJlQ29sbGVjdGlvbiwNCiAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICAgIGlmIChtYXBPYmoubWFwLmdldExheWVyKCdlbmRQb2ludExheWVyX25vdycpKSB7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgICAgICBpZDogJ2VuZFBvaW50TGF5ZXJfbm93JywNCiAgICAgICAgICAgIHR5cGU6ICdjaXJjbGUnLA0KICAgICAgICAgICAgc291cmNlOiAnZW5kUG9pbnRTb3VyY2Vfbm93JywNCiAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAnY2lyY2xlLXNvcnQta2V5JzogNSwNCiAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBwYWludDogew0KICAgICAgICAgICAgICAnY2lyY2xlLXJhZGl1cyc6IDMsDQogICAgICAgICAgICAgICdjaXJjbGUtc3Ryb2tlLXdpZHRoJzogNSwNCiAgICAgICAgICAgICAgJ2NpcmNsZS1zdHJva2UtY29sb3InOiAnI2FkZGQ1MicsDQogICAgICAgICAgICAgICdjaXJjbGUtY29sb3InOiAnd2hpdGUnLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LCAnaW5zcFVzZXJMYXllcicpDQogICAgICAgIH0NCg0KICAgICAgICAvLyDooaXlhYV0cmFja2xpbmUNCiAgICAgICAgbGV0IGpzb25MaW5lID0gew0KICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJywNCiAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSwNCiAgICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgICAgdHlwZTogJ0xpbmVTdHJpbmcnLA0KICAgICAgICAgICAgY29vcmRpbmF0ZXM6IHRoYXQudHJhY2tQb2ludExpc3QsDQogICAgICAgICAgfSwNCiAgICAgICAgfQ0KICAgICAgICBsZXQganNvbkxpbmVGZWF0dXJlQ29sbGVjdGlvbiA9IHsNCiAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgIGZlYXR1cmVzOiBbanNvbkxpbmVdLA0KICAgICAgICB9DQogICAgICAgIGlmIChtYXBPYmoubWFwLmdldFNvdXJjZSgndHJhY2tMaW5lU291cmNlX25vdycpKSB7DQogICAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKS5zZXREYXRhKGpzb25MaW5lRmVhdHVyZUNvbGxlY3Rpb24pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWFwT2JqLm1hcC5hZGRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnLCB7DQogICAgICAgICAgICB0eXBlOiAnZ2VvanNvbicsDQogICAgICAgICAgICBkYXRhOiBqc29uTGluZUZlYXR1cmVDb2xsZWN0aW9uLA0KICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ3RyYWNrTGluZUxheWVyX25vdycpKSB7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgICAgICBpZDogJ3RyYWNrTGluZUxheWVyX25vdycsDQogICAgICAgICAgICB0eXBlOiAnbGluZScsDQogICAgICAgICAgICBzb3VyY2U6ICd0cmFja0xpbmVTb3VyY2Vfbm93JywNCiAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAnbGluZS1jYXAnOiAncm91bmQnLA0KICAgICAgICAgICAgICAnbGluZS1qb2luJzogJ3JvdW5kJywNCiAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBwYWludDogew0KICAgICAgICAgICAgICAnbGluZS1jb2xvcic6ICcjYWRkZDUyJywNCiAgICAgICAgICAgICAgJ2xpbmUtd2lkdGgnOiA1LA0KICAgICAgICAgICAgICAnbGluZS1vcGFjaXR5JzogMC44LA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICB9LCAnaW5zcFVzZXJMYXllcicpDQogICAgICAgIH0NCiAgICAgICAgLy8gbGFiZWwNCiAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ2VuZFBvaW50X2xhYmVsJykpIHsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtYXBPYmoubWFwLmFkZExheWVyKHsNCiAgICAgICAgICAgIGlkOiAnZW5kUG9pbnRfbGFiZWwnLA0KICAgICAgICAgICAgdHlwZTogJ3N5bWJvbCcsDQogICAgICAgICAgICBzb3VyY2U6ICdlbmRQb2ludFNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgbGF5b3V0OiB7DQogICAgICAgICAgICAgICdzeW1ib2wtcGxhY2VtZW50JzogJ3BvaW50JywNCiAgICAgICAgICAgICAgJ2ljb24taW1hZ2UnOiAnZW5kX3BvaW50JywNCiAgICAgICAgICAgICAgJ2ljb24tc2l6ZSc6IDAuNiwNCiAgICAgICAgICAgICAgJ2ljb24tb2Zmc2V0JzogWzAsIC0zNV0sDQogICAgICAgICAgICAgICdpY29uLWFsbG93LW92ZXJsYXAnOiB0cnVlLA0KICAgICAgICAgICAgICAnc3ltYm9sLXNvcnQta2V5JzogMiwNCiAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAvLyB2aXNpYmlsaXR5OiAibm9uZSINCiAgICAgICAgICAgIH0sDQogICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgICB0aGF0LnBvbGxpbmdGbGFnID0gZmFsc2UNCiAgICAgICAgLy8g6K6w5b2V57uI5q2i54K5DQogICAgICAgIHRoYXQucG9zdFRyYWNrRGF0YV9Qb2ludCgNCiAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRMaXN0W3RoYXQudHJhY2tQb2ludExpc3QubGVuZ3RoIC0gMV0sDQogICAgICAgICAgdGhhdC50cmFja1BvaW50VGltZUxpc3RbdGhhdC50cmFja1BvaW50VGltZUxpc3QubGVuZ3RoIC0gMV0sDQogICAgICAgICAgZGlzdGFuY2UNCiAgICAgICAgKQ0KICAgICAgICAvLyDkuIrkvKDkuYvliY3kuIrkvKDlpLHotKXnmoTngrnkvY0NCiAgICAgICAgdGhhdC5yZXBvcnRGYWlsVHJhY2tQb2ludHMubGVuZ3RoID4gMCAmJiB0aGF0LnBvc3RGYWlsVHJhY2tEYXRhKCkNCiAgICAgICAgdGhhdC4kcmVmcy5teW1hcC51cGxvYWRGaWxlZFBpcGVJZExpc3QubGVuZ3RoID4gMCAmJiBhcGkucmVjb3JkSW5zcExpbmUodGhhdC4kcmVmcy5teW1hcC51cGxvYWRGaWxlZFBpcGVJZExpc3QpLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICBpZiAocmVzLnN0YXR1cykgew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ+euoee6v+ihpeWFheS4iuS8oOaIkOWKnycpDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICBpZiAodHlwZSA9PSAndGFzaycpIHsNCiAgICAgICAgICB0aGlzLnN0cmF0T3JFbmRUYXNrUmVjb3JkKDIpIC8vIOW3suW3oeajgOeKtuaAgSAnMicNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbGV0IHR5cGUgPSB0eXBlDQogICAgICAgIGxldCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgIHRoYXQuZHJhd0VuZFBvaW50KHR5cGUpDQogICAgICAgIH0sIDEwMDApDQogICAgICB9DQogICAgfSwNCiAgICBhc3luYyBwb3N0RmFpbFRyYWNrRGF0YSgpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgYXdhaXQgYXBpDQogICAgICAgIC5pbnNwZWN0aW9uVHJhY2sodGhhdC5yZXBvcnRGYWlsVHJhY2tQb2ludHMpDQogICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfovajov7nlrZjlgqjmiJDlip8nKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyDkuIrkvKDlpLHotKXnmoTngrnkvY3vvIzmmoLml7blrZjlnKhhcHDnq68NCiAgICAgICAgICAgIGxldCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICB0aGF0LnBvc3RGYWlsVHJhY2tEYXRhKCkNCiAgICAgICAgICAgIH0sIDIwMDApDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKCflt6Hmo4Dovajov7nlrZjlgqjlpLHotKXvvJonICsgZXJyKQ0KICAgICAgICB9KQ0KICAgIH0sDQoNCiAgICAvLyDljZXngrkt5ZCO56uv6K6w5b2V6L2o6L+55pWw5o2uDQogICAgYXN5bmMgcG9zdFRyYWNrRGF0YV9Qb2ludChwb2ludERhdGEsIHRpbWVEYXRhLCBkaXN0YW5jZSkgew0KICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICBmb3IgKGxldCBwID0gMDsgcCA8IHBvaW50RGF0YS5sZW5ndGg7IHArKykgew0KICAgICAgICBwb2ludERhdGFbcF0gPSBOdW1iZXIocG9pbnREYXRhW3BdKQ0KICAgICAgfQ0KICAgICAgbGV0IGRhdGVfbm93ID0gZGF5anMoKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKQ0KICAgICAgbGV0IHJlY29yZERhdGEgPSBbXQ0KICAgICAgcmVjb3JkRGF0YS5wdXNoKHsNCiAgICAgICAgdGFza0lkOiB0aGF0LnRhc2tEZXRhaWwuaWQsDQogICAgICAgIGluc3BEYXRlOiB0aW1lRGF0YSwNCiAgICAgICAgaW5zcFRpbWU6IGRhdGVfbm93LA0KICAgICAgICBkaXN0YW5jZSwNCiAgICAgICAgaW5zcGVjdG9yOiB0aGF0LnVzZXJJbmZvLnVzZXJGdWxsbmFtZSwNCiAgICAgICAgbG9uZ2l0dWRlOiBwb2ludERhdGFbMF0sDQogICAgICAgIGxhdGl0dWRlOiBwb2ludERhdGFbMV0sDQogICAgICB9KQ0KICAgICAgYXdhaXQgYXBpDQogICAgICAgIC5pbnNwZWN0aW9uVHJhY2socmVjb3JkRGF0YSkNCiAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgIGlmIChyZXMgJiYgcmVzLnN0YXR1cykgew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ+i9qOi/ueWtmOWCqOaIkOWKnycsIHJlY29yZERhdGEpDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIOS4iuS8oOWksei0peeahOeCueS9je+8jOaaguaXtuWtmOWcqGFwcOerrw0KICAgICAgICAgICAgdGhhdC5yZXBvcnRGYWlsVHJhY2tQb2ludHMucHVzaChyZWNvcmREYXRhKQ0KICAgICAgICAgICAgY29uc29sZS5sb2coJ3RoYXQucmVwb3J0RmFpbFRyYWNrUG9pbnRzOiAnLCB0aGF0LnJlcG9ydEZhaWxUcmFja1BvaW50cyk7DQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKCflt6Hmo4Dovajov7nlrZjlgqjlpLHotKXvvJonICsgZXJyKQ0KICAgICAgICB9KQ0KICAgIH0sDQogICAgc3RyYXRPckVuZFRhc2tSZWNvcmQoc3RhdHVzKSB7DQogICAgICBsZXQgZGF0YSA9IHsNCiAgICAgICAgcGxhbklkOiB0aGlzLnBsYW5EZXRhaWwucGxhbklkLA0KICAgICAgICB0YXNrTmFtZTogdGhpcy50YXNrRGV0YWlsLnRhc2tOYW1lLA0KICAgICAgICB0YXNrQ29kZTogdGhpcy50YXNrRGV0YWlsLnRhc2tDb2RlLA0KICAgICAgICB0YXNrU3RhdHVzOiBzdGF0dXMsDQogICAgICAgIGlkOiB0aGlzLnRhc2tEZXRhaWwuaWQsDQogICAgICAgIHRhc2tUeXBlOiB0aGlzLnRhc2tEZXRhaWwudGFza1R5cGUNCiAgICAgIH0NCiAgICAgIGFwaS5jaGFuZ2VUYXNrU3RhdHVzKGRhdGEpLnRoZW4oKHJlcykgPT4gew0KICAgICAgICBpZiAocmVzLnN0YXR1cykgew0KICAgICAgICAgIGNvbnNvbGUubG9nKHJlcykNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOa4hemZpOe8k+WtmOeahOi9qOi/ueaVsOaNrg0KICAgIGNsZWFyQnVmZmVyVHJhY2soKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIC8v5pWw57uE5b2S6Zu2DQogICAgICB0aGF0LnRyYWNrUG9pbnRMaXN0ID0gW10NCiAgICAgIHRoYXQudHJhY2tQb2ludFRpbWVMaXN0ID0gW10NCiAgICAgIHRoYXQub3ZlclNwZWVkVHJhY2tMaW5lTGlzdCA9IFtdDQogICAgICAvL+aVsOaNrua6kOa4heepug0KICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKS5zZXREYXRhKHsNCiAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgIGZlYXR1cmVzOiBbXSwNCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldFNvdXJjZSgndHJhY2tMaW5lU291cmNlX292ZXJTcGVlZCcpKSB7DQogICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfb3ZlclNwZWVkJykuc2V0RGF0YSh7DQogICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICBmZWF0dXJlczogW10sDQogICAgICAgIH0pDQogICAgICB9DQogICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93Jykuc2V0RGF0YSh7DQogICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICBmZWF0dXJlczogW10sDQogICAgICAgIH0pDQogICAgICB9DQoNCiAgICAgIGlmIChtYXBPYmoubWFwLmdldFNvdXJjZSgnZW5kUG9pbnRTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ2VuZFBvaW50U291cmNlX25vdycpLnNldERhdGEoew0KICAgICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0sDQogICAgYWRkTWFwSW1nKCkgew0KICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICBtYXBPYmoubWFwLmxvYWRJbWFnZSgNCiAgICAgICAgcmVxdWlyZSgnQGFzc2V0cy9pbWcvaW5zcGVjdGlvbi93aGl0ZV9hcnJvd19yaWdodC5wbmcnKSwNCiAgICAgICAgZnVuY3Rpb24gKGVycm9yLCBpbWFnZSkgew0KICAgICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3INCiAgICAgICAgICBpZiAoIW1hcE9iai5tYXAuaGFzSW1hZ2UoJ2Fycm93SWNvbicpKSB7DQogICAgICAgICAgICBtYXBPYmoubWFwLmFkZEltYWdlKCdhcnJvd0ljb24nLCBpbWFnZSwge30pDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICApDQogICAgICBtYXBPYmoubWFwLmxvYWRJbWFnZSgNCiAgICAgICAgcmVxdWlyZSgnQGFzc2V0cy9pbWcvaW5zcGVjdGlvbi9pY29uX3N0YXJ0aW5nX3BvaW50LnBuZycpLA0KICAgICAgICBmdW5jdGlvbiAoZXJyb3IsIGltYWdlKSB7DQogICAgICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcg0KICAgICAgICAgIGlmICghbWFwT2JqLm1hcC5oYXNJbWFnZSgnc3RhcnRfcG9pbnQnKSkgew0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRJbWFnZSgnc3RhcnRfcG9pbnQnLCBpbWFnZSwge30pDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICApDQogICAgICBtYXBPYmoubWFwLmxvYWRJbWFnZSgNCiAgICAgICAgcmVxdWlyZSgnQGFzc2V0cy9pbWcvaW5zcGVjdGlvbi9pY29uX2F0X2VuZC5wbmcnKSwNCiAgICAgICAgZnVuY3Rpb24gKGVycm9yLCBpbWFnZSkgew0KICAgICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3INCiAgICAgICAgICBpZiAoIW1hcE9iai5tYXAuaGFzSW1hZ2UoJ2VuZF9wb2ludCcpKSB7DQogICAgICAgICAgICBtYXBPYmoubWFwLmFkZEltYWdlKCdlbmRfcG9pbnQnLCBpbWFnZSwge30pDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICApDQogICAgfSwNCiAgICAvLyDlvIDlp4vorrDlvZUg5LiK5Lyg6LW354K55oiQ5Yqf5ZCO5omN6L+b5YWl5beh5qOA6L+H56iLDQogICAgc3RhcnRJbnNwUmVjb3JkKCkgew0KICAgICAgaWYgKHRoaXMuaXNWaWV3KSB7DQogICAgICAgIFRvYXN0KHsNCiAgICAgICAgICBtZXNzYWdlOiAn6K+l5beh5qOA5Lu75Yqh5bey57uT5p2fJywNCiAgICAgICAgICBkdXJhdGlvbjogMTUwMA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIGlmICghdGhpcy5jdXJyZW50UG9zaXRpb24gfHwgIXRoaXMuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSkgew0KICAgICAgICBUb2FzdCh7DQogICAgICAgICAgbWVzc2FnZTogJ+W9k+WJjUdQU+S/oeWPt+W8se+8jOaXoOazleW8gOWni+S7u+WKoScsDQogICAgICAgICAgZHVyYXRpb246IDEwMDAsDQogICAgICAgIH0pDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgdGhpcy5pZlJlY29yZGluZyA9IHRydWUNCiAgICAgIHRoaXMuY2xlYXJCdWZmZXJUcmFjaygpDQogICAgICB0aGlzLmFkZE1hcEltZygpDQogICAgICB0aGlzLmRyYXdTdGFydFBvaW50KCkNCiAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgIGlmIChyZXMpIHsNCiAgICAgICAgICAgIFRvYXN0KHsNCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+W8gOWni+iusOW9lScsDQogICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIHRoaXMucG9sbGluZ0ZsYWcgPSB0cnVlDQogICAgICAgICAgICB0aGlzLmlmUmVjb3JkaW5nID0gdHJ1ZQ0KICAgICAgICAgICAgdGhpcy5zdGFydExvY2F0aW9uKCkNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzdGFydFJlY29yZExpbmVzJywgJ3N0YXJ0JykNCiAgICAgICAgICAgIC8vIOW8gOWni+i9ruivog0KICAgICAgICAgICAgdGhpcy5wb2xsaW5nKCkNCiAgICAgICAgICAgIC8vIOiusOW9leW9k+WJjeaXtumXtA0KICAgICAgICAgICAgdGhpcy5zdGFydFJlY29yZFRpbWVyID0gbmV3IERhdGUoKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBUb2FzdCh7DQogICAgICAgICAgICAgIG1lc3NhZ2U6ICfnvZHnu5znirbmgIHlvILluLjvvIzml6Dms5XlvIDlp4vku7vliqEnLA0KICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwMCwNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKGVycikNCiAgICAgICAgICAvLyBUb2FzdCh7DQogICAgICAgICAgLy8gICBtZXNzYWdlOiBgJHtlcnJ9YCwNCiAgICAgICAgICAvLyAgIGR1cmF0aW9uOiAzMDAwDQogICAgICAgICAgLy8gfSk7DQogICAgICAgIH0pDQogICAgfSwNCiAgICAvLyDnu5PmnZ/orrDlvZUNCiAgICBlbmRSZWNvcmQodHlwZSA9IG51bGwpIHsNCiAgICAgIGxldCBkaWZmID0gTWF0aC5mbG9vcigobmV3IERhdGUoKSAtIHRoaXMuc3RhcnRSZWNvcmRUaW1lcikgLyAxMDAwKQ0KDQogICAgICBpZiAoZGlmZiA8PSAxMCkgew0KICAgICAgICBUb2FzdCh7DQogICAgICAgICAgbWVzc2FnZTogYOe7k+adn+WkquW/q+S6hizor7ckezEwIC0gZGlmZn3np5LlkI7lho3or5VgLA0KICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIERpYWxvZy5jb25maXJtKHsNCiAgICAgICAgdGl0bGU6ICfmoIfpopgnLA0KICAgICAgICBtZXNzYWdlOiAn56Gu5a6a57uT5p2f5pys5qyh5beh5qOA77yfJywNCiAgICAgIH0pDQogICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICB0aGlzLmVuZFJlY29yZENvbmZpcm0odHlwZSkNCiAgICAgICAgfSkNCiAgICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICB0aGlzLmVuZFJlY29yZENhbmNlbCgpDQogICAgICAgIH0pDQogICAgfSwNCiAgICAvLyB1cGxvYWRJbnNwUm91dGUoKSB7DQogICAgLy8gICB0cnkgew0KICAgIC8vICAgICBjb25zdCB0aGF0ID0gdGhpczsNCiAgICAvLyAgICAgLy8g5a6a5pe25ZmoDQogICAgLy8gICAgIGxldCB0aW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsNCiAgICAvLyAgICAgICAvLyDmuIXpmaTlrprml7blmagNCiAgICAvLyAgICAgICAvLyBjbGVhckludGVydmFsKHRpbWVyKTsNCiAgICAvLyAgICAgICBsZXQgdGVtcFRyYWNrUG9sbnRMaXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnRyYWNrUG9pbnRMaXN0KSkNCiAgICAvLyAgICAgICBpZiAodGVtcFRyYWNrUG9sbnRMaXN0Lmxlbmd0aCA+IDApIHsNCg0KICAgIC8vICAgICAgIH0NCiAgICAvLyAgICAgfSwgMTAwMCAqIDYwICogNjAgKiAyNCAqIDEpDQogICAgLy8gICB9IGNhdGNoIChlKSB7DQogICAgLy8gICAgIGNvbnNvbGUubG9nKGUpDQogICAgLy8gICB9DQogICAgLy8gfSwNCiAgICAvLyDnu5PmnZ/orrDlvZXlj5bmtogNCiAgICBlbmRSZWNvcmRDYW5jZWwoKSB7DQogICAgICB0aGlzLmVuZFJlY29yZFNob3cgPSBmYWxzZQ0KICAgIH0sDQogICAgLy8g57uT5p2f6K6w5b2V56Gu6K6kDQogICAgYXN5bmMgZW5kUmVjb3JkQ29uZmlybSh0eXBlID0gbnVsbCkgew0KICAgICAgdGhpcy5lbmRSZWNvcmRTaG93ID0gZmFsc2UNCiAgICAgIHRoaXMucG9sbGluZ0ZsYWcgPSBmYWxzZQ0KICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAuc3RvcFJlcXVlc3RMb2NhdGlvbnMoKQ0KICAgICAgYXdhaXQgdGhpcy5kcmF3RW5kUG9pbnQodHlwZSkNCiAgICAgIHRoaXMuaWZSZWNvcmRpbmcgPSBmYWxzZQ0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3N0YXJ0UmVjb3JkTGluZXMnLCAnZW5kJykNCiAgICAgIGlmICh0eXBlICE9ICdsZWF2ZScpIHsNCiAgICAgICAgdGhpcy5yZWZyZXNoVGFzaygpDQogICAgICB9DQogICAgICBUb2FzdCh7DQogICAgICAgIG1lc3NhZ2U6ICfnu5PmnZ/miJDlip8nLA0KICAgICAgICBkdXJhdGlvbjogMjAwMA0KICAgICAgfSkNCiAgICAgIC8qKiAyMDIxLzkvMjIg5Y+W5raI5LiK5oql5bey5beh5qOA566h57q/DQogICAgICAvLyDkuIrmiqXlt6Hmo4DorrDlvZUNCiAgICAgIC8vIOmcgOi/h+a7pOWHuuW3suW3oeajgOeuoee6vw0KICAgICAgbGV0IHNvdXJjZURhdGEgPSBhd2FpdCB0aGlzLiRyZWZzLm15bWFwLmZpbmRIYWRJbnNwRmVhdHVyZSgpOw0KICAgICAgbGV0IHJlY29yZERhdGEgPSBzb3VyY2VEYXRhLm1hcCgoaXRlbSkgPT4gew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGNhbGliZXI6ICBpdGVtLnByb3BlcnRpZXMuY2FsaWJlciwNCiAgICAgICAgICBndWlkOiBpdGVtLnByb3BlcnRpZXMuZ3VpZCwNCiAgICAgICAgICBsZW5ndGg6IGl0ZW0ucHJvcGVydGllcy5sZW5ndGgsDQogICAgICAgICAgdGFza0lkOiB0aGlzLnRhc2tEZXRhaWwudGFza0lkLA0KICAgICAgICB9Ow0KICAgICAgfSk7DQogICAgICByZWNvcmREYXRhID0gcmVjb3JkRGF0YS5maWx0ZXIoeCA9PiB0aGlzLmxpbmVzLmV2ZXJ5KHkgPT4geS5ndWlkICE9IHguZ3VpZCkpOw0KICAgICAgaWYgKHJlY29yZERhdGEubGVuZ3RoIDw9IDApIHsNCiAgICAgICAgdW5pLnNob3dUb2FzdCh7DQogICAgICAgICAgdGl0bGU6ICLnu5PmnZ/orrDlvZUiLA0KICAgICAgICAgIGR1cmF0aW9uOiAzMDAwLA0KICAgICAgICB9KTsNCiAgICAgICAgbGV0IHQgPSBzZXRUaW1lb3V0KCgpPT57DQogICAgICAgICAgdGhpcy5yZWNvcmRCdXR0b25Mb2FkaW5nID0gZmFsc2U7DQogICAgICAgIH0sIDEwMDApOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICB0aGlzLiRhcGkucG9zdEFjdGlvbigiL29wcy1pbnNwZWN0aW9uL2FwaS9pbnNwZWN0aW9uUmVjb3JkTXVsdGlwbGUiLCByZWNvcmREYXRhKQ0KICAgICAgICAudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygi5paw5aKe5beh5qOA6K6w5b2V5oiQ5YqfIik7DQogICAgICAgICAgICAvLyDnu5PmnZ/orrDlvZXlkI7lsLHliKDpmaTmnKzlnLDnvJPlrZgNCiAgICAgICAgICAgIHVuaVdlYlZpZXcucG9zdE1lc3NhZ2Uoew0KICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgICAgYWN0aW9uOiAicmVtb3ZlSW5zcFJlY29yZCIsDQogICAgICAgICAgICAgICAgdGFza0lkOiB0aGlzLnRhc2tEZXRhaWwudGFza0lkDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChyZWNvcmREYXRhLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgdW5pV2ViVmlldy5wb3N0TWVzc2FnZSh7DQogICAgICAgICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICAgICAgYWN0aW9uOiAic2F2ZUluc3BSZWNvcmQiLA0KICAgICAgICAgICAgICAgICAgaW5zcFJlY29yZERhdGE6IEpTT04uc3RyaW5naWZ5KHJlY29yZERhdGEpLA0KICAgICAgICAgICAgICAgICAgdGFza0lkOiB0aGlzLnRhc2tEZXRhaWwudGFza0lkLA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgLmZpbmFsbHkoKCk9PnsNCiAgICAgICAgICB1bmkuc2hvd1RvYXN0KHsNCiAgICAgICAgICAgIHRpdGxlOiAi57uT5p2f6K6w5b2VIiwNCiAgICAgICAgICAgIGR1cmF0aW9uOiAzMDAwLA0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGxldCB0ID0gc2V0VGltZW91dCgoKT0+ew0KICAgICAgICAgICAgdGhpcy5yZWNvcmRCdXR0b25Mb2FkaW5nID0gZmFsc2U7DQogICAgICAgICAgfSwgMTAwMCk7DQogICAgICAgIH0pDQogICAgICAqLw0KICAgIH0sDQoNCiAgICAvLyDlrprml7blkJHmnKzmnLrlj5HpgIHlrZjlgqjkv6Hmga8NCiAgICBhc3luYyBzZXRMb2NhbFN0b3JhZ2UoKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIGlmICh0aGlzLnBvbGxpbmdGbGFnKSB7DQogICAgICAgIC8qIGxldCBzdG9yYWdlVHJhY2tEYXRhID0gew0KICAgICAgICAgIHRyYWNrUG9pbnRMaXN0OiB0aGF0LnRyYWNrUG9pbnRMaXN0LA0KICAgICAgICAgIHRyYWNrUG9pbnRUaW1lTGlzdDogdGhhdC50cmFja1BvaW50VGltZUxpc3QsDQogICAgICAgICAgb3ZlclNwZWVkVHJhY2tMaW5lTGlzdDogdGhhdC5vdmVyU3BlZWRUcmFja0xpbmVMaXN0LA0KICAgICAgICB9Ow0KDQogICAgICAgIHVuaVdlYlZpZXcucG9zdE1lc3NhZ2Uoew0KICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgIGFjdGlvbjogInNhdmVJbnNwVHJhY2siLA0KICAgICAgICAgICAgaW5zcFRyYWNrRGF0YTogSlNPTi5zdHJpbmdpZnkoc3RvcmFnZVRyYWNrRGF0YSksDQogICAgICAgICAgICB0YXNrSWQ6IHRoYXQudGFza0RldGFpbC50YXNrSWQsDQogICAgICAgICAgfSwNCiAgICAgICAgfSk7ICovDQoNCiAgICAgICAgLy8g5LiK5oql5beh5qOA6K6w5b2VDQogICAgICAgIGxldCBzb3VyY2VEYXRhID0gYXdhaXQgdGhpcy4kcmVmcy5teW1hcC5maW5kSGFkSW5zcEZlYXR1cmUoKQ0KICAgICAgICBsZXQgcmVjb3JkRGF0YSA9IHNvdXJjZURhdGEubWFwKChpdGVtKSA9PiB7DQogICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGNhbGliZXI6IGl0ZW0ucHJvcGVydGllcy5jYWxpYmVyLA0KICAgICAgICAgICAgZ3VpZDogaXRlbS5wcm9wZXJ0aWVzLmd1aWQsDQogICAgICAgICAgICBsZW5ndGg6IGl0ZW0ucHJvcGVydGllcy5sZW5ndGgsDQogICAgICAgICAgICB0YXNrSWQ6IHRoaXMudGFza0RldGFpbC50YXNrSWQsDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICByZWNvcmREYXRhID0gcmVjb3JkRGF0YS5maWx0ZXIoKHgpID0+IHRoaXMubGluZXMuZXZlcnkoKHkpID0+IHkuZ3VpZCAhPSB4Lmd1aWQpKQ0KICAgICAgICBpZiAocmVjb3JkRGF0YS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgdGhpcy4kYXBpDQogICAgICAgICAgICAucG9zdEFjdGlvbignL29wcy1pbnNwZWN0aW9uL2FwaS9pbnNwZWN0aW9uUmVjb3JkTXVsdGlwbGUnLCByZWNvcmREYXRhKQ0KICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5paw5aKe5beh5qOA6K6w5b2V5oiQ5YqfJykNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB1bmlXZWJWaWV3LnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc2F2ZUluc3BSZWNvcmQnLA0KICAgICAgICAgICAgICAgICAgICBpbnNwUmVjb3JkRGF0YTogSlNPTi5zdHJpbmdpZnkocmVjb3JkRGF0YSksDQogICAgICAgICAgICAgICAgICAgIHRhc2tJZDogdGhpcy50YXNrRGV0YWlsLnRhc2tJZCwNCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgICBsZXQgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICB0aGlzLnNldExvY2FsU3RvcmFnZSgpDQogICAgICAgIH0sIDE1MDAwKQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5p+l6K+iYXBw56uv5a2Y5YKo55qE6K+l5Lu75Yqh55qE5beh5qOA6K6w5b2V5ZKM6L2o6L+554K55L2N5pWw5o2uDQogICAgZ2V0QXBwSW5zcERhdGEoaWQpIHsNCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgew0KICAgICAgICAvKiogMjAyMS85LzIyIOWPlua2iOiOt+WPlmFwcOerr+e8k+WtmOeahOaVsOaNrg0KICAgICAgICB1bmlXZWJWaWV3LnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICBhY3Rpb246ICJnZXRJbnNwUmVjb3JkIiwNCiAgICAgICAgICAgIHRhc2tJZDogaWQsDQogICAgICAgICAgfSwNCiAgICAgICAgfSk7DQogICAgICAgICovDQogICAgICAgIC8vIHVuaVdlYlZpZXcucG9zdE1lc3NhZ2Uoew0KICAgICAgICAvLyAgIGRhdGE6IHsNCiAgICAgICAgLy8gICAgIGFjdGlvbjogImdldFRyYWNrUG9pbnRzIiwNCiAgICAgICAgLy8gICAgIHRhc2tJZDogaWQNCiAgICAgICAgLy8gICB9DQogICAgICAgIC8vIH0pDQogICAgICAgIHJlc29sdmUoKQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOW8gOWni+WumuS9jQ0KICAgIHN0YXJ0TG9jYXRpb24oKSB7DQogICAgICBpZiAoIXRoaXMuY3VycmVudFBvc2l0aW9uIHx8ICF0aGlzLmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUgfHwgIXRoaXMuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlKSB7DQogICAgICAgIFRvYXN0KHsNCiAgICAgICAgICBtZXNzYWdlOiAn6I635Y+W5L2N572u5aSx6LSlIScsDQogICAgICAgICAgZHVyYXRpb246IDIwMDANCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb25zdCBjb29yZCA9IFtwYXJzZUZsb2F0KHRoaXMuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSksIHBhcnNlRmxvYXQodGhpcy5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGUpXQ0KICAgICAgICB0aGlzLmZseVRvUG9pbnQoY29vcmQpDQogICAgICB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiDotoXlm77lnZDmoIfovazmjaLkuLpmZWF0dXJlDQogICAgICovDQogICAgc3VwZXJNYXBQYXJhbXNUb0ZlYXR1cmUoZ2VvbWV0cnkpIHsNCiAgICAgIGxldCBjb29yZA0KICAgICAgbGV0IHR5cGUNCiAgICAgIHN3aXRjaCAoZ2VvbWV0cnkudHlwZSkgew0KICAgICAgICBjYXNlICdQT0lOVCc6DQogICAgICAgICAgdHlwZSA9ICdQb2ludCcNCiAgICAgICAgICBjb29yZCA9IFtnZW9tZXRyeS5wb2ludHNbMF0ueCwgZ2VvbWV0cnkucG9pbnRzWzBdLnldDQogICAgICAgICAgYnJlYWsNCiAgICAgICAgY2FzZSAnTElORSc6DQogICAgICAgICAgdHlwZSA9ICdMaW5lU3RyaW5nJw0KICAgICAgICAgIGNvb3JkID0gZ2VvbWV0cnkucG9pbnRzLm1hcCgocG9pbnQpID0+IFtwb2ludC54LCBwb2ludC55XSkNCiAgICAgICAgICBicmVhaw0KICAgICAgICBjYXNlICdSRUdJT04nOg0KICAgICAgICAgIHR5cGUgPSAnUG9seWdvbicNCiAgICAgICAgICBjb29yZCA9IFtnZW9tZXRyeS5wb2ludHMubWFwKChwb2ludCkgPT4gW3BvaW50LngsIHBvaW50LnldKV0NCiAgICAgICAgICBicmVhaw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLA0KICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgIHR5cGUsDQogICAgICAgICAgY29vcmRpbmF0ZXM6IGNvb3JkLA0KICAgICAgICB9LA0KICAgICAgfQ0KICAgIH0sDQogICAgZmVhdHVyZVRvT2JqZWN0KG5hbWVzLCB2YWx1ZXMpIHsNCiAgICAgIGxldCBvYmogPSB7fQ0KICAgICAgbmFtZXMuZm9yRWFjaCgobmFtZSwgaW5kZXgpID0+IHsNCiAgICAgICAgb2JqW25hbWVdID0gdmFsdWVzW2luZGV4XQ0KICAgICAgfSkNCiAgICAgIHJldHVybiBvYmoNCiAgICB9LA0KICAgIGdvRXZlbnRPckZsYXdEZXRhaWwoZmVhdHVyZSwgdHlwZSkgew0KICAgICAgbGV0IGN1cnJlbnRQb2ludCA9IGZlYXR1cmUNCiAgICAgIGN1cnJlbnRQb2ludCA9IGZlYXR1cmUNCiAgICAgIGN1cnJlbnRQb2ludC5jb2RlID0gZmVhdHVyZS5kZXZpY2VJZCB8fCAnJw0KICAgICAgY3VycmVudFBvaW50LmJpZ1R5cGUgPSBmZWF0dXJlLmJpelR5cGUgfHwgJycNCiAgICAgIGN1cnJlbnRQb2ludC5sbmcgPSBmZWF0dXJlLnN0YXJ0TG9uZ2l0dWRlDQogICAgICBjdXJyZW50UG9pbnQubGF0ID0gZmVhdHVyZS5zdGFydExhdGl0dWRlDQogICAgICAvLyDopoHntKDmiYDlnKjlm77lsYJJROWSjOWxnuaAp+S/oeaBrw0KICAgICAgLy8gY3VycmVudFBvaW50LmxheWVySUQgPSBmZWF0dXJlLmxheWVyLmlkIHx8ICcnDQogICAgICAvLyBjdXJyZW50UG9pbnQubGF5ZXJUeXBlID0gZmVhdHVyZS5sYXllci50eXBlIHx8ICcnDQogICAgICAvLyBjdXJyZW50UG9pbnQucHJvcGVydGllcyA9IGZlYXR1cmUucHJvcGVydGllcyB8fCAnJw0KICAgICAgLy8g5bqV5Zu+6KaB57SgbmFtZV9sb2NhbOaIluiuvuaWveimgee0oHJvYWRfbmFtZSxpZA0KICAgICAgY3VycmVudFBvaW50LnJvYWRfbmFtZSA9IGZlYXR1cmUucm9hZA0KICAgICAgLy8gY3VycmVudFBvaW50LmlkID0gZmVhdHVyZS5wcm9wZXJ0aWVzLmlkDQogICAgICBpZiAodHlwZSA9PSAnZXZlbnQnKSB7DQogICAgICAgIC8vIHRoaXMuJHJvdXRlci5wdXNoKHsNCiAgICAgICAgLy8gICBuYW1lOiAnYWRkUHJvYmxlbUluZGV4JywNCiAgICAgICAgLy8gICBxdWVyeTogeyBtc2c6IGN1cnJlbnRQb2ludCwgdG9rZW46IHRoaXMuZm9ybVRva2VuLCB0YXNrSWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZCB9LA0KICAgICAgICAvLyAgIHBhcmFtczogeyB0eXBlOiAnYWRkJyB9DQogICAgICAgIC8vIH0pDQogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsNCiAgICAgICAgICBuYW1lOiAnYWRkUHJvYmxlbUluZGV4JywNCiAgICAgICAgICBxdWVyeTogeyBtc2c6IGN1cnJlbnRQb2ludCwgdG9rZW46IHRoaXMuZm9ybVRva2VuLCB0YXNrSWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZCB9LA0KICAgICAgICAgIHBhcmFtczogeyB0eXBlOiAnYWRkJyB9LA0KICAgICAgICB9KQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goew0KICAgICAgICAgIG5hbWU6ICdhZGRGbGF3cycsDQogICAgICAgICAgcXVlcnk6IHsgbXNnOiBjdXJyZW50UG9pbnQsIHRva2VuOiB0aGlzLmZvcm1Ub2tlbiwgdGFza0lkOiB0aGlzLiRyb3V0ZS5xdWVyeS50YXNrSWQgfSwNCiAgICAgICAgICBwYXJhbXM6IHsgdHlwZTogJ2FkZCcgfQ0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g56Gu6K6kDQogICAgb25Db25maXJtKCkgew0KICAgICAgaWYgKHRydWUpIHsNCiAgICAgICAgbGV0IGZlYXR1cmUgPSB0aGlzLnNpZ25Gb3JtLmZlYXR1cmUNCiAgICAgICAgbGV0IGNvcHlTaWduRm9ybSA9IHRoaXMuZGVlcENsb25lKHRoaXMuc2lnbkZvcm0pDQogICAgICAgIGNvcHlTaWduRm9ybS5pbnNwRGF0ZSA9IGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJykNCiAgICAgICAgY29weVNpZ25Gb3JtLmV4dDEgPSBjb3B5U2lnbkZvcm0ucmVtYXJrIC8vIOWkh+azqA0KICAgICAgICBkZWxldGUgY29weVNpZ25Gb3JtLmZlYXR1cmUNCiAgICAgICAgYXBpLnNpZ25Jbihjb3B5U2lnbkZvcm0pLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgIGlmIChyZXMgJiYgcmVzLnN0YXR1cykgew0KICAgICAgICAgICAgVG9hc3Qoew0KICAgICAgICAgICAgICBtZXNzYWdlOiAn5q2k5YWz6ZSu54K5562+5Yiw5oiQ5YqfJywNCiAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsDQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgLy8g5beh5qOA5LqL5Lu25LiK5oqlDQogICAgICAgICAgICBpZiAoY29weVNpZ25Gb3JtLmlzUmVwb3J0ID09ICfpl67popjkuIrmiqUnKSB7DQogICAgICAgICAgICAgIHRoaXMuZ29FdmVudE9yRmxhd0RldGFpbChmZWF0dXJlLCAnZXZlbnQnKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29weVNpZ25Gb3JtLmlzUmVwb3J0ID09ICfmlrDlop7nvLrpmbcnKSB7DQogICAgICAgICAgICAgIHRoaXMuZ29FdmVudE9yRmxhd0RldGFpbChmZWF0dXJlLCAnZmxhdycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBUb2FzdCh7DQogICAgICAgICAgICAgIG1lc3NhZ2U6ICfmraTlhbPplK7ngrnnrb7liLDlpLHotKUnLA0KICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMCwNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICB0aGlzLnNpZ25TaG93ID0gZmFsc2UNCiAgICAgICAgdGhpcy5zaWduRm9ybS5yZW1hcmsgPSAnJw0KICAgICAgICB0aGlzLnNpZ25Gb3JtLmRldmljZVN0YXR1cyA9ICcwJw0KICAgICAgICB0aGlzLnNpZ25Gb3JtLmlzUmVwb3J0ID0gJycNCiAgICAgICAgdGhpcy5zaWduRm9ybS5pbnNwSW1hZ2VzTGlzdCA9IFtdDQogICAgICAgIHRoaXMuYXR0YWNobWVudCA9ICcnDQogICAgICAgIG1hcE9iai5tYXBJbnN0YW5jZS5zZXRTb3VyY2VEYXRhKCdidWZmZXJlZCcsIHsNCiAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgIGZlYXR1cmVzOiBbXSwNCiAgICAgICAgfSkNCiAgICAgICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0oImlzUmVwb3J0RXZlbnQiLCBmYWxzZSk7DQogICAgICAgIHRoaXMucmVmcmVzaFRhc2soKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY29uc29sZS5sb2coJ+mqjOivgeWksei0pScpDQogICAgICB9DQogICAgfSwNCiAgICAvLyDlj5bmtogNCiAgICBvbkNhbmNlbCgpIHsNCiAgICAgIGNvbnNvbGUubG9nKCdjbGljayBjYW5jZWwnKQ0KICAgICAgLy8gbG9jYWxTdG9yYWdlLnNldEl0ZW0oImlzUmVwb3J0RXZlbnQiLCBmYWxzZSk7DQogICAgICB0aGlzLnNpZ25TaG93ID0gZmFsc2UNCiAgICAgIG1hcE9iai5tYXBJbnN0YW5jZS5zZXRTb3VyY2VEYXRhKCdidWZmZXJlZCcsIHsNCiAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOetvuWIsA0KICAgIGFzeW5jIHN0YXJ0U2lnbkluKGZlYXR1cmUpIHsNCiAgICAgIC8vIOWIqeeUqGZlYXR1cmXmnaXliKTmlq3mmK/lkKblpITkuo4zNW3ojIPlm7TlhoXvvIzlpoLmnpzlpITkuo7vvIzlj6/ku6Xov5vooYznrb7liLDvvIzlkKbliJnkuI3og73ov5vooYznrb7liLANCiAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5jdXJyZW50UG9zaXRpb24NCiAgICAgIGlmICghcG9zaXRpb24pIHsNCiAgICAgICAgVG9hc3Qud2FybmluZyh7DQogICAgICAgICAgbWVzc2FnZTogJ+iOt+WPluS4jeWIsOW3oeajgOS6uuS9jee9ricsDQogICAgICAgICAgZHVyYXRpb246IDIwMDAsDQogICAgICAgIH0pDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgY29uc3QgY29vcmQgPSBbDQogICAgICAgIHBhcnNlRmxvYXQocG9zaXRpb24ubG9uZ2l0dWRlKSwNCiAgICAgICAgcGFyc2VGbG9hdChwb3NpdGlvbi5sYXRpdHVkZSksDQogICAgICBdDQogICAgICBjb25zdCBwb2ludCA9IHR1cmYucG9pbnQoY29vcmQpDQogICAgICBjb25zdCBlbmdHZW9tID0gZmVhdHVyZS5nZW9tDQogICAgICBjb25zdCBidWZmZXJlZCA9IHR1cmYuYnVmZmVyKGVuZ0dlb20sIDAuMDM1LCB7IHVuaXQ6ICdraWxvbWV0ZXJzJyB9KQ0KICAgICAgY29uc3QgaXNJbkJ1ZmZlciA9IHR1cmYuaW5zaWRlKHBvaW50LCBidWZmZXJlZCkNCiAgICAgIGlmICghaXNJbkJ1ZmZlcikgew0KICAgICAgICBUb2FzdCh7DQogICAgICAgICAgbWVzc2FnZTogJ+acquWkhOS6juivpeWFs+mUrueCueiMg+WbtOWGhScsDQogICAgICAgICAgZHVyYXRpb246IDIwMDAsDQogICAgICAgIH0pDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgVG9hc3QubG9hZGluZyh7DQogICAgICAgIG1lc3NhZ2U6ICfmraPlnKjliqDovb0nLA0KICAgICAgICBmb3JiaWRDbGljazogdHJ1ZSwNCiAgICAgIH0pDQogICAgICB0aGlzLnNpZ25TaG93ID0gdHJ1ZQ0KICAgICAgdGhpcy5wb2ludExpc3RTaG93ID0gZmFsc2UNCiAgICAgIHRoaXMuYXR0YWNobWVudCA9ICcnDQogICAgICB0aGlzLmlzUmVwb3J0ID0gJycNCiAgICAgIHRoaXMuZGV2aWNlTmFtZSA9IGZlYXR1cmUuZGV2aWNlVHlwZSArIChmZWF0dXJlLmRldmljZUlkIHx8ICcnKQ0KICAgICAgaWYgKCFmZWF0dXJlLmRldmljZVN0YXR1cyB8fCBmZWF0dXJlLmRldmljZVN0YXR1cyA9PSAnMicpIHsNCiAgICAgICAgLy8g5pyq5beh5qOADQogICAgICAgIHRoaXMuaGFzU2lnbkluID0gZmFsc2UNCiAgICAgICAgdGhpcy5zaWduRm9ybS5yZW1hcmsgPSAnJw0KICAgICAgICB0aGlzLnNpZ25Gb3JtLmRldmljZVN0YXR1cyA9ICcwJw0KICAgICAgICB0aGlzLnNpZ25Gb3JtLmluc3BJbWFnZXNMaXN0ID0gW10NCiAgICAgICAgdGhpcy5zaWduRm9ybS5wb2ludElkID0gZmVhdHVyZS5pZA0KICAgICAgICB0aGlzLnNpZ25Gb3JtLnRhc2tJZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZCwNCiAgICAgICAgdGhpcy5zaWduRm9ybS5mZWF0dXJlID0gZmVhdHVyZQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy5oYXNTaWduSW4gPSB0cnVlDQogICAgICAgIGxldCBwYXJhbXMgPSB7DQogICAgICAgICAgcGFnZTogMSwNCiAgICAgICAgICBzaXplOiA5OTksDQogICAgICAgICAgZGV2aWNlU3RhdHVzOiBmZWF0dXJlLmRldmljZVN0YXR1cywNCiAgICAgICAgICBwb2ludElkOiBmZWF0dXJlLmlkLA0KICAgICAgICAgIHRhc2tJZDogdGhpcy4kcm91dGUucXVlcnkudGFza0lkLA0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3Qoew0KICAgICAgICAgIHVybDogJy94YXN3LXBpcGUtb3BlcmF0aW9uL2luc3BQb2ludFJlY29yZC9wYWdlJywNCiAgICAgICAgICBtZXRob2Q6ICdnZXQnLA0KICAgICAgICAgIHBhcmFtczogcGFyYW1zLA0KICAgICAgICB9KQ0KICAgICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICBsZXQgcmVzdWx0ID0gcmVzLmRhdGEucmVjb3Jkc1swXQ0KICAgICAgICAgIHRoaXMuc2lnbkZvcm0uZGV2aWNlU3RhdHVzID0gcmVzdWx0LmRldmljZVN0YXR1cw0KICAgICAgICAgIHRoaXMuc2lnbkZvcm0ucmVtYXJrID0gcmVzdWx0LmV4dDENCiAgICAgICAgICB0aGlzLnNpZ25Gb3JtLmlzUmVwb3J0ID0gcmVzdWx0LmlzUmVwb3J0DQogICAgICAgICAgY29uc3QgYXR0ID0gYXdhaXQgcmVxdWVzdCh7DQogICAgICAgICAgICB1cmw6ICcveGFzdy1waXBlLW9wZXJhdGlvbi9pbnNwUG9pbnRSZWNvcmQnLA0KICAgICAgICAgICAgbWV0aG9kOiAnZ2V0JywNCiAgICAgICAgICAgIHBhcmFtczogeyBpZDogcmVzdWx0LmlkIH0NCiAgICAgICAgICB9KQ0KICAgICAgICAgIGlmIChhdHQgJiYgYXR0LnN0YXR1cykgew0KICAgICAgICAgICAgdGhpcy5zaWduRm9ybS5pbnNwSW1hZ2VzTGlzdCA9IGF0dC5kYXRhLmluc3BJbWFnZXNMaXN0DQogICAgICAgICAgICB0aGlzLmF0dGFjaG1lbnQgPSBhdHQuZGF0YS5pbnNwSW1hZ2VzTGlzdFswXS5maWxlSWQNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGNvbnNvbGUubG9nKCdzaWduRm9ybScsIHRoaXMuc2lnbkZvcm0pDQogICAgfSwNCiAgICAvLyDkuovku7bnsbvlnovpgInmi6nnoa7orqQNCiAgICBldmVudFR5cGVDb25maXJtKGV2ZW50KSB7DQogICAgICB0aGlzLiRzZXQodGhpcy5zaWduRm9ybSwgJ2V2ZW50VHlwZScsIGV2ZW50WzFdLmxhYmVsKQ0KICAgICAgdGhpcy5zaWduRm9ybS5pbnNwSXRlbUlkID0gZXZlbnRbMV0udmFsdWUNCiAgICB9LA0KICAgIC8vIOa3seaLt+i0nQ0KICAgIGRlZXBDbG9uZShkYXRhKSB7DQogICAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSkNCiAgICB9LA0KICAgIC8vIOiuoeeul+S4reW/g+eCuQ0KICAgIGNvbXB1dGVDZW50ZXIoZmVhdHVyZSkgew0KICAgICAgbGV0IHBvc2l0aW9uDQogICAgICBpZiAoZmVhdHVyZS50eXBlID09PSAnUG9seWdvbicgfHwgZmVhdHVyZS50eXBlID09PSAnTXVsdGlQb2x5Z29uJykgew0KICAgICAgICBjb25zdCBjZW50ZXIgPSB0dXJmLmNlbnRlcihmZWF0dXJlKQ0KICAgICAgICBwb3NpdGlvbiA9IGNlbnRlci5nZW9tZXRyeQ0KICAgICAgfSBlbHNlIGlmIChmZWF0dXJlLnR5cGUgPT09ICdMaW5lU3RyaW5nJykgew0KICAgICAgICBjb25zdCBjZW50ZXIgPSB0dXJmLmNlbnRlcihmZWF0dXJlKQ0KICAgICAgICBwb3NpdGlvbiA9IGNlbnRlci5nZW9tZXRyeQ0KICAgICAgfSBlbHNlIGlmIChmZWF0dXJlLnR5cGUgPT09ICdQb2ludCcpIHsNCiAgICAgICAgcG9zaXRpb24gPSBmZWF0dXJlDQogICAgICB9DQogICAgICByZXR1cm4gcG9zaXRpb24NCiAgICB9LA0KICAgIHJlcG9ydEV2ZW50KGZlYXR1cmUpIHsNCiAgICAgIHRoaXMucmVwb3J0Rm9vdGVyU2hvdyA9IGZhbHNlDQogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7DQogICAgICAgIHBhdGg6ICcvcGFnZXMvaW5zcGVjdGlvbk1hbmFnZS9hZGQtZXZlbnQnLA0KICAgICAgICBxdWVyeTogew0KICAgICAgICAgIHRhc2tJZDogdGhpcy50YXNrRGV0YWlsLnRhc2tJZCwNCiAgICAgICAgICBmZWF0dXJlOiBmZWF0dXJlLA0KICAgICAgICAgIHJhbmdlTGlzdDogdGhpcy5yYW5nZUxpc3QsDQogICAgICAgICAgdGFza0RldGFpbDogdGhpcy50YXNrRGV0YWlsLA0KICAgICAgICB9LA0KICAgICAgfSkNCiAgICB9LA0KICAgIEdldERpc3RhbmNlKGNvb3JkQXJyYXkxLCBjb29yZEFycmF5Mikgew0KICAgICAgbGV0IGxuZzEgPSBjb29yZEFycmF5MVswXQ0KICAgICAgbGV0IGxhdDEgPSBjb29yZEFycmF5MVsxXQ0KICAgICAgbGV0IGxuZzIgPSBjb29yZEFycmF5MlswXQ0KICAgICAgbGV0IGxhdDIgPSBjb29yZEFycmF5MlsxXQ0KICAgICAgbGV0IHJhZExhdDEgPSAobGF0MSAqIE1hdGguUEkpIC8gMTgwLjANCiAgICAgIGxldCByYWRMYXQyID0gKGxhdDIgKiBNYXRoLlBJKSAvIDE4MC4wDQogICAgICBsZXQgYSA9IHJhZExhdDEgLSByYWRMYXQyDQogICAgICBsZXQgYiA9IChsbmcxICogTWF0aC5QSSkgLyAxODAuMCAtIChsbmcyICogTWF0aC5QSSkgLyAxODAuMA0KICAgICAgbGV0IHMgPQ0KICAgICAgICAyICoNCiAgICAgICAgTWF0aC5hc2luKA0KICAgICAgICAgIE1hdGguc3FydCgNCiAgICAgICAgICAgIE1hdGgucG93KE1hdGguc2luKGEgLyAyKSwgMikgKw0KICAgICAgICAgICAgICBNYXRoLmNvcyhyYWRMYXQxKSAqIE1hdGguY29zKHJhZExhdDIpICogTWF0aC5wb3coTWF0aC5zaW4oYiAvIDIpLCAyKQ0KICAgICAgICAgICkNCiAgICAgICAgKQ0KICAgICAgcyA9IHMgKiA2Mzc4LjEzNyAvLyBFQVJUSF9SQURJVVM7DQogICAgICBzID0gTWF0aC5yb3VuZChzICogMTAwMDApIC8gMTAwMDANCiAgICAgIHJldHVybiBzDQogICAgfSwNCiAgICBzaG93Um91dGUoKSB7DQogICAgICB0aGlzLmlzU2hvd1JvdXRlID0gIXRoaXMuaXNTaG93Um91dGUNCiAgICAgIGlmIChtYXBPYmoubWFwLmdldExheW91dFByb3BlcnR5KCd0cmFja0xpbmVMYXllcl9ub3cnLCAndmlzaWJpbGl0eScpID09PSAndmlzaWJsZScpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgndHJhY2tMaW5lTGF5ZXJfbm93JywgJ3Zpc2liaWxpdHknLCAnbm9uZScpDQogICAgICB9IGVsc2Ugew0KICAgICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCd0cmFja0xpbmVMYXllcl9ub3cnLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldExheW91dFByb3BlcnR5KCd0cmFja0xpbmVMYXllcl9hcnJvdycsICd2aXNpYmlsaXR5JykgPT09ICd2aXNpYmxlJykgew0KICAgICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCd0cmFja0xpbmVMYXllcl9hcnJvdycsICd2aXNpYmlsaXR5JywgJ25vbmUnKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgndHJhY2tMaW5lTGF5ZXJfYXJyb3cnLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldExheW91dFByb3BlcnR5KCd0cmFja0xpbmVMYXllcl9vdmVyU3BlZWQnLCAndmlzaWJpbGl0eScpID09PSAndmlzaWJsZScpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgndHJhY2tMaW5lTGF5ZXJfb3ZlclNwZWVkJywgJ3Zpc2liaWxpdHknLCAnbm9uZScpDQogICAgICB9IGVsc2Ugew0KICAgICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCd0cmFja0xpbmVMYXllcl9vdmVyU3BlZWQnLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldExheW91dFByb3BlcnR5KCdzdGFydFBvaW50TGF5ZXJfbm93JywgJ3Zpc2liaWxpdHknKSA9PT0gJ3Zpc2libGUnKSB7DQogICAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3N0YXJ0UG9pbnRMYXllcl9ub3cnLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3N0YXJ0UG9pbnRMYXllcl9ub3cnLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldExheW91dFByb3BlcnR5KCdlbmRQb2ludExheWVyX25vdycsICd2aXNpYmlsaXR5JykgPT09ICd2aXNpYmxlJykgew0KICAgICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdlbmRQb2ludExheWVyX25vdycsICd2aXNpYmlsaXR5JywgJ25vbmUnKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnZW5kUG9pbnRMYXllcl9ub3cnLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldExheW91dFByb3BlcnR5KCdzdGFydFBvaW50X2xhYmVsJywgJ3Zpc2liaWxpdHknKSA9PT0gJ3Zpc2libGUnKSB7DQogICAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3N0YXJ0UG9pbnRfbGFiZWwnLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIG1hcE9iai5tYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3N0YXJ0UG9pbnRfbGFiZWwnLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldExheW91dFByb3BlcnR5KCdlbmRQb2ludF9sYWJlbCcsICd2aXNpYmlsaXR5JykgPT09ICd2aXNpYmxlJykgew0KICAgICAgICBtYXBPYmoubWFwLnNldExheW91dFByb3BlcnR5KCdlbmRQb2ludF9sYWJlbCcsICd2aXNpYmlsaXR5JywgJ25vbmUnKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnZW5kUG9pbnRfbGFiZWwnLCAndmlzaWJpbGl0eScsICd2aXNpYmxlJykNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlc2V0TWFwVmlldygpIHsNCiAgICAgIHRoaXMuJHJlZnMubXltYXAgJiYgbWFwT2JqLm1hcC5yZXNldE5vcnRoUGl0Y2goKQ0KICAgIH0sDQogICAgY2xpY2tSZXBvcnRFdmVudCgpIHsNCiAgICAgIGNvbnNvbGUubG9nKCdjbGljayB0aGUgY2xpY2tSZXBvcnRFdmVudCcpDQogICAgICBsZXQgcG9zaXRpb24gPSBbXQ0KICAgICAgaWYgKCF0aGlzLmN1cnJlbnRQb3NpdGlvbikgew0KICAgICAgICBsZXQgcG9zID0gdW5kZWZpbmVkDQogICAgICAgIGlmICh0aGlzLnJhbmdlTGlzdC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgbGV0IGZlYXR1cmUgPSBKU09OLnBhcnNlKHRoaXMucmFuZ2VMaXN0WzBdLnRhc2tSYW5nZXJHZW9tKQ0KICAgICAgICAgIGlmIChmZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdQb2x5Z29uJyB8fCBmZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdNdWx0aVBvbHlnb24nKSB7DQogICAgICAgICAgICBjb25zdCBjZW50ZXIgPSB0dXJmLmNlbnRlcihmZWF0dXJlLmdlb21ldHJ5KQ0KICAgICAgICAgICAgcG9zID0gY2VudGVyLmdlb21ldHJ5DQogICAgICAgICAgfSBlbHNlIGlmIChmZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdMaW5lU3RyaW5nJykgew0KICAgICAgICAgICAgY29uc3QgY2VudGVyID0gdHVyZi5jZW50ZXIoZmVhdHVyZS5nZW9tZXRyeSkNCg0KICAgICAgICAgICAgcG9zID0gY2VudGVyLmdlb21ldHJ5DQogICAgICAgICAgfSBlbHNlIGlmIChmZWF0dXJlLmdlb21ldHJ5LnR5cGUgPT09ICdQb2ludCcpIHsNCiAgICAgICAgICAgIHBvcyA9IGZlYXR1cmUuZ2VvbWV0cnkNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKHBvcykgew0KICAgICAgICAgICAgcG9zaXRpb24gPSBwb3MuY29vcmRpbmF0ZXMNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcG9zaXRpb24gPSBbMTE5Ljk2MTIzNTU5NzcyOTY4LCAzMC4yNzA5NDY5MTk5MTgwNl0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHBvc2l0aW9uID0gWw0KICAgICAgICAgIHBhcnNlRmxvYXQodGhpcy5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlKSwNCiAgICAgICAgICBwYXJzZUZsb2F0KHRoaXMuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlKSwNCiAgICAgICAgXQ0KICAgICAgfQ0KICAgICAgdGhpcy5zaWduU2hvdyA9IGZhbHNlDQogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7DQogICAgICAgIG5hbWU6ICdhZGRFdmVudCcsDQogICAgICAgIHF1ZXJ5OiB7DQogICAgICAgICAgdGFza0lkOiB0aGlzLnRhc2tEZXRhaWwudGFza0lkLA0KICAgICAgICAgIHJhbmdlTGlzdDogdGhpcy5yYW5nZUxpc3QsDQogICAgICAgICAgdGFza0RldGFpbDogdGhpcy50YXNrRGV0YWlsLA0KICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbiwNCiAgICAgICAgfSwNCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyDns7vnu5/mj5DnpLrpn7MNCiAgICAvLyBzcGVlY2goKSB7DQogICAgLy8gICAvLyDnp4HmnInlj5jph490aW1lcg0KICAgIC8vICAgbGV0IHRpbWVyID0gbmV3IERhdGUoKTsNCiAgICAvLyAgIC8vIOesrOS4gOasoei/m+WFpQ0KICAgIC8vICAgbGV0IGlzRmlyc3RJbiA9IHRydWU7DQogICAgLy8gICByZXR1cm4gew0KICAgIC8vICAgICBwdWJsaWNTcGVlY2g6IGZ1bmN0aW9uICgpIHsNCiAgICAvLyAgICAgICBpZiAoaXNGaXJzdEluIHx8IChuZXcgRGF0ZSgpIC0gdGltZXIpLzEwMDAgPiAyMCkgew0KICAgIC8vICAgICAgICAgY29uc3QgaW5uZXJBdWRpb0NvbnRleHQgPSB1bmkuY3JlYXRlSW5uZXJBdWRpb0NvbnRleHQoKTsNCiAgICAvLyAgICAgICAgIGlubmVyQXVkaW9Db250ZXh0LmF1dG9wbGF5ID0gdHJ1ZTsNCiAgICAvLyAgICAgICAgIGlubmVyQXVkaW9Db250ZXh0LnNyYyA9IHJlcXVpcmUoIkBzdGF0aWMvYXVkaW8vdGlwcy5tcDMiKTsNCiAgICAvLyAgICAgICAgIGlubmVyQXVkaW9Db250ZXh0Lm9uUGxheSgoKSA9PiB7DQogICAgLy8gICAgICAgICAgIGNvbnNvbGUubG9nKCLlvIDlp4vmkq3mlL4iKTsNCiAgICAvLyAgICAgICAgIH0pOw0KICAgIC8vICAgICAgICAgaW5uZXJBdWRpb0NvbnRleHQub25FcnJvcigocmVzKSA9PiB7DQogICAgLy8gICAgICAgICAgIGNvbnNvbGUubG9nKHJlcz8uZXJyTXNnKTsNCiAgICAvLyAgICAgICAgICAgY29uc29sZS5sb2cocmVzPy5lcnJDb2RlKTsNCiAgICAvLyAgICAgICAgIH0pDQogICAgLy8gICAgICAgICBpbm5lckF1ZGlvQ29udGV4dC5wbGF5KCk7DQogICAgLy8gICAgICAgICAvLyDlr7nnp4HmnInlj5jph4/ov5vooYzotYvlgLwNCiAgICAvLyAgICAgICAgIGlzRmlyc3RJbiA9IGZhbHNlOw0KICAgIC8vICAgICAgICAgdGltZXIgPSBuZXcgRGF0ZSgpOw0KICAgIC8vICAgICAgIH0NCiAgICAvLyAgICAgfSwNCiAgICAvLyAgICAgcmVzZXRGaXJzdEluOiBmdW5jdGlvbiAoKSB7DQogICAgLy8gICAgICAgaXNGaXJzdEluID0gdHJ1ZTsNCiAgICAvLyAgICAgfQ0KICAgIC8vICAgfTsNCiAgICAvLyB9LA0KICAgIC8vIOWIpOaWreaYr+WQpuWcqOWFs+mUrueCueiMg+WbtOWGhQ0KICAgIGlzSW5LZXlQb2ludEJ1ZmZlcigpIHsNCiAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5jdXJyZW50UG9zaXRpb24NCiAgICAgIHRoaXMua2V5RGV0YWlsTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgIGxldCBkZXRhaWwgPSBpdGVtPy5pbnNwZWN0aW9uVGFza0RldGFpbERUTz8uaW5zcGVjdGlvblRhc2tEZXRhaWwNCiAgICAgICAgaWYgKHRydWUpIHsNCiAgICAgICAgICBjb25zdCBjb29yZCA9IFtwYXJzZUZsb2F0KHBvc2l0aW9uLmxvbmdpdHVkZSksIHBhcnNlRmxvYXQocG9zaXRpb24ubGF0aXR1ZGUpXQ0KICAgICAgICAgIGNvbnN0IHBvaW50ID0gdHVyZi5wb2ludChjb29yZCkNCiAgICAgICAgICBjb25zdCBlbmdHZW9tID0NCiAgICAgICAgICAgIHR5cGVvZiBpdGVtLmVuZ0luZm9EVE8uZW5nR2VvbSAhPT0gJ29iamVjdCcNCiAgICAgICAgICAgICAgPyBKU09OLnBhcnNlKGl0ZW0uZW5nSW5mb0RUTy5lbmdHZW9tKQ0KICAgICAgICAgICAgICA6IGl0ZW0uZW5nSW5mb0RUTy5lbmdHZW9tDQogICAgICAgICAgY29uc3QgYnVmZmVyZWQgPSB0dXJmLmJ1ZmZlcihlbmdHZW9tLCAwLjAzNSwgJ2tpbG9tZXRlcnMnKQ0KICAgICAgICAgIGNvbnN0IGlzSW5CdWZmZXIgPSB0dXJmLmluc2lkZShwb2ludCwgYnVmZmVyZWQpDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICAvLyAkcm91dGU6IHsNCiAgICAvLyAgIGhhbmRsZXIodG8sIGZyb20sIG5leHQpIHsNCiAgICAvLyAgICAgaWYgKGZyb20ucGF0aCA9PT0gJy9wcmV2aWV3LWltYWdlJykgew0KICAgIC8vICAgICAgIHRoaXMuc2hvd1Zpc2libGUgPSB0cnVlDQogICAgLy8gICAgIH0gZWxzZSB7DQogICAgLy8gICAgICAgdGhpcy5zaG93VmlzaWJsZSA9IGZhbHNlDQogICAgLy8gICAgIH0NCiAgICAvLyAgIH0sDQogICAgLy8gfSwNCiAgfSwNCiAgYmVmb3JlUm91dGVMZWF2ZSh0bywgZnJvbSwgbmV4dCkgew0KICAgIGlmICh0by5uYW1lID09ICdJbnNwZWN0aW9uJyAmJiBmcm9tLm5hbWUgPT0gJ0luc3BlY3Rpb25NYW5hZ2UnKSB7DQogICAgICBpZiAodGhpcy5pZlJlY29yZGluZykgew0KICAgICAgICB0aGlzLmVuZFJlY29yZCgnbGVhdmUnKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbmV4dCgpDQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIG5leHQoKQ0KICAgIH0NCiAgfSwNCiAgYmVmb3JlRGVzdHJveSgpIHsNCiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnc3RhcnRSZWNvcmRMaW5lcycpDQogICAgYnVzLiRvZmYoJ3N0YXJ0U2lnbkluJykNCiAgICAvLyBidXMuJG9mZigicmVwb3J0SW5zcEV2ZW50Iik7DQogIH0sDQogIC8vIOi/lOWbnuWIsOWIl+ihqOmhtemdog0KICBvbkJhY2tQcmVzcygpIHsNCiAgICAvLyB1bmkucmVkaXJlY3RUbygiL3BhZ2VzL3Byb2plY3RNYW5hZ2VtZW50L3Byb2plY3RMaXN0UGFnZSIpOw0KICAgIHJldHVybiB0cnVlDQogIH0sDQogIG9uTmF2aWdhdGlvbkJhckJ1dHRvblRhcDogZnVuY3Rpb24gKGUpIHt9LA0KfQ0K"},{"version":3,"sources":["daily-task.vue"],"names":[],"mappings":";AAwOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"daily-task.vue","sourceRoot":"src/views/inspectionManage","sourcesContent":["<template>\r\n  <div class=\"task-map full-width\">\r\n    <!-- 导航栏 -->\r\n    <div class=\"navbar-box\">\r\n      <fm-nav-bar\r\n        :title=\"navbarTitle\"\r\n        left-arrow\r\n        @click-left=\"$router.go(-1)\"\r\n        @click-right=\"openPopup\"\r\n      >     \r\n        <template #right>\r\n          <fm-popover\r\n            :visible.sync=\"showPopover\"\r\n            trigger=\"click\"\r\n            :actions=\"actions\"\r\n            @select=\"onSelect\"\r\n            placement=\"bottom-end\"\r\n          >\r\n            <template #reference>\r\n              <img style=\"width: 34px\" :src=\"require('@/assets/img/inspection/增加.png')\" />\r\n            </template>\r\n          </fm-popover>\r\n        </template>\r\n      </fm-nav-bar>\r\n    </div>\r\n    <!-- 地图 -->\r\n    <MapComp\r\n      ref=\"mymap\"\r\n      :ifInspection=\"true\"\r\n      @mapLoaded=\"mapLoaded\"\r\n    ></MapComp>\r\n    <!-- <fm-popup\r\n      :visible.sync=\"pointListShow\"\r\n      close-on-click-modal\r\n      :close-on-popstate=\"true\"\r\n      position=\"bottom\"\r\n      safe-area-inset-bottom\r\n    >\r\n      <fm-tabs type=\"card\" style=\"padding-top: 20px\">\r\n        <fm-tab label=\"未上报关键点\">\r\n          <fm-empty v-if=\"keyDetailList.length <= 0\" description=\"暂无数据\" mode=\"list\"></fm-empty>\r\n        </fm-tab>\r\n        <fm-tab label=\"已上报关键点\">\r\n          <fm-empty v-if=\"keyDetailList.length <= 0\" description=\"暂无数据\" mode=\"list\"></fm-empty>\r\n        </fm-tab>\r\n      </fm-tabs>\r\n    </fm-popup> -->\r\n    <!-- 开始记录与结束记录 -->\r\n    <div class=\"start-record\">\r\n      <img\r\n        v-if=\"!ifRecording\"\r\n        :src=\"require('@/assets/img/inspection/暂停.png')\"\r\n        @click=\"startInspRecord\"\r\n      />\r\n      <img v-else :src=\"require('@/assets/img/inspection/开始.png')\" @click=\"endRecord\" />\r\n      <!-- <fm-button\r\n        v-if=\"!ifRecording\"\r\n        :loading=\"recordButtonLoading\"\r\n        :disabled=\"recordButtonLoading\"\r\n        class=\"start-button\"\r\n        type=\"primary\"\r\n        @click=\"startInspRecord\"\r\n      >开始记录</fm-button>\r\n      <fm-button\r\n        v-else\r\n        :loading=\"recordButtonLoading\"\r\n        :disabled=\"recordButtonLoading\"\r\n        class=\"start-button\"\r\n        type=\"primary\"\r\n        @click=\"endRecord\"\r\n      >结束记录</fm-button> -->\r\n    </div>\r\n    <!-- 数据面板 -->\r\n    <div class=\"controlCard\">\r\n      <div class=\"controlContent\">\r\n        <div class=\"infoContent\">\r\n          <div class=\"endControl\">\r\n            <div class=\"leftText\">\r\n              <img :src=\"require('@/assets/img/inspection/剩余时间.png')\" />\r\n              <fm-count-down\r\n                style=\"margin: auto\"\r\n                :time=\"getRestTime(taskDetail.planEndTime)\"\r\n                format=\"DD天HH小时\"\r\n              />\r\n            </div>\r\n            <div class=\"rightButton\">\r\n              <fm-button v-show=\"ifRecording\" class=\"endBtn\" round @click=\"endTask\">结束</fm-button>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"bottomSide\">\r\n            <div class=\"block\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ changeToRate(taskDetail.coverage) }}\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">覆盖率</div>\r\n            </div>\r\n\r\n            <div class=\"block\">\r\n              <div class=\"rate\">\r\n                <div class=\"centerStyle\">\r\n                  <div class=\"inspKp\" style=\"font-size: 19px\">\r\n                    {{ changeToInspCount(taskDetail.reportRate) }}\r\n                  </div>\r\n                  <div class=\"uninspKp\" style=\"font-size: 14px\">\r\n                    /{{ changeToAllInspCount(taskDetail.reportRate) }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">关键点</div>\r\n            </div>\r\n\r\n            <div class=\"block\" @click=\"reportClick\" style=\"cursor: pointer;\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ problemDataList1.length + problemDataList2.length }}\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">上报</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- 轨迹显示与定位功能 -->\r\n    <div class=\"tool-box\">\r\n      <!-- 地图旋转、俯视角度重置 -->\r\n      <!-- <div class=\"refresh\" @click=\"resetMapView\">\r\n        <fm-image class=\"refresh-image\" :src=\"require('@/assets/img/inspection/reset.png')\"></fm-image>\r\n      </div>\r\n      <div class=\"route\" @click=\"showRoute\">\r\n        <fm-image\r\n          v-if=\"isShowRoute\"\r\n          class=\"route-image\"\r\n          :src=\"require('@/assets/img/inspection/route2.png')\"\r\n        ></fm-image>\r\n        <fm-image v-else class=\"route-image\" :src=\"require('@/assets/img/inspection/route.png')\"></fm-image>\r\n      </div> -->\r\n      <div class=\"location\" @click=\"startLocation\">\r\n        <fm-image\r\n          class=\"location-image\"\r\n          :src=\"require('@/assets/img/inspection/location.png')\"\r\n        ></fm-image>\r\n      </div>\r\n    </div>\r\n    <!-- 签到框 -->\r\n    <fm-popup\r\n      :visible.sync=\"signShow\"\r\n      :modal=\"false\"\r\n      round\r\n      position=\"bottom\"\r\n      :style=\"{ height: signForm.deviceStatus == '1' ? '76%' : '62%' }\"\r\n    >\r\n      <div class=\"popup-view\">\r\n        <fm-form ref=\"signForm\">\r\n          <div class=\"title\">\r\n            <img :src=\"require('@/assets/img/inspection/sideIcon.png')\" />\r\n            <div class=\"deviceId\">{{ deviceName }}</div>\r\n          </div>\r\n          <fm-field :name=\"signForm.deviceStatus\" label=\"运行情况\" required>\r\n            <template #input>\r\n              <fm-radio-group v-model=\"signForm.deviceStatus\" direction=\"horizontal\">\r\n                <fm-radio name=\"0\">正常</fm-radio>\r\n                <fm-radio name=\"1\">异常</fm-radio>\r\n              </fm-radio-group>\r\n            </template>\r\n          </fm-field>\r\n          <fm-field v-if=\"signForm.deviceStatus == '1'\" label=\"是否上报\" required>\r\n          </fm-field>\r\n          <fm-field :name=\"signForm.isReport\" v-if=\"signForm.deviceStatus == '1'\">\r\n            <template #input>\r\n              <fm-radio-group v-model=\"signForm.isReport\" direction=\"horizontal\">\r\n                <fm-radio v-for=\"(item, index) in reportChose\" :key=\"index\" :name=\"item.value\"\r\n                  >{{ item.name }}\r\n                </fm-radio>\r\n              </fm-radio-group>\r\n            </template>\r\n          </fm-field>\r\n          <uploader\r\n            v-model=\"attachment\"\r\n            @fileChange=\"fileChange\"\r\n            multiple\r\n            :maxImagesCount=\"2\"\r\n            type=\"image\"\r\n          />\r\n          <fm-field label=\"备注\" type=\"textarea\" placehold=\"请输入\" v-model=\"signForm.remark\">\r\n          </fm-field>\r\n        </fm-form>\r\n      </div>\r\n      <div class=\"btnArea\" v-show=\"!hasSignIn\">\r\n        <fm-button class=\"btn1\" @click=\"onCancel\" round type=\"default\">取消</fm-button>\r\n        <fm-button class=\"btn2\" @click=\"onConfirm\" round type=\"primary\">提交</fm-button>\r\n      </div>\r\n      <div class=\"btnArea\" v-show=\"hasSignIn\">\r\n        <fm-button class=\"btn\" @click=\"onCancel\" round type=\"default\">关闭</fm-button>\r\n      </div>\r\n    </fm-popup>\r\n    <fm-popup :visible.sync=\"reportShow\" @close=\"handleClose\" round position=\"bottom\" :overlay-style=\"{ background: 'rgba(0, 0, 0, 0.1)' }\" :style=\"{ height: '50%' }\">\r\n      <fm-tabs v-model=\"active\" swipeable style=\"height: 100%\">\r\n        <fm-tab label=\"问题上报\">\r\n          <div v-for=\"(item, index) in problemDataList1\" :key=\"index\">\r\n            <problemCardInfo\r\n              type=\"001\"\r\n              :cardInfo=\"item\"\r\n              @toDetailPanel=\"toDetailPanel\"\r\n              @flyToPoint=\"flyToPoint\"\r\n            ></problemCardInfo>\r\n          </div>\r\n        </fm-tab>\r\n        <fm-tab label=\"设施缺陷\">\r\n          <div v-for=\"(item, index) in problemDataList2\" :key=\"index\">\r\n            <problemCardInfo\r\n              type=\"002\"\r\n              :cardInfo=\"item\"\r\n              @toDetailPanel=\"toDetailPanel\"\r\n              @flyToPoint=\"flyToPoint\"\r\n            ></problemCardInfo>\r\n          </div>\r\n        </fm-tab>\r\n      </fm-tabs>\r\n    </fm-popup>\r\n    \r\n    <!-- 提示层 -->\r\n    <div v-show=\"ifTips\" class=\"tip-tools\">\r\n      <img :src=\"require('@/assets/img/tips.png')\" class=\"tipImg\" />\r\n      <div class=\"context\">请在地图上选择设施或者点位</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport bus from '../../views/inspectMap/utils/Bus.js'\r\nimport axios from 'axios'\r\nimport dayjs from 'dayjs'\r\nimport MapComp from '../../views/inspectMap/index.vue'\r\nimport keyPointList from './keypoint-list.vue'\r\nimport request from '@/utils/request'\r\nimport * as api from './api'\r\nimport { Toast, Dialog } from 'fawkes-mobile-lib'\r\nimport * as turf from '@turf/turf'\r\nimport Uploader from '@/components/upload/Uploader.vue'\r\nimport problemCardInfo from './problemCardInfo';\r\nimport API from \"@/common/config.js\";\r\nconst mapObj = {\r\n  map: null,\r\n  mapInstance: null,\r\n}\r\nexport default {\r\n  name: 'daily-task',\r\n  components: {\r\n    MapComp,\r\n    keyPointList,\r\n    Uploader,\r\n    problemCardInfo,\r\n  },\r\n  data() {\r\n    return {\r\n      ifTips: false,\r\n      reportDataIsLoaded: false,\r\n      // 巡检任务下所有巡检管线\r\n      allTaskLines: [],\r\n      isView: true,\r\n      active: 0,\r\n      deviceName: '',\r\n      hasSignIn: false,\r\n      showPopover: false,\r\n      actions: [\r\n        {\r\n          text: '问题上报',\r\n        },\r\n        {\r\n          text: '设施缺陷',\r\n        },\r\n      ],\r\n      currentRate: 0,\r\n      // 控制关键点列表显隐\r\n      pointListShow: false,\r\n      // 全局发声函数\r\n      // 记录开始巡检的时间，用于判断是否在开始巡检的10s内\r\n      startRecordTimer: '',\r\n      navbarTitle: '日常任务',\r\n      // 上报失败的巡检轨迹点位数组\r\n      reportFailTrackPoints: [],\r\n      isShowRoute: true,\r\n      inspBusinessType: '',\r\n      recordData: [],\r\n      // 当前巡检员所处位置\r\n      currentPosition: null,\r\n      lines: [],\r\n      // 巡检员信息\r\n      userInfo: {},\r\n      ifRecording: false,\r\n      endRecordShow: false,\r\n      selectEventType: false,\r\n      eventTypeList: [],\r\n      signShow: false,\r\n      attachment: '',\r\n      signForm: {\r\n        deviceStatus: '1',\r\n        inspImagesList: [],\r\n        remark: '',\r\n        isReport: '',\r\n        taskId: '',\r\n        pointId: '',\r\n      },\r\n      taskDetail: {\r\n        coverage: '0/0',\r\n        reportRate: '0/0',\r\n        planEndTime: '',\r\n      },\r\n      engInfoDTO: {},\r\n      taskRestTime: 0,\r\n      reportFooterShow: false,\r\n      feature: {},\r\n      planDetail: {},\r\n      // 用于地图中显示范围和关键点\r\n      inspRangeList: [],\r\n      rangeList: [],\r\n      keyDetailList: [],\r\n      isRunList: [\r\n        {\r\n          name: '正常',\r\n          value: '1',\r\n        },\r\n        {\r\n          name: '异常',\r\n          value: '0',\r\n        },\r\n      ],\r\n      reportChose: [\r\n        {\r\n          name: '问题上报',\r\n          value: '问题上报',\r\n        },\r\n        {\r\n          name: '新增缺陷',\r\n          value: '新增缺陷',\r\n        },\r\n        {\r\n          name: '无需上报',\r\n          value: '无需上报',\r\n        },\r\n      ],\r\n      rules: {\r\n      },\r\n      previewURL: '/sys-storage/download_image?f8s=',\r\n      upimgPreview: [],\r\n      headers: {},\r\n      url: {\r\n        // 本页面使用到的url\r\n        uploadFile: 'sys-storage/upload',\r\n        findFile: 'ecidi-cmp/file/cmpFileGroup/findFilesByGroupId',\r\n      },\r\n      pollingFlag: false,\r\n      pollingGapTime: 3,\r\n      trackPointList: [],\r\n      trackPointTimeList: [],\r\n      overSpeedTrackLineList: [],\r\n      trackLocation_start: '',\r\n      trackLocation_end: '',\r\n      showVisible: false,\r\n      isMask: false, //是否显示遮罩层\r\n      reportShow: false, // 问题上报面板显示\r\n      accessToken: this.$storage.get('access_token'),\r\n      header: {},\r\n      formToken: '',\r\n      // 问题上报list\r\n      problemDataList1: [],\r\n      // 设施缺陷list\r\n      problemDataList2: []\r\n    }\r\n  },\r\n  computed: {\r\n  },\r\n  created() {\r\n    // 获取问题上报和设施缺陷数据\r\n    this.getCardListData()\r\n  },\r\n  mounted() {\r\n    this.userInfo = this.$store.state.userInfo\r\n    console.log('this.userInfo: ', this.userInfo);\r\n    this.isStart = false\r\n    localStorage.setItem('startRecordLines', 'end')\r\n    this.navbarTitle = '日常任务'\r\n    bus.$on('startSignIn', (feature) => {\r\n      this.startSignIn(feature)\r\n    })\r\n    this.isView = this.$route.query.isView\r\n    const id = this.$route.query.taskId\r\n    this.getTaskById(id)\r\n    this.getTrackRecordsById(id)\r\n    // this.getAppInspData(id)\r\n    let that = this\r\n    !(function computedPosition() {\r\n      let gapTimer = 10\r\n      if (that.currentPosition) {\r\n        // 计算当前时间与当前插件返回的时间的间隔\r\n        let gap = (new Date().getTime() - new Date(that.currentPosition.locTime).getTime()) / 1000\r\n        // 如果间隔时间大于某一值，则说明在gapTimer时间内没有收到来自插件的新点位\r\n        if (gap > gapTimer) {\r\n          // 开启提示\r\n          // Notify.warning({ message: '当前GPS信号较弱,位置和轨迹更新可能缓慢', duration: 5000 })\r\n          let t = setTimeout(() => {\r\n            // 提示结束，并开始下次调用\r\n            computedPosition()\r\n          }, 15000)\r\n        } else {\r\n          // 开始下次调用\r\n          let t = setTimeout(() => {\r\n            computedPosition()\r\n          }, 10000)\r\n        }\r\n      } else {\r\n        // Notify.warning({ message: '当前GPS无信', duration: 5000 })\r\n        let t = setTimeout(() => {\r\n          computedPosition()\r\n        }, 10000)\r\n      }\r\n    })()\r\n  },\r\n  methods: {\r\n    // 获取问题上报和设施缺陷数据\r\n    getCardListData() {\r\n      // 获取header，查询工单用\r\n      axios({\r\n        url: API.VUE_APP_WPG_URL + '/main/userCenterApi/sso/tokenByToken',\r\n        method: 'post',\r\n        params: {\r\n          token: this.accessToken,\r\n        },\r\n        headers: {\r\n          Authorization: 'Basic b3V0d29yazp3cGcyMDIw',\r\n        },\r\n      }).then((res) => {\r\n        if (res.status == 200) {\r\n          this.formToken = res.data.resultData.token\r\n          this.header = {\r\n            'Content-Type': 'application/json',\r\n            Authorization: 'Bearer ' + this.formToken,\r\n          }\r\n        }\r\n      })\r\n    },\r\n    // 问题上报(smallType: 'abnormal_inform')、设施缺陷(smallType: \"defect\")使用同一接口\r\n    async getProblemDataList(params) {\r\n      this.problemDataList1 = []\r\n      this.problemDataList2 = []\r\n\r\n      let commonParams = Object.assign({\r\n        sysCode: 'outwork',\r\n        // token: this.accessToken,\r\n        page: {\r\n          current: 1,\r\n          size: 99999, // 查全部\r\n        }\r\n      }, params)\r\n      // 问题上报\r\n      let params1 = {\r\n        ...commonParams,\r\n        smallType: 'abnormal_inform'\r\n      }\r\n      // 设施缺陷\r\n      let params2 = {\r\n        ...commonParams,\r\n        smallType: 'defect'\r\n      }\r\n      let problemPointFeatures = []\r\n      // 问题上报\r\n      await this.getAxiosData(params1, this.problemDataList1)\r\n      // 设施缺陷\r\n      await this.getAxiosData(params2, this.problemDataList2)\r\n      let allProblem = this.problemDataList1.concat(this.problemDataList2)\r\n      allProblem.forEach(it => {\r\n        problemPointFeatures.push({\r\n          type: 'Feature',\r\n          geometry: {\r\n            type: 'Point',\r\n            coordinates: it.lnglat\r\n          },\r\n          properties: {\r\n            id: it.id,\r\n            title: it.title\r\n          }\r\n        })\r\n      })\r\n      this.$refs.mymap.addInspEventLayer(problemPointFeatures)\r\n      this.reportDataIsLoaded = true\r\n    },\r\n    getAxiosData(params, problemDataList) {\r\n      return new Promise((resolve, reject) => {\r\n        axios({\r\n          url: API.VUE_APP_WPG_URL + '/main/outworkapi/ticketStatisticClient/getTicketList',\r\n          method: 'post',\r\n          data: params,\r\n          headers: this.header,\r\n        }).then((res) => {\r\n          if (res.status == 200) {\r\n            res.data.resultData.records.forEach((item) => {\r\n              problemDataList.push({\r\n                id: item.id, // 工单ID\r\n                title: item.title, // 工单标题\r\n                ticketStatusName: item.ticketStatusName,\r\n                handleType: item.formValue.handleType, // 描述\r\n                createByName: item.createByName, // 创建人\r\n                createTime: item.createTime.substring(0, 10), // 创建时间\r\n                defectFrom: item.formValue.defectFrom,\r\n                faultTypes: item.formValue.faultTypes,\r\n                fileUrl: item.formValue?.handleImgs?.[0]?.fileUrl,\r\n                // 图片地址\r\n                url: item.formValue?.files?.[0]?.url,\r\n                // 发生经纬度\r\n                lnglat: [item.appealLng, item.appealLat],\r\n                device_type: item.formValue?.device_type || [],\r\n                questionDescribe: item.formValue.questionDescribe,\r\n              })\r\n            })\r\n            resolve()\r\n          }\r\n          // problemDataList.forEach((item) => {\r\n          //   // console.log('图片地址', item.url)\r\n          // })\r\n        })\r\n      })\r\n    },\r\n    // 问题上报点击标题、设施缺陷点击卡片进入详情页\r\n    toDetailPanel(cardDetail) {\r\n      window.location.href =\r\n        'http://172.20.79.70/outworkApp/#/pages/ticket/detail/index?id=' +\r\n        cardDetail.id +\r\n        '&sysCode=outwork' +\r\n        '&token=' +\r\n        this.formToken\r\n    },\r\n    // 卡片定位\r\n    flyToPoint(lnglat) {\r\n      mapObj.map.flyTo({ center: lnglat, zoom: 17.5 })\r\n    },\r\n    // 上报\r\n    reportClick() {\r\n      if (this.reportDataIsLoaded) {\r\n        this.reportShow = true\r\n        mapObj.map.setLayoutProperty('eventPointsLayer', 'visibility', 'visible')\r\n      } else {\r\n        Toast({\r\n          message: '上报数据加载中。。。',\r\n          duration: 1500\r\n        })\r\n        return\r\n      }\r\n    },\r\n    handleClose() {\r\n      mapObj.map.setLayoutProperty('eventPointsLayer', 'visibility', 'none')\r\n    },\r\n    fileChange(file) {\r\n      this.signForm.inspImagesList = []\r\n      file.fileList.forEach(it => {\r\n        this.signForm.inspImagesList.push(\r\n          {\r\n            fileId: it.response.groupToken,\r\n            imagesName: it.url\r\n          }\r\n        )\r\n      })\r\n      console.log(this.signForm)\r\n    },\r\n    async endTask() {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '该巡检任务已结束',\r\n          duration: 1500\r\n        })\r\n        return\r\n      }\r\n      await this.getTaskById(this.$route.query.taskId)\r\n      let hasInspKp = this.changeToInspCount(this.taskDetail.reportRate)\r\n      let allInspKp = this.changeToAllInspCount(this.taskDetail.reportRate)\r\n      Dialog.confirm({\r\n        title: '提示',\r\n        message: `您还有${allInspKp - hasInspKp}个关键点未打卡，确定结束巡检任务？`,\r\n      })\r\n        .then(() => {\r\n          this.endRecordConfirm('task')\r\n        })\r\n        .catch(() => {\r\n          this.endRecordCancel()\r\n        })\r\n    },\r\n    openPopup() {\r\n      this.showPopover = true\r\n    },\r\n    onSelect(val) {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '该巡检任务已结束',\r\n          duration: '1500'\r\n        })\r\n        return\r\n      }\r\n      // Toast({\r\n      //   message: '请在地图上选择设施或者点位',\r\n      //   duration: 1500\r\n      // });\r\n      this.ifTips = true\r\n      setTimeout(() => {\r\n        this.ifTips = false\r\n      }, 2500)\r\n      mapObj.map.off('click', 'keypointsLayer', this.$refs.mymap.signInBuffer)\r\n      val.text == '问题上报' ? mapObj.map.on('click', this.selectReportPoint) : mapObj.map.on('click', this.selectFlawPoint)\r\n    },\r\n    selectReportPoint(e) {\r\n      let features = mapObj.map.queryRenderedFeatures(e.point)\r\n      console.log(features)\r\n      if (features.length > 0) {\r\n        if (\r\n        features[0].source != \"inspUser\" \r\n        && features[0].source != \"initInspLineSource\" \r\n        && features[0].source != \"keypoints\" \r\n        &&(features[0].geometry.type === \"Point\")\r\n        ) {\r\n        this.$refs.mymap.addEventObjMarker(features[0], 'event', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName });\r\n        } else if (features.length > 1 \r\n          && features[1].source !=\"eventPoints\" \r\n          && features[1].source != \"inspUser\" \r\n          && features[1].source != \"keypoints\" \r\n          && (features[1].geometry.type === \"Point\")\r\n          ) {\r\n          this.$refs.mymap.addEventObjMarker(features[1], 'event', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName });\r\n        }\r\n      }\r\n      mapObj.map.on('click', 'keypointsLayer', this.$refs.mymap.signInBuffer)\r\n      mapObj.map.off('click', this.selectReportPoint)\r\n    },\r\n    selectFlawPoint(e) {\r\n      let features = mapObj.map.queryRenderedFeatures(e.point)\r\n      console.log(features)\r\n      if (features.length > 0) {\r\n        if (\r\n        features[0].source !=\"eventPoints\"\r\n        && features[0].source != \"inspUser\" \r\n        && features[0].source != \"initInspLineSource\" \r\n        && features[0].source != \"keypoints\" \r\n        &&(features[0].geometry.type === \"Point\")\r\n        ) {\r\n        this.$refs.mymap.addEventObjMarker(features[0], 'flaw', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName });\r\n        } else if (features.length > 1 \r\n          && features[1].source !=\"eventPoints\"\r\n          && features[1].source != \"inspUser\" \r\n          && features[1].source != \"keypoints\"\r\n          && (features[1].geometry.type === \"Point\")\r\n          ) {\r\n          this.$refs.mymap.addEventObjMarker(features[1], 'flaw', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName });\r\n        }\r\n      }\r\n      mapObj.map.on('click', 'keypointsLayer', this.$refs.mymap.signInBuffer)\r\n      mapObj.map.off('click', this.selectFlawPoint)\r\n    },\r\n    getRestTime(time) {\r\n      return time ? new Date(time).getTime() - new Date().getTime() : 0\r\n    },\r\n    changeToInspCount(reportRate) {\r\n      if (reportRate.includes('/')) {\r\n        return Number(reportRate.split('/')[0])\r\n      } else {\r\n        return 0\r\n      }\r\n    },\r\n    changeToAllInspCount(reportRate) {\r\n      if (reportRate.includes('/')) {\r\n        return Number(reportRate.split('/')[1])\r\n      } else {\r\n        return 0\r\n      }\r\n    },\r\n    changeToRate(coverage) {\r\n      if (coverage.includes('/')) {\r\n        let insp = Number(coverage.split('/')[0])\r\n        let uninsp = Number(coverage.split('/')[1])\r\n        if (uninsp) {\r\n          return ((insp / uninsp) * 100).toFixed(2) + '%'\r\n        } else {\r\n          return '0%'\r\n        }\r\n      } else {\r\n        return '0%'\r\n      }\r\n    },\r\n    mapLoaded(mapInstance) {\r\n      console.log('mapLoadedddddddd')\r\n      let that = this\r\n      mapObj.mapInstance = mapInstance\r\n      mapObj.map = mapInstance.map\r\n      // this.$refs.mymap.setInspUserPosition({\r\n      //   longitude: 115.854563,\r\n      //   latitude: 39.043407\r\n      // })\r\n      yuanchu.locationAMap.requestSingleLocation(\r\n        ['1'],\r\n        (res) => {\r\n          that.currentPosition = JSON.parse(JSON.stringify(res))\r\n          const param = {\r\n            ...that.currentPosition,\r\n          }\r\n          this.$refs.mymap.setInspUserPosition(param)\r\n        },\r\n        (err) => {\r\n          console.log('err=', err)\r\n        }\r\n      )\r\n    },\r\n    // 刷新地图\r\n    refreshMap() {\r\n      try {\r\n        this.clearBufferTrack()\r\n        // 清空所有的popup\r\n        let classNames = document.getElementsByClassName('mapboxgl-popup-anchor-bottom')\r\n        for (let i = classNames.length - 1; i >= 0; i--) {\r\n          if (classNames[i] != null) {\r\n            classNames[i].parentNode.removeChild(classNames[i])\r\n          }\r\n        }\r\n        // 清空所有关键点marker\r\n        let ids = []\r\n        this.keyDetailList.forEach((item) => {\r\n          if (item.engInfoDTO) {\r\n            ids.push(item.engInfoDTO.engId)\r\n          }\r\n        })\r\n        mapObj.mapInstance && this.$refs.mymap.removeKeyPointMarker(ids)\r\n        // 清空巡检范围图层\r\n        mapObj.map.getSource('rangeSource') &&\r\n          mapObj.mapInstance.setSourceData('rangeSource', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n        // 清空巡检管线图层\r\n        mapObj.map.getSource('initInspLineSource') &&\r\n          mapObj.mapInstance.setSourceData('initInspLineSource', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n        mapObj.map.getSource('unInspLineSource') &&\r\n          mapObj.mapInstance.setSourceData('unInspLineSource', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n        mapObj.map.getSource('inspLineSource') &&\r\n          mapObj.mapInstance.setSourceData('inspLineSource', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n        mapObj.map.getSource('inspUserLineSource') &&\r\n          mapObj.mapInstance.setSourceData('inspUserLineSource', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n        mapObj.map.getSource('inspUser') &&\r\n          mapObj.mapInstance.setSourceData('inspUser', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n        mapObj.map.getSource('buffered') &&\r\n          mapObj.mapInstance.setSourceData('buffered', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n        // 如果存在事件图层，就移除该图层\r\n        mapObj.map.getLayer('eventPointsLayer') && mapObj.map.removeLayer('eventPointsLayer')\r\n        mapObj.map.getSource('eventPoints') && mapObj.map.removeSource('eventPoints')\r\n        this.$refs.mymap.removeEventObjMarker()\r\n        this.$refs.mymap.removeRangeMVT()\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    },\r\n    // 刷新任务\r\n    refreshTask() {\r\n      // let ids = []\r\n      // this.keyDetailList.forEach((item) => {\r\n      //   if (item.engInfoDTO) {\r\n      //     ids.push(item.engInfoDTO.engId)\r\n      //   }\r\n      // })\r\n      // mapObj.mapInstance && this.$refs.mymap.removeKeyPointMarker(ids)\r\n      const id = this.$route.query.taskId\r\n      this.getTaskById(id, 'refresh')\r\n      // await this.getAppInspData(id)\r\n    },\r\n    async getTrackRecordsById(id) {\r\n      const res = await request({\r\n        url: '/xasw-pipe-operation/inspTask/track',\r\n        method: 'get',\r\n        params: { id, pageNum: 1, pageSize: 9999 },\r\n      })\r\n      if (res && res.status) {\r\n        console.log(res)\r\n      }\r\n    },\r\n    // 根据任务id获取巡检状况\r\n    async getTaskById(id, type=null) {\r\n      Toast.loading({\r\n        message: '地图加载中...',\r\n        forbidClick: true,\r\n      })\r\n      this.isMask = true\r\n      // await this.postAppData(id);\r\n      // 处理已巡检管线的接口\r\n      const recordLines = await api.recordedPipeLine({\r\n        taskId: id,\r\n        page: 1,\r\n        size: 9999\r\n      })\r\n      this.lines = []\r\n      if (recordLines.status) {\r\n        this.lines = recordLines.data.records.map((item) => item.pipeId)\r\n      }\r\n      this.reportFooterShow = false // 事件上报弹窗开关\r\n      const res = await request({\r\n        url: '/xasw-pipe-operation/inspTask/getById',\r\n        method: 'get',\r\n        params: { id },\r\n      })\r\n      // let point = turf.point([115.854546, 39.043415])\r\n      // this.$refs.mymap.drawBuffer(point, 5)\r\n      if (res && res.status) {\r\n        this.taskDetail = res.data.inspTask\r\n        this.planDetail = res.data.inspPlan\r\n        this.inspRangeList = res.data.detailList.map((range) => {\r\n          return {\r\n            taskId: id,\r\n            ...range,\r\n          }\r\n        })\r\n        // 修改未巡检(0)任务状态至巡检中(1)\r\n        if (this.$route.query.isNew && this.taskDetail.taskStatus != 1) {\r\n          this.stratOrEndTaskRecord(1)\r\n        }\r\n        if (type != 'refresh') {\r\n          const allTaskLines = await api.getAllTaskLines({\r\n            devType: '管线',\r\n            gridId: this.planDetail.gridId,\r\n            pageNum: 1,\r\n            pageSize: 99999\r\n          })\r\n          if (allTaskLines.status) {\r\n            allTaskLines.data.list.forEach(item => {\r\n              this.allTaskLines.push({\r\n                type: 'Feature',\r\n                id: item.id,\r\n                geometry: JSON.parse(item.geom),\r\n                properties: {\r\n                  id: item.id,\r\n                  length: item['length']\r\n                }\r\n              })\r\n            })\r\n            this.$refs.mymap.setAllInspLineSource(this.allTaskLines)\r\n          }\r\n        }\r\n        const kpRes = await request({\r\n          url: '/xasw-pipe-operation/inspTask/point',\r\n          method: 'get',\r\n          params: { id, gridId: this.planDetail.gridId, pageNum: 1, pageSize: 9999, bizScope: this.$route.query.taskType },\r\n        })\r\n        this.keyDetailList = []\r\n        if (kpRes && kpRes.status) {\r\n          let keys = Object.keys(kpRes.data)\r\n          keys.forEach((item) => {\r\n            this.keyDetailList.push(...kpRes.data[item].list)\r\n          })\r\n        }\r\n        let completion = this.changeToRate(this.taskDetail.coverage)\r\n        this.navbarTitle = this.taskDetail.taskName\r\n        try {\r\n          const that = this\r\n          let timer = setInterval(function () {\r\n            // 30s后取消\r\n            setTimeout(() => {\r\n              clearInterval(timer)\r\n            }, 30000)\r\n            if (that.$refs.mymap.isOnLoaded()) {\r\n              clearInterval(timer)\r\n              that.$refs.mymap.addKeyPoints(that.keyDetailList)\r\n              if (type != 'refresh') {\r\n                that.$refs.mymap.addRangeList(that.inspRangeList)\r\n              }\r\n              const params = {\r\n                extParam: {\r\n                  task_id: that.$route.query.taskId\r\n                }\r\n              }\r\n              // that.getEventAll(params);\r\n              // 问题上报、设施缺陷接口\r\n              that.getProblemDataList(params)\r\n              // let reslines = that.lines.concat(that.recordData);\r\n              // 图层回显方式改变\r\n              that.$refs.mymap.addInspRecordTileLineSource(that.lines, completion)\r\n              if (!that.currentPosition) return\r\n              const param = {\r\n                ...that.currentPosition,\r\n              }\r\n              that.$refs.mymap.setInspUserPosition(param)\r\n            }\r\n          }, 500)\r\n        } catch (e) {\r\n          console.log(e)\r\n          if (this.isMask) {\r\n            this.isMask = false\r\n          }\r\n        }\r\n      } else {\r\n        if (this.isMask) {\r\n          this.isMask = false\r\n        }\r\n        Toast({\r\n          message: '网络状态较差，加载任务失败',\r\n          icon: 'warn',\r\n          duration: 3000,\r\n        })\r\n      }\r\n    },\r\n    // 获取从app端传来的数据\r\n    postAppData(id) {\r\n      let that = this\r\n      return new Promise(async function (resolve, reject) {\r\n        /** 2021/9/22 取消缓存在app端的数据上报\r\n        const result = await that.$api.postAction(\"/ops-inspection/api/inspectionRecordMultiple\", that.recordData);\r\n        if (result.status) {\r\n          console.log(\"上报缓存在app的数据\");\r\n        };\r\n        */\r\n        if (that.reportFailTrackPoints.length <= 0) {\r\n          resolve()\r\n          return\r\n        }\r\n        const result2 = await inspectionTrackMultiple(that.reportFailTrackPoints)\r\n        if (result2 && result2.status) {\r\n          console.log('上报缓存在app端的轨迹点数据')\r\n          let resetTrackPoints = []\r\n          that.reportFailTrackPoints = resetTrackPoints\r\n          uniWebView.postMessage({\r\n            data: {\r\n              action: 'saveTrackPoints',\r\n              trackData: JSON.stringify(resetTrackPoints),\r\n              taskId: id,\r\n            },\r\n          })\r\n        }\r\n        resolve()\r\n      })\r\n    },\r\n    // 获取巡检事件\r\n    async getEventAll(params) {\r\n      const res = await inspectionEventAll(params)\r\n      if (res && res.status) {\r\n        let features = []\r\n        res.data.forEach((item) => {\r\n          if (item.eventItemText) {\r\n            const geom = JSON.parse(item.eventItemText)\r\n            let feature = {\r\n              geometry: geom.type === 'Feature' ? geom.geometry : geom,\r\n              properties: {},\r\n            }\r\n            this.$set(feature, 'geometry', this.computeCenter(feature.geometry))\r\n            this.$set(feature, 'id', item.id)\r\n            this.$set(feature.properties, 'eventType', item.eventType)\r\n            // this.$set(feature, \"eventType\", item.eventType);\r\n            // this.$refs.mymap.addInspEventMarker(feature);\r\n            features.push(feature)\r\n          }\r\n        })\r\n        this.$refs.mymap.addInspEventLayer(features)\r\n      }\r\n    },\r\n    // 获取事件类型\r\n    getEventTypeList() {\r\n      getEventTypeList()\r\n        .then((res) => {\r\n          this.eventTypeList = res.data.sons.map((item) => {\r\n            return {\r\n              value: item.code,\r\n              label: item.name,\r\n              children: item.sons.map((item) => {\r\n                return {\r\n                  value: item.code,\r\n                  label: item.name,\r\n                  children: item.sons.map((item) => {\r\n                    return {\r\n                      value: item.code,\r\n                      label: item.name,\r\n                    }\r\n                  }),\r\n                }\r\n              }),\r\n            }\r\n          })\r\n        })\r\n        .catch(() => {\r\n          Toast({\r\n            message: '字典加载失败',\r\n          })\r\n        })\r\n    },\r\n    // 轮询 currentPosition，绘制轨迹线\r\n    polling() {\r\n      let that = this\r\n      if (that.pollingFlag) {\r\n        yuanchu.locationAMap.requestLocations(\r\n          ['5', '1', '10', '30', '0', true],\r\n          (res) => {\r\n            that.currentPosition = JSON.parse(JSON.stringify(res))\r\n            that.currentPosition = Object.assign(that.currentPosition, {\r\n              direction: 0\r\n            })\r\n            if (!that.currentPosition) {\r\n              Toast({\r\n                message: '当前GPS信号弱',\r\n                duration: 1500\r\n              })\r\n              return\r\n            }\r\n            if (\r\n              that.trackPointList.length != 0 &&\r\n              that.trackPointList[that.trackPointList.length - 1][0] !=\r\n                that.currentPosition.longitude &&\r\n              that.trackPointList[that.trackPointList.length - 1][1] !=\r\n                that.currentPosition.latitude\r\n            ) {\r\n              // 新一次轮询的当前时间\r\n              let date_now = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n              // 上次最后的点位\r\n              let lastPoint = that.trackPointList[that.trackPointList.length - 1]\r\n              // 当前点位\r\n              let currentPoint = [that.currentPosition.longitude, that.currentPosition.latitude]\r\n              let distance = (Number(that.GetDistance(lastPoint, currentPoint))) * 1000\r\n              that.trackPointList.push([\r\n                that.currentPosition.longitude,\r\n                that.currentPosition.latitude\r\n              ])\r\n              that.trackPointTimeList.push(date_now)\r\n              console.log(that.trackPointList, this.trackPointTimeList)\r\n\r\n              // 构造临时线对象\r\n              let jsonLine = {\r\n                type: 'Feature',\r\n                properties: {},\r\n                geometry: {\r\n                  type: 'LineString',\r\n                  coordinates: that.trackPointList,\r\n                },\r\n              }\r\n              const coord = [parseFloat(that.currentPosition.longitude), parseFloat(that.currentPosition.latitude)];\r\n              const point = turf.point(coord);\r\n              mapObj.mapInstance.setSourceData(\"inspUser\", {\r\n                type: \"FeatureCollection\",\r\n                features: [point]\r\n              })\r\n              let jsonLineFeatureCollection = {\r\n                type: 'FeatureCollection',\r\n                features: [jsonLine],\r\n              }\r\n              if (mapObj.map.getSource('trackLineSource_now')) {\r\n                mapObj.map.getSource('trackLineSource_now').setData(jsonLineFeatureCollection)\r\n              } else {\r\n                mapObj.map.addSource('trackLineSource_now', {\r\n                  type: 'geojson',\r\n                  data: jsonLineFeatureCollection,\r\n                })\r\n              }\r\n              if (mapObj.map.getLayer('trackLineLayer_now')) {\r\n              } else {\r\n                mapObj.map.addLayer({\r\n                  id: 'trackLineLayer_now',\r\n                  type: 'line',\r\n                  source: 'trackLineSource_now',\r\n                  layout: {\r\n                    'line-cap': 'round',\r\n                    'line-join': 'round',\r\n                    'line-sort-key': 1,\r\n                    visibility: 'visible',\r\n                    // visibility: \"none\"\r\n                  },\r\n                  paint: {\r\n                    'line-color': '#addd52',\r\n                    'line-width': 5,\r\n                    'line-opacity': 0.8,\r\n                  },\r\n                }, 'inspUserLayer')\r\n              }\r\n              let param = {\r\n                ...that.currentPosition,\r\n              }\r\n              // that.$refs.mymap.setInspUserPosition(param)\r\n              if (mapObj.map.getLayer('trackLineLayer_arrow')) {\r\n              } else {\r\n                mapObj.map.addLayer({\r\n                  id: 'trackLineLayer_arrow',\r\n                  type: 'symbol',\r\n                  source: 'trackLineSource_now',\r\n                  layout: {\r\n                    'symbol-placement': 'line',\r\n                    'symbol-spacing': 20,\r\n                    'icon-image': 'arrowIcon',\r\n                    'icon-size': 0.5,\r\n                    'icon-allow-overlap': true,\r\n                    'symbol-sort-key': 3,\r\n                    visibility: 'visible',\r\n                    // visibility: \"none\"\r\n                  },\r\n                }, 'inspUserLayer')\r\n              }\r\n              // 改变管线颜色\r\n              that.$refs.mymap.changeInspLineSourceBySpeed(that.currentPosition)\r\n              // 记录过程点\r\n              that.postTrackData_Point(\r\n                that.trackPointList[that.trackPointList.length - 1],\r\n                that.trackPointTimeList[that.trackPointTimeList.length - 1],\r\n                distance\r\n              )\r\n            } else {\r\n              Toast({\r\n                message: '当前GPS信号弱,无法获取最新定位数据',\r\n                duration: 1500\r\n              })\r\n            }\r\n          },\r\n          (err) => {\r\n            Toast({\r\n              message: 'err' + err,\r\n              duration: 2000,\r\n            })\r\n          }\r\n        )\r\n        // this.uploadInspRoute()\r\n      }\r\n    },\r\n    // 绘制超速线段\r\n    drawOverSpeedTrack(lastPoint, currentPoint, gapTime = 3) {\r\n      let that = this\r\n      if ((that.GetDistance(lastPoint, currentPoint) * 1000) / gapTime > 10) {\r\n        that.overSpeedTrackLineList.push([lastPoint, currentPoint])\r\n        let overSpeedTrackLineCollection = {\r\n          type: 'Feature',\r\n          properties: {},\r\n          geometry: {\r\n            type: 'MultiLineString',\r\n            coordinates: that.overSpeedTrackLineList,\r\n          },\r\n        }\r\n        let overSpeedTrackLineFeatureCollection = {\r\n          type: 'FeatureCollection',\r\n          features: [overSpeedTrackLineCollection],\r\n        }\r\n        if (mapObj.map.getSource('trackLineSource_overSpeed')) {\r\n          mapObj.map\r\n            .getSource('trackLineSource_overSpeed')\r\n            .setData(overSpeedTrackLineFeatureCollection)\r\n        } else {\r\n          mapObj.map.addSource('trackLineSource_overSpeed', {\r\n            type: 'geojson',\r\n            data: overSpeedTrackLineFeatureCollection,\r\n          })\r\n        }\r\n        if (mapObj.map.getLayer('trackLineLayer_overSpeed')) {\r\n        } else {\r\n          mapObj.map.addLayer({\r\n            id: 'trackLineLayer_overSpeed',\r\n            type: 'line',\r\n            source: 'trackLineSource_overSpeed',\r\n            layout: {\r\n              'line-cap': 'round',\r\n              'line-join': 'round',\r\n              'line-sort-key': 2,\r\n              visibility: 'visible',\r\n              // visibility: \"none\"\r\n            },\r\n            paint: {\r\n              'line-color': '#FFB13B',\r\n              'line-width': 5,\r\n              'line-opacity': 1,\r\n            },\r\n          })\r\n        }\r\n      }\r\n    },\r\n    // 绘制起始点\r\n    drawStartPoint() {\r\n      let that = this\r\n      return new Promise(async function (resolve, reject) {\r\n        yuanchu.locationAMap.requestSingleLocation(\r\n          ['1'],\r\n          (res) => {\r\n            that.currentPosition = JSON.parse(JSON.stringify(res))\r\n            const param = {\r\n              ...that.currentPosition,\r\n            }\r\n            that.$refs.mymap.setInspUserPosition(param)\r\n          },\r\n          (err) => {\r\n            console.log('err=', err)\r\n          }\r\n        )\r\n        if (that.currentPosition != null) {\r\n          // 临时记录起始点和起始时间\r\n          let position = that.currentPosition\r\n          let tempPointList = []\r\n          tempPointList.push([position.longitude, position.latitude])\r\n          let date_now = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n          // 进行第一个点位上报\r\n          let pointData = tempPointList[tempPointList.length - 1]\r\n\r\n          // 经纬度数字化\r\n          for (let p = 0; p < pointData.length; p++) {\r\n            pointData[p] = Number(pointData[p])\r\n          }\r\n          let recordData = []\r\n          recordData.push({\r\n            taskId: that.taskDetail.id, // 任务id\r\n            longitude: pointData[0],\r\n            latitude: pointData[1],\r\n            inspTime: date_now,\r\n            distance: 0, // 第一个点距离为0\r\n            inspDate: date_now,\r\n            inspector: that.userInfo.userFullName,\r\n          })\r\n          // 使用上报点位作为起点\r\n          that.trackPointList.push([position.longitude, position.latitude])\r\n          that.trackPointTimeList.push(date_now)\r\n          // let jsonPoint = {\r\n          //   type: 'Feature',\r\n          //   properties: {},\r\n          //   geometry: {\r\n          //     type: 'Point',\r\n          //     coordinates: [position.longitude, position.latitude],\r\n          //   },\r\n          // }\r\n          // let jsonPointFeatureCollection = {\r\n          //   type: 'FeatureCollection',\r\n          //   features: [jsonPoint],\r\n          // }\r\n          // if (mapObj.map.getSource('startPointSource_now')) {\r\n          //   mapObj.map\r\n          //     .getSource('startPointSource_now')\r\n          //     .setData(jsonPointFeatureCollection)\r\n          // } else {\r\n          //   mapObj.map.addSource('startPointSource_now', {\r\n          //     type: 'geojson',\r\n          //     data: jsonPointFeatureCollection,\r\n          //   })\r\n          // }\r\n          // if (mapObj.map.getLayer('startPointLayer_now')) {\r\n          // } else {\r\n          //   mapObj.map.addLayer({\r\n          //     id: 'startPointLayer_now',\r\n          //     type: 'circle',\r\n          //     source: 'startPointSource_now',\r\n          //     layout: {\r\n          //       'circle-sort-key': 5,\r\n          //       visibility: 'visible',\r\n          //       // visibility: \"none\"\r\n          //     },\r\n          //     paint: {\r\n          //       'circle-radius': 3,\r\n          //       'circle-stroke-width': 5,\r\n          //       'circle-stroke-color': '#2A83E6',\r\n          //       'circle-color': 'white',\r\n          //     },\r\n          //   })\r\n          // }\r\n          // // label\r\n          // if (mapObj.map.getLayer('startPoint_label')) {\r\n          // } else {\r\n          //   mapObj.map.addLayer({\r\n          //     id: 'startPoint_label',\r\n          //     type: 'symbol',\r\n          //     source: 'startPointSource_now',\r\n          //     layout: {\r\n          //       'symbol-placement': 'point',\r\n          //       'icon-image': 'start_point',\r\n          //       'icon-size': 0.6,\r\n          //       'icon-offset': [0, -35],\r\n          //       'icon-allow-overlap': true,\r\n          //       'symbol-sort-key': 2,\r\n          //       visibility: 'visible',\r\n          //       // visibility: \"none\"\r\n          //     },\r\n          //   })\r\n          // }\r\n          // resolve(true)\r\n          await api\r\n            .inspectionTrack(recordData)\r\n            .then((res) => {\r\n              if (res && res.status) {\r\n                console.log('轨迹存储成功')\r\n                // 使用上报点位作为起点\r\n                // that.trackPointList.push([\r\n                //   position.longitude,\r\n                //   position.latitude\r\n                // ]);\r\n                // that.trackPointTimeList.push(date_now);\r\n                let jsonPoint = {\r\n                  type: 'Feature',\r\n                  properties: {},\r\n                  geometry: {\r\n                    type: 'Point',\r\n                    coordinates: [position.longitude, position.latitude],\r\n                  },\r\n                }\r\n                let jsonPointFeatureCollection = {\r\n                  type: 'FeatureCollection',\r\n                  features: [jsonPoint],\r\n                }\r\n                if (mapObj.map.getSource('startPointSource_now')) {\r\n                  mapObj.map.getSource('startPointSource_now').setData(jsonPointFeatureCollection)\r\n                } else {\r\n                  mapObj.map.addSource('startPointSource_now', {\r\n                    type: 'geojson',\r\n                    data: jsonPointFeatureCollection,\r\n                  })\r\n                }\r\n                if (mapObj.map.getLayer('startPointLayer_now')) {\r\n                } else {\r\n                  mapObj.map.addLayer({\r\n                    id: 'startPointLayer_now',\r\n                    type: 'circle',\r\n                    source: 'startPointSource_now',\r\n                    layout: {\r\n                      'circle-sort-key': 5,\r\n                      visibility: 'visible',\r\n                      // visibility: \"none\"\r\n                    },\r\n                    paint: {\r\n                      'circle-radius': 3,\r\n                      'circle-stroke-width': 5,\r\n                      'circle-stroke-color': '#2A83E6',\r\n                      'circle-color': 'white',\r\n                    },\r\n                  }, 'inspUserLayer')\r\n                }\r\n                // label\r\n                if (mapObj.map.getLayer('startPoint_label')) {\r\n                } else {\r\n                  mapObj.map.addLayer({\r\n                    id: 'startPoint_label',\r\n                    type: 'symbol',\r\n                    source: 'startPointSource_now',\r\n                    layout: {\r\n                      'symbol-placement': 'point',\r\n                      'icon-image': 'start_point',\r\n                      'icon-size': 0.6,\r\n                      'icon-offset': [0, -35],\r\n                      'icon-allow-overlap': true,\r\n                      'symbol-sort-key': 2,\r\n                      visibility: 'visible',\r\n                      // visibility: \"none\"\r\n                    },\r\n                  })\r\n                }\r\n                resolve(true)\r\n              } else {\r\n                // console.log(\"轨迹存储失败\");\r\n                resolve(false)\r\n              }\r\n            })\r\n            .catch((err) => {\r\n              // console.log(\"轨迹存储失败err\", err);\r\n              reject(err)\r\n            })\r\n        }\r\n      })\r\n    },\r\n    // 绘制终止点\r\n    async drawEndPoint(type = null) {\r\n      let that = this\r\n      yuanchu.locationAMap.stopRequestLocations()\r\n      if (that.currentPosition != null) {\r\n        let lastPoint = that.trackPointList[that.trackPointList.length - 1]\r\n        let currentPoint = [that.currentPosition.longitude, that.currentPosition.latitude]\r\n        let distance = (Number(that.GetDistance(lastPoint, currentPoint))) * 1000\r\n        that.trackPointList.push([that.currentPosition.longitude, that.currentPosition.latitude])\r\n        let date_now = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n        that.trackPointTimeList.push(date_now)\r\n        let jsonPoint = {\r\n          type: 'Feature',\r\n          properties: {},\r\n          geometry: {\r\n            type: 'Point',\r\n            coordinates: [that.currentPosition.longitude, that.currentPosition.latitude],\r\n          },\r\n        }\r\n        let jsonPointFeatureCollection = {\r\n          type: 'FeatureCollection',\r\n          features: [jsonPoint],\r\n        }\r\n        if (mapObj.map.getSource('endPointSource_now')) {\r\n          mapObj.map.getSource('endPointSource_now').setData(jsonPointFeatureCollection)\r\n        } else {\r\n          mapObj.map.addSource('endPointSource_now', {\r\n            type: 'geojson',\r\n            data: jsonPointFeatureCollection,\r\n          })\r\n        }\r\n        if (mapObj.map.getLayer('endPointLayer_now')) {\r\n        } else {\r\n          mapObj.map.addLayer({\r\n            id: 'endPointLayer_now',\r\n            type: 'circle',\r\n            source: 'endPointSource_now',\r\n            layout: {\r\n              'circle-sort-key': 5,\r\n              visibility: 'visible',\r\n              // visibility: \"none\"\r\n            },\r\n            paint: {\r\n              'circle-radius': 3,\r\n              'circle-stroke-width': 5,\r\n              'circle-stroke-color': '#addd52',\r\n              'circle-color': 'white',\r\n            },\r\n          }, 'inspUserLayer')\r\n        }\r\n\r\n        // 补充trackline\r\n        let jsonLine = {\r\n          type: 'Feature',\r\n          properties: {},\r\n          geometry: {\r\n            type: 'LineString',\r\n            coordinates: that.trackPointList,\r\n          },\r\n        }\r\n        let jsonLineFeatureCollection = {\r\n          type: 'FeatureCollection',\r\n          features: [jsonLine],\r\n        }\r\n        if (mapObj.map.getSource('trackLineSource_now')) {\r\n          mapObj.map.getSource('trackLineSource_now').setData(jsonLineFeatureCollection)\r\n        } else {\r\n          mapObj.map.addSource('trackLineSource_now', {\r\n            type: 'geojson',\r\n            data: jsonLineFeatureCollection,\r\n          })\r\n        }\r\n        if (mapObj.map.getLayer('trackLineLayer_now')) {\r\n        } else {\r\n          mapObj.map.addLayer({\r\n            id: 'trackLineLayer_now',\r\n            type: 'line',\r\n            source: 'trackLineSource_now',\r\n            layout: {\r\n              'line-cap': 'round',\r\n              'line-join': 'round',\r\n              visibility: 'visible',\r\n              // visibility: \"none\"\r\n            },\r\n            paint: {\r\n              'line-color': '#addd52',\r\n              'line-width': 5,\r\n              'line-opacity': 0.8,\r\n            },\r\n          }, 'inspUserLayer')\r\n        }\r\n        // label\r\n        if (mapObj.map.getLayer('endPoint_label')) {\r\n        } else {\r\n          mapObj.map.addLayer({\r\n            id: 'endPoint_label',\r\n            type: 'symbol',\r\n            source: 'endPointSource_now',\r\n            layout: {\r\n              'symbol-placement': 'point',\r\n              'icon-image': 'end_point',\r\n              'icon-size': 0.6,\r\n              'icon-offset': [0, -35],\r\n              'icon-allow-overlap': true,\r\n              'symbol-sort-key': 2,\r\n              visibility: 'visible',\r\n              // visibility: \"none\"\r\n            },\r\n          })\r\n        }\r\n        that.pollingFlag = false\r\n        // 记录终止点\r\n        that.postTrackData_Point(\r\n          that.trackPointList[that.trackPointList.length - 1],\r\n          that.trackPointTimeList[that.trackPointTimeList.length - 1],\r\n          distance\r\n        )\r\n        // 上传之前上传失败的点位\r\n        that.reportFailTrackPoints.length > 0 && that.postFailTrackData()\r\n        that.$refs.mymap.uploadFiledPipeIdList.length > 0 && api.recordInspLine(that.$refs.mymap.uploadFiledPipeIdList).then(res => {\r\n          if (res.status) {\r\n            console.log('管线补充上传成功')\r\n          }\r\n        })\r\n        if (type == 'task') {\r\n          this.stratOrEndTaskRecord(2) // 已巡检状态 '2'\r\n        }\r\n      } else {\r\n        let type = type\r\n        let timer = setTimeout(() => {\r\n          that.drawEndPoint(type)\r\n        }, 1000)\r\n      }\r\n    },\r\n    async postFailTrackData() {\r\n      let that = this\r\n      await api\r\n        .inspectionTrack(that.reportFailTrackPoints)\r\n        .then((res) => {\r\n          if (res && res.status) {\r\n            console.log('轨迹存储成功')\r\n          } else {\r\n            // 上传失败的点位，暂时存在app端\r\n            let timer = setTimeout(() => {\r\n              that.postFailTrackData()\r\n            }, 2000)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log('巡检轨迹存储失败：' + err)\r\n        })\r\n    },\r\n\r\n    // 单点-后端记录轨迹数据\r\n    async postTrackData_Point(pointData, timeData, distance) {\r\n      let that = this\r\n      for (let p = 0; p < pointData.length; p++) {\r\n        pointData[p] = Number(pointData[p])\r\n      }\r\n      let date_now = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n      let recordData = []\r\n      recordData.push({\r\n        taskId: that.taskDetail.id,\r\n        inspDate: timeData,\r\n        inspTime: date_now,\r\n        distance,\r\n        inspector: that.userInfo.userFullname,\r\n        longitude: pointData[0],\r\n        latitude: pointData[1],\r\n      })\r\n      await api\r\n        .inspectionTrack(recordData)\r\n        .then((res) => {\r\n          if (res && res.status) {\r\n            console.log('轨迹存储成功', recordData)\r\n          } else {\r\n            // 上传失败的点位，暂时存在app端\r\n            that.reportFailTrackPoints.push(recordData)\r\n            console.log('that.reportFailTrackPoints: ', that.reportFailTrackPoints);\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log('巡检轨迹存储失败：' + err)\r\n        })\r\n    },\r\n    stratOrEndTaskRecord(status) {\r\n      let data = {\r\n        planId: this.planDetail.planId,\r\n        taskName: this.taskDetail.taskName,\r\n        taskCode: this.taskDetail.taskCode,\r\n        taskStatus: status,\r\n        id: this.taskDetail.id,\r\n        taskType: this.taskDetail.taskType\r\n      }\r\n      api.changeTaskStatus(data).then((res) => {\r\n        if (res.status) {\r\n          console.log(res)\r\n        }\r\n      })\r\n    },\r\n    // 清除缓存的轨迹数据\r\n    clearBufferTrack() {\r\n      let that = this\r\n      //数组归零\r\n      that.trackPointList = []\r\n      that.trackPointTimeList = []\r\n      that.overSpeedTrackLineList = []\r\n      //数据源清空\r\n      if (mapObj.map.getSource('trackLineSource_now')) {\r\n        mapObj.map.getSource('trackLineSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n      if (mapObj.map.getSource('trackLineSource_overSpeed')) {\r\n        mapObj.map.getSource('trackLineSource_overSpeed').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n      if (mapObj.map.getSource('startPointSource_now')) {\r\n        mapObj.map.getSource('startPointSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n\r\n      if (mapObj.map.getSource('endPointSource_now')) {\r\n        mapObj.map.getSource('endPointSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n    },\r\n    addMapImg() {\r\n      let that = this\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/white_arrow_right.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('arrowIcon')) {\r\n            mapObj.map.addImage('arrowIcon', image, {})\r\n          }\r\n        }\r\n      )\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/icon_starting_point.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('start_point')) {\r\n            mapObj.map.addImage('start_point', image, {})\r\n          }\r\n        }\r\n      )\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/icon_at_end.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('end_point')) {\r\n            mapObj.map.addImage('end_point', image, {})\r\n          }\r\n        }\r\n      )\r\n    },\r\n    // 开始记录 上传起点成功后才进入巡检过程\r\n    startInspRecord() {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '该巡检任务已结束',\r\n          duration: 1500\r\n        })\r\n        return\r\n      }\r\n      if (!this.currentPosition || !this.currentPosition.longitude) {\r\n        Toast({\r\n          message: '当前GPS信号弱，无法开始任务',\r\n          duration: 1000,\r\n        })\r\n        return\r\n      }\r\n      this.ifRecording = true\r\n      this.clearBufferTrack()\r\n      this.addMapImg()\r\n      this.drawStartPoint()\r\n        .then((res) => {\r\n          if (res) {\r\n            Toast({\r\n              message: '开始记录',\r\n              duration: 1000,\r\n            })\r\n            this.pollingFlag = true\r\n            this.ifRecording = true\r\n            this.startLocation()\r\n            localStorage.setItem('startRecordLines', 'start')\r\n            // 开始轮询\r\n            this.polling()\r\n            // 记录当前时间\r\n            this.startRecordTimer = new Date()\r\n          } else {\r\n            Toast({\r\n              message: '网络状态异常，无法开始任务',\r\n              duration: 3000,\r\n            })\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n          // Toast({\r\n          //   message: `${err}`,\r\n          //   duration: 3000\r\n          // });\r\n        })\r\n    },\r\n    // 结束记录\r\n    endRecord(type = null) {\r\n      let diff = Math.floor((new Date() - this.startRecordTimer) / 1000)\r\n\r\n      if (diff <= 10) {\r\n        Toast({\r\n          message: `结束太快了,请${10 - diff}秒后再试`,\r\n          duration: 1000,\r\n        })\r\n        return\r\n      }\r\n      Dialog.confirm({\r\n        title: '标题',\r\n        message: '确定结束本次巡检？',\r\n      })\r\n        .then(() => {\r\n          this.endRecordConfirm(type)\r\n        })\r\n        .catch(() => {\r\n          this.endRecordCancel()\r\n        })\r\n    },\r\n    // uploadInspRoute() {\r\n    //   try {\r\n    //     const that = this;\r\n    //     // 定时器\r\n    //     let timer = setInterval(function () {\r\n    //       // 清除定时器\r\n    //       // clearInterval(timer);\r\n    //       let tempTrackPolntList = JSON.parse(JSON.stringify(this.trackPointList))\r\n    //       if (tempTrackPolntList.length > 0) {\r\n\r\n    //       }\r\n    //     }, 1000 * 60 * 60 * 24 * 1)\r\n    //   } catch (e) {\r\n    //     console.log(e)\r\n    //   }\r\n    // },\r\n    // 结束记录取消\r\n    endRecordCancel() {\r\n      this.endRecordShow = false\r\n    },\r\n    // 结束记录确认\r\n    async endRecordConfirm(type = null) {\r\n      this.endRecordShow = false\r\n      this.pollingFlag = false\r\n      yuanchu.locationAMap.stopRequestLocations()\r\n      await this.drawEndPoint(type)\r\n      this.ifRecording = false\r\n      localStorage.setItem('startRecordLines', 'end')\r\n      if (type != 'leave') {\r\n        this.refreshTask()\r\n      }\r\n      Toast({\r\n        message: '结束成功',\r\n        duration: 2000\r\n      })\r\n      /** 2021/9/22 取消上报已巡检管线\r\n      // 上报巡检记录\r\n      // 需过滤出已巡检管线\r\n      let sourceData = await this.$refs.mymap.findHadInspFeature();\r\n      let recordData = sourceData.map((item) => {\r\n        return {\r\n          caliber:  item.properties.caliber,\r\n          guid: item.properties.guid,\r\n          length: item.properties.length,\r\n          taskId: this.taskDetail.taskId,\r\n        };\r\n      });\r\n      recordData = recordData.filter(x => this.lines.every(y => y.guid != x.guid));\r\n      if (recordData.length <= 0) {\r\n        uni.showToast({\r\n          title: \"结束记录\",\r\n          duration: 3000,\r\n        });\r\n        let t = setTimeout(()=>{\r\n          this.recordButtonLoading = false;\r\n        }, 1000);\r\n        return;\r\n      }\r\n      this.$api.postAction(\"/ops-inspection/api/inspectionRecordMultiple\", recordData)\r\n        .then((res) => {\r\n          if (res && res.status) {\r\n            console.log(\"新增巡检记录成功\");\r\n            // 结束记录后就删除本地缓存\r\n            uniWebView.postMessage({\r\n              data: {\r\n                action: \"removeInspRecord\",\r\n                taskId: this.taskDetail.taskId\r\n              }\r\n            })\r\n          } else {\r\n            if (recordData.length > 0) {\r\n              uniWebView.postMessage({\r\n                data: {\r\n                  action: \"saveInspRecord\",\r\n                  inspRecordData: JSON.stringify(recordData),\r\n                  taskId: this.taskDetail.taskId,\r\n                },\r\n              });\r\n            }\r\n          }\r\n        })\r\n        .finally(()=>{\r\n          uni.showToast({\r\n            title: \"结束记录\",\r\n            duration: 3000,\r\n          });\r\n          let t = setTimeout(()=>{\r\n            this.recordButtonLoading = false;\r\n          }, 1000);\r\n        })\r\n      */\r\n    },\r\n\r\n    // 定时向本机发送存储信息\r\n    async setLocalStorage() {\r\n      let that = this\r\n      if (this.pollingFlag) {\r\n        /* let storageTrackData = {\r\n          trackPointList: that.trackPointList,\r\n          trackPointTimeList: that.trackPointTimeList,\r\n          overSpeedTrackLineList: that.overSpeedTrackLineList,\r\n        };\r\n\r\n        uniWebView.postMessage({\r\n          data: {\r\n            action: \"saveInspTrack\",\r\n            inspTrackData: JSON.stringify(storageTrackData),\r\n            taskId: that.taskDetail.taskId,\r\n          },\r\n        }); */\r\n\r\n        // 上报巡检记录\r\n        let sourceData = await this.$refs.mymap.findHadInspFeature()\r\n        let recordData = sourceData.map((item) => {\r\n          return {\r\n            caliber: item.properties.caliber,\r\n            guid: item.properties.guid,\r\n            length: item.properties.length,\r\n            taskId: this.taskDetail.taskId,\r\n          }\r\n        })\r\n        recordData = recordData.filter((x) => this.lines.every((y) => y.guid != x.guid))\r\n        if (recordData.length > 0) {\r\n          this.$api\r\n            .postAction('/ops-inspection/api/inspectionRecordMultiple', recordData)\r\n            .then((res) => {\r\n              if (res && res.status) {\r\n                console.log('新增巡检记录成功')\r\n              } else {\r\n                uniWebView.postMessage({\r\n                  data: {\r\n                    action: 'saveInspRecord',\r\n                    inspRecordData: JSON.stringify(recordData),\r\n                    taskId: this.taskDetail.taskId,\r\n                  },\r\n                })\r\n              }\r\n            })\r\n        }\r\n        let timer = setTimeout(() => {\r\n          this.setLocalStorage()\r\n        }, 15000)\r\n      }\r\n    },\r\n    // 查询app端存储的该任务的巡检记录和轨迹点位数据\r\n    getAppInspData(id) {\r\n      return new Promise(function (resolve) {\r\n        /** 2021/9/22 取消获取app端缓存的数据\r\n        uniWebView.postMessage({\r\n          data: {\r\n            action: \"getInspRecord\",\r\n            taskId: id,\r\n          },\r\n        });\r\n        */\r\n        // uniWebView.postMessage({\r\n        //   data: {\r\n        //     action: \"getTrackPoints\",\r\n        //     taskId: id\r\n        //   }\r\n        // })\r\n        resolve()\r\n      })\r\n    },\r\n    // 开始定位\r\n    startLocation() {\r\n      if (!this.currentPosition || !this.currentPosition.longitude || !this.currentPosition.latitude) {\r\n        Toast({\r\n          message: '获取位置失败!',\r\n          duration: 2000\r\n        })\r\n        return\r\n      } else {\r\n        const coord = [parseFloat(this.currentPosition.longitude), parseFloat(this.currentPosition.latitude)]\r\n        this.flyToPoint(coord)\r\n      }\r\n    },\r\n    /**\r\n     * 超图坐标转换为feature\r\n     */\r\n    superMapParamsToFeature(geometry) {\r\n      let coord\r\n      let type\r\n      switch (geometry.type) {\r\n        case 'POINT':\r\n          type = 'Point'\r\n          coord = [geometry.points[0].x, geometry.points[0].y]\r\n          break\r\n        case 'LINE':\r\n          type = 'LineString'\r\n          coord = geometry.points.map((point) => [point.x, point.y])\r\n          break\r\n        case 'REGION':\r\n          type = 'Polygon'\r\n          coord = [geometry.points.map((point) => [point.x, point.y])]\r\n          break\r\n      }\r\n      return {\r\n        type: 'Feature',\r\n        geometry: {\r\n          type,\r\n          coordinates: coord,\r\n        },\r\n      }\r\n    },\r\n    featureToObject(names, values) {\r\n      let obj = {}\r\n      names.forEach((name, index) => {\r\n        obj[name] = values[index]\r\n      })\r\n      return obj\r\n    },\r\n    goEventOrFlawDetail(feature, type) {\r\n      let currentPoint = feature\r\n      currentPoint = feature\r\n      currentPoint.code = feature.deviceId || ''\r\n      currentPoint.bigType = feature.bizType || ''\r\n      currentPoint.lng = feature.startLongitude\r\n      currentPoint.lat = feature.startLatitude\r\n      // 要素所在图层ID和属性信息\r\n      // currentPoint.layerID = feature.layer.id || ''\r\n      // currentPoint.layerType = feature.layer.type || ''\r\n      // currentPoint.properties = feature.properties || ''\r\n      // 底图要素name_local或设施要素road_name,id\r\n      currentPoint.road_name = feature.road\r\n      // currentPoint.id = feature.properties.id\r\n      if (type == 'event') {\r\n        // this.$router.push({\r\n        //   name: 'addProblemIndex',\r\n        //   query: { msg: currentPoint, token: this.formToken, taskId: this.$route.query.taskId },\r\n        //   params: { type: 'add' }\r\n        // })\r\n        this.$router.push({\r\n          name: 'addProblemIndex',\r\n          query: { msg: currentPoint, token: this.formToken, taskId: this.$route.query.taskId },\r\n          params: { type: 'add' },\r\n        })\r\n      } else {\r\n        this.$router.push({\r\n          name: 'addFlaws',\r\n          query: { msg: currentPoint, token: this.formToken, taskId: this.$route.query.taskId },\r\n          params: { type: 'add' }\r\n        })\r\n      }\r\n    },\r\n    // 确认\r\n    onConfirm() {\r\n      if (true) {\r\n        let feature = this.signForm.feature\r\n        let copySignForm = this.deepClone(this.signForm)\r\n        copySignForm.inspDate = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n        copySignForm.ext1 = copySignForm.remark // 备注\r\n        delete copySignForm.feature\r\n        api.signIn(copySignForm).then((res) => {\r\n          if (res && res.status) {\r\n            Toast({\r\n              message: '此关键点签到成功',\r\n              duration: 2000,\r\n            })\r\n            // 巡检事件上报\r\n            if (copySignForm.isReport == '问题上报') {\r\n              this.goEventOrFlawDetail(feature, 'event');\r\n            } else if (copySignForm.isReport == '新增缺陷') {\r\n              this.goEventOrFlawDetail(feature, 'flaw');\r\n            }\r\n          } else {\r\n            Toast({\r\n              message: '此关键点签到失败',\r\n              duration: 2000,\r\n            })\r\n          }\r\n        })\r\n        this.signShow = false\r\n        this.signForm.remark = ''\r\n        this.signForm.deviceStatus = '0'\r\n        this.signForm.isReport = ''\r\n        this.signForm.inspImagesList = []\r\n        this.attachment = ''\r\n        mapObj.mapInstance.setSourceData('buffered', {\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n        // localStorage.setItem(\"isReportEvent\", false);\r\n        this.refreshTask()\r\n      } else {\r\n        console.log('验证失败')\r\n      }\r\n    },\r\n    // 取消\r\n    onCancel() {\r\n      console.log('click cancel')\r\n      // localStorage.setItem(\"isReportEvent\", false);\r\n      this.signShow = false\r\n      mapObj.mapInstance.setSourceData('buffered', {\r\n        type: 'FeatureCollection',\r\n        features: [],\r\n      })\r\n    },\r\n    // 签到\r\n    async startSignIn(feature) {\r\n      // 利用feature来判断是否处于35m范围内，如果处于，可以进行签到，否则不能进行签到\r\n      const position = this.currentPosition\r\n      if (!position) {\r\n        Toast.warning({\r\n          message: '获取不到巡检人位置',\r\n          duration: 2000,\r\n        })\r\n        return\r\n      }\r\n      const coord = [\r\n        parseFloat(position.longitude),\r\n        parseFloat(position.latitude),\r\n      ]\r\n      const point = turf.point(coord)\r\n      const engGeom = feature.geom\r\n      const buffered = turf.buffer(engGeom, 0.035, { unit: 'kilometers' })\r\n      const isInBuffer = turf.inside(point, buffered)\r\n      if (!isInBuffer) {\r\n        Toast({\r\n          message: '未处于该关键点范围内',\r\n          duration: 2000,\r\n        })\r\n        return\r\n      }\r\n      Toast.loading({\r\n        message: '正在加载',\r\n        forbidClick: true,\r\n      })\r\n      this.signShow = true\r\n      this.pointListShow = false\r\n      this.attachment = ''\r\n      this.isReport = ''\r\n      this.deviceName = feature.deviceType + (feature.deviceId || '')\r\n      if (!feature.deviceStatus || feature.deviceStatus == '2') {\r\n        // 未巡检\r\n        this.hasSignIn = false\r\n        this.signForm.remark = ''\r\n        this.signForm.deviceStatus = '0'\r\n        this.signForm.inspImagesList = []\r\n        this.signForm.pointId = feature.id\r\n        this.signForm.taskId = this.$route.query.taskId,\r\n        this.signForm.feature = feature\r\n      } else {\r\n        this.hasSignIn = true\r\n        let params = {\r\n          page: 1,\r\n          size: 999,\r\n          deviceStatus: feature.deviceStatus,\r\n          pointId: feature.id,\r\n          taskId: this.$route.query.taskId,\r\n        }\r\n        const res = await request({\r\n          url: '/xasw-pipe-operation/inspPointRecord/page',\r\n          method: 'get',\r\n          params: params,\r\n        })\r\n        if (res && res.status) {\r\n          let result = res.data.records[0]\r\n          this.signForm.deviceStatus = result.deviceStatus\r\n          this.signForm.remark = result.ext1\r\n          this.signForm.isReport = result.isReport\r\n          const att = await request({\r\n            url: '/xasw-pipe-operation/inspPointRecord',\r\n            method: 'get',\r\n            params: { id: result.id }\r\n          })\r\n          if (att && att.status) {\r\n            this.signForm.inspImagesList = att.data.inspImagesList\r\n            this.attachment = att.data.inspImagesList[0].fileId\r\n          }\r\n        }\r\n      }\r\n      console.log('signForm', this.signForm)\r\n    },\r\n    // 事件类型选择确认\r\n    eventTypeConfirm(event) {\r\n      this.$set(this.signForm, 'eventType', event[1].label)\r\n      this.signForm.inspItemId = event[1].value\r\n    },\r\n    // 深拷贝\r\n    deepClone(data) {\r\n      return JSON.parse(JSON.stringify(data))\r\n    },\r\n    // 计算中心点\r\n    computeCenter(feature) {\r\n      let position\r\n      if (feature.type === 'Polygon' || feature.type === 'MultiPolygon') {\r\n        const center = turf.center(feature)\r\n        position = center.geometry\r\n      } else if (feature.type === 'LineString') {\r\n        const center = turf.center(feature)\r\n        position = center.geometry\r\n      } else if (feature.type === 'Point') {\r\n        position = feature\r\n      }\r\n      return position\r\n    },\r\n    reportEvent(feature) {\r\n      this.reportFooterShow = false\r\n      this.$router.push({\r\n        path: '/pages/inspectionManage/add-event',\r\n        query: {\r\n          taskId: this.taskDetail.taskId,\r\n          feature: feature,\r\n          rangeList: this.rangeList,\r\n          taskDetail: this.taskDetail,\r\n        },\r\n      })\r\n    },\r\n    GetDistance(coordArray1, coordArray2) {\r\n      let lng1 = coordArray1[0]\r\n      let lat1 = coordArray1[1]\r\n      let lng2 = coordArray2[0]\r\n      let lat2 = coordArray2[1]\r\n      let radLat1 = (lat1 * Math.PI) / 180.0\r\n      let radLat2 = (lat2 * Math.PI) / 180.0\r\n      let a = radLat1 - radLat2\r\n      let b = (lng1 * Math.PI) / 180.0 - (lng2 * Math.PI) / 180.0\r\n      let s =\r\n        2 *\r\n        Math.asin(\r\n          Math.sqrt(\r\n            Math.pow(Math.sin(a / 2), 2) +\r\n              Math.cos(radLat1) * Math.cos(radLat2) * Math.pow(Math.sin(b / 2), 2)\r\n          )\r\n        )\r\n      s = s * 6378.137 // EARTH_RADIUS;\r\n      s = Math.round(s * 10000) / 10000\r\n      return s\r\n    },\r\n    showRoute() {\r\n      this.isShowRoute = !this.isShowRoute\r\n      if (mapObj.map.getLayoutProperty('trackLineLayer_now', 'visibility') === 'visible') {\r\n        mapObj.map.setLayoutProperty('trackLineLayer_now', 'visibility', 'none')\r\n      } else {\r\n        mapObj.map.setLayoutProperty('trackLineLayer_now', 'visibility', 'visible')\r\n      }\r\n      if (mapObj.map.getLayoutProperty('trackLineLayer_arrow', 'visibility') === 'visible') {\r\n        mapObj.map.setLayoutProperty('trackLineLayer_arrow', 'visibility', 'none')\r\n      } else {\r\n        mapObj.map.setLayoutProperty('trackLineLayer_arrow', 'visibility', 'visible')\r\n      }\r\n      if (mapObj.map.getLayoutProperty('trackLineLayer_overSpeed', 'visibility') === 'visible') {\r\n        mapObj.map.setLayoutProperty('trackLineLayer_overSpeed', 'visibility', 'none')\r\n      } else {\r\n        mapObj.map.setLayoutProperty('trackLineLayer_overSpeed', 'visibility', 'visible')\r\n      }\r\n      if (mapObj.map.getLayoutProperty('startPointLayer_now', 'visibility') === 'visible') {\r\n        mapObj.map.setLayoutProperty('startPointLayer_now', 'visibility', 'none')\r\n      } else {\r\n        mapObj.map.setLayoutProperty('startPointLayer_now', 'visibility', 'visible')\r\n      }\r\n      if (mapObj.map.getLayoutProperty('endPointLayer_now', 'visibility') === 'visible') {\r\n        mapObj.map.setLayoutProperty('endPointLayer_now', 'visibility', 'none')\r\n      } else {\r\n        mapObj.map.setLayoutProperty('endPointLayer_now', 'visibility', 'visible')\r\n      }\r\n      if (mapObj.map.getLayoutProperty('startPoint_label', 'visibility') === 'visible') {\r\n        mapObj.map.setLayoutProperty('startPoint_label', 'visibility', 'none')\r\n      } else {\r\n        mapObj.map.setLayoutProperty('startPoint_label', 'visibility', 'visible')\r\n      }\r\n      if (mapObj.map.getLayoutProperty('endPoint_label', 'visibility') === 'visible') {\r\n        mapObj.map.setLayoutProperty('endPoint_label', 'visibility', 'none')\r\n      } else {\r\n        mapObj.map.setLayoutProperty('endPoint_label', 'visibility', 'visible')\r\n      }\r\n    },\r\n    resetMapView() {\r\n      this.$refs.mymap && mapObj.map.resetNorthPitch()\r\n    },\r\n    clickReportEvent() {\r\n      console.log('click the clickReportEvent')\r\n      let position = []\r\n      if (!this.currentPosition) {\r\n        let pos = undefined\r\n        if (this.rangeList.length > 0) {\r\n          let feature = JSON.parse(this.rangeList[0].taskRangerGeom)\r\n          if (feature.geometry.type === 'Polygon' || feature.geometry.type === 'MultiPolygon') {\r\n            const center = turf.center(feature.geometry)\r\n            pos = center.geometry\r\n          } else if (feature.geometry.type === 'LineString') {\r\n            const center = turf.center(feature.geometry)\r\n\r\n            pos = center.geometry\r\n          } else if (feature.geometry.type === 'Point') {\r\n            pos = feature.geometry\r\n          }\r\n          if (pos) {\r\n            position = pos.coordinates\r\n          } else {\r\n            position = [119.96123559772968, 30.27094691991806]\r\n          }\r\n        }\r\n      } else {\r\n        position = [\r\n          parseFloat(this.currentPosition.longitude),\r\n          parseFloat(this.currentPosition.latitude),\r\n        ]\r\n      }\r\n      this.signShow = false\r\n      this.$router.push({\r\n        name: 'addEvent',\r\n        query: {\r\n          taskId: this.taskDetail.taskId,\r\n          rangeList: this.rangeList,\r\n          taskDetail: this.taskDetail,\r\n          position: position,\r\n        },\r\n      })\r\n    },\r\n    // 系统提示音\r\n    // speech() {\r\n    //   // 私有变量timer\r\n    //   let timer = new Date();\r\n    //   // 第一次进入\r\n    //   let isFirstIn = true;\r\n    //   return {\r\n    //     publicSpeech: function () {\r\n    //       if (isFirstIn || (new Date() - timer)/1000 > 20) {\r\n    //         const innerAudioContext = uni.createInnerAudioContext();\r\n    //         innerAudioContext.autoplay = true;\r\n    //         innerAudioContext.src = require(\"@static/audio/tips.mp3\");\r\n    //         innerAudioContext.onPlay(() => {\r\n    //           console.log(\"开始播放\");\r\n    //         });\r\n    //         innerAudioContext.onError((res) => {\r\n    //           console.log(res?.errMsg);\r\n    //           console.log(res?.errCode);\r\n    //         })\r\n    //         innerAudioContext.play();\r\n    //         // 对私有变量进行赋值\r\n    //         isFirstIn = false;\r\n    //         timer = new Date();\r\n    //       }\r\n    //     },\r\n    //     resetFirstIn: function () {\r\n    //       isFirstIn = true;\r\n    //     }\r\n    //   };\r\n    // },\r\n    // 判断是否在关键点范围内\r\n    isInKeyPointBuffer() {\r\n      const position = this.currentPosition\r\n      this.keyDetailList.forEach((item) => {\r\n        let detail = item?.inspectionTaskDetailDTO?.inspectionTaskDetail\r\n        if (true) {\r\n          const coord = [parseFloat(position.longitude), parseFloat(position.latitude)]\r\n          const point = turf.point(coord)\r\n          const engGeom =\r\n            typeof item.engInfoDTO.engGeom !== 'object'\r\n              ? JSON.parse(item.engInfoDTO.engGeom)\r\n              : item.engInfoDTO.engGeom\r\n          const buffered = turf.buffer(engGeom, 0.035, 'kilometers')\r\n          const isInBuffer = turf.inside(point, buffered)\r\n        }\r\n      })\r\n    },\r\n  },\r\n  watch: {\r\n    // $route: {\r\n    //   handler(to, from, next) {\r\n    //     if (from.path === '/preview-image') {\r\n    //       this.showVisible = true\r\n    //     } else {\r\n    //       this.showVisible = false\r\n    //     }\r\n    //   },\r\n    // },\r\n  },\r\n  beforeRouteLeave(to, from, next) {\r\n    if (to.name == 'Inspection' && from.name == 'InspectionManage') {\r\n      if (this.ifRecording) {\r\n        this.endRecord('leave')\r\n      } else {\r\n        next()\r\n      }\r\n    } else {\r\n      next()\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    localStorage.removeItem('startRecordLines')\r\n    bus.$off('startSignIn')\r\n    // bus.$off(\"reportInspEvent\");\r\n  },\r\n  // 返回到列表页面\r\n  onBackPress() {\r\n    // uni.redirectTo(\"/pages/projectManagement/projectListPage\");\r\n    return true\r\n  },\r\n  onNavigationBarButtonTap: function (e) {},\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n/deep/.mapboxgl-popup-content {\r\n  width: auto;\r\n  min-width: 280px;\r\n  height: 50px;\r\n  padding: 24px 36px;\r\n  border-radius: 18px;\r\n  box-shadow: 10px 10px 30px rgba(0, 0, 0, 0.1);\r\n}\r\n.task-map {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: hidden;\r\n\r\n  .tip-tools {\r\n    position: fixed;\r\n    display: flex;\r\n    top: 140px;\r\n    left: 200px;\r\n    border-radius: 16px;\r\n    padding: 24px;\r\n    background: #FFFFFF;\r\n    box-shadow: 0px 10px 18px 0px rgba(0,0,0,0.06);\r\n    border: 2px solid rgba(23,144,254,0.6);\r\n    .tipImg {\r\n      width: 32px;\r\n      height: 32px;\r\n      margin-right: 16px;\r\n    }\r\n    .context {\r\n      font-size: 24px;\r\n      font-family: MicrosoftYaHei;\r\n      color: #1B67D8;\r\n      line-height: 31px;\r\n    }\r\n  }\r\n\r\n  .alert {\r\n    top: 2.22rem;\r\n    position: fixed;\r\n    width: 100%;\r\n    z-index: 4;\r\n    background-color: #62707c;\r\n    opacity: 0.5;\r\n    font-size: 1rem;\r\n\r\n    .u-alert-content {\r\n      width: 100%;\r\n    }\r\n  }\r\n\r\n  .progress {\r\n    width: 80%;\r\n    height: 1rem;\r\n    background-color: #fff;\r\n    box-shadow: 0 0.4rem 0.6rem 0 rgba(0, 0, 0, 0.2);\r\n    border-radius: 0.1rem;\r\n    margin: 0 0.3rem;\r\n    padding: 0.1rem 0.15rem;\r\n    position: fixed;\r\n    top: 2.5rem;\r\n\r\n    &-box {\r\n      width: 100%;\r\n      margin: 0.3rem 0;\r\n      display: flex;\r\n\r\n      .pro-dot {\r\n        width: 0.3rem;\r\n        height: 0.3rem;\r\n        border-radius: 50%;\r\n        float: left;\r\n        margin: auto 0.3rem;\r\n      }\r\n\r\n      .pro-text {\r\n        line-height: 0.5rem;\r\n        display: flex;\r\n        font-size: 12px;\r\n        float: left;\r\n      }\r\n    }\r\n  }\r\n\r\n  .pro-circle {\r\n    position: fixed;\r\n    width: 1rem;\r\n    height: 1rem;\r\n    right: 0.1rem;\r\n    padding: 0.1rem;\r\n    top: 2.5rem;\r\n    // margin: 0.27rem 0rem;\r\n    background-color: #fff;\r\n    z-index: 3;\r\n    box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n    border-radius: 0.1rem;\r\n\r\n    .progress-text-view {\r\n      font-size: 0.4rem;\r\n      z-index: 4;\r\n\r\n      .progress-text-up {\r\n        color: #306cc8;\r\n      }\r\n\r\n      .progress-text-down {\r\n        border-top: 0.05rem solid #555555;\r\n      }\r\n    }\r\n  }\r\n\r\n  .point-list {\r\n    position: fixed;\r\n    width: 1.2rem;\r\n    height: 1.2rem;\r\n    left: 0.3rem;\r\n    bottom: 2rem;\r\n    background-color: #fff;\r\n    z-index: 3;\r\n    box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n    border-radius: 0.27rem;\r\n\r\n    .list-image {\r\n      margin: 0.18rem;\r\n      width: 0.82rem;\r\n      height: 0.82rem;\r\n    }\r\n  }\r\n\r\n  .footer {\r\n    width: inherit;\r\n    padding: 1.11rem 0.83rem;\r\n    color: #333333;\r\n    background-color: #ffffff;\r\n    height: 3.55rem;\r\n    z-index: 4;\r\n    position: fixed;\r\n    bottom: 0rem;\r\n\r\n    &-content {\r\n      float: left;\r\n    }\r\n\r\n    &-btn {\r\n      float: right;\r\n      width: 4.44rem;\r\n      height: 1.77rem;\r\n      line-height: 1.77rem;\r\n      border-radius: 0.88rem;\r\n    }\r\n  }\r\n\r\n  .start-record {\r\n    position: absolute;\r\n    z-index: 3;\r\n    left: 50%;\r\n    bottom: 235px;\r\n    transform: translate(-50%, 0);\r\n\r\n    img {\r\n      width: 140px;\r\n      height: 140px;\r\n    }\r\n  }\r\n\r\n  .controlCard {\r\n    width: 100%;\r\n    height: 328px;\r\n    position: absolute;\r\n    bottom: 0;\r\n    background-image: url('~@/assets/img/inspection/controlBg.png');\r\n    background-repeat: no-repeat;\r\n    background-size: 100%;\r\n\r\n    .controlContent {\r\n      margin: 60px 30px 0;\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      .infoContent {\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-around;\r\n        margin-bottom: 24px;\r\n\r\n        .block {\r\n          text-align: center;\r\n          width: 210px;\r\n          height: 160px;\r\n          display: flex;\r\n          flex-direction: column;\r\n          align-items: center;\r\n          background: rgba(27, 103, 216, 0.05);\r\n          border-radius: 16px;\r\n          // margin: 0 20px;\r\n\r\n          .rate {\r\n            width: 100%;\r\n            height: 50%;\r\n            display: flex;\r\n            align-items: center;\r\n            margin: auto;\r\n            font-size: 48px;\r\n            font-family: Helvetica-Bold, Helvetica;\r\n            font-weight: bold;\r\n            color: #306cc8;\r\n\r\n            .centerStyle {\r\n              margin: auto;\r\n              display: flex;\r\n              align-items: center;\r\n              font-size: 38px;\r\n              font-family: Helvetica-Bold, Helvetica;\r\n              font-weight: bold;\r\n\r\n              .inspKp {\r\n                padding-bottom: 3px;\r\n                padding-right: 3px;\r\n                color: #306cc8;\r\n              }\r\n\r\n              .uninspKp {\r\n                color: #191919;\r\n                letter-spacing: 3px;\r\n              }\r\n            }\r\n          }\r\n\r\n          .name {\r\n            font-size: 14px;\r\n            font-family: PingFangSC-Regular, PingFang SC;\r\n            font-weight: 400;\r\n            color: #555555;\r\n            width: 100%;\r\n            height: 33%;\r\n          }\r\n        }\r\n      }\r\n\r\n      .bottomSide {\r\n        width: 100%;\r\n        display: flex;\r\n        margin-top: 24px;\r\n        justify-content: space-around;\r\n      }\r\n\r\n      .endControl {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n\r\n        .leftText {\r\n          width: 27%;\r\n          display: flex;\r\n          justify-content: space-around;\r\n          align-items: center;\r\n\r\n          img {\r\n            width: 32px;\r\n            height: 32px;\r\n            margin: auto;\r\n          }\r\n\r\n          /deep/.fm-count-down {\r\n            font-size: 24px;\r\n            color: #306cc8;\r\n          }\r\n        }\r\n\r\n        .rightButton {\r\n          display: flex;\r\n\r\n          .endBtn {\r\n            font-size: 24px;\r\n            width: 120px;\r\n            height: 60px;\r\n            background: #ffffff;\r\n            color: #306cc8;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .tool-box {\r\n    position: fixed;\r\n    width: 1.2rem;\r\n    height: auto;\r\n    right: 0.3rem;\r\n    bottom: 350px;\r\n\r\n    .refresh {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .route {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .location {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 60px;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n  }\r\n\r\n  /deep/.fm-popup {\r\n    background: #f5f7f9;\r\n  }\r\n\r\n  .popup-view {\r\n    height: auto;\r\n    width: auto;\r\n    margin: 32px;\r\n    overflow: scroll;\r\n    border-radius: 32px;\r\n    background-color: #fff;\r\n\r\n    /deep/.fm-radio--horizontal {\r\n      margin-right: 20px;\r\n    }\r\n\r\n    .title {\r\n      display: flex;\r\n      margin-top: 32px;\r\n      padding-bottom: 32px;\r\n      border-bottom: 1px #f5f5f5 solid;\r\n\r\n      img {\r\n        width: 6px;\r\n        height: 40px;\r\n      }\r\n\r\n      .deviceId {\r\n        margin-left: 32px;\r\n        font-size: 36px;\r\n        font-family: PingFangSC-Semibold, PingFang SC;\r\n        font-weight: 600;\r\n        color: #191919;\r\n        line-height: 50px;\r\n      }\r\n    }\r\n\r\n    /deep/.fm-uploader__wrapper {\r\n      margin-left: 16px;\r\n    }\r\n\r\n    .preview-cover {\r\n      position: absolute;\r\n      bottom: 0;\r\n      box-sizing: border-box;\r\n      width: 100%;\r\n      padding: 4px;\r\n      color: #fff;\r\n      font-size: 12px;\r\n      text-align: center;\r\n      background: rgba(0, 0, 0, 0.3);\r\n    }\r\n  }\r\n\r\n  .btnArea {\r\n    display: flex;\r\n\r\n    .btn {\r\n      width: 94%;\r\n      margin: 0 auto;\r\n    }\r\n\r\n    .btn1 {\r\n      width: 44%;\r\n      margin: 0 12px 0 30px;\r\n    }\r\n\r\n    .btn2 {\r\n      width: 44%;\r\n      margin: 0 30px 0 12px;\r\n    }\r\n  }\r\n\r\n  .confirm-pop {\r\n    .title {\r\n      border-left: 0.22rem solid #306cc8;\r\n      margin: 0.27rem;\r\n      padding-left: 0.55rem;\r\n    }\r\n\r\n    .content {\r\n      border-top: 0.027rem solid rgba(128, 128, 128, 0.322);\r\n      width: 11.66rem;\r\n      padding: 1.33rem;\r\n      text-align: center;\r\n      background-color: #fff;\r\n\r\n      &-view {\r\n        font-size: 0.88rem;\r\n      }\r\n\r\n      .confirm-btn {\r\n        margin-top: 2.22rem;\r\n        justify-items: center;\r\n\r\n        .popup-btn {\r\n          float: left;\r\n          width: 3.33rem;\r\n          height: 1.77rem;\r\n          border-radius: 0.27rem;\r\n\r\n          &-l {\r\n            margin-left: 0.55rem;\r\n            margin-right: 0.55rem;\r\n          }\r\n\r\n          &-r {\r\n            margin-left: 0.55rem;\r\n            margin-right: 0.55rem;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}