{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\FlawsManagement\\addFlaws.vue?vue&type=style&index=0&id=39d2f136&lang=less&scoped=true","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\FlawsManagement\\addFlaws.vue","mtime":1708928163373},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQovL+makOiXj+a7muWKqOadoQ0KJjo6LXdlYmtpdC1zY3JvbGxiYXIgew0KICBkaXNwbGF5OiBub25lOyAvL0Nocm9tZSB8IFNhZmFyaQ0KfQ0KDQouYWRkLWNvbnRhaW5lciB7DQogIHdpZHRoOiAxMDAlOw0KICBoZWlnaHQ6IDEwMCU7DQoNCiAgLmNvbnRlbnQgew0KICAgIHdpZHRoOiAxMDAlOw0KICAgIGhlaWdodDogY2FsYygxMDAlIC0gMjUwcHgpOw0KDQogICAgLmJpZ0Zvcm0tY29udGFpbmVyIHsNCiAgICAgIG92ZXJmbG93OiBzY3JvbGw7DQogICAgICB3aWR0aDogMTAwJTsNCiAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgIGJhY2tncm91bmQ6ICNmZmZmZmY7DQoNCiAgICAgIC5zdWJ0YWJsZSB7DQogICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgICAgbWFyZ2luOiAxMHB4Ow0KICAgICAgICBwYWRkaW5nOiAxM3B4Ow0KICAgICAgICAvLyBiYWNrZ3JvdW5kLWNvbG9yOiBhcXVhbWFyaW5lOw0KICAgICAgICBib3JkZXItcmFkaXVzOiAxNnB4Ow0KICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjNTE5NWQwOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIC5ib3R0b20gew0KICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICBib3R0b206IDBweDsNCiAgICBsZWZ0OiAwcHg7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiAxMzZweDsNCiAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmOw0KDQogICAgLmJvdHRvbS1kaXYgew0KICAgICAgbWFyZ2luLXRvcDogMjBweDsNCiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgIHdpZHRoOiAzNzBweDsNCiAgICAgIGZsb2F0OiBsZWZ0Ow0KICAgICAgaGVpZ2h0OiA4OHB4Ow0KICAgICAgbGluZS1oZWlnaHQ6IDg4cHg7DQogICAgICBmb250LXNpemU6IDMycHg7DQogICAgICBmb250LWZhbWlseTogUGluZ0ZhbmdTQy1SZWd1bGFyLCBQaW5nRmFuZyBTQzsNCiAgICAgIGZvbnQtd2VpZ2h0OiA0MDA7DQoNCiAgICAgIC5jYW5jZWwgew0KICAgICAgICB3aWR0aDogOTAlOw0KICAgICAgICBib3JkZXItcmFkaXVzOiA0NHB4Ow0KICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjMWI2N2Q4Ow0KICAgICAgICBjb2xvcjogIzFiNjdkODsNCiAgICAgIH0NCg0KICAgICAgLnN1Ym1pdCB7DQogICAgICAgIHdpZHRoOiA5MCU7DQogICAgICAgIGJvcmRlci1yYWRpdXM6IDQ0cHg7DQogICAgICAgIGNvbG9yOiAjZmZmZmZmOw0KICAgICAgICBiYWNrZ3JvdW5kOiAjMWI2N2Q4Ow0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["addFlaws.vue"],"names":[],"mappings":";AAugBA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addFlaws.vue","sourceRoot":"src/views/FlawsManagement","sourcesContent":["<template>\r\n  <div class=\"add-container\">\r\n    <fm-nav-bar title=\"缺陷新增\" left-arrow @click-left=\"$router.go(-1)\"></fm-nav-bar>\r\n    <div class=\"content\">\r\n      <fm-form class=\"bigForm-container\" @submit=\"onSubmit\" @failed=\"onFailed\">\r\n        <!-- @submit=\"onSubmit\" -->\r\n        <fm-field readonly clickable required name=\"picker\" :value=\"commonForm.defectFrom\" label=\"缺陷来源\"\r\n          placeholder=\"缺陷来源\" suffix-icon=\"arrow\" @click=\"choosePicker('缺陷来源')\"\r\n          :rules=\"[{ required: true, message: '请填写缺陷来源' }]\" input-align=\"right\" />\r\n        <fm-field readonly clickable required name=\"picker\" :value=\"commonForm.bigType\" label=\"业务类型\" placeholder=\"业务类型\"\r\n          suffix-icon=\"arrow\" @click=\"choosePicker('业务类型')\" :rules=\"[{ required: true, message: '请填写业务类型' }]\"\r\n          input-align=\"right\" @change=\"commonForm.smallType = '';\" />\r\n        <fm-field readonly clickable required name=\"picker\" :value=\"commonForm.smallType\" label=\"设施类型\"\r\n          placeholder=\"设施类型\" suffix-icon=\"arrow\" @click=\"choosePicker('设施类型')\"\r\n          :rules=\"[{ required: true, message: '请填写设施类型' }]\" input-align=\"right\" />\r\n\r\n        <fm-popup :visible.sync=\"showPicker\" position=\"bottom\">\r\n          <fm-picker show-toolbar :columns=\"columns\" @confirm=\"onConfirm\" @cancel=\"showPicker = false\" />\r\n        </fm-popup>\r\n\r\n        <fm-field clearable v-model=\"commonForm.smallCode\" name=\"input\" label=\"设施编号\" placeholder=\"设施编号\"\r\n          input-align=\"right\" />\r\n        <fm-field v-model=\"commonForm.position\" name=\"input\" label=\"缺陷位置\" placeholder=\"缺陷位置\" input-align=\"right\" />\r\n        <!-- 新增一条缺陷 -->\r\n        <div class=\"subtable\" v-for=\"(item) in subForms\" :key=\"item.id\">\r\n          <img src=\"./img/link.png\" alt style=\"position: absolute;height: 34px;z-index: 2;top: -18px\" />\r\n          <img src=\"./img/link.png\" alt\r\n            style=\"position: absolute;height: 34px;z-index: 2;float: right;right: 5px; top: -18px\" />\r\n          <fm-form>\r\n            <!-- :value=\"subForm.defectType\"  :columns=\"defectTypeList\"-->\r\n            <fm-field v-model=\"item.defectType\" readonly clickable name=\"picker\" label=\"缺陷类型\" suffix-icon=\"arrow\"\r\n              placeholder=\"缺陷类型\" @click=\"showPickerDefect = true\" input-align=\"right\"></fm-field>\r\n            <fm-popup :visible.sync=\"showPickerDefect\" position=\"bottom\">\r\n              <fm-picker show-toolbar :columns=\"sEventsOptThird\"\r\n                @confirm=\"(val) => { item.defectType = val; showPickerDefect = false }\"\r\n                @cancel=\"showPickerDefect = false\" />\r\n            </fm-popup>\r\n\r\n            <fm-field v-model=\"item.note\" name=\"input\" label=\"备注\" placeholder=\"备注\" input-align=\"right\"></fm-field>\r\n\r\n            <uploader :wpgHeader=\"wpgHeader\" :token=\"token\" label=\"照片\" type=\"image\" v-model=\"picUp\" ref=\"picUp\"\r\n              @fileChange=\"(recall) => fileChange(recall, '', item.pic)\" style=\"width: 100%;\"></uploader>\r\n          </fm-form>\r\n        </div>\r\n        <fm-button native-type=\"button\" type=\"default\" icon=\"plus\" size=\"large\" @click=\"addRow\"\r\n          style=\"margin-left: 8px;width:96%\">新增缺陷</fm-button>\r\n        <fm-field v-model=\"commonForm.describe\" name=\"input\" label=\"现场描述\" placeholder=\"现场描述\" type=\"textarea\" rows=\"2\"\r\n          autosize maxlength=\"200\" show-word-limit input-align=\"right\" />\r\n\r\n        <!--多媒体附件等  -->\r\n        <uploader :wpgHeader=\"wpgHeader\" :token=\"token\" label=\"多媒体附件\" v-model=\"attachment\" ref=\"attachment\"\r\n          @fileChange=\"(recall) => fileChange(recall, '公共')\" style=\"width: 100%;\"></uploader>\r\n\r\n        <fm-field readonly v-model=\"upPerson\" name=\"input\" label=\"上报人\" placeholder=\"上报人\" input-align=\"right\" />\r\n        <fm-field readonly v-model=\"upTime\" name=\"input\" label=\"上报时间\" placeholder=\"上报时间\" input-align=\"right\" />\r\n      </fm-form>\r\n    </div>\r\n    <!-- <div class=\"btnArea\" style=\"margin-top:10px;display:flex;justify-content: space-around;\">\r\n      <fm-button type=\"default\" @click=\"concle\">取消</fm-button>\r\n      <fm-button type=\"primary\" :disabled=\"subForms.length < 1\" @click=\"onSubmit\">提交</fm-button>\r\n    </div> -->\r\n    <div class=\"bottom\">\r\n      <div class=\"bottom-div\">\r\n        <fm-button native-type=\"button\" type=\"default\" class=\"cancel\" @click=\"concle\">取消</fm-button>\r\n      </div>\r\n      <div class=\"bottom-div\">\r\n        <fm-button class=\"submit\" type=\"primary\" :disabled=\"subForms.length < 1\" @click=\"onSubmit\">提交</fm-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { ENUM } from '@/store/State/stateTypes'\r\nimport Uploader from './upload/Uploader'\r\n// import Uploader from '@/components/upload/Uploader.vue'\r\nimport fileUpload from '@/components/fileUpload/index.vue'\r\nimport { Toast } from 'fawkes-mobile-lib'\r\nimport axios from 'axios'\r\nexport default {\r\n  name: 'addFlaws',\r\n  components: { [Toast.name]: Toast, Uploader, fileUpload },\r\n  data() {\r\n    return {\r\n      wpgHeader: {},\r\n      token: '',\r\n      picUp: '',\r\n      attachment: '',\r\n      fileList: [], // 图片多媒体\r\n      // 选择器\r\n      commonForm: {\r\n        defectFrom: '巡检', //缺陷来源，移动端默认巡检\r\n        bigType: '', //业务类型\r\n        smallType: '', //设施类型\r\n        smallCode: '', //设施编号\r\n        position: '', //缺陷位置，xx路就好，经纬度需要但不用显示\r\n        lng: '',\r\n        lat: '',\r\n        properties: {},\r\n        describe: '', //现场描述\r\n        media: [], //多媒体附件\r\n      },\r\n      upPerson: '',\r\n      upTime: '',\r\n      // value: '',\r\n      columns: [],\r\n      showPicker: false, //就一条次 选择器\r\n      showPickerDefect: false, //新增缺陷 可多次 选择器\r\n      whichPicker: '',\r\n      subFormID: 1,\r\n      subForms: [\r\n        {\r\n          id: 1,\r\n          defectType: '',\r\n          note: '', //备注\r\n          pic: [],\r\n        },\r\n      ],\r\n      bigTypeList: [],\r\n      flawsManage: [],//业务对象事件类型\r\n    }\r\n  },\r\n  computed: {\r\n    smallTypeList() {\r\n      let list = []\r\n      if (this.flawsManage) {\r\n        console.log(\"业务-对象\", this.flawsManage.find(it => it.code == this.commonForm.bigType)?.child);\r\n        this.flawsManage.find(it => it.code == this.commonForm.bigType)?.child.forEach(it => {\r\n          list.push(it['zh-CN'])\r\n        })\r\n        return list\r\n      } else {\r\n        return []\r\n      }\r\n\r\n    },\r\n    sEventsOpt() {\r\n      console.log(\"业务-对象\", this.flawsManage)\r\n      if (this.flawsManage) {\r\n        console.log(\"业务-对象\", this.flawsManage.find(it => it.code == this.commonForm.bigType)?.child);\r\n        return this.flawsManage.find(it => it.code == this.commonForm.bigType)?.child\r\n      } else {\r\n        return []\r\n      }\r\n    },\r\n    sEventsOptThird() {\r\n      if (this.commonForm.smallType != '' && this.sEventsOpt) {\r\n        console.log(\"业务-对象-事件\", this.sEventsOpt.find(it => it.code == this.commonForm.smallType)?.child);\r\n        let list = []\r\n        this.sEventsOpt.find(it => it.code == this.commonForm.smallType)?.child.forEach(dic => {\r\n          list.push(dic['zh-CN'])\r\n        })\r\n        return list\r\n      } else if (this.commonForm.smallType == '' && this.flawsManage) {\r\n        let sEventsOptThird = []\r\n        this.flawsManage.find(it => it.code == this.commonForm.bigType)?.child.forEach(it => {\r\n          it.child.forEach(v => {\r\n            sEventsOptThird.push(v)\r\n          })\r\n        });\r\n        console.log('sEventsOptThird: ', sEventsOptThird);\r\n        let list = []\r\n        sEventsOptThird.forEach(it => {\r\n          list.push(it.code)\r\n        })\r\n        return list\r\n      } else {\r\n        return []\r\n      }\r\n    },\r\n    // 缺陷来源\r\n    defectFromDic() {\r\n      console.log(\r\n        'this.$store.state[ENUM].defectFrom: ',\r\n        this.$store.state[ENUM].defectFrom\r\n      )\r\n      return this.$store.state[ENUM].defectFrom\r\n    },\r\n    defectFromList() {\r\n      let list = []\r\n      if (this.defectFromDic) {\r\n        this.defectFromDic.forEach((dic) => {\r\n          list.push(dic['zh-CN'])\r\n        })\r\n      }\r\n      return list\r\n    },\r\n    defectFromListDic() {\r\n      let listDic = {}\r\n      if (this.defectFromDic) {\r\n        this.defectFromDic.forEach((dic) => {\r\n          listDic[dic['zh-CN']] = dic.code\r\n        })\r\n      }\r\n      return listDic\r\n    },\r\n    // 缺陷类型\r\n    // faultTypesDic() {\r\n    //   console.log(\r\n    //     'this.$store.state[ENUM].pipeNetDefectTypes',\r\n    //     this.$store.state[ENUM].pipeNetDefectTypes\r\n    //   )\r\n    //   return this.$store.state[ENUM].pipeNetDefectTypes\r\n    // },\r\n    // defectTypeList() {\r\n    //   let list = []\r\n    //   if (this.faultTypesDic) {\r\n    //     if (\r\n    //       this.faultTypesDic.filter((it) =>\r\n    //         it['zh-CN'].includes(this.commonForm.smallType)\r\n    //       ).length > 0\r\n    //     ) {\r\n    //       this.faultTypesDic\r\n    //         .filter((it) => it['zh-CN'].includes(this.commonForm.smallType))[0]\r\n    //         .child.forEach((dic) => {\r\n    //           list.push(dic['zh-CN'])\r\n    //         })\r\n    //     }\r\n    //   }\r\n    //   return list\r\n    // },\r\n    // defectTypeListDic() {\r\n    //   let listDic = {}\r\n    //   if (this.faultTypesDic) {\r\n    //     this.faultTypesDic.forEach((dic) => {\r\n    //       listDic[dic['zh-CN']] = dic.code\r\n    //     })\r\n    //   }\r\n    //   return listDic\r\n    // },\r\n    // 系统字典虽叫defectType，但实际二级为 业务类型/设施类型\r\n    // 业务类型/设施类型\r\n    // busDeviceTypeDic() {\r\n    //   console.log(\r\n    //     'this.$store.state[ENUM].defectType: ',\r\n    //     this.$store.state[ENUM].defectType\r\n    //   )\r\n    //   return this.$store.state[ENUM].defectType\r\n    // },\r\n    // bigTypeList() {\r\n    //   let list = []\r\n    //   if (this.busDeviceTypeDic) {\r\n    //     this.busDeviceTypeDic.forEach((dic) => {\r\n    //       list.push(dic['zh-CN'])\r\n    //     })\r\n    //   }\r\n    //   return list\r\n    // },\r\n    // bigTypeListDic() {\r\n    //   let listDic = {}\r\n    //   if (this.busDeviceTypeDic) {\r\n    //     this.busDeviceTypeDic.forEach((dic) => {\r\n    //       listDic[dic['zh-CN']] = dic.code\r\n    //     })\r\n    //   }\r\n    //   return listDic\r\n    // },\r\n    // // 二级--设施类型\r\n    // smallTypeObj() {\r\n    //   let listDic = {}\r\n    //   if (this.busDeviceTypeDic) {\r\n    //     this.busDeviceTypeDic.forEach((dic) => {\r\n    //       let list = []\r\n    //       dic.child.forEach((second) => {\r\n    //         list.push(second['zh-CN'])\r\n    //       })\r\n    //       listDic[dic['zh-CN']] = list\r\n    //     })\r\n    //   }\r\n    //   return listDic\r\n    // },\r\n    // smallTypeDic() {\r\n    //   let listDic = {}\r\n    //   if (this.busDeviceTypeDic) {\r\n    //     this.busDeviceTypeDic.forEach((dic) => {\r\n    //       dic.child.forEach((second) => {\r\n    //         listDic[second['zh-CN']] = second.code\r\n    //       })\r\n    //     })\r\n    //   }\r\n    //   return listDic\r\n    // },\r\n  },\r\n  created() {\r\n    this.flawsManage = this.$store.state[ENUM].flawsManage //业务对象事件类型\r\n    console.log('this.flawsManage: ', this.flawsManage);\r\n    this.flawsManage.forEach(it => {\r\n      this.bigTypeList.push(it['zh-CN'])\r\n    })\r\n    // 路由过来，带着参数\r\n    this.objInfo = this.$route.query.msg\r\n    this.token = this.$route.query.token\r\n    // 回填信息\r\n    this.$nextTick(() => {\r\n      this.commonForm.bigType = this.objInfo.bigType || ''\r\n      this.commonForm.smallType = this.objInfo.smallType || ''\r\n      this.commonForm.smallCode = this.objInfo.code || ''\r\n      this.commonForm.position =\r\n        this.objInfo.road_name || [this.objInfo.lng, this.objInfo.lat].toString()\r\n      // 提交表单用的，不回填显示\r\n      this.commonForm.lng = this.objInfo.lng\r\n      this.commonForm.lat = this.objInfo.lat\r\n      this.commonForm.properties = this.objInfo.properties\r\n    })\r\n  },\r\n  methods: {\r\n    // 图片多媒体\r\n    fileChange(recall, mark, rowItem) {\r\n      if (recall.res) {\r\n        let formFile = {\r\n          fileUrl: recall.res.resultData.url,\r\n          fileType: recall.res.resultData.suffix,\r\n          fileSize: recall.res.resultData.size,\r\n          fileId: recall.res.resultData.id,\r\n          name: recall.res.resultData.oldName,\r\n          url:\r\n            process.env.VUE_APP_THIRD_REQUEST_URL +\r\n            '/main/userCenterApi/FileManager/download/' +\r\n            recall.res.resultData.id,\r\n          uid: recall.res.resultData.id,\r\n        }\r\n        if (mark == '公共') {\r\n          // 公共的\r\n          this.commonForm.media.push(formFile)\r\n        } else {\r\n          // 每条缺陷的\r\n          rowItem.push(formFile)\r\n        }\r\n      }\r\n    },\r\n    // 新增相关\r\n    // 新增缺陷 子表项\r\n    addRow() {\r\n      console.log('subForms前: ', this.subForms)\r\n      this.subForms.push({\r\n        id: (this.subFormID += 1),\r\n        defectType: '',\r\n        note: '', //备注\r\n        pic: [],\r\n      })\r\n    },\r\n\r\n    // 取消\r\n    concle() {\r\n      this.commonForm.media.forEach((m) => {\r\n        this.$refs.attachment.removeFile(m)\r\n      })\r\n      this.attachment = ''\r\n      this.picUp = ''\r\n      this.subForms = [\r\n      ]\r\n      this.commonForm = {\r\n        defectFrom: '巡检', //缺陷来源，移动端默认巡检\r\n        bigType: '', //业务类型\r\n        smallType: '', //设施类型\r\n        smallCode: '', //设施编号\r\n        position: '', //缺陷位置，xx路就好，经纬度需要但不用显示\r\n        lng: '',\r\n        lat: '',\r\n        properties: {},\r\n        describe: '', //现场描述\r\n        media: [], //多媒体附件\r\n      }\r\n      let time = new Date()\r\n      this.upTime = time.toLocaleString()\r\n      this.$router.go(-1)\r\n    },\r\n    //提交前 校验未通过\r\n    onFailed() {\r\n      if (\r\n        this.commonForm.defectFrom == '' ||\r\n        this.commonForm.bigType == '' ||\r\n        this.commonForm.smallType == ''\r\n      ) {\r\n        console.log('vcsdfghjngbc: ');\r\n        Toast({\r\n          message: '请检查必填信息',\r\n          position: 'top',\r\n        })\r\n        return false\r\n      }\r\n    },\r\n    // 提交\r\n    onSubmit() {\r\n      Toast({\r\n        message: '提交中',\r\n        position: 'top',\r\n      })\r\n      if (\r\n        this.commonForm.defectFrom != '' &&\r\n        this.commonForm.bigType != '' &&\r\n        this.commonForm.smallType != ''\r\n      ) {\r\n        this.subForms.forEach((sf) => {\r\n          let params = {\r\n            templateCode: 'defect_template',\r\n            title: '缺陷新增', //表单项无，但是接口必填字段\r\n            sysSource: 'outwork',\r\n            createType: 'APP',\r\n            longitude: this.commonForm.lng,\r\n            latitude: this.commonForm.lat,\r\n            questionDescribe: this.commonForm.describe,\r\n            address: this.commonForm.properties?.road_name || '',\r\n            formJson: {\r\n              task_id: this.$route.query.taskId, //巡检任务ID\r\n              gridId: this.objInfo.gridId,\r\n              gridName: this.objInfo.gridName,\r\n              deviceId: this.objInfo.id,\r\n              detail: {\r\n                img: sf.pic,//每条记录的图片\r\n                remark: sf.note,//每条记录的 备注\r\n                defectType: sf.defectType\r\n              },\r\n              files: this.commonForm.media, //公共 附件\r\n              defectFrom: this.defectFromListDic[this.commonForm.defectFrom],\r\n              \"deviceType\": [this.commonForm.bigType, this.commonForm.smallType],\r\n              deviceCode: this.commonForm.smallCode,\r\n              // \"deviceDetail\": this.commonForm.properties,\r\n              deviceDetail: {\r\n                longitude: this.commonForm.lng,\r\n                latitude: this.commonForm.lat,\r\n                road_name: this.commonForm.properties?.road_name || '',\r\n              },\r\n            },\r\n          }\r\n          this.wpgHeader = {\r\n            'Content-Type': 'application/json',\r\n            Authorization: 'Bearer ' + this.token,\r\n          }\r\n          // 提交\r\n          let that = this\r\n          axios({\r\n            url:\r\n              process.env.VUE_APP_THIRD_REQUEST_URL +\r\n              '/main/outworkapi/ticketClient/create',\r\n            method: 'post',\r\n            data: params,\r\n            headers: this.wpgHeader,\r\n          }).then((res) => {\r\n            if (res.status = 200 && res.data.success) {\r\n              Toast.success({\r\n                message: '提交成功',\r\n                duration: 1000,\r\n                onClose: () => {\r\n                  that.subForms.shift()\r\n                  that.$router.go(-1)\r\n                }\r\n              })\r\n            } else {\r\n              Toast.error({\r\n                message: '提交失败，请稍后再试',\r\n                duration: 2000\r\n              })\r\n            }\r\n          })\r\n        }) //forEach结束\r\n      } else {\r\n        Toast({\r\n          message: '请检查必填信息',\r\n          position: 'top',\r\n        })\r\n      }\r\n    },\r\n    // 弹出哪个选择器\r\n    choosePicker(item) {\r\n      this.columns = []\r\n      switch (item) {\r\n        case '缺陷来源':\r\n          this.whichPicker = item\r\n          this.columns = this.defectFromList\r\n          break\r\n        case '业务类型':\r\n          this.whichPicker = item\r\n          this.columns = this.bigTypeList\r\n          break\r\n        case '设施类型':\r\n          this.whichPicker = item\r\n          // this.columns = this.smallTypeObj[this.commonForm.bigType]\r\n          this.columns = this.smallTypeList\r\n          break\r\n        // case '缺陷类型':\r\n        //     this.whichPicker = item\r\n        //     this.columns = this.defectTypeList\r\n        //     break\r\n      }\r\n      this.showPicker = true\r\n    },\r\n    // 选择器选择\r\n    onConfirm(value) {\r\n      switch (this.whichPicker) {\r\n        case '缺陷来源':\r\n          this.commonForm.defectFrom = value\r\n          break\r\n        case '业务类型':\r\n          this.commonForm.bigType = value\r\n          break\r\n        case '设施类型':\r\n          this.commonForm.smallType = value\r\n          break\r\n        // case '缺陷类型':\r\n        //     this.subForm.defectType = value\r\n        //     break\r\n      }\r\n      this.showPicker = false\r\n    },\r\n  },\r\n  mounted() {\r\n    if (this.$route.query.from == 'insp') {\r\n      this.commonForm.defectFrom = '巡检'\r\n    } else if (this.$route.query.from == 'mainten') {\r\n      this.commonForm.defectFrom = '养护'\r\n    }\r\n    this.upPerson = localStorage.getItem(\"cs_userFullname\")\r\n    let time = new Date()\r\n    this.upTime = time.toLocaleString()\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n//隐藏滚动条\r\n&::-webkit-scrollbar {\r\n  display: none; //Chrome | Safari\r\n}\r\n\r\n.add-container {\r\n  width: 100%;\r\n  height: 100%;\r\n\r\n  .content {\r\n    width: 100%;\r\n    height: calc(100% - 250px);\r\n\r\n    .bigForm-container {\r\n      overflow: scroll;\r\n      width: 100%;\r\n      height: 100%;\r\n      background: #ffffff;\r\n\r\n      .subtable {\r\n        position: relative;\r\n        margin: 10px;\r\n        padding: 13px;\r\n        // background-color: aquamarine;\r\n        border-radius: 16px;\r\n        border: 1px solid #5195d0;\r\n      }\r\n    }\r\n  }\r\n\r\n  .bottom {\r\n    position: fixed;\r\n    bottom: 0px;\r\n    left: 0px;\r\n    width: 100%;\r\n    height: 136px;\r\n    background: #ffffff;\r\n\r\n    .bottom-div {\r\n      margin-top: 20px;\r\n      text-align: center;\r\n      width: 370px;\r\n      float: left;\r\n      height: 88px;\r\n      line-height: 88px;\r\n      font-size: 32px;\r\n      font-family: PingFangSC-Regular, PingFang SC;\r\n      font-weight: 400;\r\n\r\n      .cancel {\r\n        width: 90%;\r\n        border-radius: 44px;\r\n        border: 1px solid #1b67d8;\r\n        color: #1b67d8;\r\n      }\r\n\r\n      .submit {\r\n        width: 90%;\r\n        border-radius: 44px;\r\n        color: #ffffff;\r\n        background: #1b67d8;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>"]}]}