{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\components\\select-user\\index.vue?vue&type=style&index=0&id=0e2580c2&scoped=true&lang=less","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\components\\select-user\\index.vue","mtime":1705912799960},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoucG9wdXAtY29udGFpbmVyIHsNCiAgLy8g5YeP5Y675qCH6aKY5qCP55qE6auY5bqmDQogIGhlaWdodDogY2FsYygxMDAlIC0gOTJweCk7DQogIGRpc3BsYXk6IGZsZXg7DQogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQp9DQouYWRkcmVzcy1zZWFyY2gtYm94IHsNCiAgbWFyZ2luLWJvdHRvbTogMTBweDsNCn0NCi5zZWxlY3RlZC11c2VyIHsNCiAgcG9zaXRpb246IGZpeGVkOw0KICBib3R0b206IDA7DQogIGJhY2tncm91bmQ6ICNmZmZmZmY7DQogIHdpZHRoOiAxMDAlOw0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogIHBhZGRpbmc6IDIwcHg7DQogIGZvbnQtc2l6ZTogMC4yMTMzM3JlbTsNCiAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgLnNlbGVjdC10ZXh0IHsNCiAgICBmb250LXNpemU6IDMycHg7DQogICAgY29sb3I6ICMwMjdhZmY7DQogIH0NCn0NCg0KLmFkZHJlc3MtYm94IHsNCiAgbWF4LWhlaWdodDogY2FsYygxMDAlIC0gMTA0cHgpOw0KICBiYWNrZ3JvdW5kOiAjZjlmOWY5Ow0KICBmbGV4OiAxOw0KfQ0KDQovLyDmsqHmnInmmL7npLrpgInkuK3kurrkv6Hmga/ml7YNCi5hZGRyZXNzLWJveC13aXRoLW9yZyB7DQogIG1heC1oZWlnaHQ6IGNhbGMoMTAwJSk7DQp9DQoNCi5hZGRyZXNzLXRyZWUgew0KICBoZWlnaHQ6IGNhbGMoMTAwJSAtIDEyNHB4KTsNCiAgb3ZlcmZsb3c6IHNjcm9sbDsNCiAgLmZtLWxpc3Qgew0KICAgIGhlaWdodDogMTAwJTsNCiAgfQ0KfQ0KLmNlbGwtdGl0bGUgew0KICBtYXJnaW4tbGVmdDogMC4zMnJlbTsNCn0NCg0KLmN1cy1pY29uIHsNCiAgbWFyZ2luOiBhdXRvIDA7DQp9DQoNCi9kZWVwLyAuZm0tbmF2LWJhciAuZm0taWNvbiB7DQogIGNvbG9yOiAjZmZmZmZmOw0KfQ0KDQoucGVyc29uLWNvbnRhaW5lciB7DQogIGhlaWdodDogMTAwJTsNCiAgYmFja2dyb3VuZDogI2VlZWVlZTsNCn0NCi5wZXJzb24tYm94IHsNCiAgaGVpZ2h0OiA4MCU7DQogIGRpc3BsYXk6IGZsZXg7DQogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgZmxleC13cmFwOiBub3dyYXA7DQp9DQoucGVyc29uLXBob3RvIHsNCiAgbWFyZ2luOiAwLjQyNjY3cmVtOw0KfQ0KDQoucGVyc29uLXBob3RvLXRpdGxlIHsNCiAgbWFyZ2luOiAwLjRyZW0gMC44cmVtOw0KICAvZGVlcC8uZm0tY2VsbF9fdmFsdWUtLWFsb25lIHsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIH0NCn0NCg0KLnBlcnNvbi1waG90by10aXRsZTEgew0KICBtYXJnaW46IDAuNHJlbSAwLjhyZW07DQogIC9kZWVwLy5mbS1jZWxsX192YWx1ZS0tYWxvbmUgew0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBjb2xvcjogI2ZmZmZmZjsNCiAgfQ0KICAvZGVlcC8uZm0tY2VsbCB7DQogICAgYmFja2dyb3VuZDogIzAyN2FmZjsNCiAgfQ0KfQ0KLmZtLWNlbGxfX3RpdGxlIHsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCi5oZWFkLXBob3RvIHsNCiAgd2lkdGg6IDgwcHg7DQogIGhlaWdodDogODBweDsNCiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzOGRlZywgIzJmOTVmNSAwJSwgIzQwODhmZiAxMDAlKTsNCiAgb3BhY2l0eTogMC45MjsNCiAgYm9yZGVyLXJhZGl1czogNTAlOw0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIGxpbmUtaGVpZ2h0OiA4MHB4Ow0KICBjb2xvcjogI2ZmZjsNCiAgZm9udC1zaXplOiAzMnB4Ow0KfQ0KL2RlZXAvLmZtLW5vdGlmeSB7DQogIHBhZGRpbmctdG9wOiB2YXIoLS1oZWlnaHQpOw0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAkrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/select-user","sourcesContent":["<!--\r\n * @Author: wei_sc\r\n * @Date: 2022-03-03 11:47:41\r\n * @LastEditors: xie_sm\r\n * @LastEditTime: 2022-05-18 16:38:18\r\n * @FilePath: \\mobile-template\\src\\components\\select-user\\index.vue\r\n * @Description: 选人组件\r\n *\r\n-->\r\n<template>\r\n  <div class=\"select-container\">\r\n    <div class=\"select-box\">\r\n      <!-- 回填展示数据 -->\r\n      <fm-cell :title=\"title\" is-link @click=\"selectUser\" :required=\"required\">\r\n        <template #default>\r\n          <div v-if=\"displayData.length && displayData.length != 0\">\r\n            <fm-tag\r\n              v-for=\"(item, index) in displayData\"\r\n              :key=\"index\"\r\n              :closeable=\"!disabled\"\r\n              size=\"medium\"\r\n              style=\"margin-right: 8px\"\r\n              @close=\"handleDelete(index)\"\r\n            >\r\n              {{ item.userFullname }}\r\n            </fm-tag>\r\n          </div>\r\n          <span v-else>\r\n            {{ placeholder }}\r\n          </span>\r\n        </template>\r\n        <template #right-icon>\r\n          <i\r\n            v-if=\"!(displayData.length && displayData.length != 0)\"\r\n            class=\"fm-icon fm-icon-arrow\"\r\n          ></i>\r\n        </template>\r\n      </fm-cell>\r\n      <!-- 选择用户界面 -->\r\n      <div class=\"select-popup\">\r\n        <fm-popup\r\n          ref=\"userPopup\"\r\n          :visible.sync=\"show\"\r\n          position=\"bottom\"\r\n          :style=\"{ height: '100%', overflow: 'hidden' }\"\r\n        >\r\n          <fm-nav-bar :title=\"navTitle\" :border=\"true\">\r\n            <template #left>\r\n              <i class=\"fm-icon fm-icon-arrow-left\" @click=\"back\"></i>\r\n            </template>\r\n          </fm-nav-bar>\r\n          <div class=\"popup-container\">\r\n            <div\r\n              :class=\"['address-box', treeShow ? 'address-box-with-org' : '']\"\r\n            >\r\n              <div class=\"address-search-box\">\r\n                <fm-search\r\n                  v-model=\"searchValue\"\r\n                  placeholder=\"搜索\"\r\n                  @search=\"onSearch\"\r\n                  @clear=\"onClear\"\r\n                >\r\n                </fm-search>\r\n              </div>\r\n              <div class=\"address-tree\">\r\n                <fm-cell-group v-if=\"treeShow\">\r\n                  <fm-cell\r\n                    v-for=\"item in treeList\"\r\n                    :key=\"item.id\"\r\n                    @click=\"handleClick(item)\"\r\n                  >\r\n                    <template #title>\r\n                      <fm-image\r\n                        width=\"20\"\r\n                        height=\"20\"\r\n                        :src=\"require('@/assets/img/org-tree.png')\"\r\n                      />\r\n                      <span class=\"cell-title\">{{ item.content.name }}</span>\r\n                    </template>\r\n                  </fm-cell>\r\n                </fm-cell-group>\r\n                <fm-list\r\n                  v-else\r\n                  v-model=\"loading\"\r\n                  :finished=\"finished\"\r\n                  finished-text=\"我们是有底线的\"\r\n                  :immediate-check=\"false\"\r\n                  @load=\"onLoad\"\r\n                >\r\n                  <!-- <fm-checkbox-group v-model=\"result\"> -->\r\n                  <fm-cell-group>\r\n                    <fm-cell\r\n                      v-for=\"item in userList\"\r\n                      :key=\"item.userName\"\r\n                      clickable\r\n                    >\r\n                      <template #title>\r\n                        <img\r\n                          class=\"head-photo\"\r\n                          v-if=\"item.photoToken\"\r\n                          :src=\"item.photoToken | lookHeadPhoto\"\r\n                        />\r\n                        <div class=\"head-photo\" v-else>\r\n                          {{ item.userFullname | headPhotoSize }}\r\n                        </div>\r\n                        <span class=\"cell-title\">{{ item.userFullname }}</span>\r\n                      </template>\r\n                      <template #right-icon>\r\n                        <fm-checkbox\r\n                          v-if=\"multiple\"\r\n                          :name=\"item\"\r\n                          v-model=\"item.checked\"\r\n                        />\r\n                        <fm-radio\r\n                          v-else\r\n                          :name=\"item.userName\"\r\n                          :value=\"checkedName\"\r\n                          @click=\"handleRaidoCheck(item)\"\r\n                        />\r\n                      </template>\r\n                    </fm-cell>\r\n                  </fm-cell-group>\r\n                  <!-- </fm-checkbox-group> -->\r\n                </fm-list>\r\n              </div>\r\n            </div>\r\n            <div class=\"selected-user\" v-if=\"!treeShow\">\r\n              <span class=\"select-text\" @click=\"viewSelectedUser\"\r\n                >已选：{{ result.length }} 人</span\r\n              >\r\n              <div class=\"select-button\">\r\n                <fm-button type=\"primary\" size=\"small\" @click=\"confirm\" native-type=\"button\"\r\n                  >确定</fm-button\r\n                >\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </fm-popup>\r\n      </div>\r\n      <!-- 查看已选择用户界面，可在此处删除，删除后点击确定才会变更result值 -->\r\n      <div>\r\n        <fm-popup\r\n          :visible.sync=\"viewShow\"\r\n          position=\"bottom\"\r\n          :style=\"{ height: '100%' }\"\r\n          :safe-area-inset-bottom=\"true\"\r\n          @closed=\"afterClosed\"\r\n        >\r\n          <fm-nav-bar\r\n            :title=\"selectTitle\"\r\n            :border=\"true\"\r\n            right-text=\"确定\"\r\n            @click-right=\"saveUser\"\r\n          >\r\n            <template #left>\r\n              <i class=\"fm-icon fm-icon-arrow-left\" @click=\"cancel\"></i>\r\n            </template>\r\n          </fm-nav-bar>\r\n          <div class=\"popup-container\">\r\n            <fm-cell-group>\r\n              <fm-cell\r\n                v-for=\"(item, index) in displayList\"\r\n                :key=\"item.username\"\r\n              >\r\n                <template #title>\r\n                  <img\r\n                    class=\"head-photo\"\r\n                    v-if=\"item.photoToken\"\r\n                    :src=\"item.photoToken | lookHeadPhoto\"\r\n                  />\r\n                  <div class=\"head-photo\" v-else>\r\n                    {{ item.userFullname | headPhotoSize }}\r\n                  </div>\r\n                  <span class=\"cell-title\">{{ item.userFullname }}</span>\r\n                </template>\r\n                <template #right-icon>\r\n                  <i\r\n                    class=\"fm-icon fm-icon-close cus-icon\"\r\n                    @click=\"deleteUser(item, index)\"\r\n                  ></i>\r\n                </template>\r\n              </fm-cell>\r\n            </fm-cell-group>\r\n          </div>\r\n        </fm-popup>\r\n      </div>\r\n    </div>\r\n    <fm-notify :visible.sync=\"notifyShow\" type=\"warning\">\r\n      <span>{{ notifyText }}</span>\r\n    </fm-notify>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  NavBar,\r\n  Search,\r\n  Cell,\r\n  CellGroup,\r\n  Image,\r\n  List,\r\n  Popup,\r\n  Button,\r\n  RadioGroup,\r\n  Radio,\r\n  Tag,\r\n  Checkbox,\r\n  CheckboxGroup,\r\n  Notify,\r\n} from 'fawkes-mobile-lib'\r\nimport { STATUS_BAR_HEIGHT } from '@/store/State/stateTypes'\r\nimport { getDept } from './api'\r\nimport { searchUser } from '@/api/user'\r\n\r\nexport default {\r\n  components: {\r\n    [NavBar.name]: NavBar,\r\n    [Search.name]: Search,\r\n    [Cell.name]: Cell,\r\n    [CellGroup.name]: CellGroup,\r\n    [Image.name]: Image,\r\n    [List.name]: List,\r\n    [Popup.name]: Popup,\r\n    [Button.name]: Button,\r\n    [RadioGroup.name]: RadioGroup,\r\n    [Radio.name]: Radio,\r\n    [Tag.name]: Tag,\r\n    [Checkbox.name]: Checkbox,\r\n    [CheckboxGroup.name]: CheckboxGroup,\r\n    [Notify.Component.name]: Notify.Component,\r\n  },\r\n  filters: {\r\n    headPhotoSize: function (value) {\r\n      return value.substr(0, 1)\r\n    },\r\n    lookHeadPhoto: function (val) {\r\n      return `${process.env.VUE_APP_BASE_URL}/sys-storage/download_image?f8s=${val}`\r\n    },\r\n  },\r\n  props: {\r\n    userName: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    userFullname: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: '选择人员',\r\n    },\r\n    multiple: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    placeholder: {\r\n      type: String,\r\n      default: '',\r\n    },\r\n    required: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      userList: [],\r\n      userData: [],\r\n      result: [], // 当前选中的用户数组\r\n      displayList: [], // 已选界面展示的用户数组\r\n      displayData: [], // 展示已选的、确认后的数据\r\n      selectUserList: [], //选中的人员数组\r\n      show: false, // 显示选人组件popup界面\r\n      viewShow: false, // 显示已选人员界面\r\n      navTitle: '组织架构',\r\n      searchValue: '',\r\n      treeList: [], //组织架构数据\r\n      treeData: [], // 存放每一级页面部门列表\r\n      treeShow: true, // 当前页面是否显示部门\r\n      loading: false,\r\n      finished: false,\r\n      depId: [], //记录访问深度\\修改navTitle, 默认第一级“组织架构”\r\n      pageNo: 1,\r\n      pageSize: 20,\r\n      accountStatus: 1,\r\n      notifyShow: false,\r\n      notifyText: '',\r\n      changePaged: false, // 是否切换部门\r\n      searchInUserPage: false, // 是否在用户界面查询\r\n      nodeItem: null, // 当前部门节点\r\n    }\r\n  },\r\n  computed: {\r\n    // 选中的结果集\r\n    tempResult() {\r\n      // 多选时，获取当前已选中的用户\r\n      if (this.multiple) {\r\n        return this.userList.filter((user) => user.checked)\r\n      } else {\r\n        return this.result\r\n      }\r\n    },\r\n    // 是否在用户列表界面\r\n    inUserPage() {\r\n      // 用部门节点是否为叶子节点判断是在部门还是用户列表页面\r\n      return this.depId.length != 0 && !this.depId.at(-1)?.hasChildren\r\n    },\r\n    selectTitle() {\r\n      return `已选： ${this.displayList.length} 人`\r\n    },\r\n    // 单选的用户名\r\n    checkedName() {\r\n      return this.result[0]?.userName || ''\r\n    },\r\n  },\r\n  watch: {\r\n    //解决FormCenter打开表单时数据不回显问题\r\n    userFullname() {\r\n      this.init()\r\n    },\r\n    tempResult(newVal, oldVal) {\r\n      // 多选\r\n      if (this.multiple) {\r\n        // newVal - oldVal - reuslt 待新增的\r\n        const toAdd = newVal\r\n          .filter(\r\n            (user) => !oldVal.some((val) => user.userName == val.userName)\r\n          )\r\n          .filter(\r\n            (add) => !this.result.some((val) => val.userName == add.userName)\r\n          )\r\n\r\n        if (toAdd.length > 0) {\r\n          this.result = this.result.concat(toAdd)\r\n        }\r\n\r\n        let toRemove = []\r\n\r\n        // 处理切换部门时意外清空选中记录问题\r\n        if (this.changePaged) {\r\n          this.changePaged = false\r\n        } else {\r\n          // 待删除 old-new\r\n          toRemove = oldVal.filter(\r\n            (user) => !newVal.some((val) => user.userName == val.userName)\r\n          )\r\n        }\r\n\r\n        // 切换部门时不删除，避免已选中记录被清空\r\n        if (toRemove.length > 0) {\r\n          this.result = this.result.filter(\r\n            (item) => !toRemove.some((val) => val.userName == item.userName)\r\n          )\r\n        }\r\n      } else {\r\n        // 单选\r\n        this.result = newVal\r\n      }\r\n    },\r\n    depId(newVal) {\r\n      if (newVal.length > 0) {\r\n        document.removeEventListener(\r\n          'backbutton',\r\n          this.$refs.userPopup.close,\r\n          false\r\n        )\r\n        document.addEventListener('backbutton', this.back, false)\r\n      } else {\r\n        document.addEventListener(\r\n          'backbutton',\r\n          this.$refs.userPopup.close,\r\n          false\r\n        )\r\n        document.removeEventListener('backbutton', this.back, false)\r\n      }\r\n    },\r\n    viewShow(newVal) {\r\n      if (newVal) {\r\n        document.removeEventListener('backbutton', this.back, false)\r\n        document.addEventListener('backbutton', this.cancel, false)\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.init()\r\n  },\r\n  methods: {\r\n    //更新父组件\r\n    updateProps(val) {\r\n      let usernameStr = ''\r\n      let userfullnameStr = ''\r\n      if (val.length == 0) {\r\n        this.$emit('update:userName', '')\r\n        this.$emit('update:userFullname', '')\r\n        this.$emit('change', val) //暴露选人组件的change事件后续需要可以调用\r\n      } else {\r\n        val.forEach((item) => {\r\n          usernameStr += item.userName + ','\r\n          userfullnameStr += item.userFullname + ','\r\n        })\r\n        this.$emit(\r\n          'update:userName',\r\n          usernameStr.substring(0, usernameStr.length - 1)\r\n        )\r\n        this.$emit(\r\n          'update:userFullname',\r\n          userfullnameStr.substring(0, userfullnameStr.length - 1)\r\n        )\r\n        this.$emit('change', val)\r\n      }\r\n    },\r\n    //删除\r\n    handleDelete(index) {\r\n      this.result.splice(index, 1)\r\n      this.displayData = this.result\r\n      this.updateProps(this.result)\r\n    },\r\n    //选择人员\\打开弹出层\r\n    selectUser() {\r\n      if (this.disabled) {\r\n        return\r\n      } else {\r\n        this.show = true\r\n        this.treeShow = true\r\n        //获取树形数据\r\n        getDept({}).then((res) => {\r\n          if (res.status) {\r\n            this.treeList = res.data\r\n            this.treeData.push(res.data)\r\n            this.depId.push({\r\n              title: '组织架构',\r\n              id: '0',\r\n              hasChildren: res.data.length > 0,\r\n            })\r\n          }\r\n        })\r\n      }\r\n    },\r\n    //查看已选人员名单\r\n    viewSelectedUser() {\r\n      this.viewShow = true\r\n      this.displayList = Array.from(this.result)\r\n    },\r\n    // 已选择用户界面删除用户\r\n    deleteUser(item, index) {\r\n      this.displayList.splice(index, 1)\r\n    },\r\n    //保存的话会保存操作\r\n    saveUser() {\r\n      this.result = Array.from(this.displayList)\r\n      if (this.multiple) {\r\n        if (this.result.length == 0) {\r\n          this.userList.forEach((user) => {\r\n            this.$set(user, 'checked', false)\r\n          })\r\n        } else {\r\n          this.result.forEach((item) => {\r\n            this.userList.forEach((user) => {\r\n              if (user.userName == item.userName) {\r\n                this.$set(user, 'checked', true)\r\n              } else {\r\n                this.$set(user, 'checked', false)\r\n              }\r\n            })\r\n          })\r\n        }\r\n      }\r\n\r\n      this.viewShow = false\r\n    },\r\n    //取消则之前做的操作都取消\r\n    cancel() {\r\n      this.viewShow = false\r\n    },\r\n    //回退\r\n    back() {\r\n      // 清空搜索框\r\n      this.searchValue = ''\r\n      // 查询页面不要弹出标题，清空操作\r\n      if (this.searchInUserPage || (!this.treeShow && !this.inUserPage)) {\r\n        this.onClear()\r\n        return\r\n      } else {\r\n        // 删除当前标题\r\n        this.depId.pop()\r\n      }\r\n\r\n      if (this.depId.length > 0) {\r\n        this.navTitle = this.depId[this.depId.length - 1]?.title\r\n      } else {\r\n        // 第一级页面时关闭弹窗且恢复已选值\r\n        this.show = false\r\n        this.result = Array.from(this.displayData)\r\n        return\r\n      }\r\n\r\n      if (this.treeShow) {\r\n        this.treeData.pop()\r\n        // 获取上一级部门列表信息\r\n        this.treeList = this.treeData.at(-1)\r\n      } else {\r\n        // 从用户列表页面返回\r\n        this.treeShow = true\r\n      }\r\n    },\r\n    //树形判断\r\n    judgeChild(node, tree) {\r\n      if (tree.length != 0) {\r\n        for (let i = 0; i < tree.length; i++) {\r\n          if (node == tree[i] && tree[i].children) {\r\n            return tree[i].children\r\n          } else if (tree[i].children) {\r\n            this.judgeChild(node, tree[i].children)\r\n          }\r\n        }\r\n      }\r\n    },\r\n    //树形点击后出现子级目录：下级组织机构或者下面的人员\r\n    handleClick(item) {\r\n      this.searchValue = ''\r\n      if (this.treeShow) {\r\n        this.nodeItem = item\r\n      }\r\n      // 跳转新部门前记录上一级\r\n      this.depId.push({\r\n        title: item.content.name,\r\n        id: item.id,\r\n        hasChildren: item?.children?.length > 0,\r\n      })\r\n      this.navTitle = item.content.name\r\n      // 部门页面\r\n      if (this.judgeChild(item, this.treeList)) {\r\n        this.treeList = this.judgeChild(item, this.treeList)\r\n        this.treeData.push(this.treeList)\r\n      } else {\r\n        // 人员列表页面\r\n        this.pageNo = 1 //初始化进入时，页码必须为1，否则会被影响\r\n        let data = {\r\n          orgNo: item.content.orgNo,\r\n          searchValue: this.searchValue,\r\n          pageSize: this.pageSize,\r\n          pageNo: this.pageNo,\r\n          accountStatus: 1,\r\n        }\r\n        this.changePaged = true\r\n        searchUser(data).then((res) => {\r\n          this.userList = res.data.list\r\n          this.finished = res.data.isLastPage\r\n          this.treeShow = false\r\n          // 多选\r\n          if (this.multiple) {\r\n            if (this.result.length && this.userList.length) {\r\n              this.result.forEach((item) => {\r\n                this.userList.forEach((user) => {\r\n                  if (item.userName == user.userName) {\r\n                    this.$set(user, 'checked', true)\r\n                  }\r\n                })\r\n              })\r\n            }\r\n          }\r\n        })\r\n      }\r\n    },\r\n    //下拉加载数据\r\n    onLoad() {\r\n      this.pageNo += 1\r\n      let data = {\r\n        orgNo: this.nodeItem?.id,\r\n        searchValue: this.searchValue,\r\n        pageSize: this.pageSize,\r\n        pageNo: this.pageNo,\r\n        accountStatus: 1,\r\n      }\r\n      searchUser(data).then((res) => {\r\n        this.userList.push(...res.data.list)\r\n        this.treeShow = false\r\n        if (this.userList.length == res.data.total) {\r\n          this.finished = true\r\n        }\r\n      })\r\n      this.loading = false\r\n    },\r\n    //确认选择\r\n    confirm() {\r\n      this.depId = []\r\n      this.navTitle = '组织架构'\r\n      this.show = false\r\n      this.searchValue = ''\r\n      this.treeList = []\r\n      // 更新回填展示数据\r\n      this.displayData = this.result\r\n      this.updateProps(this.result)\r\n    },\r\n    // 初始化\r\n    init() {\r\n      const userfullnameArr = this.userFullname\r\n        ? this.userFullname.split(',')\r\n        : []\r\n      const usernameArr = this.userName ? this.userName.split(',') : []\r\n      const len = userfullnameArr.length\r\n      const len2 = usernameArr.length\r\n\r\n      if (this.userFullname && this.userName) {\r\n        if (len !== len2) {\r\n          this.controlNotifyShow('初始人员数值错误')\r\n          return false\r\n        } else {\r\n          this.displayData = usernameArr.map((userName, index) => {\r\n            return { userName: userName, userFullname: userfullnameArr[index] }\r\n          })\r\n          this.result = Array.from(this.displayData)\r\n        }\r\n      } else if (!this.userfullname && !this.username) {\r\n        this.displayList = []\r\n      } else {\r\n        this.controlNotifyShow(\r\n          '请输入正确的人员数据,人员id和人员名称需同时赋值'\r\n        )\r\n      }\r\n    },\r\n    onSearch(val) {\r\n      // 空条件等同于清空\r\n      if (val === '' || !val) {\r\n        this.onClear()\r\n      } else {\r\n        if (this.inUserPage) {\r\n          this.searchInUserPage = true\r\n        }\r\n        this.pageNo = 1\r\n        let data = {\r\n          searchValue: val,\r\n          pageSize: this.pageSize,\r\n          pageNo: this.pageNo,\r\n          accountStatus: 1,\r\n        }\r\n        searchUser(data).then((res) => {\r\n          this.userList = res.data.list\r\n          this.treeShow = false\r\n        })\r\n      }\r\n    },\r\n    onClear() {\r\n      this.searchValue = ''\r\n      // 在用户列表页面清空查询时\r\n      if (this.inUserPage) {\r\n        this.searchInUserPage = false\r\n        this.pageNo = 1\r\n        let data = {\r\n          orgNo: this.nodeItem?.id,\r\n          pageSize: this.pageSize,\r\n          pageNo: this.pageNo,\r\n          accountStatus: 1,\r\n        }\r\n        searchUser(data).then((res) => {\r\n          this.userList = res.data.list\r\n          this.treeShow = false\r\n        })\r\n      } else {\r\n        // 在部门列表页面\r\n        this.userList = []\r\n        this.treeShow = true\r\n      }\r\n    },\r\n    controlNotifyShow(text) {\r\n      this.notifyText = text\r\n      this.notifyShow = true\r\n      setTimeout(() => {\r\n        this.notifyShow = false\r\n      }, 1000)\r\n    },\r\n    handleRaidoCheck(item) {\r\n      // this.checkedName = item.userName\r\n      this.result = [item]\r\n    },\r\n    // 第二级弹窗（已选用户界面）关闭后\r\n    afterClosed() {\r\n      document.removeEventListener('backbutton', this.cancel, false)\r\n      // 移除组件关闭时添加的默认事件\r\n      document.removeEventListener('backbutton', this.$back, false)\r\n      document.addEventListener('backbutton', this.back, false)\r\n    },\r\n  },\r\n}\r\n</script>\r\n<style scoped lang=\"less\">\r\n.popup-container {\r\n  // 减去标题栏的高度\r\n  height: calc(100% - 92px);\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n.address-search-box {\r\n  margin-bottom: 10px;\r\n}\r\n.selected-user {\r\n  position: fixed;\r\n  bottom: 0;\r\n  background: #ffffff;\r\n  width: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 20px;\r\n  font-size: 0.21333rem;\r\n  box-sizing: border-box;\r\n  .select-text {\r\n    font-size: 32px;\r\n    color: #027aff;\r\n  }\r\n}\r\n\r\n.address-box {\r\n  max-height: calc(100% - 104px);\r\n  background: #f9f9f9;\r\n  flex: 1;\r\n}\r\n\r\n// 没有显示选中人信息时\r\n.address-box-with-org {\r\n  max-height: calc(100%);\r\n}\r\n\r\n.address-tree {\r\n  height: calc(100% - 124px);\r\n  overflow: scroll;\r\n  .fm-list {\r\n    height: 100%;\r\n  }\r\n}\r\n.cell-title {\r\n  margin-left: 0.32rem;\r\n}\r\n\r\n.cus-icon {\r\n  margin: auto 0;\r\n}\r\n\r\n/deep/ .fm-nav-bar .fm-icon {\r\n  color: #ffffff;\r\n}\r\n\r\n.person-container {\r\n  height: 100%;\r\n  background: #eeeeee;\r\n}\r\n.person-box {\r\n  height: 80%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  flex-wrap: nowrap;\r\n}\r\n.person-photo {\r\n  margin: 0.42667rem;\r\n}\r\n\r\n.person-photo-title {\r\n  margin: 0.4rem 0.8rem;\r\n  /deep/.fm-cell__value--alone {\r\n    text-align: center;\r\n  }\r\n}\r\n\r\n.person-photo-title1 {\r\n  margin: 0.4rem 0.8rem;\r\n  /deep/.fm-cell__value--alone {\r\n    text-align: center;\r\n    color: #ffffff;\r\n  }\r\n  /deep/.fm-cell {\r\n    background: #027aff;\r\n  }\r\n}\r\n.fm-cell__title {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.head-photo {\r\n  width: 80px;\r\n  height: 80px;\r\n  background: linear-gradient(138deg, #2f95f5 0%, #4088ff 100%);\r\n  opacity: 0.92;\r\n  border-radius: 50%;\r\n  text-align: center;\r\n  line-height: 80px;\r\n  color: #fff;\r\n  font-size: 32px;\r\n}\r\n/deep/.fm-notify {\r\n  padding-top: var(--height);\r\n}\r\n</style>\r\n"]}]}