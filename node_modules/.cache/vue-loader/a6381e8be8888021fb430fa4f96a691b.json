{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\FormCenter\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\FormCenter\\index.vue","mtime":1705912800023},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyBDVVJSRU5UX1JPVyB9IGZyb20gJ0Avc3RvcmUvU3RhdGUvc3RhdGVUeXBlcycNCmltcG9ydCBmbG93QXBwcm92YWwgZnJvbSAnLi9jb21wb25lbnRzL0Zsb3dBcHByb3ZhbCcNCmltcG9ydCBmbG93RW50cnVzdCBmcm9tICcuL2NvbXBvbmVudHMvRmxvd0VudHJ1c3QnDQppbXBvcnQgZmxvd1RpbWVsaW5lIGZyb20gJy4vY29tcG9uZW50cy9GbG93VGltZWxpbmUnDQppbXBvcnQgeyBzdWJtaXRGb3JtIH0gZnJvbSAnLi9hcGknDQppbXBvcnQgeyBUYWIsIFRhYnMsIE5hdkJhciwgRmllbGQsIEJ1dHRvbiwgVG9hc3QgfSBmcm9tICdmYXdrZXMtbW9iaWxlLWxpYicNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ0Zvcm1DZW50ZXInLA0KICBjb21wb25lbnRzOiB7DQogICAgZmxvd0FwcHJvdmFsLA0KICAgIGZsb3dFbnRydXN0LA0KICAgIGZsb3dUaW1lbGluZSwNCiAgICBbVGFiLm5hbWVdOiBUYWIsDQogICAgW1RhYnMubmFtZV06IFRhYnMsDQogICAgW05hdkJhci5uYW1lXTogTmF2QmFyLA0KICAgIFtGaWVsZC5uYW1lXTogRmllbGQsDQogICAgW0J1dHRvbi5uYW1lXTogQnV0dG9uLA0KICAgIFtUb2FzdC5uYW1lXTogVG9hc3QsDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHR5cGU6IHRoaXMuJHJvdXRlLnBhcmFtcy50eXBlLA0KICAgICAgZm9ybUtleTogdGhpcy4kcm91dGUucGFyYW1zLmZvcm1LZXksIC8vIOihqOWNlemUruWAvA0KICAgICAgYml6SWQ6IHRoaXMuJHJvdXRlLnBhcmFtcy5iaXpJZCwNCiAgICAgIHRhc2tJZDogdGhpcy4kcm91dGUucGFyYW1zLnRhc2tJZCwNCiAgICAgIHRhc2tLZXk6IHRoaXMuJHJvdXRlLnBhcmFtcy50YXNrS2V5LA0KICAgICAgZHluYW1pY0Zvcm06ICcnLA0KICAgICAgaXNEaXNhYmxlZDogZmFsc2UsDQogICAgICB0YWJUaXRsZXM6IFtdLA0KICAgICAgZGV0YWlsUGFyYW1MaXN0OiBbXSwgLy8g6ZyA5o+Q5Lqk55qE5piO57uG6KGo5pWw5o2uDQogICAgICB0YWI6IDAsDQogICAgICBlbnRpdHlOYW1lOiAnJywgLy8g5Lia5Yqh6KGo55qE5a6e5L2T57G75ZCNDQogICAgICBzZXJ2aWNlOiB7fSwgLy/mj5DkuqTlnLDlnYDlkozliJ3lp4vljJblnLDlnYANCiAgICAgIGZvcm1OYW1lOiAnJywgLy/ooajljZXlkI3np7ANCiAgICAgIGZsb3dEYXRhOiB7DQogICAgICAgIG1vZGVsS2V5OiAnJywgLy/mtYHnqIvplK7lgLwNCiAgICAgIH0sDQogICAgICAvLyDnp7vliqjnq6/lj5Hotbfml7bmj5DkvpvnmoTmjInpkq4NCiAgICAgIGJ1dHRvbkxpc3Q6IFsNCiAgICAgICAgew0KICAgICAgICAgIHR5cGU6ICdzYXZlRHJhZnQnLA0KICAgICAgICAgIHRleHQ6ICfmmoLlrZgnLA0KICAgICAgICAgIGNvZGU6ICdTQVZFRFJBRlQnLA0KICAgICAgICAgIGN1c3RvbUNvZGU6ICdTQVZFRFJBRlQnLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgdHlwZTogJ3N1Ym1pdCcsDQogICAgICAgICAgdGV4dDogJ+aPkOS6pCcsDQogICAgICAgICAgY29kZTogJ1NVQk1JVCcsDQogICAgICAgICAgY3VzdG9tQ29kZTogJ1NVQk1JVCcsDQogICAgICAgIH0sDQogICAgICBdLA0KICAgICAgZm9ybURhdGE6IHt9LA0KICAgIH0NCiAgfSwNCiAgd2F0Y2g6IHt9LA0KICBjb21wdXRlZDogew0KICAgIHJvdygpIHsNCiAgICAgIC8vIOmhtemdouS4reS9v+eUqHJvd+adpeaMh+S7o+W9k+WJjeiusOW9lQ0KICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlW0NVUlJFTlRfUk9XXQ0KICAgIH0sDQogICAgbGFuZygpIHsNCiAgICAgIGlmICh0aGlzLiRzdG9yYWdlLmdldCgnaTE4bkxvY2FsZScpID09ICd6aCcpIHsNCiAgICAgICAgcmV0dXJuICd6aC1DTicNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAnZW4nDQogICAgICB9DQogICAgfSwNCiAgfSwNCiAgY3JlYXRlZCgpIHt9LA0KICBtb3VudGVkKCkgew0KICAgIHRoaXMuaW5pdEZvcm0oKQ0KICAgIGlmICh0aGlzLnR5cGUgPT0gJ2V4ZWN1dGUnKSB7DQogICAgICB0aGlzLnRhYlRpdGxlcyA9IFsn6K+m5oOFJywgJ+a1gei9rCcsICflrqHmibknLCAn5aeU5omYJ10NCiAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PSAndmlldycpIHsNCiAgICAgIHRoaXMudGFiVGl0bGVzID0gWyfor6bmg4UnLCAn5rWB6L2sJ10NCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy50YWJUaXRsZXMgPSBbJ+ivpuaDhScsICflp5TmiZgnXQ0KICAgIH0NCiAgICB0aGlzLmlzRGlzYWJsZWQgPSB0cnVlDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBnb0JhY2soKSB7DQogICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpDQogICAgfSwNCiAgICAvLyDpnZ7nqbrmoKHpqozmlrnms5UNCiAgICBjaGVja1J1bGVzKCkgew0KICAgICAgLy8g5Lia5Yqh6KGo5Y2V5o+Q5L6b5qCh6aqM5pa55rOVDQogICAgICBpZiAodGhpcy4kcmVmcy5mb3JtVGVtcC52YWxpZGF0b3IpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuJHJlZnMuZm9ybVRlbXAudmFsaWRhdG9yKCkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiB0cnVlDQogICAgICB9DQogICAgfSwNCiAgICAvLyDmj5DkuqTmtYHnqIvliY3pkqnlrZDlh73mlbANCiAgICBiZWZvcmVTdWJtaXQoKSB7DQogICAgICB0aGlzLiRyZWZzLmZvcm1UZW1wPy5iZWZvcmVTdWJtaXQoKQ0KICAgIH0sDQogICAgLy8g5o+Q5Lqk5rWB56iL5ZCO55qE5pON5L2cDQogICAgYWZ0ZXJTdWJtaXQoKSB7fSwNCiAgICAvLyDooajljZXpgIDlm57kuYvlkI7nmoTmk43kvZwNCiAgICBhZnRlcmVSZWplY3QoKSB7fSwNCiAgICB0YWJjbGljayh2YWwpIHsNCiAgICAgIHRoaXMudGFiID0gdmFsDQogICAgfSwNCiAgICAvLyDliqjmgIHojrflj5ZGb3JtQ2VudGVy5LiL55qE5a+55bqU55qE5rWB56iL6KGo5Y2V57uE5Lu2DQogICAgaW5pdEZvcm0oKSB7DQogICAgICBjb25zdCByZXFzID0gcmVxdWlyZS5jb250ZXh0KCdAL3ZpZXdzL0Zvcm1DZW50ZXInLCB0cnVlLCAvaW5kZXhcLnZ1ZS8sICdsYXp5JykNCiAgICAgIHJlcXMua2V5cygpLmZvckVhY2goKGtleSkgPT4gew0KICAgICAgICAvLyDmraTlpITmo4DmtYvmqKHlnZfnmoTmlofku7blpLnlkI3lkoxmb3Jta2V55Yy56YWN5pe25b+955Wl5aSn5bCP77yM5Yib5bu6Zm9ybWtleeaXtuacgOWlveS9v+eUqOW4leaWr+WNoeWRveWQjeazlQ0KICAgICAgICBpZiAoUmVnRXhwKGBcXC8ke3RoaXMuZm9ybUtleX1cXC9gLCAnaScpLnRlc3Qoa2V5KSkgew0KICAgICAgICAgIHJlcXMoa2V5KS50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICAgIHRoaXMuZHluYW1pY0Zvcm0gPSByZXMuZGVmYXVsdA0KICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICBzZXRGb3JtTmFtZShmb3JtTmFtZSkgew0KICAgICAgdGhpcy5mb3JtTmFtZSA9IGZvcm1OYW1lDQogICAgfSwNCiAgICBzZXRNb2RlbEtleShtb2RlbEtleSkgew0KICAgICAgdGhpcy5mbG93RGF0YS5tb2RlbEtleSA9IG1vZGVsS2V5DQogICAgfSwNCiAgICBzZXRFbnRpdHlOYW1lKGVudGl0eU5hbWUpIHsNCiAgICAgIHRoaXMuZW50aXR5TmFtZSA9IGVudGl0eU5hbWUNCiAgICB9LA0KICAgIHNldFNlcnZpY2Uoc2VydmljZSkgew0KICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZQ0KICAgIH0sDQogICAgc2V0UHJlU2F2ZVZhbGlkYXRlUHJvcHMocHJvcHMpIHsNCiAgICAgIHRoaXMucHJlU2F2ZVZhbGlkYXRlUHJvcHMgPSBwcm9wcw0KICAgIH0sDQogICAgc2V0Rm9ybURhdGEoZm9ybURhdGEpIHsNCiAgICAgIHRoaXMuZm9ybURhdGEgPSBmb3JtRGF0YQ0KICAgIH0sDQogICAgc2V0RGV0YWlsUGFyYW1MaXN0KGRldGFpbFBhcmFtTGlzdCkgew0KICAgICAgdGhpcy5kZXRhaWxQYXJhbUxpc3QgPSBkZXRhaWxQYXJhbUxpc3QNCiAgICB9LA0KICAgIG9uQWN0aW9uKGl0ZW0pIHsNCiAgICAgIC8vIOaaguWtmOS4jemcgOimgeagoemqjO+8jOebtOaOpeS/neWtmA0KICAgICAgaWYgKGl0ZW0udHlwZSA9PSAnc2F2ZURyYWZ0Jykgew0KICAgICAgICB0aGlzLmhhbmRsZUFjdGlvbihpdGVtKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8g6KGo5Y2V57uf5LiA5L2/55SoZm9ybeeahHJlZuWAvA0KICAgICAgICBpZiAodGhpcy4kcmVmcy5mb3JtVGVtcC4kcmVmcy5mb3JtKSB7DQogICAgICAgICAgdGhpcy4kcmVmcy5mb3JtVGVtcC4kcmVmcy5mb3JtDQogICAgICAgICAgICAudmFsaWRhdGUoKQ0KICAgICAgICAgICAgLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgICB0aGlzLmhhbmRsZUN1c3RvbVZhbGlkYXRvcihpdGVtKQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgICAgIFRvYXN0KCfooajljZXmoKHpqozmnKrpgJrov4cnKQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAvL+acquWumuS5iWZvcm3nmoTlvJXnlKjlgLzml7YNCiAgICAgICAgICB0aGlzLmhhbmRsZUN1c3RvbVZhbGlkYXRvcigpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIGhhbmRsZUN1c3RvbVZhbGlkYXRvcihpdGVtKSB7DQogICAgICBpZiAodHlwZW9mIHRoaXMuJHJlZnMuZm9ybVRlbXAudmFsaWRhdG9yID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGlmICh0aGlzLiRyZWZzLmZvcm1UZW1wLnZhbGlkYXRvcigpKSB7DQogICAgICAgICAgdGhpcy5oYW5kbGVBY3Rpb24oaXRlbSkNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8g5rKh5pyJ6Ieq5a6a5LmJ55qE6KGo5Y2V5qCh6aqM6KeE5YiZ77yM55u05o6l5o+Q5LqkDQogICAgICAgIHRoaXMuaGFuZGxlQWN0aW9uKGl0ZW0pDQogICAgICB9DQogICAgfSwNCiAgICBoYW5kbGVBY3Rpb24oaXRlbSkgew0KICAgICAgaWYgKHR5cGVvZiB0aGlzLiRyZWZzLmZvcm1UZW1wLmJlZm9yZVN1Ym1pdCA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICB0aGlzLiRyZWZzLmZvcm1UZW1wLmJlZm9yZVN1Ym1pdCgpDQogICAgICB9DQogICAgICBsZXQgZm9ybSA9IHsNCiAgICAgICAgZW50aXR5TmFtZTogdGhpcy5lbnRpdHlOYW1lLA0KICAgICAgICBlbnRpdHlPYmplY3Q6IHRoaXMuZm9ybURhdGEsDQogICAgICAgIGZvcm1Qcm9jZXNzUGFyYW06IHRoaXMudXNlUHJvY2VzcyhpdGVtKSwNCiAgICAgICAgZGV0YWlsUGFyYW1MaXN0OiB0aGlzLmRldGFpbFBhcmFtTGlzdCwNCiAgICAgIH0NCiAgICAgIHN1Ym1pdEZvcm0odGhpcy5zZXJ2aWNlLnN1Ym1pdCwgZm9ybSkudGhlbigocmVzKSA9PiB7DQogICAgICAgIGlmIChyZXMuc3RhdHVzKSB7DQogICAgICAgICAgVG9hc3QoJ+aPkOS6pOaIkOWKnycpDQogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpDQogICAgICAgICAgfSwgMTAwMCkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBUb2FzdChyZXMubWVzc2FnZSkNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOiOt+WPlua1geeoi+WPguaVsOS/oeaBrw0KICAgIHVzZVByb2Nlc3MoYnV0dG9uSW5mbykgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgbW9kZWxLZXk6IHRoaXMuZmxvd0RhdGEubW9kZWxLZXksDQogICAgICAgIGJpeklkOiB0aGlzLmJpeklkLA0KICAgICAgICBwcm9jZXNzSW5zdGFuY2VJZDogdGhpcy5wcm9jZXNzSW5zdGFuY2VJZCwNCiAgICAgICAgZm9ybUtleTogdGhpcy5mb3JtS2V5LA0KICAgICAgICBzdGFnZUZsYWc6IGJ1dHRvbkluZm8udHlwZSA9PT0gJ3NhdmVEcmFmdCcgPyAxIDogMCwNCiAgICAgICAgdmFyaWFibGU6IHRoaXMuZm9ybURhdGEsDQogICAgICAgIHRhc2tJZDogdGhpcy50YXNrSWQsDQogICAgICAgIGFwcHJvdmFsOiBidXR0b25JbmZvLnR5cGUgPT09ICdzYXZlRHJhZnQnID8gJ3N0YWdlJyA6ICcnLA0KICAgICAgICBjb21tZW50OiB0aGlzLmNvbW1lbnQsDQogICAgICAgIHRhcmdldEtleTogYnV0dG9uSW5mby50YXJnZXRLZXksDQogICAgICB9DQogICAgfSwNCiAgfSwNCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AA2EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/FormCenter","sourcesContent":["<template>\r\n  <div class=\"main-container\">\r\n    <fm-nav-bar :title=\"formName\" left-text=\"\" right-text=\"\" left-arrow @click-left=\"goBack\" />\r\n    <fm-tabs line-width=\"80px\" @tab-click=\"tabclick\" v-if=\"type != 'add'\">\r\n      <fm-tab v-for=\"(item, index) in tabTitles\" :label=\"item\" :key=\"index\"></fm-tab>\r\n    </fm-tabs>\r\n    <!-- 从业务模块发起时只显示表单详情和暂存、提交 -->\r\n    <div v-if=\"type == 'add'\" class=\"component\">\r\n      <!-- style=\"height: calc(100% - 108px); overflow: auto\" -->\r\n      <component\r\n        class=\"cus-form\"\r\n        ref=\"formTemp\"\r\n        v-bind:is=\"dynamicForm\"\r\n        @setFormName=\"setFormName\"\r\n        @setModelKey=\"setModelKey\"\r\n        @setEntityName=\"setEntityName\"\r\n        @setService=\"setService\"\r\n        @setPreSaveValidateProps=\"setPreSaveValidateProps\"\r\n        @setFormData=\"setFormData\"\r\n        @setDetailParamList=\"setDetailParamList\"\r\n      ></component>\r\n      <div class=\"buttons\" v-if=\"type == 'add' || (type == 'execute' && flowList.length === 1)\">\r\n        <div class=\"button\" v-for=\"item in buttonList\" :key=\"item.type\">\r\n          <fm-button\r\n            block\r\n            type=\"primary\"\r\n            native-type=\"submit\"\r\n            @click=\"onAction(item)\"\r\n            :class=\"[item.type]\"\r\n            >{{ item.text }}</fm-button\r\n          >\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- 任务待办打开时 -->\r\n    <div v-else style=\"height: calc(100% - 88px); overflow: auto\">\r\n      <div v-show=\"tab == 0\" class=\"content-container\">\r\n        <component\r\n          ref=\"formTemp\"\r\n          v-bind:is=\"dynamicForm\"\r\n          @setFormName=\"setFormName\"\r\n          @setModelKey=\"setModelKey\"\r\n          @setEntityName=\"setEntityName\"\r\n          @setService=\"setService\"\r\n          @setPreSaveValidateProps=\"setPreSaveValidateProps\"\r\n          @setFormData=\"setFormData\"\r\n          @setDetailParamList=\"setDetailParamList\"\r\n          class=\"task-detail-form\"\r\n        ></component>\r\n      </div>\r\n      <div v-show=\"tab == 1\" class=\"content-container\">\r\n        <flow-entrust v-if=\"type == 'flowView'\" :formData=\"formData\"></flow-entrust>\r\n        <flow-timeline :taskId=\"taskId\" :bizId=\"bizId\" v-else></flow-timeline>\r\n      </div>\r\n      <div v-show=\"tab == 2\" class=\"content-container\">\r\n        <flow-approval\r\n          :submitURL=\"service.submit\"\r\n          :entityName=\"entityName\"\r\n          :formData=\"formData\"\r\n          :detailParamList=\"detailParamList\"\r\n          :modelKey=\"flowData.modelKey\"\r\n          :checkRules=\"checkRules\"\r\n          :beforeSubmit=\"beforeSubmit\"\r\n          :aftereReject=\"aftereReject\"\r\n          :afterSubmit=\"afterSubmit\"\r\n        >\r\n        </flow-approval>\r\n      </div>\r\n      <div v-show=\"tab == 3\" class=\"content-container\">\r\n        <flow-entrust :formData=\"formData\"></flow-entrust>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { CURRENT_ROW } from '@/store/State/stateTypes'\r\nimport flowApproval from './components/FlowApproval'\r\nimport flowEntrust from './components/FlowEntrust'\r\nimport flowTimeline from './components/FlowTimeline'\r\nimport { submitForm } from './api'\r\nimport { Tab, Tabs, NavBar, Field, Button, Toast } from 'fawkes-mobile-lib'\r\nexport default {\r\n  name: 'FormCenter',\r\n  components: {\r\n    flowApproval,\r\n    flowEntrust,\r\n    flowTimeline,\r\n    [Tab.name]: Tab,\r\n    [Tabs.name]: Tabs,\r\n    [NavBar.name]: NavBar,\r\n    [Field.name]: Field,\r\n    [Button.name]: Button,\r\n    [Toast.name]: Toast,\r\n  },\r\n  data() {\r\n    return {\r\n      type: this.$route.params.type,\r\n      formKey: this.$route.params.formKey, // 表单键值\r\n      bizId: this.$route.params.bizId,\r\n      taskId: this.$route.params.taskId,\r\n      taskKey: this.$route.params.taskKey,\r\n      dynamicForm: '',\r\n      isDisabled: false,\r\n      tabTitles: [],\r\n      detailParamList: [], // 需提交的明细表数据\r\n      tab: 0,\r\n      entityName: '', // 业务表的实体类名\r\n      service: {}, //提交地址和初始化地址\r\n      formName: '', //表单名称\r\n      flowData: {\r\n        modelKey: '', //流程键值\r\n      },\r\n      // 移动端发起时提供的按钮\r\n      buttonList: [\r\n        {\r\n          type: 'saveDraft',\r\n          text: '暂存',\r\n          code: 'SAVEDRAFT',\r\n          customCode: 'SAVEDRAFT',\r\n        },\r\n        {\r\n          type: 'submit',\r\n          text: '提交',\r\n          code: 'SUBMIT',\r\n          customCode: 'SUBMIT',\r\n        },\r\n      ],\r\n      formData: {},\r\n    }\r\n  },\r\n  watch: {},\r\n  computed: {\r\n    row() {\r\n      // 页面中使用row来指代当前记录\r\n      return this.$store.state[CURRENT_ROW]\r\n    },\r\n    lang() {\r\n      if (this.$storage.get('i18nLocale') == 'zh') {\r\n        return 'zh-CN'\r\n      } else {\r\n        return 'en'\r\n      }\r\n    },\r\n  },\r\n  created() {},\r\n  mounted() {\r\n    this.initForm()\r\n    if (this.type == 'execute') {\r\n      this.tabTitles = ['详情', '流转', '审批', '委托']\r\n    } else if (this.type == 'view') {\r\n      this.tabTitles = ['详情', '流转']\r\n    } else {\r\n      this.tabTitles = ['详情', '委托']\r\n    }\r\n    this.isDisabled = true\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      this.$router.go(-1)\r\n    },\r\n    // 非空校验方法\r\n    checkRules() {\r\n      // 业务表单提供校验方法\r\n      if (this.$refs.formTemp.validator) {\r\n        return this.$refs.formTemp.validator()\r\n      } else {\r\n        return true\r\n      }\r\n    },\r\n    // 提交流程前钩子函数\r\n    beforeSubmit() {\r\n      this.$refs.formTemp?.beforeSubmit()\r\n    },\r\n    // 提交流程后的操作\r\n    afterSubmit() {},\r\n    // 表单退回之后的操作\r\n    aftereReject() {},\r\n    tabclick(val) {\r\n      this.tab = val\r\n    },\r\n    // 动态获取FormCenter下的对应的流程表单组件\r\n    initForm() {\r\n      const reqs = require.context('@/views/FormCenter', true, /index\\.vue/, 'lazy')\r\n      reqs.keys().forEach((key) => {\r\n        // 此处检测模块的文件夹名和formkey匹配时忽略大小，创建formkey时最好使用帕斯卡命名法\r\n        if (RegExp(`\\\\/${this.formKey}\\\\/`, 'i').test(key)) {\r\n          reqs(key).then((res) => {\r\n            this.dynamicForm = res.default\r\n          })\r\n        }\r\n      })\r\n    },\r\n    setFormName(formName) {\r\n      this.formName = formName\r\n    },\r\n    setModelKey(modelKey) {\r\n      this.flowData.modelKey = modelKey\r\n    },\r\n    setEntityName(entityName) {\r\n      this.entityName = entityName\r\n    },\r\n    setService(service) {\r\n      this.service = service\r\n    },\r\n    setPreSaveValidateProps(props) {\r\n      this.preSaveValidateProps = props\r\n    },\r\n    setFormData(formData) {\r\n      this.formData = formData\r\n    },\r\n    setDetailParamList(detailParamList) {\r\n      this.detailParamList = detailParamList\r\n    },\r\n    onAction(item) {\r\n      // 暂存不需要校验，直接保存\r\n      if (item.type == 'saveDraft') {\r\n        this.handleAction(item)\r\n      } else {\r\n        // 表单统一使用form的ref值\r\n        if (this.$refs.formTemp.$refs.form) {\r\n          this.$refs.formTemp.$refs.form\r\n            .validate()\r\n            .then(() => {\r\n              this.handleCustomValidator(item)\r\n            })\r\n            .catch(() => {\r\n              Toast('表单校验未通过')\r\n            })\r\n        } else {\r\n          //未定义form的引用值时\r\n          this.handleCustomValidator()\r\n        }\r\n      }\r\n    },\r\n    handleCustomValidator(item) {\r\n      if (typeof this.$refs.formTemp.validator === 'function') {\r\n        if (this.$refs.formTemp.validator()) {\r\n          this.handleAction(item)\r\n        }\r\n      } else {\r\n        // 没有自定义的表单校验规则，直接提交\r\n        this.handleAction(item)\r\n      }\r\n    },\r\n    handleAction(item) {\r\n      if (typeof this.$refs.formTemp.beforeSubmit === 'function') {\r\n        this.$refs.formTemp.beforeSubmit()\r\n      }\r\n      let form = {\r\n        entityName: this.entityName,\r\n        entityObject: this.formData,\r\n        formProcessParam: this.useProcess(item),\r\n        detailParamList: this.detailParamList,\r\n      }\r\n      submitForm(this.service.submit, form).then((res) => {\r\n        if (res.status) {\r\n          Toast('提交成功')\r\n          setTimeout(() => {\r\n            this.$router.go(-1)\r\n          }, 1000)\r\n        } else {\r\n          Toast(res.message)\r\n        }\r\n      })\r\n    },\r\n    // 获取流程参数信息\r\n    useProcess(buttonInfo) {\r\n      return {\r\n        modelKey: this.flowData.modelKey,\r\n        bizId: this.bizId,\r\n        processInstanceId: this.processInstanceId,\r\n        formKey: this.formKey,\r\n        stageFlag: buttonInfo.type === 'saveDraft' ? 1 : 0,\r\n        variable: this.formData,\r\n        taskId: this.taskId,\r\n        approval: buttonInfo.type === 'saveDraft' ? 'stage' : '',\r\n        comment: this.comment,\r\n        targetKey: buttonInfo.targetKey,\r\n      }\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n* {\r\n  box-sizing: border-box;\r\n}\r\n\r\n.main-container {\r\n  overflow: hidden;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.component,\r\n.cus-form {\r\n  height: calc(100% - 122px - env(safe-area-inset-bottom));\r\n  height: calc(100% - 122px - constant(safe-area-inset-bottom));\r\n  overflow-y: auto;\r\n  flex: 1;\r\n}\r\n\r\n// 表单底部安全区\r\n.task-detail-form {\r\n  padding-bottom: constant(safe-area-inset-bottom); /* 兼容 iOS < 11.2 */\r\n  padding-bottom: env(safe-area-inset-bottom); /* 兼容 iOS >= 11.2 */\r\n}\r\n\r\n/deep/.fm-field--disabled .fm-field__label {\r\n  color: #000;\r\n}\r\n\r\n/deep/ .fm-cell-group__title {\r\n  color: #000;\r\n}\r\n.field-attachment {\r\n  flex-direction: column;\r\n  /deep/ .fm-field__control--right {\r\n    justify-content: flex-start;\r\n  }\r\n}\r\n\r\n.buttons {\r\n  display: flex;\r\n  padding: 18px 30px;\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  height: calc(122px + constant(safe-area-inset-bottom));\r\n  height: calc(122px + env(safe-area-inset-bottom));\r\n}\r\n.button {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  .saveDraft {\r\n    border-radius: 10px;\r\n    background: #ffffff;\r\n    color: #027aff;\r\n  }\r\n\r\n  .submit {\r\n    border-radius: 10px;\r\n    background: #027aff;\r\n    margin-left: 23px;\r\n  }\r\n}\r\n</style>\r\n"]}]}