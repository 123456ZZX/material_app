{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\inspectionManage\\daily-task.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\inspectionManage\\daily-task.vue","mtime":1708928163428},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgYnVzIGZyb20gJy4uLy4uL3ZpZXdzL2luc3BlY3RNYXAvdXRpbHMvQnVzLmpzJw0KaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJw0KaW1wb3J0IGRheWpzIGZyb20gJ2RheWpzJw0KaW1wb3J0IE1hcENvbXAgZnJvbSAnLi4vLi4vdmlld3MvaW5zcGVjdE1hcC9pbmRleC52dWUnDQppbXBvcnQgcmVxdWVzdCBmcm9tICdAL3V0aWxzL3JlcXVlc3QnDQppbXBvcnQgKiBhcyBhcGkgZnJvbSAnLi9hcGknDQppbXBvcnQgeyBUb2FzdCwgRGlhbG9nLCBOb3RpZnkgfSBmcm9tICdmYXdrZXMtbW9iaWxlLWxpYicNCmltcG9ydCAqIGFzIHR1cmYgZnJvbSAnQHR1cmYvdHVyZicNCmltcG9ydCBVcGxvYWRlciBmcm9tICdAL2NvbXBvbmVudHMvdXBsb2FkL1VwbG9hZGVyLnZ1ZScNCmltcG9ydCBwcm9ibGVtQ2FyZEluZm8gZnJvbSAnLi9wcm9ibGVtQ2FyZEluZm8nOw0KaW1wb3J0IEFQSSBmcm9tICJAL2NvbW1vbi9jb25maWcuanMiOw0KaW1wb3J0IF9jbG9uZURlZXAgZnJvbSAnbG9kYXNoL2Nsb25lRGVlcCcNCmNvbnN0IG1hcE9iaiA9IHsNCiAgbWFwOiBudWxsLA0KICBtYXBJbnN0YW5jZTogbnVsbCwNCn0NCmxldCBwYXVzZVN0YXRlVHJhY2tQb2ludHMgPSBbXQ0KbGV0IHBhdXNlU3RhdGVQaXBlSWRMaXN0ID0gW10NCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ2RhaWx5LXRhc2snLA0KICBjb21wb25lbnRzOiB7DQogICAgTWFwQ29tcCwNCiAgICBVcGxvYWRlciwNCiAgICBwcm9ibGVtQ2FyZEluZm8NCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgc2hvd0tleUxpc3Q6IGZhbHNlLA0KICAgICAgYnV0dG9uTGlzdDogW10sDQogICAgICB1bkluc3BLZXlEZXRhaWxMaXN0OiBbXSwNCiAgICAgIGxvYWRpbmc6IGZhbHNlLA0KICAgICAgZmluaXNoZWQ6IHRydWUsDQogICAgICBjdXJyZW50U2VsZWN0OiAn5YWo6YOoJywNCiAgICAgIGlzUmVzdW1lOiB0cnVlLA0KICAgICAgaWZMZWF2ZVRhc2s6IGZhbHNlLA0KICAgICAgc3RvcFJlYXNvbjogJycsDQogICAgICBpZkVuZFRhc2s6IGZhbHNlLA0KICAgICAgbGVnZW5kQ29uZmlnOiBbXSwNCiAgICAgIGlmVGlwczogZmFsc2UsDQogICAgICByZXBvcnREYXRhSXNMb2FkZWQ6IGZhbHNlLA0KICAgICAgLy8g5beh5qOA5Lu75Yqh5LiL5omA5pyJ5beh5qOA566h57q/DQogICAgICBhbGxUYXNrTGluZXM6IFtdLA0KICAgICAgaXNWaWV3OiB0cnVlLA0KICAgICAgYWN0aXZlOiAwLA0KICAgICAgZGV2aWNlTmFtZTogJycsDQogICAgICBoYXNTaWduSW46IGZhbHNlLA0KICAgICAgc2hvd1BvcG92ZXI6IGZhbHNlLA0KICAgICAgYWN0aW9uczogWw0KICAgICAgICB7DQogICAgICAgICAgdGV4dDogJ+mXrumimOS4iuaKpScsDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICB0ZXh0OiAn6K6+5pa957y66Zm3JywNCiAgICAgICAgfSwNCiAgICAgIF0sDQogICAgICBjdXJyZW50UmF0ZTogMCwNCiAgICAgIC8vIOaOp+WItuWFs+mUrueCueWIl+ihqOaYvumakA0KICAgICAgcG9pbnRMaXN0U2hvdzogZmFsc2UsDQogICAgICAvLyDlhajlsYDlj5Hlo7Dlh73mlbANCiAgICAgIC8vIOiusOW9leW8gOWni+W3oeajgOeahOaXtumXtO+8jOeUqOS6juWIpOaWreaYr+WQpuWcqOW8gOWni+W3oeajgOeahDEwc+WGhQ0KICAgICAgc3RhcnRSZWNvcmRUaW1lcjogJycsDQogICAgICBuYXZiYXJUaXRsZTogJ+aXpeW4uOS7u+WKoScsDQogICAgICAvLyDkuIrmiqXlpLHotKXnmoTlt6Hmo4Dovajov7nngrnkvY3mlbDnu4QNCiAgICAgIHJlcG9ydEZhaWxUcmFja1BvaW50czogW10sDQogICAgICBpc1Nob3dSb3V0ZTogdHJ1ZSwNCiAgICAgIGluc3BCdXNpbmVzc1R5cGU6ICcnLA0KICAgICAgcmVjb3JkRGF0YTogW10sDQogICAgICAvLyDlvZPliY3lt6Hmo4DlkZjmiYDlpITkvY3nva4NCiAgICAgIGN1cnJlbnRQb3NpdGlvbjogbnVsbCwNCiAgICAgIGxpbmVzOiBbXSwNCiAgICAgIC8vIOW3oeajgOWRmOS/oeaBrw0KICAgICAgdXNlckluZm86IHt9LA0KICAgICAgaWZSZWNvcmRpbmc6IGZhbHNlLA0KICAgICAgc2VsZWN0RXZlbnRUeXBlOiBmYWxzZSwNCiAgICAgIGV2ZW50VHlwZUxpc3Q6IFtdLA0KICAgICAgc2lnblNob3c6IGZhbHNlLA0KICAgICAgYXR0YWNobWVudDogJycsDQogICAgICBzaWduRm9ybTogew0KICAgICAgICBkZXZpY2VTdGF0dXM6ICcxJywNCiAgICAgICAgaW5zcEltYWdlc0xpc3Q6IFtdLA0KICAgICAgICByZW1hcms6ICcnLA0KICAgICAgICBpc1JlcG9ydDogJycsDQogICAgICAgIHRhc2tJZDogJycsDQogICAgICAgIHBvaW50SWQ6ICcnLA0KICAgICAgICBsaXF1aWRMZXZlbDogJycsDQogICAgICB9LA0KICAgICAgdGFza0RldGFpbDogew0KICAgICAgICBjb3ZlcmFnZTogJzAvMCcsDQogICAgICAgIHJlcG9ydFJhdGU6ICcwLzAnLA0KICAgICAgICBwbGFuRW5kVGltZTogJycsDQogICAgICB9LA0KICAgICAgZW5nSW5mb0RUTzoge30sDQogICAgICB0YXNrUmVzdFRpbWU6IDAsDQogICAgICByZXBvcnRGb290ZXJTaG93OiBmYWxzZSwNCiAgICAgIGZlYXR1cmU6IHt9LA0KICAgICAgcGxhbkRldGFpbDoge30sDQogICAgICAvLyDnlKjkuo7lnLDlm77kuK3mmL7npLrojIPlm7TlkozlhbPplK7ngrkNCiAgICAgIGluc3BSYW5nZUxpc3Q6IFtdLA0KICAgICAgcmFuZ2VMaXN0OiBbXSwNCiAgICAgIGtleURldGFpbExpc3Q6IFtdLA0KICAgICAgaXNSdW5MaXN0OiBbDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5q2j5bi4JywNCiAgICAgICAgICB2YWx1ZTogJzEnLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+W8guW4uCcsDQogICAgICAgICAgdmFsdWU6ICcwJywNCiAgICAgICAgfSwNCiAgICAgIF0sDQogICAgICByZXBvcnRDaG9zZTogWw0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+mXrumimOS4iuaKpScsDQogICAgICAgICAgdmFsdWU6ICfpl67popjkuIrmiqUnLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+aWsOWinue8uumZtycsDQogICAgICAgICAgdmFsdWU6ICfmlrDlop7nvLrpmbcnLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+aXoOmcgOS4iuaKpScsDQogICAgICAgICAgdmFsdWU6ICfml6DpnIDkuIrmiqUnLA0KICAgICAgICB9LA0KICAgICAgXSwNCiAgICAgIHJ1bGVzOiB7DQogICAgICB9LA0KICAgICAgcHJldmlld1VSTDogJy9zeXMtc3RvcmFnZS9kb3dubG9hZF9pbWFnZT9mOHM9JywNCiAgICAgIHVwaW1nUHJldmlldzogW10sDQogICAgICBoZWFkZXJzOiB7fSwNCiAgICAgIHVybDogew0KICAgICAgICAvLyDmnKzpobXpnaLkvb/nlKjliLDnmoR1cmwNCiAgICAgICAgdXBsb2FkRmlsZTogJ3N5cy1zdG9yYWdlL3VwbG9hZCcsDQogICAgICAgIGZpbmRGaWxlOiAnZWNpZGktY21wL2ZpbGUvY21wRmlsZUdyb3VwL2ZpbmRGaWxlc0J5R3JvdXBJZCcsDQogICAgICB9LA0KICAgICAgcG9sbGluZ0ZsYWc6IGZhbHNlLA0KICAgICAgcG9sbGluZ0dhcFRpbWU6IDMsDQogICAgICB0cmFja1BvaW50TGlzdDogW10sDQogICAgICB0cmFja1BvaW50VGltZUxpc3Q6IFtdLA0KICAgICAgb3ZlclNwZWVkVHJhY2tMaW5lTGlzdDogW10sDQogICAgICB0cmFja0xvY2F0aW9uX3N0YXJ0OiAnJywNCiAgICAgIHRyYWNrTG9jYXRpb25fZW5kOiAnJywNCiAgICAgIHNob3dWaXNpYmxlOiBmYWxzZSwNCiAgICAgIHJlcG9ydFNob3c6IGZhbHNlLCAvLyDpl67popjkuIrmiqXpnaLmnb/mmL7npLoNCiAgICAgIGFjY2Vzc1Rva2VuOiB0aGlzLiRzdG9yYWdlLmdldCgnYWNjZXNzX3Rva2VuJyksDQogICAgICBoZWFkZXI6IHt9LA0KICAgICAgZm9ybVRva2VuOiAnJywNCiAgICAgIC8vIOmXrumimOS4iuaKpWxpc3QNCiAgICAgIHByb2JsZW1EYXRhTGlzdDE6IFtdLA0KICAgICAgLy8g6K6+5pa957y66Zm3bGlzdA0KICAgICAgcHJvYmxlbURhdGFMaXN0MjogW10sDQogICAgICAvLyDmtrLkvY3ovpPlhaXmoYbmmK/lkKbmmL7npLoNCiAgICAgIHdhdGVyTGV2ZWxTaG93OiBmYWxzZSwNCiAgICAgIC8vIOW3oeajgOimgeeCuWxpc3TmlbDmja4NCiAgICAgIGtleVBvaW50c0luc3BlY3Rpb25MaXN0OiBbXSwNCiAgICB9DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgYnV0dG9uQXJlYVN0eWxlKCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgJy0td2lkdGgnOiB0aGlzLmJ1dHRvbkxpc3QubGVuZ3RoICogKDgwICsgMTApICsgJ3B4JywNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIC8vIOiOt+WPlumXrumimOS4iuaKpeWSjOiuvuaWvee8uumZt+aVsOaNrg0KICAgIHRoaXMuZ2V0Q2FyZExpc3REYXRhKCkNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJwYXVzZSIsIHRoaXMucGF1c2UsIGZhbHNlKQ0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInJlc3VtZSIsIHRoaXMucmVzdW1lLCBmYWxzZSkNCiAgICB0aGlzLnVzZXJJbmZvID0gdGhpcy4kc3RvcmUuc3RhdGUudXNlckluZm8NCiAgICBjb25zb2xlLmxvZygndGhpcy51c2VySW5mbzogJywgdGhpcy51c2VySW5mbyk7DQogICAgdGhpcy5pc1N0YXJ0ID0gZmFsc2UNCiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc3RhcnRSZWNvcmRMaW5lcycsICdlbmQnKQ0KICAgIHRoaXMubmF2YmFyVGl0bGUgPSAn5pel5bi45Lu75YqhJw0KICAgIGxldCB0aGF0ID0gdGhpcw0KICAgIGJ1cy4kb2ZmKCdzdGFydFNpZ25JbicpLiRvbignc3RhcnRTaWduSW4nLCAoZmVhdHVyZSkgPT4gew0KICAgICAgdGhhdC5zdGFydFNpZ25JbihmZWF0dXJlKQ0KICAgIH0pDQogICAgdGhpcy5pc1ZpZXcgPSB0aGlzLiRyb3V0ZS5xdWVyeS5pc1ZpZXcNCiAgICBjb25zdCBpZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZA0KICAgIHRoaXMuZ2V0VGFza0J5SWQoaWQpDQogICAgdGhpcy5nZXRUcmFja1JlY29yZHNCeUlkKGlkKQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgb3BlbktleVBvaW50TGlzdCgpIHsNCiAgICAgIHRoaXMuc2hvd0tleUxpc3QgPSB0cnVlDQogICAgfSwNCiAgICBnb1RvRGVhbChvYmopIHsNCiAgICAgIGlmIChvYmouc3RhcnRMb25naXR1ZGUgJiYgb2JqLnN0YXJ0TGF0aXR1ZGUpIHsNCiAgICAgICAgdGhpcy5mbHlUb1BvaW50KFtvYmouc3RhcnRMb25naXR1ZGUsIG9iai5zdGFydExhdGl0dWRlXSkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIFRvYXN0Lndhcm5pbmcoew0KICAgICAgICAgIG1lc3NhZ2U6ICflvZPliY3orr7mlr3ml6DlnLDnkIblnZDmoIfkv6Hmga8nLA0KICAgICAgICAgIGR1cmF0aW9uOiAyMDAwDQogICAgICAgIH0pDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgIH0sDQogICAgY2hhbmdlQml6VHlwZSh0eXBlKSB7DQogICAgICB0aGlzLmN1cnJlbnRTZWxlY3QgPSB0eXBlDQogICAgICB0aGlzLnVuSW5zcEtleURldGFpbExpc3QgPSBbXQ0KICAgICAgaWYgKHR5cGUgPT0gJ+WFqOmDqCcpIHsNCiAgICAgICAgdGhpcy51bkluc3BLZXlEZXRhaWxMaXN0ID0gdGhpcy5rZXlEZXRhaWxMaXN0LmZpbHRlcihpdCA9PiAhaXQuZGV2aWNlU3RhdHVzKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy51bkluc3BLZXlEZXRhaWxMaXN0ID0gdGhpcy5rZXlEZXRhaWxMaXN0LmZpbHRlcihpdCA9PiAhaXQuZGV2aWNlU3RhdHVzICYmIGl0LmJpelR5cGUgPT0gdHlwZSkNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOiOt+WPlumXrumimOS4iuaKpeWSjOiuvuaWvee8uumZt+aVsOaNrg0KICAgIGdldENhcmRMaXN0RGF0YSgpIHsNCiAgICAgIC8vIOiOt+WPlmhlYWRlcu+8jOafpeivouW3peWNleeUqA0KICAgICAgYXhpb3Moew0KICAgICAgICB1cmw6IHByb2Nlc3MuZW52LlZVRV9BUFBfVEhJUkRfUkVRVUVTVF9VUkwgKyAnL21haW4vdXNlckNlbnRlckFwaS9zc28vdG9rZW5CeVRva2VuJywNCiAgICAgICAgbWV0aG9kOiAncG9zdCcsDQogICAgICAgIHBhcmFtczogew0KICAgICAgICAgIHRva2VuOiB0aGlzLmFjY2Vzc1Rva2VuLA0KICAgICAgICB9LA0KICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0Jhc2ljIGIzVjBkMjl5YXpwM2NHY3lNREl3JywNCiAgICAgICAgfSwNCiAgICAgIH0pLnRoZW4oKHJlcykgPT4gew0KICAgICAgICBpZiAocmVzLnN0YXR1cyA9PSAyMDApIHsNCiAgICAgICAgICB0aGlzLmZvcm1Ub2tlbiA9IHJlcy5kYXRhLnJlc3VsdERhdGEudG9rZW4NCiAgICAgICAgICB0aGlzLmhlYWRlciA9IHsNCiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsDQogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyB0aGlzLmZvcm1Ub2tlbiwNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfSwNCiAgICBhc3luYyBnZXRQcm9ibGVtRGF0YUxpc3QocGFyYW1zKSB7DQogICAgICB0aGlzLnByb2JsZW1EYXRhTGlzdDEgPSBbXQ0KICAgICAgdGhpcy5wcm9ibGVtRGF0YUxpc3QyID0gW10NCg0KICAgICAgbGV0IGNvbW1vblBhcmFtcyA9IE9iamVjdC5hc3NpZ24oew0KICAgICAgICBzeXNDb2RlOiAnb3V0d29yaycsDQogICAgICAgIC8vIHRva2VuOiB0aGlzLmFjY2Vzc1Rva2VuLA0KICAgICAgICBwYWdlOiB7DQogICAgICAgICAgY3VycmVudDogMSwNCiAgICAgICAgICBzaXplOiA5OTk5OSwgLy8g5p+l5YWo6YOoDQogICAgICAgIH0NCiAgICAgIH0sIHBhcmFtcykNCiAgICAgIC8vIOmXrumimOS4iuaKpQ0KICAgICAgbGV0IHBhcmFtczEgPSB7DQogICAgICAgIC4uLmNvbW1vblBhcmFtcywNCiAgICAgICAgc21hbGxUeXBlOiAnYWJub3JtYWxfaW5mb3JtJw0KICAgICAgfQ0KICAgICAgLy8g6K6+5pa957y66Zm3DQogICAgICBsZXQgcGFyYW1zMiA9IHsNCiAgICAgICAgLi4uY29tbW9uUGFyYW1zLA0KICAgICAgICBzbWFsbFR5cGU6ICdkZWZlY3QnDQogICAgICB9DQogICAgICBsZXQgcHJvYmxlbVBvaW50RmVhdHVyZXMgPSBbXQ0KICAgICAgLy8g6Zeu6aKY5LiK5oqlDQogICAgICBhd2FpdCB0aGlzLmdldEF4aW9zRGF0YShwYXJhbXMxLCB0aGlzLnByb2JsZW1EYXRhTGlzdDEpDQogICAgICAvLyDorr7mlr3nvLrpmbcNCiAgICAgIGF3YWl0IHRoaXMuZ2V0QXhpb3NEYXRhKHBhcmFtczIsIHRoaXMucHJvYmxlbURhdGFMaXN0MikNCiAgICAgIGxldCBhbGxQcm9ibGVtID0gdGhpcy5wcm9ibGVtRGF0YUxpc3QxLmNvbmNhdCh0aGlzLnByb2JsZW1EYXRhTGlzdDIpDQogICAgICBhbGxQcm9ibGVtLmZvckVhY2goaXQgPT4gew0KICAgICAgICBwcm9ibGVtUG9pbnRGZWF0dXJlcy5wdXNoKHsNCiAgICAgICAgICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgZ2VvbWV0cnk6IHsNCiAgICAgICAgICAgIHR5cGU6ICdQb2ludCcsDQogICAgICAgICAgICBjb29yZGluYXRlczogaXQubG5nbGF0DQogICAgICAgICAgfSwNCiAgICAgICAgICBwcm9wZXJ0aWVzOiB7DQogICAgICAgICAgICBpZDogaXQuaWQsDQogICAgICAgICAgICB0aXRsZTogaXQudGl0bGUNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICB9KQ0KICAgICAgdGhpcy4kcmVmcy5teW1hcC5hZGRJbnNwRXZlbnRMYXllcihwcm9ibGVtUG9pbnRGZWF0dXJlcykNCiAgICAgIHRoaXMucmVwb3J0RGF0YUlzTG9hZGVkID0gdHJ1ZQ0KICAgIH0sDQogICAgZ2V0QXhpb3NEYXRhKHBhcmFtcywgcHJvYmxlbURhdGFMaXN0KSB7DQogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICBheGlvcyh7DQogICAgICAgICAgdXJsOiBwcm9jZXNzLmVudi5WVUVfQVBQX1RISVJEX1JFUVVFU1RfVVJMICsgJy9tYWluL291dHdvcmthcGkvdGlja2V0U3RhdGlzdGljQ2xpZW50L2dldFRpY2tldExpc3QnLA0KICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLA0KICAgICAgICAgIGRhdGE6IHBhcmFtcywNCiAgICAgICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlciwNCiAgICAgICAgfSkudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT0gMjAwKSB7DQogICAgICAgICAgICByZXMuZGF0YS5yZXN1bHREYXRhLnJlY29yZHMuZm9yRWFjaCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaXRlbTogJywgaXRlbSk7DQogICAgICAgICAgICAgIHByb2JsZW1EYXRhTGlzdC5wdXNoKHsNCiAgICAgICAgICAgICAgICBpZDogaXRlbS5pZCwgLy8g5bel5Y2VSUQNCiAgICAgICAgICAgICAgICB0aXRsZTogaXRlbS50aXRsZSwgLy8g5bel5Y2V5qCH6aKYDQogICAgICAgICAgICAgICAgdGlja2V0U3RhdHVzTmFtZTogaXRlbS50aWNrZXRTdGF0dXNOYW1lLA0KICAgICAgICAgICAgICAgIGhhbmRsZVR5cGU6IGl0ZW0uZm9ybVZhbHVlLmhhbmRsZVR5cGUsIC8vIOaPj+i/sA0KICAgICAgICAgICAgICAgIGNyZWF0ZUJ5TmFtZTogaXRlbS5jcmVhdGVCeU5hbWUsIC8vIOWIm+W7uuS6ug0KICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IGl0ZW0uY3JlYXRlVGltZS5zdWJzdHJpbmcoMCwgMTApLCAvLyDliJvlu7rml7bpl7QNCiAgICAgICAgICAgICAgICBkZWZlY3RGcm9tOiBpdGVtLmZvcm1WYWx1ZS5kZWZlY3RGcm9tLA0KICAgICAgICAgICAgICAgIGZhdWx0VHlwZXM6IGl0ZW0uZm9ybVZhbHVlLmRldGFpbD8uZGVmZWN0VHlwZSB8fCBpdGVtLmZvcm1WYWx1ZS5mYXVsdFR5cGVzLA0KICAgICAgICAgICAgICAgIC8vIGZpbGVVcmw6IGl0ZW0uZm9ybVZhbHVlPy5oYW5kbGVJbWdzPy5bMF0/LmZpbGVVcmwsDQogICAgICAgICAgICAgICAgLy8g5Zu+54mH5Zyw5Z2ADQogICAgICAgICAgICAgICAgdXJsOiBpdGVtLmZvcm1WYWx1ZT8uZmlsZXM/LlswXT8udXJsLA0KICAgICAgICAgICAgICAgIC8vIOWPkeeUn+e7j+e6rOW6pg0KICAgICAgICAgICAgICAgIGxuZ2xhdDogW2l0ZW0uYXBwZWFsTG5nLCBpdGVtLmFwcGVhbExhdF0gfHwgW2l0ZW0uZm9ybVZhbHVlLmRldmljZURldGFpbC5sb25naXR1ZGUsIGl0ZW0uZm9ybVZhbHVlLmRldmljZURldGFpbC5sYXRpdHVkZV0sDQogICAgICAgICAgICAgICAgLy8gZGV2aWNlVHlwZTogaXRlbS5mb3JtVmFsdWU/LmRldmljZVR5cGUgfHwgW10sDQogICAgICAgICAgICAgICAgZGV2aWNlVHlwZTogaXRlbS5mb3JtVmFsdWU/LmRldmljZVR5cGUgfHwgaXRlbS5mb3JtVmFsdWU/LmRldmljZV90eXBlIHx8IFtdLA0KICAgICAgICAgICAgICAgIHF1ZXN0aW9uRGVzY3JpYmU6IGl0ZW0uZm9ybVZhbHVlLnF1ZXN0aW9uRGVzY3JpYmUsDQogICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgcmVzb2x2ZSgpDQogICAgICAgICAgfQ0KICAgICAgICAgIC8vIHByb2JsZW1EYXRhTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgLy8gICAvLyBjb25zb2xlLmxvZygn5Zu+54mH5Zyw5Z2AJywgaXRlbS51cmwpDQogICAgICAgICAgLy8gfSkNCiAgICAgICAgfSkNCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyDpl67popjkuIrmiqXngrnlh7vmoIfpopjjgIHorr7mlr3nvLrpmbfngrnlh7vljaHniYfov5vlhaXor6bmg4XpobUgIA0KICAgIHRvRGV0YWlsUGFuZWwoY2FyZERldGFpbCkgew0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goew0KICAgICAgICBuYW1lOiAnZGV0YWlsUHJvYmxlbU9yZGVyJywNCiAgICAgICAgcXVlcnk6IHsgaWQ6IGNhcmREZXRhaWwuaWQgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOWNoeeJh+WumuS9jQ0KICAgIGZseVRvUG9pbnQobG5nbGF0KSB7DQogICAgICBtYXBPYmoubWFwLmZseVRvKHsgY2VudGVyOiBsbmdsYXQsIHpvb206IDE3LjUgfSkNCiAgICB9LA0KICAgIC8vIOS4iuaKpQ0KICAgIHJlcG9ydENsaWNrKCkgew0KICAgICAgaWYgKHRoaXMucmVwb3J0RGF0YUlzTG9hZGVkKSB7DQogICAgICAgIHRoaXMucmVwb3J0U2hvdyA9IHRydWUNCiAgICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnZXZlbnRQb2ludHNMYXllcicsICd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgVG9hc3QubG9hZGluZyh7DQogICAgICAgICAgbWVzc2FnZTogJ+S4iuaKpeaVsOaNruWKoOi9veS4reOAguOAguOAgicsDQogICAgICAgICAgbG9hZGluZ1R5cGU6ICdzcGlubmVyJywNCiAgICAgICAgICBkdXJhdGlvbjogMTUwMA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICB9LA0KICAgIGhhbmRsZUNsb3NlKCkgew0KICAgICAgbWFwT2JqLm1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnZXZlbnRQb2ludHNMYXllcicsICd2aXNpYmlsaXR5JywgJ25vbmUnKQ0KICAgIH0sDQogICAgZmlsZUNoYW5nZShmaWxlKSB7DQogICAgICB0aGlzLnNpZ25Gb3JtLmluc3BJbWFnZXNMaXN0ID0gW10NCiAgICAgIGlmIChmaWxlLmZpbGVMaXN0Lmxlbmd0aCA9PSAwKSB7DQogICAgICAgIHRoaXMuYXR0YWNobWVudCA9ICcnDQogICAgICB9DQogICAgICBmaWxlLmZpbGVMaXN0LmZvckVhY2goaXQgPT4gew0KICAgICAgICB0aGlzLnNpZ25Gb3JtLmluc3BJbWFnZXNMaXN0LnB1c2goDQogICAgICAgICAgew0KICAgICAgICAgICAgZmlsZUlkOiBpdC5yZXNwb25zZS5ncm91cFRva2VuLA0KICAgICAgICAgICAgaW1hZ2VzTmFtZTogaXQudXJsDQogICAgICAgICAgfQ0KICAgICAgICApDQogICAgICB9KQ0KICAgICAgY29uc29sZS5sb2codGhpcy5zaWduRm9ybSkNCiAgICB9LA0KICAgIGNvbnRpbnVlVGFzaygpIHsNCiAgICAgIHRoaXMuc3RvcFJlYXNvbiA9ICcnDQogICAgICB0aGlzLmlmRW5kVGFzayA9IGZhbHNlDQogICAgfSwNCiAgICBzdG9wVGFzaygpIHsNCiAgICAgIGlmICh0aGlzLnN0b3BSZWFzb24gPT0gJycpIHsNCiAgICAgICAgVG9hc3Qud2FybmluZyh7DQogICAgICAgICAgbWVzc2FnZTogJ+ivt+i+k+WFpee7iOatouWOn+WboCcsDQogICAgICAgICAgZHVyYXRpb246IDE1MDANCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICB0aGlzLmlmRW5kVGFzayA9IGZhbHNlDQogICAgICB0aGlzLmVuZFJlY29yZENvbmZpcm0oJ2VuZCcpDQogICAgfSwNCiAgICBhc3luYyBlbmRUYXNrKCkgew0KICAgICAgaWYgKHRoaXMuaXNWaWV3KSB7DQogICAgICAgIFRvYXN0KHsNCiAgICAgICAgICBtZXNzYWdlOiAn6K+l5beh5qOA5Lu75Yqh5bey57uT5p2fJywNCiAgICAgICAgICBkdXJhdGlvbjogMTUwMA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIC8vIGJ1cy4kb2ZmKCd1cGRhdGVEYXRhJykNCiAgICAgIGF3YWl0IHRoaXMuZ2V0VGFza0J5SWQodGhpcy4kcm91dGUucXVlcnkudGFza0lkKQ0KICAgICAgbGV0IGhhc0luc3BLcCA9IHRoaXMuY2hhbmdlVG9JbnNwQ291bnQodGhpcy50YXNrRGV0YWlsLnJlcG9ydFJhdGUpDQogICAgICBsZXQgYWxsSW5zcEtwID0gdGhpcy5jaGFuZ2VUb0FsbEluc3BDb3VudCh0aGlzLnRhc2tEZXRhaWwucmVwb3J0UmF0ZSkNCiAgICAgIGlmICgoYWxsSW5zcEtwIC0gaGFzSW5zcEtwID09IDApICYmIHRoaXMuY2hhbmdlVG9SYXRlKHRoaXMudGFza0RldGFpbC5jb3ZlcmFnZSkgPT0gJzEwMCUnKSB7DQogICAgICAgIHRoaXMuZW5kUmVjb3JkQ29uZmlybSgnZW5kJykNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuaWZFbmRUYXNrID0gdHJ1ZQ0KICAgICAgfQ0KICAgIH0sDQogICAgb3BlblBvcHVwKCkgew0KICAgICAgaWYgKHRoaXMuaXNWaWV3KSB7DQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgdGhpcy5zaG93UG9wb3ZlciA9IHRydWUNCiAgICB9LA0KICAgIG9uU2VsZWN0KHZhbCkgew0KICAgICAgaWYgKHRoaXMuaXNWaWV3KSB7DQogICAgICAgIFRvYXN0KHsNCiAgICAgICAgICBtZXNzYWdlOiAn6K+l5beh5qOA5Lu75Yqh5bey57uT5p2fJywNCiAgICAgICAgICBkdXJhdGlvbjogJzE1MDAnDQogICAgICAgIH0pDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgdGhpcy5pZlRpcHMgPSB0cnVlDQogICAgICBtYXBPYmoubWFwLm9mZignY2xpY2snLCAna2V5cG9pbnRzTGF5ZXInLCB0aGlzLiRyZWZzLm15bWFwLnNpZ25JbkJ1ZmZlcikNCiAgICAgIHZhbC50ZXh0ID09ICfpl67popjkuIrmiqUnID8gbWFwT2JqLm1hcC5vbignY2xpY2snLCB0aGlzLnNlbGVjdFJlcG9ydFBvaW50KSA6IG1hcE9iai5tYXAub24oJ2NsaWNrJywgdGhpcy5zZWxlY3RGbGF3UG9pbnQpDQogICAgfSwNCiAgICBzZWxlY3RSZXBvcnRQb2ludChlKSB7DQogICAgICBsZXQgZmVhdHVyZXMgPSBtYXBPYmoubWFwLnF1ZXJ5UmVuZGVyZWRGZWF0dXJlcyhlLnBvaW50KQ0KICAgICAgaWYgKHRoaXMuaWZUaXBzKSB7DQogICAgICAgIHRoaXMuaWZUaXBzID0gZmFsc2UNCiAgICAgIH0NCiAgICAgIGlmIChmZWF0dXJlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIGlmICgNCiAgICAgICAgICBmZWF0dXJlc1swXS5zb3VyY2UgIT0gImluc3BVc2VyIg0KICAgICAgICAgIC8vICYmIGZlYXR1cmVzWzBdLnNvdXJjZSAhPSAiaW5pdEluc3BMaW5lU291cmNlIiANCiAgICAgICAgICAmJiBmZWF0dXJlc1swXS5zb3VyY2UgIT0gImtleXBvaW50cyINCiAgICAgICAgICAmJiAoZmVhdHVyZXNbMF0uZ2VvbWV0cnkudHlwZSA9PT0gIlBvaW50IikNCiAgICAgICAgKSB7DQogICAgICAgICAgdGhpcy4kcmVmcy5teW1hcC5hZGRFdmVudE9iak1hcmtlcihmZWF0dXJlc1swXSwgJ2RldmljZScsICdldmVudCcsIHsgZ3JpZElkOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZElkLCBncmlkTmFtZTogdGhpcy5wbGFuRGV0YWlsLmdyaWROYW1lLCBncmlkTWFuYWdlcjogeyBmdWxsTmFtZTogdGhpcy5wbGFuRGV0YWlsLmdyaWRNYW5hZ2VyLCB1c2VybmFtZTogdGhpcy5wbGFuRGV0YWlsLnVzZXJOYW1lLCB1c2VySWQ6IHRoaXMucGxhbkRldGFpbC51c2VySWQgfSB9KTsNCiAgICAgICAgfSBlbHNlIGlmIChmZWF0dXJlcy5sZW5ndGggPiAxDQogICAgICAgICAgJiYgZmVhdHVyZXNbMV0uc291cmNlICE9ICJldmVudFBvaW50cyINCiAgICAgICAgICAmJiBmZWF0dXJlc1sxXS5zb3VyY2UgIT0gImluc3BVc2VyIg0KICAgICAgICAgICYmIGZlYXR1cmVzWzFdLnNvdXJjZSAhPSAia2V5cG9pbnRzIg0KICAgICAgICAgICYmIChmZWF0dXJlc1sxXS5nZW9tZXRyeS50eXBlID09PSAiUG9pbnQiKQ0KICAgICAgICApIHsNCiAgICAgICAgICB0aGlzLiRyZWZzLm15bWFwLmFkZEV2ZW50T2JqTWFya2VyKGZlYXR1cmVzWzFdLCAnZGV2aWNlJywgJ2V2ZW50JywgeyBncmlkSWQ6IHRoaXMucGxhbkRldGFpbC5ncmlkSWQsIGdyaWROYW1lOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZE5hbWUsIGdyaWRNYW5hZ2VyOiB7IGZ1bGxOYW1lOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZE1hbmFnZXIsIHVzZXJuYW1lOiB0aGlzLnBsYW5EZXRhaWwudXNlck5hbWUsIHVzZXJJZDogdGhpcy5wbGFuRGV0YWlsLnVzZXJJZCB9IH0pOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLiRyZWZzLm15bWFwLmFkZEV2ZW50T2JqTWFya2VyKGUubG5nTGF0LCAnbG5nbGF0JywgJ2V2ZW50JywgeyBncmlkSWQ6IHRoaXMucGxhbkRldGFpbC5ncmlkSWQsIGdyaWROYW1lOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZE5hbWUsIGdyaWRNYW5hZ2VyOiB7IGZ1bGxOYW1lOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZE1hbmFnZXIsIHVzZXJuYW1lOiB0aGlzLnBsYW5EZXRhaWwudXNlck5hbWUsIHVzZXJJZDogdGhpcy5wbGFuRGV0YWlsLnVzZXJJZCB9IH0pOw0KICAgICAgfQ0KICAgICAgbWFwT2JqLm1hcC5vbignY2xpY2snLCAna2V5cG9pbnRzTGF5ZXInLCB0aGlzLiRyZWZzLm15bWFwLnNpZ25JbkJ1ZmZlcikNCiAgICAgIG1hcE9iai5tYXAub2ZmKCdjbGljaycsIHRoaXMuc2VsZWN0UmVwb3J0UG9pbnQpDQogICAgfSwNCiAgICBzZWxlY3RGbGF3UG9pbnQoZSkgew0KICAgICAgbGV0IGZlYXR1cmVzID0gbWFwT2JqLm1hcC5xdWVyeVJlbmRlcmVkRmVhdHVyZXMoZS5wb2ludCkNCiAgICAgIGlmICh0aGlzLmlmVGlwcykgew0KICAgICAgICB0aGlzLmlmVGlwcyA9IGZhbHNlDQogICAgICB9DQogICAgICBpZiAoZmVhdHVyZXMubGVuZ3RoID4gMCkgew0KICAgICAgICBpZiAoDQogICAgICAgICAgZmVhdHVyZXNbMF0uc291cmNlICE9ICJldmVudFBvaW50cyINCiAgICAgICAgICAmJiBmZWF0dXJlc1swXS5zb3VyY2UgIT0gImluc3BVc2VyIg0KICAgICAgICAgIC8vICYmIGZlYXR1cmVzWzBdLnNvdXJjZSAhPSAiaW5pdEluc3BMaW5lU291cmNlIiANCiAgICAgICAgICAmJiBmZWF0dXJlc1swXS5zb3VyY2UgIT0gImtleXBvaW50cyINCiAgICAgICAgICAmJiAoZmVhdHVyZXNbMF0uZ2VvbWV0cnkudHlwZSA9PT0gIlBvaW50IikNCiAgICAgICAgKSB7DQogICAgICAgICAgdGhpcy4kcmVmcy5teW1hcC5hZGRFdmVudE9iak1hcmtlcihmZWF0dXJlc1swXSwgJ2RldmljZScsICdmbGF3JywgeyBncmlkSWQ6IHRoaXMucGxhbkRldGFpbC5ncmlkSWQsIGdyaWROYW1lOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZE5hbWUgfSk7DQogICAgICAgIH0gZWxzZSBpZiAoZmVhdHVyZXMubGVuZ3RoID4gMQ0KICAgICAgICAgICYmIGZlYXR1cmVzWzFdLnNvdXJjZSAhPSAiZXZlbnRQb2ludHMiDQogICAgICAgICAgJiYgZmVhdHVyZXNbMV0uc291cmNlICE9ICJpbnNwVXNlciINCiAgICAgICAgICAmJiBmZWF0dXJlc1sxXS5zb3VyY2UgIT0gImtleXBvaW50cyINCiAgICAgICAgICAmJiAoZmVhdHVyZXNbMV0uZ2VvbWV0cnkudHlwZSA9PT0gIlBvaW50IikNCiAgICAgICAgKSB7DQogICAgICAgICAgdGhpcy4kcmVmcy5teW1hcC5hZGRFdmVudE9iak1hcmtlcihmZWF0dXJlc1sxXSwgJ2RldmljZScsICdmbGF3JywgeyBncmlkSWQ6IHRoaXMucGxhbkRldGFpbC5ncmlkSWQsIGdyaWROYW1lOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZE5hbWUgfSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuJHJlZnMubXltYXAuYWRkRXZlbnRPYmpNYXJrZXIoZS5sbmdMYXQsICdsbmdsYXQnLCAnZmxhdycsIHsgZ3JpZElkOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZElkLCBncmlkTmFtZTogdGhpcy5wbGFuRGV0YWlsLmdyaWROYW1lIH0pOw0KICAgICAgfQ0KICAgICAgbWFwT2JqLm1hcC5vbignY2xpY2snLCAna2V5cG9pbnRzTGF5ZXInLCB0aGlzLiRyZWZzLm15bWFwLnNpZ25JbkJ1ZmZlcikNCiAgICAgIG1hcE9iai5tYXAub2ZmKCdjbGljaycsIHRoaXMuc2VsZWN0Rmxhd1BvaW50KQ0KICAgIH0sDQogICAgZ2V0UmVzdFRpbWUodGltZSkgew0KICAgICAgcmV0dXJuIHRpbWUgPyBuZXcgRGF0ZSh0aW1lKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKSA6IDANCiAgICB9LA0KICAgIGNoYW5nZVRvSW5zcENvdW50KHJlcG9ydFJhdGUpIHsNCiAgICAgIGlmIChyZXBvcnRSYXRlLmluY2x1ZGVzKCcvJykpIHsNCiAgICAgICAgcmV0dXJuIE51bWJlcihyZXBvcnRSYXRlLnNwbGl0KCcvJylbMF0pDQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gMA0KICAgICAgfQ0KICAgIH0sDQogICAgY2hhbmdlVG9BbGxJbnNwQ291bnQocmVwb3J0UmF0ZSkgew0KICAgICAgaWYgKHJlcG9ydFJhdGUuaW5jbHVkZXMoJy8nKSkgew0KICAgICAgICByZXR1cm4gTnVtYmVyKHJlcG9ydFJhdGUuc3BsaXQoJy8nKVsxXSkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAwDQogICAgICB9DQogICAgfSwNCiAgICBjaGFuZ2VUb1JhdGUoY292ZXJhZ2UpIHsNCiAgICAgIGlmIChjb3ZlcmFnZS5pbmNsdWRlcygnLycpKSB7DQogICAgICAgIGxldCBpbnNwID0gTnVtYmVyKGNvdmVyYWdlLnNwbGl0KCcvJylbMF0pDQogICAgICAgIGxldCB1bmluc3AgPSBOdW1iZXIoY292ZXJhZ2Uuc3BsaXQoJy8nKVsxXSkNCiAgICAgICAgaWYgKHVuaW5zcCkgew0KICAgICAgICAgIHJldHVybiAoKGluc3AgLyB1bmluc3ApICogMTAwKS50b0ZpeGVkKDIpICsgJyUnDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuICcwJScNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuICcwJScNCiAgICAgIH0NCiAgICB9LA0KICAgIG1hcExvYWRlZChtYXBJbnN0YW5jZSkgew0KICAgICAgY29uc29sZS5sb2coJ21hcExvYWRlZGRkZGRkZGQnKQ0KICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICBtYXBPYmoubWFwSW5zdGFuY2UgPSBtYXBJbnN0YW5jZQ0KICAgICAgbWFwT2JqLm1hcCA9IG1hcEluc3RhbmNlLm1hcA0KICAgICAgLy8g5beh5qOA5qih5oufDQogICAgICAvLyBtYXBPYmoubWFwLm9uKCdjbGljaycsIGUgPT4gew0KICAgICAgLy8gICBpZiAodGhhdC50cmFja1BvaW50TGlzdC5sZW5ndGggPT0gMCkgew0KICAgICAgLy8gICAgIHRoYXQudHJhY2tQb2ludExpc3QucHVzaChbZS5sbmdMYXQubG5nLCBlLmxuZ0xhdC5sYXRdKQ0KICAgICAgLy8gICB9IGVsc2Ugew0KICAgICAgLy8gICAgIHRoYXQuZHJhd0luc3BMaW5lKHsgbG9uZ2l0dWRlOiBlLmxuZ0xhdC5sbmcsIGxhdGl0dWRlOiBlLmxuZ0xhdC5sYXQsIGxvY1RpbWU6IHRoYXQuJGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJyksIGxvY1R5cGU6ICdHUFMnIH0pDQogICAgICAvLyAgIH0NCiAgICAgIC8vIH0pDQogICAgICBtYXBPYmoubWFwLm9uKCdjbGljaycsICgpID0+IHsNCiAgICAgICAgdGhpcy5zaG93S2V5TGlzdCA9IGZhbHNlDQogICAgICB9KQ0KICAgICAgdGhpcy5hZGRNYXBJbWcoKQ0KICAgICAgaWYgKHR5cGVvZiB5dWFuY2h1ICE9ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHl1YW5jaHUubG9jYXRpb25BTWFwLnJlcXVlc3RTaW5nbGVMb2NhdGlvbigNCiAgICAgICAgICBbJzEnXSwNCiAgICAgICAgICAocmVzKSA9PiB7DQogICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzKSkNCiAgICAgICAgICAgIGNvbnN0IHBhcmFtID0gew0KICAgICAgICAgICAgICAuLi50aGF0LmN1cnJlbnRQb3NpdGlvbiwNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuJHJlZnMubXltYXAuc2V0SW5zcFVzZXJQb3NpdGlvbihwYXJhbSkNCiAgICAgICAgICB9LA0KICAgICAgICAgIChlcnIpID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnI9JywgZXJyKQ0KICAgICAgICAgIH0NCiAgICAgICAgKQ0KICAgICAgfQ0KICAgICAgLy8gLy8g5beh5qOA5qih5oufDQogICAgICAvLyBtYXBPYmoubWFwLm9uKCdjbGljaycsIGUgPT4gew0KICAgICAgLy8gICB0aGF0LmN1cnJlbnRQb3NpdGlvbiA9IHsNCiAgICAgIC8vICAgICBsb25naXR1ZGU6IGUubG5nTGF0LmxuZywNCiAgICAgIC8vICAgICBsYXRpdHVkZTogZS5sbmdMYXQubGF0LA0KICAgICAgLy8gICAgIGxvY1RpbWU6IHRoYXQuJGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJyksDQogICAgICAvLyAgICAgbG9jVHlwZTogJ0dQUycsDQogICAgICAvLyAgIH0NCiAgICAgIC8vICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAvLyAgICAgLi4udGhhdC5jdXJyZW50UG9zaXRpb24sDQogICAgICAvLyAgIH0NCiAgICAgIC8vICAgdGhpcy4kcmVmcy5teW1hcC5zZXRJbnNwVXNlclBvc2l0aW9uKHBhcmFtKQ0KICAgICAgLy8gICAvLyBpZiAodGhhdC50cmFja1BvaW50TGlzdC5sZW5ndGggPT0gMCkgew0KICAgICAgLy8gICAvLyAgIHRoYXQudHJhY2tQb2ludExpc3QucHVzaChbZS5sbmdMYXQubG5nLCBlLmxuZ0xhdC5sYXRdKQ0KICAgICAgLy8gICAvLyB9IGVsc2Ugew0KICAgICAgLy8gICAvLyAgIHRoYXQuZHJhd0luc3BMaW5lKHsgbG9uZ2l0dWRlOiBlLmxuZ0xhdC5sbmcsIGxhdGl0dWRlOiBlLmxuZ0xhdC5sYXQsIGxvY1RpbWU6IHRoYXQuJGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJyksIGxvY1R5cGU6ICdHUFMnIH0pDQogICAgICAvLyAgIC8vIH0NCiAgICAgIC8vIH0pDQogICAgfSwNCiAgICAvLyDliLfmlrDku7vliqENCiAgICByZWZyZXNoVGFzaygpIHsNCiAgICAgIGNvbnN0IGlkID0gdGhpcy4kcm91dGUucXVlcnkudGFza0lkDQogICAgICB0aGlzLmdldFRhc2tCeUlkKGlkLCAncmVmcmVzaCcpDQogICAgfSwNCiAgICBhc3luYyBnZXRUcmFja1JlY29yZHNCeUlkKGlkKSB7DQogICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KHsNCiAgICAgICAgdXJsOiAnL3hhc3ctcGlwZS1vcGVyYXRpb24vaW5zcFRhc2svdHJhY2snLA0KICAgICAgICBtZXRob2Q6ICdnZXQnLA0KICAgICAgICBwYXJhbXM6IHsgaWQsIHBhZ2VOdW06IDEsIHBhZ2VTaXplOiA5OTk5IH0sDQogICAgICB9KQ0KICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgIGNvbnNvbGUubG9nKHJlcykNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOagueaNruS7u+WKoWlk6I635Y+W5beh5qOA54q25Ya1DQogICAgYXN5bmMgZ2V0VGFza0J5SWQoaWQsIHR5cGUgPSBudWxsKSB7DQogICAgICBsZXQgdG9hc3QgPSBUb2FzdC5sb2FkaW5nKHsNCiAgICAgICAgbWVzc2FnZTogJ+WcsOWbvuWKoOi9veS4rS4uLicsDQogICAgICAgIGxvYWRpbmdUeXBlOiAnc3Bpbm5lcicsDQogICAgICAgIGR1cmF0aW9uOiAwLA0KICAgICAgICBmb3JiaWRDbGljazogdHJ1ZQ0KICAgICAgfSkNCiAgICAgIC8vIOWkhOeQhuW3suW3oeajgOeuoee6v+eahOaOpeWPow0KICAgICAgY29uc3QgcmVjb3JkTGluZXMgPSBhd2FpdCBhcGkucmVjb3JkZWRQaXBlTGluZSh7DQogICAgICAgIHRhc2tJZDogaWQsDQogICAgICAgIHBhZ2U6IDEsDQogICAgICAgIHNpemU6IDk5OTkNCiAgICAgIH0pDQogICAgICB0aGlzLmxpbmVzID0gW10NCiAgICAgIGlmIChyZWNvcmRMaW5lcy5zdGF0dXMpIHsNCiAgICAgICAgdGhpcy5saW5lcyA9IHJlY29yZExpbmVzLmRhdGEucmVjb3Jkcy5tYXAoKGl0ZW0pID0+IGl0ZW0ucGlwZUlkKQ0KICAgICAgfQ0KICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdCh7DQogICAgICAgIHVybDogJy94YXN3LXBpcGUtb3BlcmF0aW9uL2luc3BUYXNrL2dldEJ5SWQnLA0KICAgICAgICBtZXRob2Q6ICdnZXQnLA0KICAgICAgICBwYXJhbXM6IHsgaWQsIGJpelNjb3BlOiB0aGlzLiRyb3V0ZS5xdWVyeS50YXNrVHlwZSB9DQogICAgICB9KQ0KICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgIHRoaXMudGFza0RldGFpbCA9IHJlcy5kYXRhLmluc3BUYXNrDQogICAgICAgIHRoaXMucGxhbkRldGFpbCA9IHJlcy5kYXRhLmluc3BQbGFuDQogICAgICAgIHRoaXMuYnV0dG9uTGlzdCA9IFsn5YWo6YOoJ10uY29uY2F0KHRoaXMucGxhbkRldGFpbC5iaXpUeXBlLnNwbGl0KCcsJykpDQogICAgICAgIHRoaXMuaW5zcFJhbmdlTGlzdCA9IHJlcy5kYXRhLmRldGFpbExpc3QubWFwKChyYW5nZSkgPT4gew0KICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICB0YXNrSWQ6IGlkLA0KICAgICAgICAgICAgLi4ucmFuZ2UsDQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICB0aGlzLmxlZ2VuZENvbmZpZyA9IFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgbGFiZWw6ICfmsaHmsLQnLA0KICAgICAgICAgICAgICBjbGlja0ZsYWc6IHRoaXMucGxhbkRldGFpbC5iaXpUeXBlLmluY2x1ZGVzKCfmsaHmsLQnKSA/IHRydWUgOiBmYWxzZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgbGFiZWw6ICfpm6jmsLQnLA0KICAgICAgICAgICAgICBjbGlja0ZsYWc6IHRoaXMucGxhbkRldGFpbC5iaXpUeXBlLmluY2x1ZGVzKCfpm6jmsLQnKSA/IHRydWUgOiBmYWxzZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgbGFiZWw6ICfkvpvmsLQnLA0KICAgICAgICAgICAgICBjbGlja0ZsYWc6IHRoaXMucGxhbkRldGFpbC5iaXpUeXBlLmluY2x1ZGVzKCfkvpvmsLQnKSA/IHRydWUgOiBmYWxzZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgbGFiZWw6ICflho3nlJ/msLQnLA0KICAgICAgICAgICAgICBjbGlja0ZsYWc6IHRoaXMucGxhbkRldGFpbC5iaXpUeXBlLmluY2x1ZGVzKCflho3nlJ/msLQnKSA/IHRydWUgOiBmYWxzZQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIF07DQogICAgICAgIH0sIDUwMDApDQogICAgICAgIC8vIOS/ruaUueacquW3oeajgCgwKeS7u+WKoeeKtuaAgeiHs+W3oeajgOS4rSgxKQ0KICAgICAgICBpZiAodGhpcy4kcm91dGUucXVlcnkuaXNOZXcgJiYgdGhpcy50YXNrRGV0YWlsLnRhc2tTdGF0dXMgIT0gMSkgew0KICAgICAgICAgIHRoaXMuc3RhcnRPckVuZFRhc2tSZWNvcmQoMSkNCiAgICAgICAgfQ0KICAgICAgICBpZiAodHlwZSAhPSAncmVmcmVzaCcpIHsNCiAgICAgICAgICBjb25zdCBhbGxUYXNrTGluZXMgPSBhd2FpdCBhcGkuZ2V0QWxsVGFza0xpbmVzKHsNCiAgICAgICAgICAgIGRldlR5cGU6ICfnrqHnur8nLA0KICAgICAgICAgICAgZ3JpZElkOiB0aGlzLnBsYW5EZXRhaWwuZ3JpZElkLA0KICAgICAgICAgICAgcGFnZU51bTogMSwNCiAgICAgICAgICAgIHBhZ2VTaXplOiA5OTk5OTksDQogICAgICAgICAgICBiaXpTY29wZTogdGhpcy4kcm91dGUucXVlcnkudGFza1R5cGUsDQogICAgICAgICAgICBiaXpUeXBlOiB0aGlzLnBsYW5EZXRhaWwuYml6VHlwZQ0KICAgICAgICAgIH0pDQogICAgICAgICAgaWYgKGFsbFRhc2tMaW5lcy5zdGF0dXMpIHsNCiAgICAgICAgICAgIHRoaXMuYWxsVGFza0xpbmVzID0gW10NCiAgICAgICAgICAgIGFsbFRhc2tMaW5lcy5kYXRhLmxpc3QuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgICAgICAgdGhpcy5hbGxUYXNrTGluZXMucHVzaCh7DQogICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLA0KICAgICAgICAgICAgICAgIGlkOiBpdGVtLmlkLA0KICAgICAgICAgICAgICAgIGdlb21ldHJ5OiBKU09OLnBhcnNlKGl0ZW0uZ2VvbSksDQogICAgICAgICAgICAgICAgcHJvcGVydGllczogew0KICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW0uaWQsDQogICAgICAgICAgICAgICAgICBsZW5ndGg6IGl0ZW1bJ2xlbmd0aCddLA0KICAgICAgICAgICAgICAgICAgYml6VHlwZTogaXRlbS5iaXpUeXBlDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIHRoaXMuJHJlZnMubXltYXAuc2V0QWxsSW5zcExpbmVTb3VyY2UodGhpcy5hbGxUYXNrTGluZXMpDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGtwUmVzID0gYXdhaXQgcmVxdWVzdCh7DQogICAgICAgICAgdXJsOiAnL3hhc3ctcGlwZS1vcGVyYXRpb24vaW5zcFRhc2svcG9pbnQnLA0KICAgICAgICAgIG1ldGhvZDogJ2dldCcsDQogICAgICAgICAgcGFyYW1zOiB7IGlkLCBncmlkSWQ6IHRoaXMucGxhbkRldGFpbC5ncmlkSWQsIHBhZ2VOdW06IDEsIHBhZ2VTaXplOiA5OTk5LCBiaXpTY29wZTogdGhpcy4kcm91dGUucXVlcnkudGFza1R5cGUsIGJpelR5cGU6IHRoaXMucGxhbkRldGFpbC5iaXpUeXBlIH0sDQogICAgICAgIH0pDQogICAgICAgIHRoaXMua2V5RGV0YWlsTGlzdCA9IFtdDQogICAgICAgIGlmIChrcFJlcyAmJiBrcFJlcy5zdGF0dXMpIHsNCiAgICAgICAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKGtwUmVzLmRhdGEpDQogICAgICAgICAga2V5cy5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgICB0aGlzLmtleURldGFpbExpc3QucHVzaCguLi5rcFJlcy5kYXRhW2l0ZW1dLmxpc3QpDQogICAgICAgICAgfSkNCiAgICAgICAgICB0aGlzLnVuSW5zcEtleURldGFpbExpc3QgPSB0aGlzLmtleURldGFpbExpc3QuZmlsdGVyKGl0ID0+ICFpdC5kZXZpY2VTdGF0dXMpDQogICAgICAgIH0NCiAgICAgICAgbGV0IGNvbXBsZXRpb24gPSB0aGlzLmNoYW5nZVRvUmF0ZSh0aGlzLnRhc2tEZXRhaWwuY292ZXJhZ2UpDQogICAgICAgIHRoaXMubmF2YmFyVGl0bGUgPSB0aGlzLnRhc2tEZXRhaWwudGFza05hbWUNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICBjb25zdCB0aGF0ID0gdGhpcw0KICAgICAgICAgIGxldCB0aW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIDMwc+WQjuWPlua2iA0KICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpDQogICAgICAgICAgICB9LCAzMDAwMCkNCiAgICAgICAgICAgIGlmICh0aGF0LiRyZWZzLm15bWFwICYmIHRoYXQuJHJlZnMubXltYXAuaXNPbkxvYWRlZCgpKSB7DQogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXIpDQogICAgICAgICAgICAgIHRoYXQuJHJlZnMubXltYXAuYWRkS2V5UG9pbnRzKHRoYXQua2V5RGV0YWlsTGlzdCkNCiAgICAgICAgICAgICAgaWYgKHR5cGUgIT0gJ3JlZnJlc2gnKSB7DQogICAgICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC5hZGRSYW5nZUxpc3QodGhhdC5pbnNwUmFuZ2VMaXN0KQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHsNCiAgICAgICAgICAgICAgICBleHRQYXJhbTogew0KICAgICAgICAgICAgICAgICAgdGFza19pZDogdGhhdC4kcm91dGUucXVlcnkudGFza0lkDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIC8vIOmXrumimOS4iuaKpeOAgeiuvuaWvee8uumZt+aOpeWPow0KICAgICAgICAgICAgICB0aGF0LmdldFByb2JsZW1EYXRhTGlzdChwYXJhbXMpDQogICAgICAgICAgICAgIHRoYXQuJHJlZnMubXltYXAuYWRkSW5zcFJlY29yZFRpbGVMaW5lU291cmNlKHRoYXQubGluZXMsIGNvbXBsZXRpb24pDQogICAgICAgICAgICAgIHRvYXN0LmNsZWFyKCkNCiAgICAgICAgICAgICAgaWYgKCF0aGF0LmN1cnJlbnRQb3NpdGlvbikgcmV0dXJuDQogICAgICAgICAgICAgIGNvbnN0IHBhcmFtID0gew0KICAgICAgICAgICAgICAgIC4uLnRoYXQuY3VycmVudFBvc2l0aW9uLA0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHRoYXQuJHJlZnMubXltYXAuc2V0SW5zcFVzZXJQb3NpdGlvbihwYXJhbSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LCA1MDApDQogICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZyhlKQ0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBUb2FzdCh7DQogICAgICAgICAgbWVzc2FnZTogJ+e9kee7nOeKtuaAgei+g+W3ru+8jOWKoOi9veS7u+WKoeWksei0pScsDQogICAgICAgICAgaWNvbjogJ3dhcm4nLA0KICAgICAgICAgIGR1cmF0aW9uOiAzMDAwDQogICAgICAgIH0pDQogICAgICB9DQogICAgfSwNCiAgICBwYXVzZSgpIHsNCiAgICAgIGNvbnNvbGUubG9nKCfov5vlhaXlkI7lj7AnKQ0KICAgICAgaWYgKHRoaXMuaWZSZWNvcmRpbmcgJiYgdGhpcy5pc1Jlc3VtZSkgew0KICAgICAgICB0aGlzLmlzUmVzdW1lID0gZmFsc2UNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlc3VtZSgpIHsNCiAgICAgIGNvbnNvbGUubG9nKCfov5vlhaXliY3lj7AnKQ0KICAgICAgaWYgKHRoaXMuaWZSZWNvcmRpbmcpIHsNCiAgICAgICAgdGhpcy5pc1Jlc3VtZSA9IHRydWUNCiAgICAgICAgcGF1c2VTdGF0ZVRyYWNrUG9pbnRzLmxlbmd0aCA+IDAgJiYgdGhpcy51cExvYWRQYXVzZVN0YXRlVHJhY2tQb2ludHModGhpcy5kZWVwQ2xvbmUocGF1c2VTdGF0ZVRyYWNrUG9pbnRzKSkNCiAgICAgICAgcGF1c2VTdGF0ZVBpcGVJZExpc3QubGVuZ3RoID4gMCAmJiB0aGlzLnVwTG9hZFBhdXNlU3RhdGVQaXBlSWRMaXN0KHRoaXMuZGVlcENsb25lKHBhdXNlU3RhdGVQaXBlSWRMaXN0KSkNCiAgICAgIH0NCiAgICB9LA0KICAgIHVwTG9hZFBhdXNlU3RhdGVQaXBlSWRMaXN0KGRhdGEpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgYXBpLnJlY29yZEluc3BMaW5lKGRhdGEpLnRoZW4oYXN5bmMgcmVzID0+IHsNCiAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZygn5ZCO5Y+w5beh5qOA566h57q/6KGl5YWF5pWw5o2u5LiK5Lyg5oiQ5YqfJykNCiAgICAgICAgICBwYXVzZVN0YXRlUGlwZUlkTGlzdC5zcGxpY2UoMCwgZGF0YS5sZW5ndGgpIC8vIOenu+mZpOS4iuS8oOaIkOWKn+eahOaVsOaNruOAgumBv+WFjemHjeWkjeS4iuS8oA0KICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3Qoew0KICAgICAgICAgICAgdXJsOiAnL3hhc3ctcGlwZS1vcGVyYXRpb24vaW5zcFRhc2svZ2V0QnlJZCcsDQogICAgICAgICAgICBtZXRob2Q6ICdnZXQnLA0KICAgICAgICAgICAgcGFyYW1zOiB7IGlkOiB0aGF0LiRyb3V0ZS5xdWVyeS50YXNrSWQsIGJpelNjb3BlOiB0aGF0LiRyb3V0ZS5xdWVyeS50YXNrVHlwZSB9DQogICAgICAgICAgfSkNCiAgICAgICAgICBpZiAocmVzLnN0YXR1cykgew0KICAgICAgICAgICAgdGhhdC50YXNrRGV0YWlsID0gcmVzLmRhdGEuaW5zcFRhc2sNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC51cGxvYWRGaWxlZFBpcGVJZExpc3QucHVzaCguLi5kYXRhKQ0KICAgICAgICB9DQogICAgICB9KS5jYXRjaChlcnIgPT4gew0KICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICB0aGlzLnVwTG9hZFBhdXNlU3RhdGVQaXBlSWRMaXN0KGRhdGEpDQogICAgICAgIH0sIDUgKiAxMDAwKQ0KICAgICAgfSkNCiAgICB9LA0KICAgIHVwTG9hZFBhdXNlU3RhdGVUcmFja1BvaW50cyhkYXRhKSB7DQogICAgICBhcGkuaW5zcGVjdGlvblRyYWNrKGRhdGEpLnRoZW4oKHJlcykgPT4gew0KICAgICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZygn5ZCO5Y+w5beh5qOA6L2o6L+56KGl5YWF54K55L2N5LiK5Lyg5oiQ5YqfJykNCiAgICAgICAgICBwYXVzZVN0YXRlVHJhY2tQb2ludHMuc3BsaWNlKDAsIGRhdGEubGVuZ3RoKSAvLyDnp7vpmaTkuIrkvKDmiJDlip/nmoTngrnkvY3jgILpgb/lhY3ph43lpI3kuIrkvKANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBjb25zb2xlLmxvZygn5ZCO5Y+w5beh5qOA6L2o6L+56KGl5YWF54K55L2N5LiK5Lyg5byC5bi4JykNCiAgICAgICAgICB0aGlzLnJlcG9ydEZhaWxUcmFja1BvaW50cy5wdXNoKC4uLmRhdGEpDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICB0aGlzLnVwTG9hZFBhdXNlU3RhdGVUcmFja1BvaW50cyhkYXRhKQ0KICAgICAgICB9LCA1ICogMTAwMCkNCiAgICAgIH0pDQogICAgfSwNCiAgICAvLyDova7or6IgY3VycmVudFBvc2l0aW9u77yM57uY5Yi26L2o6L+557q/DQogICAgcG9sbGluZygpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgaWYgKHRoYXQucG9sbGluZ0ZsYWcpIHsNCiAgICAgICAgaWYgKHR5cGVvZiB5dWFuY2h1ICE9ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAucmVxdWVzdExvY2F0aW9ucygNCiAgICAgICAgICAgIFt0aGF0LiRyb3V0ZS5xdWVyeS50YXNrVHlwZSA9PSAn5Lq65behJyA/ICc0JyA6ICcyJywgJzEnLCAnMjAnLCAnMTAwJywgJzAnLCB0cnVlXSwNCiAgICAgICAgICAgIChyZXMpID0+IHsNCiAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKQ0KICAgICAgICAgICAgICB0aGF0LmRyYXdJbnNwTGluZShyZXMpDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgKGVycikgPT4gew0KICAgICAgICAgICAgICAvLyBUb2FzdC5lcnJvcih7DQogICAgICAgICAgICAgIC8vICAgbWVzc2FnZTogJ2VycicgKyBlcnIsDQogICAgICAgICAgICAgIC8vICAgZHVyYXRpb246IDIwMDAsDQogICAgICAgICAgICAgIC8vIH0pDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBkcmF3SW5zcExpbmUocG9zaXRpb24pIHsNCiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzDQogICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocG9zaXRpb24pKQ0KICAgICAgdGhhdC5jdXJyZW50UG9zaXRpb24gPSBPYmplY3QuYXNzaWduKHRoYXQuY3VycmVudFBvc2l0aW9uLCB7DQogICAgICAgIGRpcmVjdGlvbjogMA0KICAgICAgfSkNCiAgICAgIGlmICh0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb2NUeXBlICE9ICdTQU1FX1JFUScgJiYgdGhhdC5jdXJyZW50UG9zaXRpb24ubG9jVHlwZSAhPSAnRklYX0NBQ0hFJykgeyAvLyDov4fmu6TnvJPlrZjlrprkvY3mlbDmja4NCiAgICAgICAgbGV0IGxhc3RQb2ludCA9IHRoYXQudHJhY2tQb2ludExpc3RbdGhhdC50cmFja1BvaW50TGlzdC5sZW5ndGggLSAxXQ0KICAgICAgICBsZXQgZGlzdGFuY2UgPSB0aGF0LkdldERpc3RhbmNlKGxhc3RQb2ludCwgW3RoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwgdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGVdKSAqIDEwMDANCiAgICAgICAgLy8g6K6w5b2V6L+H56iL54K5DQogICAgICAgIHRoYXQucG9zdFRyYWNrRGF0YV9Qb2ludCgNCiAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRMaXN0W3RoYXQudHJhY2tQb2ludExpc3QubGVuZ3RoIC0gMV0sDQogICAgICAgICAgdGhhdC50cmFja1BvaW50VGltZUxpc3RbdGhhdC50cmFja1BvaW50VGltZUxpc3QubGVuZ3RoIC0gMV0sDQogICAgICAgICAgZGlzdGFuY2UNCiAgICAgICAgKS50aGVuKHJlcyA9PiB7DQogICAgICAgICAgaWYgKHJlcykgew0KICAgICAgICAgICAgLy8g5pS55Y+Y5beh5qOA6L2o6L+557yT5Yay5Yy66IyD5Zu05YaF55qE566h57q/6aKc6ImyDQogICAgICAgICAgICBsZXQgZ2VvbSA9IHsNCiAgICAgICAgICAgICAgdHlwZTogJ0xpbmVTdHJpbmcnLA0KICAgICAgICAgICAgICBjb29yZGluYXRlczogWw0KICAgICAgICAgICAgICAgIFtsYXN0UG9pbnRbMF0sIGxhc3RQb2ludFsxXV0sDQogICAgICAgICAgICAgICAgW3RoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwgdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGVdLA0KICAgICAgICAgICAgICBdDQogICAgICAgICAgICB9DQogICAgICAgICAgICBsZXQgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgICAgdGhhdC5jaGFuZ2VJbnNwTGluZVNvdXJjZUJ5U3BlZWQoZ2VvbSwgcmVzb2x2ZSkNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICBwcm9taXNlLnRoZW4ociA9PiB7DQogICAgICAgICAgICAgIGlmIChyKSB7DQogICAgICAgICAgICAgICAgdGhhdC50cmFja1BvaW50TGlzdC5wdXNoKFsNCiAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwNCiAgICAgICAgICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlDQogICAgICAgICAgICAgICAgXSkNCiAgICAgICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5wdXNoKHRoYXQuY3VycmVudFBvc2l0aW9uLmxvY1RpbWUpDQogICAgICAgICAgICAgICAgLy8g5p6E6YCg5Li05pe257q/5a+56LGhDQogICAgICAgICAgICAgICAgbGV0IGpzb25MaW5lID0gew0KICAgICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLA0KICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge30sDQogICAgICAgICAgICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTGluZVN0cmluZycsDQogICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzOiB0aGF0LnRyYWNrUG9pbnRMaXN0LA0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uc3QgY29vcmQgPSBbcGFyc2VGbG9hdCh0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUpLCBwYXJzZUZsb2F0KHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlKV07DQogICAgICAgICAgICAgICAgY29uc3QgcG9pbnQgPSB0dXJmLnBvaW50KGNvb3JkKTsNCiAgICAgICAgICAgICAgICBtYXBPYmoubWFwSW5zdGFuY2Uuc2V0U291cmNlRGF0YSgiaW5zcFVzZXIiLCB7DQogICAgICAgICAgICAgICAgICB0eXBlOiAiRmVhdHVyZUNvbGxlY3Rpb24iLA0KICAgICAgICAgICAgICAgICAgZmVhdHVyZXM6IFtwb2ludF0NCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIGxldCBqc29uTGluZUZlYXR1cmVDb2xsZWN0aW9uID0gew0KICAgICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgICAgICAgIGZlYXR1cmVzOiBbanNvbkxpbmVdLA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKSkgew0KICAgICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKS5zZXREYXRhKGpzb25MaW5lRmVhdHVyZUNvbGxlY3Rpb24pDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkU291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93Jywgew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ2VvanNvbicsDQogICAgICAgICAgICAgICAgICAgIGRhdGE6IGpzb25MaW5lRmVhdHVyZUNvbGxlY3Rpb24sDQogICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRMYXllcigndHJhY2tMaW5lTGF5ZXJfbm93JykpIHsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgICAgICAgICAgICAgIGlkOiAndHJhY2tMaW5lTGF5ZXJfbm93JywNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpbmUnLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2U6ICd0cmFja0xpbmVTb3VyY2Vfbm93JywNCiAgICAgICAgICAgICAgICAgICAgbGF5b3V0OiB7DQogICAgICAgICAgICAgICAgICAgICAgJ2xpbmUtY2FwJzogJ3JvdW5kJywNCiAgICAgICAgICAgICAgICAgICAgICAnbGluZS1qb2luJzogJ3JvdW5kJywNCiAgICAgICAgICAgICAgICAgICAgICAnbGluZS1zb3J0LWtleSc6IDEsDQogICAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgICAgIC8vIHZpc2liaWxpdHk6ICJub25lIg0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICBwYWludDogew0KICAgICAgICAgICAgICAgICAgICAgICdsaW5lLWNvbG9yJzogJyNhZGRkNTInLA0KICAgICAgICAgICAgICAgICAgICAgICdsaW5lLXdpZHRoJzogNSwNCiAgICAgICAgICAgICAgICAgICAgICAnbGluZS1vcGFjaXR5JzogMC44DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICB9LCAnaW5zcFVzZXJMYXllcicpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChtYXBPYmoubWFwLmdldExheWVyKCd0cmFja0xpbmVMYXllcl9hcnJvdycpKSB7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkTGF5ZXIoew0KICAgICAgICAgICAgICAgICAgICBpZDogJ3RyYWNrTGluZUxheWVyX2Fycm93JywNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N5bWJvbCcsDQogICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ3RyYWNrTGluZVNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXBsYWNlbWVudCc6ICdsaW5lJywNCiAgICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXNwYWNpbmcnOiAyMCwNCiAgICAgICAgICAgICAgICAgICAgICAnaWNvbi1pbWFnZSc6ICdhcnJvd0ljb24nLA0KICAgICAgICAgICAgICAgICAgICAgICdpY29uLXNpemUnOiAwLjUsDQogICAgICAgICAgICAgICAgICAgICAgJ2ljb24tYWxsb3ctb3ZlcmxhcCc6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgJ3N5bWJvbC1zb3J0LWtleSc6IDMsDQogICAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnDQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICB9LCAnaW5zcFVzZXJMYXllcicpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOagueaNrumAn+W6puaUueWPmOW3oeajgOeuoee6v+minOiJsg0KICAgIGNoYW5nZUluc3BMaW5lU291cmNlQnlTcGVlZChwb3NpdGlvbiwgcmVzb2x2ZSkgew0KICAgICAgLy8gY29uc3QgY29vcmQgPSBbcGFyc2VGbG9hdChwb3NpdGlvbi5sb25naXR1ZGUpLCBwYXJzZUZsb2F0KHBvc2l0aW9uLmxhdGl0dWRlKV07DQogICAgICAvLyBjb25zdCBwb2ludCA9IHR1cmYucG9pbnQoY29vcmQpOw0KICAgICAgY29uc3QgdGhhdCA9IHRoaXMNCiAgICAgIHRyeSB7DQogICAgICAgIC8vIOaUueWPmOWRqOWbtOimgee0oOeahOeKtuaAgQ0KICAgICAgICBsZXQgYnVmZmVyZWQgPSB0dXJmLmJ1ZmZlcihwb3NpdGlvbiwgdGhhdC4kcm91dGUucXVlcnkudGFza1R5cGUgPT0gJ+S6uuW3oScgPyAwLjAyNSA6IDAuMDQ1LCB7IHVuaXQ6ICdraWxvbWV0ZXJzJyB9KTsNCiAgICAgICAgdGhhdC5jaGFuZ2VJbnNwTGluZVN0YXRlKGJ1ZmZlcmVkLCByZXNvbHZlKTsNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5sb2coZSk7DQogICAgICB9DQogICAgfSwNCiAgICAvLyDorr7nva7lt6Hmo4DnrqHnur/kuLrlt7Llt6Hmo4ANCiAgICBjaGFuZ2VJbnNwTGluZVN0YXRlKGdlb21ldHJ5LCByZXNvbHZlKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIC8vIOWwhuWcsOeQhuWdkOagh+ezu+i9rOWMluS4uuWxj+W5leWdkOagh+ezuw0KICAgICAgZnVuY3Rpb24gZ2VvVHJhbnNUb1BpeGVsKGdlb20pIHsNCiAgICAgICAgY29uc3QgcG9seWdvbkJveCA9IHR1cmYuYmJveChnZW9tKTsNCiAgICAgICAgY29uc3Qgc291dGhXZXN0ID0gW3BvbHlnb25Cb3hbMF0sIHBvbHlnb25Cb3hbMV1dOw0KICAgICAgICBjb25zdCBub3J0aEVhc3QgPSBbcG9seWdvbkJveFsyXSwgcG9seWdvbkJveFszXV07DQogICAgICAgIGxldCBzb3V0aFdlc3RQb2ludFBpeGVsID0gbWFwT2JqLm1hcC5wcm9qZWN0KHNvdXRoV2VzdCk7DQogICAgICAgIGxldCBub3J0aEVhc3RQb2ludFBpeGVsID0gbWFwT2JqLm1hcC5wcm9qZWN0KG5vcnRoRWFzdCk7DQogICAgICAgIC8vIOWinuWkp2Jib3jnmoTmn6Xor6LojIPlm7QNCiAgICAgICAgc291dGhXZXN0UG9pbnRQaXhlbCA9IFsNCiAgICAgICAgICBzb3V0aFdlc3RQb2ludFBpeGVsLnggLSA1MCwNCiAgICAgICAgICBzb3V0aFdlc3RQb2ludFBpeGVsLnkgKyA1MA0KICAgICAgICBdDQogICAgICAgIG5vcnRoRWFzdFBvaW50UGl4ZWwgPSBbDQogICAgICAgICAgbm9ydGhFYXN0UG9pbnRQaXhlbC54ICsgNTAsDQogICAgICAgICAgbm9ydGhFYXN0UG9pbnRQaXhlbC55IC0gNTANCiAgICAgICAgXQ0KICAgICAgICByZXR1cm4gW3NvdXRoV2VzdFBvaW50UGl4ZWwsIG5vcnRoRWFzdFBvaW50UGl4ZWxdOw0KICAgICAgfQ0KICAgICAgLy8g5a+55q+P5Liq5YiS5YiG5Ye65p2l55qEYmJveOi/m+ihjOWkhOeQhg0KICAgICAgZnVuY3Rpb24gY2h1bmsoZ2VvbSwgcmVzb2x2ZSkgew0KICAgICAgICBjb25zdCBib3hGZWF0dXJlcyA9IG1hcE9iai5tYXAucXVlcnlSZW5kZXJlZEZlYXR1cmVzKGdlb1RyYW5zVG9QaXhlbChnZW9tKSwgew0KICAgICAgICAgIGxheWVyczogWyJpbml0SW5zcExpbmVMYXllciJdDQogICAgICAgIH0pOw0KICAgICAgICBjb25zb2xlLmxvZyhib3hGZWF0dXJlcywgJ2JveEZlYXR1cmVzJykNCiAgICAgICAgbGV0IHRlbXBQaXBlTGlzdCA9IFtdDQogICAgICAgIGJveEZlYXR1cmVzLmZvckVhY2goZmVhdCA9PiB7DQogICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHR1cmYuYm9vbGVhbkRpc2pvaW50KGZlYXQuZ2VvbWV0cnksIGdlb21ldHJ5KQ0KICAgICAgICAgICAgLy8g5aaC5p6c5p+l5Ye655qE6KaB57Sg5LiO55yf5a6e55qE6IyD5Zu055u45Lqk5LiU5rKh5pyJ6KKr5beh5qOA6L+H77yM5YiZ5pS55Y+Y5YW254q25oCBLOW5tuiusOW9leWFtuWFs+mUruWtlw0KICAgICAgICAgICAgaWYgKCFyZXN1bHQgJiYgIWZlYXQuc3RhdGUuaXNJbnNwKSB7DQogICAgICAgICAgICAgIG1hcE9iai5tYXAuc2V0RmVhdHVyZVN0YXRlKHsNCiAgICAgICAgICAgICAgICBzb3VyY2U6IGZlYXQuc291cmNlLA0KICAgICAgICAgICAgICAgIGlkOiBmZWF0LmlkDQogICAgICAgICAgICAgIH0sIHsgaXNJbnNwOiB0cnVlIH0pDQogICAgICAgICAgICAgIGlmICghdGVtcFBpcGVMaXN0Lm1hcChpdCA9PiBpdC5waXBlSWQpLmluY2x1ZGVzKGZlYXQuaWQpKSB7DQogICAgICAgICAgICAgICAgbGV0IGRhdGUgPSB0aGF0LiRkYXlqcygpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcycpDQogICAgICAgICAgICAgICAgdGVtcFBpcGVMaXN0LnB1c2goew0KICAgICAgICAgICAgICAgICAgaW5zcERhdGU6IGRhdGUsDQogICAgICAgICAgICAgICAgICBwaXBlSWQ6IGZlYXQuaWQsDQogICAgICAgICAgICAgICAgICBleHQzOiBmZWF0LnByb3BlcnRpZXMuYml6VHlwZSwNCiAgICAgICAgICAgICAgICAgIHBpcGVMZW5ndGg6IGZlYXQucHJvcGVydGllc1snbGVuZ3RoJ10gfHwgMCwNCiAgICAgICAgICAgICAgICAgIHRhc2tJZDogdGhhdC4kcm91dGUucXVlcnkudGFza0lkDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIGlmICh0aGF0LmlzUmVzdW1lKSB7DQogICAgICAgICAgdGVtcFBpcGVMaXN0Lmxlbmd0aCA+IDAgJiYgYXBpLnJlY29yZEluc3BMaW5lKHRlbXBQaXBlTGlzdCkudGhlbihhc3luYyByZXMgPT4gew0KICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdCh7DQogICAgICAgICAgICAgICAgdXJsOiAnL3hhc3ctcGlwZS1vcGVyYXRpb24vaW5zcFRhc2svZ2V0QnlJZCcsDQogICAgICAgICAgICAgICAgbWV0aG9kOiAnZ2V0JywNCiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgaWQ6IHRoYXQuJHJvdXRlLnF1ZXJ5LnRhc2tJZCwgYml6U2NvcGU6IHRoYXQuJHJvdXRlLnF1ZXJ5LnRhc2tUeXBlIH0NCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICAgICAgICB0aGF0LnRhc2tEZXRhaWwgPSByZXMuZGF0YS5pbnNwVGFzaw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5LiK5Lyg5aSx6LSl55qEdGVtcFBpcGVMaXN0OiAnLCB0ZW1wUGlwZUxpc3QpOw0KICAgICAgICAgICAgICB0aGF0LiRyZWZzLm15bWFwLnVwbG9hZEZpbGVkUGlwZUlkTGlzdC5wdXNoKC4uLnRlbXBQaXBlTGlzdCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRlbXBQaXBlTGlzdC5sZW5ndGggPiAwICYmIHBhdXNlU3RhdGVQaXBlSWRMaXN0LnB1c2goLi4udGVtcFBpcGVMaXN0KQ0KICAgICAgICB9DQogICAgICAgIHJlc29sdmUodHJ1ZSkNCiAgICAgIH0NCiAgICAgIC8vIGZ1bmN0aW9uIGNiKGZlYXR1cmVzKSB7DQogICAgICAvLyAgIGlmIChmZWF0dXJlcy5sZW5ndGggPiAwKSB7DQogICAgICAvLyAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAvLyAgICAgICBjaHVuayhmZWF0dXJlcy5zaGlmdCgpKTsNCiAgICAgIC8vICAgICAgIGNiKGZlYXR1cmVzKTsNCiAgICAgIC8vICAgICB9LCAxMDApOw0KICAgICAgLy8gICB9DQogICAgICAvLyB9DQogICAgICBjaHVuayhnZW9tZXRyeSwgcmVzb2x2ZSkNCiAgICAgIC8vIGNiKFtnZW9tZXRyeV0pOw0KICAgIH0sDQogICAgLy8g57uY5Yi26LW35aeL54K5DQogICAgZHJhd1N0YXJ0UG9pbnQoKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgIGlmICh0eXBlb2YgeXVhbmNodSAhPSAndW5kZWZpbmVkJykgew0KICAgICAgICAgIHl1YW5jaHUubG9jYXRpb25BTWFwLnJlcXVlc3RTaW5nbGVMb2NhdGlvbigNCiAgICAgICAgICAgIFsnMSddLA0KICAgICAgICAgICAgKHJlcykgPT4gew0KICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRQb3NpdGlvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzKSkNCiAgICAgICAgICAgICAgY29uc3QgcGFyYW0gPSB7DQogICAgICAgICAgICAgICAgLi4udGhhdC5jdXJyZW50UG9zaXRpb24sDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKQ0KICAgICAgICAgICAgICB0aGF0LiRyZWZzLm15bWFwLnNldEluc3BVc2VyUG9zaXRpb24ocGFyYW0pDQogICAgICAgICAgICAgIGlmICh0aGF0LmN1cnJlbnRQb3NpdGlvbiAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgbGV0IHJlY29yZERhdGEgPSBbXQ0KICAgICAgICAgICAgICAgIHJlY29yZERhdGEucHVzaCh7DQogICAgICAgICAgICAgICAgICB0YXNrSWQ6IHRoYXQudGFza0RldGFpbC5pZCwgLy8g5Lu75YqhaWQNCiAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogdGhhdC5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlLA0KICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlLA0KICAgICAgICAgICAgICAgICAgaW5zcFRpbWU6IHRoYXQuY3VycmVudFBvc2l0aW9uLmxvY1RpbWUsDQogICAgICAgICAgICAgICAgICBkaXN0YW5jZTogMCwgLy8g56ys5LiA5Liq54K56Led56a75Li6MA0KICAgICAgICAgICAgICAgICAgaW5zcERhdGU6IHRoYXQuY3VycmVudFBvc2l0aW9uLmxvY1RpbWUsDQogICAgICAgICAgICAgICAgICBpbnNwZWN0b3I6IHRoYXQudXNlckluZm8udXNlckZ1bGxOYW1lLA0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgYXBpLmluc3BlY3Rpb25UcmFjayhyZWNvcmREYXRhKQ0KICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAvLyDkvb/nlKjkuIrmiqXngrnkvY3kvZzkuLrotbfngrkNCiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6LW35aeL54K55a2Y5YKo5oiQ5YqfJykNCiAgICAgICAgICAgICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRMaXN0LnB1c2goW3RoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwgdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGVdKQ0KICAgICAgICAgICAgICAgICAgICAgIHRoYXQudHJhY2tQb2ludFRpbWVMaXN0LnB1c2godGhhdC5jdXJyZW50UG9zaXRpb24ubG9jVGltZSkNCiAgICAgICAgICAgICAgICAgICAgICBsZXQganNvblBvaW50ID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLA0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge30sDQogICAgICAgICAgICAgICAgICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUG9pbnQnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb29yZGluYXRlczogW3RoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwgdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGVdLA0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGpzb25Qb2ludEZlYXR1cmVDb2xsZWN0aW9uID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVzOiBbanNvblBvaW50XSwNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCdzdGFydFBvaW50U291cmNlX25vdycpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgnc3RhcnRQb2ludFNvdXJjZV9ub3cnKS5zZXREYXRhKGpzb25Qb2ludEZlYXR1cmVDb2xsZWN0aW9uKQ0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtYXBPYmoubWFwLmFkZFNvdXJjZSgnc3RhcnRQb2ludFNvdXJjZV9ub3cnLCB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToganNvblBvaW50RmVhdHVyZUNvbGxlY3Rpb24sDQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRMYXllcignc3RhcnRQb2ludExheWVyX25vdycpKSB7DQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkTGF5ZXIoew0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3N0YXJ0UG9pbnRMYXllcl9ub3cnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2lyY2xlJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiAnc3RhcnRQb2ludFNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2lyY2xlLXNvcnQta2V5JzogNSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdmlzaWJpbGl0eTogIm5vbmUiDQogICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHBhaW50OiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NpcmNsZS1yYWRpdXMnOiAzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaXJjbGUtc3Ryb2tlLXdpZHRoJzogNSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2lyY2xlLXN0cm9rZS1jb2xvcic6ICcjMkE4M0U2JywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2lyY2xlLWNvbG9yJzogJ3doaXRlJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sICdpbnNwVXNlckxheWVyJykNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgLy8gbGFiZWwNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRMYXllcignc3RhcnRQb2ludF9sYWJlbCcpKSB7DQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkTGF5ZXIoew0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3N0YXJ0UG9pbnRfbGFiZWwnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3ltYm9sJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiAnc3RhcnRQb2ludFNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3ltYm9sLXBsYWNlbWVudCc6ICdwb2ludCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24taW1hZ2UnOiAnc3RhcnRfcG9pbnQnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpY29uLXNpemUnOiAwLjYsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24tb2Zmc2V0JzogWzAsIC0zNV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24tYWxsb3ctb3ZlcmxhcCc6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5bWJvbC1zb3J0LWtleSc6IDIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZpc2liaWxpdHk6ICJub25lIg0KICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gew0KICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKQ0KICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIChlcnIpID0+IHsNCiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycj0nLCBlcnIpDQogICAgICAgICAgICB9DQogICAgICAgICAgKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g57uY5Yi257uI5q2i54K5DQogICAgYXN5bmMgZHJhd0VuZFBvaW50KHR5cGUpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgaWYgKHRoYXQuY3VycmVudFBvc2l0aW9uICE9IG51bGwpIHsNCiAgICAgICAgbGV0IGxhc3RQb2ludCA9IHRoYXQudHJhY2tQb2ludExpc3RbdGhhdC50cmFja1BvaW50TGlzdC5sZW5ndGggLSAxXQ0KICAgICAgICBsZXQgZGlzdGFuY2UgPSB0aGF0LkdldERpc3RhbmNlKGxhc3RQb2ludCwgW3RoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSwgdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGVdKSAqIDEwMDANCiAgICAgICAgbGV0IHRvYXN0ID0gVG9hc3QubG9hZGluZyh7DQogICAgICAgICAgbWVzc2FnZTogJ+eoi+W6j+WFs+mXreS4rScsDQogICAgICAgICAgbG9hZGluZ1R5cGU6ICdzcGlubmVyJywNCiAgICAgICAgICBkdXJhdGlvbjogMCwNCiAgICAgICAgICBmb3JiaWRDbGljazogdHJ1ZQ0KICAgICAgICB9KQ0KICAgICAgICAvLyDorrDlvZXnu4jmraLngrkNCiAgICAgICAgdGhhdC5wb3N0VHJhY2tEYXRhX1BvaW50KA0KICAgICAgICAgIHRoYXQudHJhY2tQb2ludExpc3RbdGhhdC50cmFja1BvaW50TGlzdC5sZW5ndGggLSAxXSwNCiAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdFt0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5sZW5ndGggLSAxXSwNCiAgICAgICAgICBkaXN0YW5jZQ0KICAgICAgICApLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICBpZiAocmVzKSB7DQogICAgICAgICAgICB0b2FzdC5jbG9zZSgpDQogICAgICAgICAgICBUb2FzdC5pbmZvKHsNCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+aaguWBnOaIkOWKnycsDQogICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwDQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiB5dWFuY2h1ICE9ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgIHl1YW5jaHUubG9jYXRpb25BTWFwLnN0b3BSZXF1ZXN0TG9jYXRpb25zKCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoYXQudHJhY2tQb2ludExpc3QucHVzaChbdGhhdC5jdXJyZW50UG9zaXRpb24ubG9uZ2l0dWRlLCB0aGF0LmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZV0pDQogICAgICAgICAgICB0aGF0LnRyYWNrUG9pbnRUaW1lTGlzdC5wdXNoKHRoYXQuY3VycmVudFBvc2l0aW9uLmxvY1RpbWUpDQogICAgICAgICAgICBsZXQganNvblBvaW50ID0gew0KICAgICAgICAgICAgICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LA0KICAgICAgICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgICAgICAgIHR5cGU6ICdQb2ludCcsDQogICAgICAgICAgICAgICAgY29vcmRpbmF0ZXM6IFt0aGF0LmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUsIHRoYXQuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlXSwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxldCBqc29uUG9pbnRGZWF0dXJlQ29sbGVjdGlvbiA9IHsNCiAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgICAgZmVhdHVyZXM6IFtqc29uUG9pbnRdLA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCdlbmRQb2ludFNvdXJjZV9ub3cnKSkgew0KICAgICAgICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgnZW5kUG9pbnRTb3VyY2Vfbm93Jykuc2V0RGF0YShqc29uUG9pbnRGZWF0dXJlQ29sbGVjdGlvbikNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkU291cmNlKCdlbmRQb2ludFNvdXJjZV9ub3cnLCB7DQogICAgICAgICAgICAgICAgdHlwZTogJ2dlb2pzb24nLA0KICAgICAgICAgICAgICAgIGRhdGE6IGpzb25Qb2ludEZlYXR1cmVDb2xsZWN0aW9uLA0KICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ2VuZFBvaW50TGF5ZXJfbm93JykpIHsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkTGF5ZXIoew0KICAgICAgICAgICAgICAgIGlkOiAnZW5kUG9pbnRMYXllcl9ub3cnLA0KICAgICAgICAgICAgICAgIHR5cGU6ICdjaXJjbGUnLA0KICAgICAgICAgICAgICAgIHNvdXJjZTogJ2VuZFBvaW50U291cmNlX25vdycsDQogICAgICAgICAgICAgICAgbGF5b3V0OiB7DQogICAgICAgICAgICAgICAgICAnY2lyY2xlLXNvcnQta2V5JzogNSwNCiAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJywNCiAgICAgICAgICAgICAgICAgIC8vIHZpc2liaWxpdHk6ICJub25lIg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgcGFpbnQ6IHsNCiAgICAgICAgICAgICAgICAgICdjaXJjbGUtcmFkaXVzJzogMywNCiAgICAgICAgICAgICAgICAgICdjaXJjbGUtc3Ryb2tlLXdpZHRoJzogNSwNCiAgICAgICAgICAgICAgICAgICdjaXJjbGUtc3Ryb2tlLWNvbG9yJzogJyNhZGRkNTInLA0KICAgICAgICAgICAgICAgICAgJ2NpcmNsZS1jb2xvcic6ICd3aGl0ZScsDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgfSwgJ2luc3BVc2VyTGF5ZXInKQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyDooaXlhYV0cmFja2xpbmUNCiAgICAgICAgICAgIGxldCBqc29uTGluZSA9IHsNCiAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmUnLA0KICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSwNCiAgICAgICAgICAgICAgZ2VvbWV0cnk6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnTGluZVN0cmluZycsDQogICAgICAgICAgICAgICAgY29vcmRpbmF0ZXM6IHRoYXQudHJhY2tQb2ludExpc3QsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICB9DQogICAgICAgICAgICBsZXQganNvbkxpbmVGZWF0dXJlQ29sbGVjdGlvbiA9IHsNCiAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgICAgZmVhdHVyZXM6IFtqc29uTGluZV0sDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKSkgew0KICAgICAgICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgndHJhY2tMaW5lU291cmNlX25vdycpLnNldERhdGEoanNvbkxpbmVGZWF0dXJlQ29sbGVjdGlvbikNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkU291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93Jywgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgICAgICAgICBkYXRhOiBqc29uTGluZUZlYXR1cmVDb2xsZWN0aW9uLA0KICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0TGF5ZXIoJ3RyYWNrTGluZUxheWVyX25vdycpKSB7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBtYXBPYmoubWFwLmFkZExheWVyKHsNCiAgICAgICAgICAgICAgICBpZDogJ3RyYWNrTGluZUxheWVyX25vdycsDQogICAgICAgICAgICAgICAgdHlwZTogJ2xpbmUnLA0KICAgICAgICAgICAgICAgIHNvdXJjZTogJ3RyYWNrTGluZVNvdXJjZV9ub3cnLA0KICAgICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICAgJ2xpbmUtY2FwJzogJ3JvdW5kJywNCiAgICAgICAgICAgICAgICAgICdsaW5lLWpvaW4nOiAncm91bmQnLA0KICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgLy8gdmlzaWJpbGl0eTogIm5vbmUiDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBwYWludDogew0KICAgICAgICAgICAgICAgICAgJ2xpbmUtY29sb3InOiAnI2FkZGQ1MicsDQogICAgICAgICAgICAgICAgICAnbGluZS13aWR0aCc6IDUsDQogICAgICAgICAgICAgICAgICAnbGluZS1vcGFjaXR5JzogMC44LA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIH0sICdpbnNwVXNlckxheWVyJykNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIGxhYmVsDQogICAgICAgICAgICBpZiAobWFwT2JqLm1hcC5nZXRMYXllcignZW5kUG9pbnRfbGFiZWwnKSkgew0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgICAgICAgICAgaWQ6ICdlbmRQb2ludF9sYWJlbCcsDQogICAgICAgICAgICAgICAgdHlwZTogJ3N5bWJvbCcsDQogICAgICAgICAgICAgICAgc291cmNlOiAnZW5kUG9pbnRTb3VyY2Vfbm93JywNCiAgICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICAgICdzeW1ib2wtcGxhY2VtZW50JzogJ3BvaW50JywNCiAgICAgICAgICAgICAgICAgICdpY29uLWltYWdlJzogJ2VuZF9wb2ludCcsDQogICAgICAgICAgICAgICAgICAnaWNvbi1zaXplJzogMC42LA0KICAgICAgICAgICAgICAgICAgJ2ljb24tb2Zmc2V0JzogWzAsIC0zNV0sDQogICAgICAgICAgICAgICAgICAnaWNvbi1hbGxvdy1vdmVybGFwJzogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICdzeW1ib2wtc29ydC1rZXknOiAyLA0KICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLA0KICAgICAgICAgICAgICAgICAgLy8gdmlzaWJpbGl0eTogIm5vbmUiDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIOS4iuS8oOS5i+WJjeS4iuS8oOWksei0peeahOeCueS9jQ0KICAgICAgICAgICAgdGhhdC5yZXBvcnRGYWlsVHJhY2tQb2ludHMubGVuZ3RoID4gMCAmJiB0aGF0LnBvc3RGYWlsVHJhY2tEYXRhKCkNCiAgICAgICAgICAgIHRoYXQuJHJlZnMubXltYXAudXBsb2FkRmlsZWRQaXBlSWRMaXN0Lmxlbmd0aCA+IDAgJiYgYXBpLnJlY29yZEluc3BMaW5lKHRoYXQuJHJlZnMubXltYXAudXBsb2FkRmlsZWRQaXBlSWRMaXN0KS50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+euoee6v+ihpeWFheS4iuS8oOaIkOWKnycpDQogICAgICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC51cGxvYWRGaWxlZFBpcGVJZExpc3QgPSBbXQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgaWYgKHR5cGUgPT0gJ2VuZCcpIHsNCiAgICAgICAgICAgICAgdGhpcy5zdGFydE9yRW5kVGFza1JlY29yZCgyKSAvLyDlt7Llt6Hmo4DnirbmgIEgJzInDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICB0aGlzLnBvbGxpbmdGbGFnID0gZmFsc2UNCiAgICAgICAgICAgICAgdGhpcy5pZlJlY29yZGluZyA9IGZhbHNlDQogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzdGFydFJlY29yZExpbmVzJywgJ2VuZCcpDQogICAgICAgICAgICAgIGlmICh0eXBlID09ICdwYXVzZScpIHsNCiAgICAgICAgICAgICAgICBUb2FzdC5zdWNjZXNzKHsNCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfmmoLlgZzmiJDlip8nLA0KICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDANCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaFRhc2soKQ0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ2xlYXZlJykgew0KICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBUb2FzdC5lcnJvcih7DQogICAgICAgICAgICAgIG1lc3NhZ2U6IHR5cGUgPT0gJ2VuZCcgPyAn57uT5p2f5aSx6LSlJyA6ICfmmoLlgZzlpLHotKUnDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGxldCB0eXBlID0gdHlwZQ0KICAgICAgICBsZXQgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICB0aGF0LmRyYXdFbmRQb2ludCh0eXBlKQ0KICAgICAgICB9LCAxMDAwKQ0KICAgICAgfQ0KICAgIH0sDQogICAgYXN5bmMgcG9zdEZhaWxUcmFja0RhdGEoKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIGF3YWl0IGFwaQ0KICAgICAgICAuaW5zcGVjdGlvblRyYWNrKHRoYXQucmVwb3J0RmFpbFRyYWNrUG9pbnRzKQ0KICAgICAgICAudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygn6L2o6L+55a2Y5YKo5oiQ5YqfJykNCiAgICAgICAgICAgIHRoYXQucmVwb3J0RmFpbFRyYWNrUG9pbnRzID0gW10NCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7DQogICAgICAgICAgY29uc29sZS5sb2coJ+W3oeajgOi9qOi/ueWtmOWCqOWksei0pe+8micgKyBlcnIpDQogICAgICAgIH0pDQogICAgfSwNCg0KICAgIC8vIOWNleeCuS3lkI7nq6/orrDlvZXovajov7nmlbDmja4NCiAgICBwb3N0VHJhY2tEYXRhX1BvaW50KHBvaW50RGF0YSwgdGltZURhdGEsIGRpc3RhbmNlKSB7DQogICAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgICAgZm9yIChsZXQgcCA9IDA7IHAgPCBwb2ludERhdGEubGVuZ3RoOyBwKyspIHsNCiAgICAgICAgICBwb2ludERhdGFbcF0gPSBOdW1iZXIocG9pbnREYXRhW3BdKQ0KICAgICAgICB9DQogICAgICAgIGxldCBkYXRlX25vdyA9IGRheWpzKCkuZm9ybWF0KCdZWVlZLU1NLUREIEhIOm1tOnNzJykNCiAgICAgICAgbGV0IHJlY29yZERhdGEgPSBbXQ0KICAgICAgICByZWNvcmREYXRhLnB1c2goew0KICAgICAgICAgIHRhc2tJZDogdGhhdC50YXNrRGV0YWlsLmlkLA0KICAgICAgICAgIGluc3BEYXRlOiB0aW1lRGF0YSwNCiAgICAgICAgICBpbnNwVGltZTogZGF0ZV9ub3csDQogICAgICAgICAgZGlzdGFuY2UsDQogICAgICAgICAgaW5zcGVjdG9yOiB0aGF0LnVzZXJJbmZvLnVzZXJGdWxsbmFtZSwNCiAgICAgICAgICBsb25naXR1ZGU6IHBvaW50RGF0YVswXSwNCiAgICAgICAgICBsYXRpdHVkZTogcG9pbnREYXRhWzFdLA0KICAgICAgICB9KQ0KICAgICAgICBpZiAodGhhdC5pc1Jlc3VtZSkgew0KICAgICAgICAgIGF3YWl0IGFwaQ0KICAgICAgICAgICAgLmluc3BlY3Rpb25UcmFjayhyZWNvcmREYXRhKQ0KICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgICAgICBpZiAocmVzICYmIHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6L2o6L+55a2Y5YKo5oiQ5YqfJywgcmVjb3JkRGF0YSkNCiAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8g5LiK5Lyg5aSx6LSl55qE54K55L2N77yM5pqC5pe25a2Y5ZyoYXBw56uvDQogICAgICAgICAgICAgICAgdGhhdC5yZXBvcnRGYWlsVHJhY2tQb2ludHMucHVzaChyZWNvcmREYXRhKQ0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0aGF0LnJlcG9ydEZhaWxUcmFja1BvaW50czogJywgdGhhdC5yZXBvcnRGYWlsVHJhY2tQb2ludHMpOw0KICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBwYXVzZVN0YXRlVHJhY2tQb2ludHMucHVzaCguLi5yZWNvcmREYXRhKQ0KICAgICAgICAgIHJlc29sdmUodHJ1ZSkNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIHN0YXJ0T3JFbmRUYXNrUmVjb3JkKHN0YXR1cykgew0KICAgICAgbGV0IGRhdGEgPSB7DQogICAgICAgIHBsYW5JZDogdGhpcy5wbGFuRGV0YWlsLmlkLA0KICAgICAgICB0YXNrTmFtZTogdGhpcy50YXNrRGV0YWlsLnRhc2tOYW1lLA0KICAgICAgICB0YXNrQ29kZTogdGhpcy50YXNrRGV0YWlsLnRhc2tDb2RlLA0KICAgICAgICB0YXNrU3RhdHVzOiBzdGF0dXMsDQogICAgICAgIGlkOiB0aGlzLnRhc2tEZXRhaWwuaWQsDQogICAgICAgIHRhc2tUeXBlOiB0aGlzLnRhc2tEZXRhaWwudGFza1R5cGUsDQogICAgICAgIGJpelR5cGU6IHRoaXMucGxhbkRldGFpbC5iaXpUeXBlLA0KICAgICAgICBleHQxOiBzdGF0dXMgPT0gMiA/IHRoaXMuc3RvcFJlYXNvbiA6ICcnDQogICAgICB9DQogICAgICBpZiAoc3RhdHVzID09IDEpIHsNCiAgICAgICAgZGF0YS5wbGFuU3RhcnRUaW1lID0gdGhpcy4kZGF5anMoKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKQ0KICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT0gMikgew0KICAgICAgICBkYXRhLnBsYW5FbmRUaW1lID0gdGhpcy4kZGF5anMoKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKQ0KICAgICAgfQ0KICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICBhcGkuY2hhbmdlVGFza1N0YXR1cyhkYXRhKS50aGVuKChyZXMpID0+IHsNCiAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsNCiAgICAgICAgICBpZiAoc3RhdHVzID09IDIpIHsNCiAgICAgICAgICAgIFRvYXN0LnN1Y2Nlc3Moew0KICAgICAgICAgICAgICBtZXNzYWdlOiAn57uT5p2f5oiQ5YqfJywNCiAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsDQogICAgICAgICAgICAgIG9uQ2xvc2U6ICgpID0+IHsNCiAgICAgICAgICAgICAgICB0aGF0LnBvbGxpbmdGbGFnID0gZmFsc2UNCiAgICAgICAgICAgICAgICB0aGF0LmlmUmVjb3JkaW5nID0gZmFsc2UNCiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnc3RhcnRSZWNvcmRMaW5lcycsICdlbmQnKQ0KICAgICAgICAgICAgICAgIHRoYXQuaXNWaWV3ID0gdHJ1ZQ0KICAgICAgICAgICAgICAgIHRoYXQuJHJvdXRlci5nbygtMSkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKHN0YXR1cyA9PSAyKSB7DQogICAgICAgICAgICBUb2FzdC5lcnJvcih7DQogICAgICAgICAgICAgIG1lc3NhZ2U6ICfnu5PmnZ/lpLHotKUsIOivt+mHjeivlScsDQogICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAwDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOa4hemZpOe8k+WtmOeahOi9qOi/ueaVsOaNrg0KICAgIGNsZWFyQnVmZmVyVHJhY2soKSB7DQogICAgICBsZXQgdGhhdCA9IHRoaXMNCiAgICAgIHRoYXQuaXNSZXN1bWUgPSB0cnVlDQogICAgICB0aGF0LmlmUmVjb3JkaW5nID0gZmFsc2UNCiAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uID0gbnVsbA0KICAgICAgLy/mlbDnu4TlvZLpm7YNCiAgICAgIHRoYXQudHJhY2tQb2ludExpc3QgPSBbXQ0KICAgICAgdGhhdC50cmFja1BvaW50VGltZUxpc3QgPSBbXQ0KICAgICAgdGhhdC5vdmVyU3BlZWRUcmFja0xpbmVMaXN0ID0gW10NCiAgICAgIHBhdXNlU3RhdGVUcmFja1BvaW50cyA9IFtdDQogICAgICBwYXVzZVN0YXRlUGlwZUlkTGlzdCA9IFtdDQogICAgICAvL+aVsOaNrua6kOa4heepug0KICAgICAgaWYgKG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3RyYWNrTGluZVNvdXJjZV9ub3cnKS5zZXREYXRhKHsNCiAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgIGZlYXR1cmVzOiBbXSwNCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICAgIGlmIChtYXBPYmoubWFwLmdldFNvdXJjZSgndHJhY2tMaW5lU291cmNlX292ZXJTcGVlZCcpKSB7DQogICAgICAgIG1hcE9iai5tYXAuZ2V0U291cmNlKCd0cmFja0xpbmVTb3VyY2Vfb3ZlclNwZWVkJykuc2V0RGF0YSh7DQogICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICBmZWF0dXJlczogW10sDQogICAgICAgIH0pDQogICAgICB9DQogICAgICBpZiAobWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ3N0YXJ0UG9pbnRTb3VyY2Vfbm93Jykuc2V0RGF0YSh7DQogICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICBmZWF0dXJlczogW10sDQogICAgICAgIH0pDQogICAgICB9DQoNCiAgICAgIGlmIChtYXBPYmoubWFwLmdldFNvdXJjZSgnZW5kUG9pbnRTb3VyY2Vfbm93JykpIHsNCiAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ2VuZFBvaW50U291cmNlX25vdycpLnNldERhdGEoew0KICAgICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0sDQogICAgYWRkTWFwSW1nKCkgew0KICAgICAgbWFwT2JqLm1hcC5sb2FkSW1hZ2UoDQogICAgICAgIHJlcXVpcmUoJ0Bhc3NldHMvaW1nL2luc3BlY3Rpb24vd2hpdGVfYXJyb3dfcmlnaHQucG5nJyksDQogICAgICAgIGZ1bmN0aW9uIChlcnJvciwgaW1hZ2UpIHsNCiAgICAgICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yDQogICAgICAgICAgaWYgKCFtYXBPYmoubWFwLmhhc0ltYWdlKCdhcnJvd0ljb24nKSkgew0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRJbWFnZSgnYXJyb3dJY29uJywgaW1hZ2UsIHt9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgKQ0KICAgICAgbWFwT2JqLm1hcC5sb2FkSW1hZ2UoDQogICAgICAgIHJlcXVpcmUoJ0Bhc3NldHMvaW1nL2luc3BlY3Rpb24vaWNvbl9zdGFydGluZ19wb2ludC5wbmcnKSwNCiAgICAgICAgZnVuY3Rpb24gKGVycm9yLCBpbWFnZSkgew0KICAgICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3INCiAgICAgICAgICBpZiAoIW1hcE9iai5tYXAuaGFzSW1hZ2UoJ3N0YXJ0X3BvaW50JykpIHsNCiAgICAgICAgICAgIG1hcE9iai5tYXAuYWRkSW1hZ2UoJ3N0YXJ0X3BvaW50JywgaW1hZ2UsIHt9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgKQ0KICAgICAgbWFwT2JqLm1hcC5sb2FkSW1hZ2UoDQogICAgICAgIHJlcXVpcmUoJ0Bhc3NldHMvaW1nL2luc3BlY3Rpb24vaWNvbl9hdF9lbmQucG5nJyksDQogICAgICAgIGZ1bmN0aW9uIChlcnJvciwgaW1hZ2UpIHsNCiAgICAgICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yDQogICAgICAgICAgaWYgKCFtYXBPYmoubWFwLmhhc0ltYWdlKCdlbmRfcG9pbnQnKSkgew0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRJbWFnZSgnZW5kX3BvaW50JywgaW1hZ2UsIHt9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgKQ0KICAgIH0sDQogICAgLy8g5byA5aeL6K6w5b2VIOS4iuS8oOi1t+eCueaIkOWKn+WQjuaJjei/m+WFpeW3oeajgOi/h+eoiw0KICAgIHN0YXJ0SW5zcFJlY29yZCgpIHsNCiAgICAgIGlmICh0aGlzLmlzVmlldykgew0KICAgICAgICBUb2FzdCh7DQogICAgICAgICAgbWVzc2FnZTogJ+ivpeW3oeajgOS7u+WKoeW3sue7k+adnycsDQogICAgICAgICAgZHVyYXRpb246IDE1MDANCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICBpZiAoIXRoaXMuY3VycmVudFBvc2l0aW9uIHx8ICF0aGlzLmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUpIHsNCiAgICAgICAgVG9hc3Qud2FybmluZyh7DQogICAgICAgICAgbWVzc2FnZTogJ+W9k+WJjUdQU+S/oeWPt+W8se+8jOivt+eojeWQjuWwneivlScsDQogICAgICAgICAgZHVyYXRpb246IDIwMDANCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICB0aGlzLmNsZWFyQnVmZmVyVHJhY2soKQ0KICAgICAgbGV0IHRvYXN0ID0gVG9hc3QubG9hZGluZyh7DQogICAgICAgIG1lc3NhZ2U6ICfnqIvluo/lkK/liqjkuK0nLA0KICAgICAgICBsb2FkaW5nVHlwZTogJ3NwaW5uZXInLA0KICAgICAgICBkdXJhdGlvbjogMCwNCiAgICAgICAgZm9yYmlkQ2xpY2s6IHRydWUNCiAgICAgIH0pDQogICAgICB0aGlzLmRyYXdTdGFydFBvaW50KCkNCiAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgIGlmIChyZXMpIHsNCiAgICAgICAgICAgIHRvYXN0LmNsb3NlKCkNCiAgICAgICAgICAgIFRvYXN0LmluZm8oew0KICAgICAgICAgICAgICBtZXNzYWdlOiAn5byA5aeL6K6w5b2VJywNCiAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDANCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICB0aGlzLnBvbGxpbmdGbGFnID0gdHJ1ZQ0KICAgICAgICAgICAgdGhpcy5pZlJlY29yZGluZyA9IHRydWUNCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdzdGFydFJlY29yZExpbmVzJywgJ3N0YXJ0JykNCiAgICAgICAgICAgIC8vIOW8gOWni+i9ruivog0KICAgICAgICAgICAgdGhpcy5wb2xsaW5nKCkNCiAgICAgICAgICAgIC8vIOiusOW9leW9k+WJjeaXtumXtA0KICAgICAgICAgICAgdGhpcy5zdGFydFJlY29yZFRpbWVyID0gbmV3IERhdGUoKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBUb2FzdC5lcnJvcih7DQogICAgICAgICAgICAgIG1lc3NhZ2U6ICfmjqXlj6PlvILluLjvvIzml6Dms5XlvIDlp4vku7vliqEnLA0KICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7DQogICAgICAgICAgY29uc29sZS5sb2coZXJyKQ0KICAgICAgICAgIFRvYXN0LmVycm9yKHsNCiAgICAgICAgICAgIG1lc3NhZ2U6ICfnvZHnu5znirbmgIHlvILluLjvvIzmraPlnKjph43or5UnLA0KICAgICAgICAgICAgZHVyYXRpb246IDIwMDANCiAgICAgICAgICB9KQ0KICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5kcmF3U3RhcnRQb2ludCgpDQogICAgICAgICAgfSwgNTAwMCkNCiAgICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOe7k+adn+iusOW9lQ0KICAgIGVuZFJlY29yZCh0eXBlKSB7DQogICAgICBsZXQgZGlmZiA9IE1hdGguZmxvb3IoKG5ldyBEYXRlKCkgLSB0aGlzLnN0YXJ0UmVjb3JkVGltZXIpIC8gMTAwMCkNCiAgICAgIGlmIChkaWZmIDw9IDEwKSB7DQogICAgICAgIFRvYXN0LmluZm8oew0KICAgICAgICAgIG1lc3NhZ2U6IGDnu5PmnZ/lpKrlv6vkuoYs6K+3JHsxMCAtIGRpZmZ956eS5ZCO5YaN6K+VYCwNCiAgICAgICAgICBkdXJhdGlvbjogMTAwMA0KICAgICAgICB9KQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIHRoaXMuZW5kUmVjb3JkQ29uZmlybSh0eXBlKQ0KICAgIH0sDQogICAgLy8g57uT5p2f6K6w5b2V56Gu6K6kDQogICAgZW5kUmVjb3JkQ29uZmlybSh0eXBlKSB7DQogICAgICB0aGlzLmRyYXdFbmRQb2ludCh0eXBlKQ0KICAgIH0sDQogICAgLy8g5byA5aeL5a6a5L2NDQogICAgc3RhcnRMb2NhdGlvbigpIHsNCiAgICAgIGxldCB0aGF0ID0gdGhpcw0KICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAucmVxdWVzdFNpbmdsZUxvY2F0aW9uKA0KICAgICAgICBbJzEnXSwNCiAgICAgICAgKHJlcykgPT4gew0KICAgICAgICAgIHRoYXQuY3VycmVudFBvc2l0aW9uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXMpKQ0KICAgICAgICAgIGNvbnN0IHBhcmFtID0gew0KICAgICAgICAgICAgLi4udGhhdC5jdXJyZW50UG9zaXRpb24sDQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICghdGhhdC5jdXJyZW50UG9zaXRpb24gfHwgIXRoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSB8fCAhdGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGUpIHsNCiAgICAgICAgICAgIFRvYXN0LmVycm9yKHsNCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+iOt+WPluS9jee9ruWksei0pSEnLA0KICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zdCBjb29yZCA9IFtwYXJzZUZsb2F0KHRoYXQuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSksIHBhcnNlRmxvYXQodGhhdC5jdXJyZW50UG9zaXRpb24ubGF0aXR1ZGUpXQ0KICAgICAgICAgICAgdGhhdC4kcmVmcy5teW1hcC5zZXRJbnNwVXNlclBvc2l0aW9uKHBhcmFtKQ0KICAgICAgICAgICAgdGhhdC5mbHlUb1BvaW50KGNvb3JkKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgKGVycikgPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnI9JywgZXJyKQ0KICAgICAgICB9DQogICAgICApDQogICAgfSwNCiAgICBnb0V2ZW50T3JGbGF3RGV0YWlsKGZlYXR1cmUsIHR5cGUpIHsNCiAgICAgIGxldCBjdXJyZW50UG9pbnQgPSBmZWF0dXJlDQogICAgICBjb25zb2xlLmxvZyhmZWF0dXJlKQ0KICAgICAgY3VycmVudFBvaW50ID0gZmVhdHVyZQ0KICAgICAgY3VycmVudFBvaW50LmJpZ1R5cGUgPSBmZWF0dXJlLmJpelR5cGUgfHwgJycNCiAgICAgIGN1cnJlbnRQb2ludC5ncmlkSWQgPSB0aGlzLnBsYW5EZXRhaWwuZ3JpZElkDQogICAgICBjdXJyZW50UG9pbnQuZ3JpZE5hbWUgPSB0aGlzLnBsYW5EZXRhaWwuZ3JpZE5hbWUNCiAgICAgIGN1cnJlbnRQb2ludC5ncmlkTWFuYWdlciA9IHsgZnVsbE5hbWU6IHRoaXMucGxhbkRldGFpbC5ncmlkTWFuYWdlciwgdXNlcm5hbWU6IHRoaXMucGxhbkRldGFpbC51c2VyTmFtZSB9DQogICAgICBjdXJyZW50UG9pbnQubG5nID0gZmVhdHVyZS5nZW9tLmNvb3JkaW5hdGVzWzBdDQogICAgICBjdXJyZW50UG9pbnQubGF0ID0gZmVhdHVyZS5nZW9tLmNvb3JkaW5hdGVzWzFdDQogICAgICBjdXJyZW50UG9pbnQucm9hZF9uYW1lID0gZmVhdHVyZS5yb2FkIHx8ICcnDQogICAgICBjdXJyZW50UG9pbnQuc21hbGxUeXBlID0gZmVhdHVyZS5kZXZpY2VUeXBlIHx8ICcnDQogICAgICBjdXJyZW50UG9pbnQuY29kZSA9IGZlYXR1cmUuZGV2aWNlSWQgfHwgJycNCiAgICAgIGN1cnJlbnRQb2ludC50YXNrSWQgPSB0aGlzLnRhc2tEZXRhaWwuaWQNCiAgICAgIGlmICh0eXBlID09ICdldmVudCcpIHsNCiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goew0KICAgICAgICAgIG5hbWU6ICdhZGRQcm9ibGVtSW5kZXgnLA0KICAgICAgICAgIHF1ZXJ5OiB7IG1zZzogY3VycmVudFBvaW50LCB0b2tlbjogdGhpcy5mb3JtVG9rZW4sIHRhc2tJZDogdGhpcy4kcm91dGUucXVlcnkudGFza0lkLCBmcm9tOiAnaW5zcCcgfSwNCiAgICAgICAgICBwYXJhbXM6IHsgdHlwZTogJ2FkZCcgfSwNCiAgICAgICAgfSkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsNCiAgICAgICAgICBuYW1lOiAnYWRkRmxhd3MnLA0KICAgICAgICAgIHF1ZXJ5OiB7IG1zZzogY3VycmVudFBvaW50LCB0b2tlbjogdGhpcy5mb3JtVG9rZW4sIHRhc2tJZDogdGhpcy4kcm91dGUucXVlcnkudGFza0lkLCBmcm9tOiAnaW5zcCcgfSwNCiAgICAgICAgICBwYXJhbXM6IHsgdHlwZTogJ2FkZCcgfQ0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g56Gu6K6kDQogICAgb25Db25maXJtKCkgew0KICAgICAgaWYgKHRydWUpIHsNCiAgICAgICAgbGV0IHRoYXQgPSB0aGlzDQogICAgICAgIGxldCBmZWF0dXJlID0gdGhpcy5zaWduRm9ybS5mZWF0dXJlDQogICAgICAgIGxldCBjb3B5U2lnbkZvcm0gPSB0aGlzLmRlZXBDbG9uZSh0aGlzLnNpZ25Gb3JtKQ0KICAgICAgICBpZiAodGhhdC5hdHRhY2htZW50ID09ICcnKSB7DQogICAgICAgICAgTm90aWZ5KHsgdHlwZTogJ2Vycm9yJywgbWVzc2FnZTogJ+ivt+S4iuS8oOmZhOS7ticgfSkNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICAvLyDmtrLkvY3ovpPlhaXmoYbmmK/lkKbmmL7npLrvvIjmsaHmsLTmo4Dmn6XkupXlv4XpobvloavlhpnmtrLkvY3lrZfmrrXvvIkNCiAgICAgICAgaWYgKHRoaXMud2F0ZXJMZXZlbFNob3cgPT0gdHJ1ZSkgew0KICAgICAgICAgIGlmIChjb3B5U2lnbkZvcm0ubGlxdWlkTGV2ZWwgPT0gJycpIHsNCiAgICAgICAgICAgIE5vdGlmeSh7IHR5cGU6ICdlcnJvcicsIG1lc3NhZ2U6ICfor7fovpPlhaXmtrLkvY0nIH0pDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY29weVNpZ25Gb3JtLmluc3BEYXRlID0gZGF5anMoKS5mb3JtYXQoJ1lZWVktTU0tREQgSEg6bW06c3MnKQ0KICAgICAgICBjb3B5U2lnbkZvcm0uZXh0MSA9IGNvcHlTaWduRm9ybS5yZW1hcmsgLy8g5aSH5rOoDQogICAgICAgIGNvcHlTaWduRm9ybS5leHQyID0gJzEnIC8vIOW3oeajgOiusOW9leeahGV4dDLlrZfmrrXvvIzpu5jorqTkuLox77yI5b6F5aSN5qC477yJ77yM5bey6YCa6L+H5Li6Mu+8jOW3sumAgOWbnuS4ujMNCiAgICAgICAgZGVsZXRlIGNvcHlTaWduRm9ybS5mZWF0dXJlDQoNCiAgICAgICAgLy8gcmVzdWx0TGlzdOmAmui/h+W3oeajgOimgeeCuWxpc3TlpITnkIblubbmt7vliqDliLBmb3Jt5LitDQogICAgICAgIGxldCByZXN1bHRMaXN0ID0gW10NCiAgICAgICAgbGV0IHRleHRJbkZsYWcgPSBmYWxzZQ0KICAgICAgICAvLyDlt6Hmo4DopoHngrlsaXN05pWw5o2uDQogICAgICAgIGlmICh0aGlzLmtleVBvaW50c0luc3BlY3Rpb25MaXN0Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgICB0aGlzLmtleVBvaW50c0luc3BlY3Rpb25MaXN0LmZvckVhY2goaXRlbSA9PiB7DQogICAgICAgICAgICByZXN1bHRMaXN0LnB1c2goew0KICAgICAgICAgICAgICBtYWluSWQ6IGl0ZW0uaWQsIC8vIOW3oeajgOimgeeCuWlkDQogICAgICAgICAgICAgIG1haW5Qb2ludDogaXRlbS5tYWluUG9pbnQsIC8vIOW3oeajgOimgeeCueWQjeensA0KICAgICAgICAgICAgICBtYWluVmFsdWU6IGl0ZW0ubWFpblZhbHVlLCAvLyDor6XopoHngrnlt6Hmo4Dnu5PmnpwNCiAgICAgICAgICAgICAgZXh0MTogaXRlbS5pbnB1dFR5cGUsIC8vIOW3oeajgOimgeeCuei+k+WFpeexu+Wei++8jOeUqOS6juafpeivouivpuaDheaXtuWIpOaWrWh0bWznu5PmnoQNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfSkNCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdExpc3QubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIC8vIOS4jeS4uicn5oiW6ICF5YWo56m65qC8DQogICAgICAgICAgICBpZiAocmVzdWx0TGlzdFtpXS5tYWluVmFsdWUgPT0gJycgfHwgcmVzdWx0TGlzdFtpXS5tYWluVmFsdWUudHJpbSgpID09ICcnKSB7DQogICAgICAgICAgICAgIHRleHRJbkZsYWcgPSB0cnVlDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICh0ZXh0SW5GbGFnKSB7DQogICAgICAgICAgTm90aWZ5KHsgdHlwZTogJ2Vycm9yJywgbWVzc2FnZTogJ+ivt+WwhuW3oeajgOimgeeCueihpeWFheWujOaVtCcgfSkNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICBjb3B5U2lnbkZvcm0ucmVzdWx0TGlzdCA9IHJlc3VsdExpc3QNCiAgICAgICAgY29uc29sZS5sb2coJ+aPkOS6pOWPguaVsCcsIF9jbG9uZURlZXAoY29weVNpZ25Gb3JtKSk7DQogICAgICAgIA0KICAgICAgICBhcGkuc2lnbkluKGNvcHlTaWduRm9ybSkudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgICAgICBUb2FzdC5zdWNjZXNzKHsNCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+atpOWFs+mUrueCueetvuWIsOaIkOWKnycsDQogICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLA0KICAgICAgICAgICAgICBmb3JiaWRDbGljazogdHJ1ZSwNCiAgICAgICAgICAgICAgb25DbG9zZTogKCkgPT4gew0KICAgICAgICAgICAgICAgIC8vIOW3oeajgOS6i+S7tuS4iuaKpQ0KICAgICAgICAgICAgICAgIGlmIChjb3B5U2lnbkZvcm0uaXNSZXBvcnQgPT0gJ+mXrumimOS4iuaKpScpIHsNCiAgICAgICAgICAgICAgICAgIHRoYXQuZ29FdmVudE9yRmxhd0RldGFpbChmZWF0dXJlLCAnZXZlbnQnKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvcHlTaWduRm9ybS5pc1JlcG9ydCA9PSAn5paw5aKe57y66Zm3Jykgew0KICAgICAgICAgICAgICAgICAgdGhhdC5nb0V2ZW50T3JGbGF3RGV0YWlsKGZlYXR1cmUsICdmbGF3Jyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIHRoYXQucmVmcmVzaFRhc2soKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgVG9hc3QuZXJyb3Ioew0KICAgICAgICAgICAgICBtZXNzYWdlOiAn5q2k5YWz6ZSu54K5562+5Yiw5aSx6LSlJywNCiAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDANCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuc2lnblNob3cgPSBmYWxzZQ0KICAgICAgICAgIHRoaXMuc2lnbkZvcm0ucmVtYXJrID0gJycNCiAgICAgICAgICB0aGlzLnNpZ25Gb3JtLmxpcXVpZExldmVsID0gJycNCiAgICAgICAgICB0aGlzLnNpZ25Gb3JtLmRldmljZVN0YXR1cyA9ICcwJw0KICAgICAgICAgIHRoaXMuc2lnbkZvcm0uaXNSZXBvcnQgPSAnJw0KICAgICAgICAgIHRoaXMuc2lnbkZvcm0uaW5zcEltYWdlc0xpc3QgPSBbXQ0KICAgICAgICAgIHRoaXMuYXR0YWNobWVudCA9ICcnDQogICAgICAgICAgbWFwT2JqLm1hcEluc3RhbmNlLnNldFNvdXJjZURhdGEoJ2J1ZmZlcmVkJywgew0KICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgIGZlYXR1cmVzOiBbXSwNCiAgICAgICAgICB9KQ0KICAgICAgICB9KQ0KICAgICAgICAvLyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiaXNSZXBvcnRFdmVudCIsIGZhbHNlKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbnNvbGUubG9nKCfpqozor4HlpLHotKUnKQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5Y+W5raIDQogICAgb25DYW5jZWwoKSB7DQogICAgICB0aGlzLnNpZ25TaG93ID0gZmFsc2UNCiAgICAgIG1hcE9iai5tYXBJbnN0YW5jZS5zZXRTb3VyY2VEYXRhKCdidWZmZXJlZCcsIHsNCiAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgfSkNCiAgICB9LA0KICAgIGNhbmNlbExlYXZlKCkgew0KICAgICAgdGhpcy5pZkxlYXZlVGFzayA9IGZhbHNlDQogICAgfSwNCiAgICBjb25maXJtTGVhdmUoKSB7DQogICAgICB0aGlzLmlmTGVhdmVUYXNrID0gZmFsc2UNCiAgICAgIHRoaXMuZW5kUmVjb3JkKCdsZWF2ZScpDQogICAgfSwNCiAgICBjbGlja0JhY2soKSB7DQogICAgICBpZiAodGhpcy5pZlJlY29yZGluZykgew0KICAgICAgICB0aGlzLmlmTGVhdmVUYXNrID0gdHJ1ZQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g562+5YiwDQogICAgYXN5bmMgc3RhcnRTaWduSW4oZmVhdHVyZSkgew0KICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0t562+5YiwLS0tLS0tLS0nLCBmZWF0dXJlKTsNCiAgICAgIGlmIChmZWF0dXJlLmJpelR5cGUgPT0gJ+axoeawtCcgJiYgZmVhdHVyZS5kZXZpY2VUeXBlID09ICfmo4Dmn6XkupUnKSB7DQogICAgICAgIC8vIOa2suS9jei+k+WFpeahhuaYr+WQpuaYvuekug0KICAgICAgICB0aGlzLndhdGVyTGV2ZWxTaG93ID0gdHJ1ZQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy53YXRlckxldmVsU2hvdyA9IGZhbHNlDQogICAgICB9DQogICAgICB0aGlzLnBvaW50TGlzdFNob3cgPSBmYWxzZQ0KICAgICAgdGhpcy5hdHRhY2htZW50ID0gJycNCiAgICAgIHRoaXMuc2lnbkZvcm0uaXNSZXBvcnQgPSAnJw0KICAgICAgdGhpcy5kZXZpY2VOYW1lID0gZmVhdHVyZS5kZXZpY2VUeXBlICsgKGZlYXR1cmUuZGV2aWNlSWQgfHwgJycpDQogICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgLy8gIGRldmljZVN0YXR1c+eKtuaAge+8iDDmraPluLggMeW8guW4uCAy5pyq5beh5qOA77yJIOW3oeajgOiusOW9leeahGV4dDLlrZfmrrXvvIzpu5jorqTkuLox77yI5b6F5aSN5qC477yJ77yM5bey6YCa6L+H5Li6Mu+8jOW3sumAgOWbnuS4ujMNCiAgICAgIGlmICghZmVhdHVyZS5kZXZpY2VTdGF0dXMgfHwgZmVhdHVyZS5kZXZpY2VTdGF0dXMgPT0gJzInIHx8IGZlYXR1cmUuZXh0MiA9PSAnMycpIHsNCiAgICAgICAgaWYgKHRoaXMuJHJvdXRlLnF1ZXJ5LmlzVmlldykgew0KICAgICAgICAgIFRvYXN0Lndhcm5pbmcoew0KICAgICAgICAgICAgbWVzc2FnZTogJ+S7u+WKoeW3sue7k+adn++8jOaXoOazlee7p+e7reaJk+WNoScsDQogICAgICAgICAgICBkdXJhdGlvbjogMjAwMA0KICAgICAgICAgIH0pDQogICAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ2J1ZmZlcmVkJykgJiYNCiAgICAgICAgICAgIG1hcE9iai5tYXBJbnN0YW5jZS5zZXRTb3VyY2VEYXRhKCdidWZmZXJlZCcsIHsNCiAgICAgICAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICAvLyDliKnnlKhmZWF0dXJl5p2l5Yik5pat5piv5ZCm5aSE5LqOMzVt6IyD5Zu05YaF77yM5aaC5p6c5aSE5LqO77yM5Y+v5Lul6L+b6KGM562+5Yiw77yM5ZCm5YiZ5LiN6IO96L+b6KGM562+5YiwDQogICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5jdXJyZW50UG9zaXRpb24NCiAgICAgICAgaWYgKCFwb3NpdGlvbikgew0KICAgICAgICAgIFRvYXN0Lndhcm5pbmcoew0KICAgICAgICAgICAgbWVzc2FnZTogJ+iOt+WPluS4jeWIsOW3oeajgOS6uuS9jee9ricsDQogICAgICAgICAgICBkdXJhdGlvbjogMjAwMA0KICAgICAgICAgIH0pDQogICAgICAgICAgbWFwT2JqLm1hcC5nZXRTb3VyY2UoJ2J1ZmZlcmVkJykgJiYNCiAgICAgICAgICBtYXBPYmoubWFwSW5zdGFuY2Uuc2V0U291cmNlRGF0YSgnYnVmZmVyZWQnLCB7DQogICAgICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICAgICAgZmVhdHVyZXM6IFtdLA0KICAgICAgICAgIH0pDQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY29vcmQgPSBbDQogICAgICAgICAgcGFyc2VGbG9hdChwb3NpdGlvbi5sb25naXR1ZGUpLA0KICAgICAgICAgIHBhcnNlRmxvYXQocG9zaXRpb24ubGF0aXR1ZGUpLA0KICAgICAgICBdDQogICAgICAgIGNvbnN0IHBvaW50ID0gdHVyZi5wb2ludChjb29yZCkNCiAgICAgICAgY29uc3QgZW5nR2VvbSA9IGZlYXR1cmUuZ2VvbQ0KICAgICAgICBjb25zdCBidWZmZXJlZCA9IHR1cmYuYnVmZmVyKGVuZ0dlb20sIDAuMDIwLCB7IHVuaXQ6ICdraWxvbWV0ZXJzJyB9KQ0KICAgICAgICBjb25zdCBpc0luQnVmZmVyID0gdHVyZi5pbnNpZGUocG9pbnQsIGJ1ZmZlcmVkKQ0KICAgICAgICBpZiAoIWlzSW5CdWZmZXIpIHsNCiAgICAgICAgICBUb2FzdC53YXJuaW5nKHsNCiAgICAgICAgICAgIG1lc3NhZ2U6ICfmnKrlpITkuo7or6XlhbPplK7ngrnojIPlm7TlhoUnLA0KICAgICAgICAgICAgZHVyYXRpb246IDIwMDANCiAgICAgICAgICB9KQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgIGNvbnNvbGUubG9nKCdmZWF0dXJl5pWw5o2uJywgZmVhdHVyZSk7DQogICAgICAgIC8vIOW3oeajgOimgeeCuWxpc3TmlbDmja4NCiAgICAgICAgdGhpcy5rZXlQb2ludHNJbnNwZWN0aW9uTGlzdCA9IFtdDQogICAgICAgIGxldCBwYXJhbXM0ID0gew0KICAgICAgICAgIGJpelR5cGU6IGZlYXR1cmUuYml6VHlwZSwgLy8g5Lia5Yqh57G75Z6L77yI5rGh5rC077yJDQogICAgICAgICAgb2JqZWN0VHlwZTogZmVhdHVyZS5kZXZpY2VUeXBlLCAvLyDlt6Hmo4Dlr7nosaHnsbvlnovlkI3np7DvvIjmo4Dmn6XkupXvvIkNCiAgICAgICAgfQ0KICAgICAgICAvLyBhcHDnq6/moLnmja7nsbvlnovmn6Xor6LlkK/nlKjnmoTlt6Hmo4DopoHngrnliJfooagNCiAgICAgICAgYXBpLmluc3BQb2ludENoZWNrTGlzdChwYXJhbXM0KQ0KICAgICAgICAgIC50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICB0aGlzLmtleVBvaW50c0luc3BlY3Rpb25MaXN0ID0gcmVzPy5kYXRhPy5maWx0ZXIoKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubWFpblN0YXR1cyA9PT0gIuWQr+eUqOS4rSINCiAgICAgICAgICAgICAgLy8gaXRlbSA9IHsNCiAgICAgICAgICAgICAgLy8gICAiaWQiOiAiMTY1NTg0MzAwNzc2ODIzNjAzMyIsDQogICAgICAgICAgICAgIC8vICAgImNyZWF0ZUJ5IjogImZhd2tlcyIsDQogICAgICAgICAgICAgIC8vICAgImNyZWF0ZURhdGUiOiAiMjAyMy0wNS0wOSAxNTo1MTo1MSIsDQogICAgICAgICAgICAgIC8vICAgInVwZGF0ZUJ5IjogbnVsbCwNCiAgICAgICAgICAgICAgLy8gICAidXBkYXRlRGF0ZSI6IG51bGwsDQogICAgICAgICAgICAgIC8vICAgImRlbGV0ZUZsYWciOiAwLA0KICAgICAgICAgICAgICAvLyAgICJtYWluUG9pbnQiOiAi5LqV5YaF5piv5ZCm5pyJ5aSn6YeP5rek56ev5oiW5p2C54mp5b2x5ZON5o6S5rC0IiwNCiAgICAgICAgICAgICAgLy8gICAiaW5wdXRUeXBlIjogIuaYry/lkKYiLA0KICAgICAgICAgICAgICAvLyAgICJ1bml0IjogIi8iLA0KICAgICAgICAgICAgICAvLyAgICJtYWluU3RhdHVzIjogIuWQr+eUqOS4rSIsDQogICAgICAgICAgICAgIC8vICAgImJpelR5cGUiOiAi5rGh5rC0IiwNCiAgICAgICAgICAgICAgLy8gICAib2JqZWN0VHlwZSI6ICLmo4Dmn6XkupUiLA0KICAgICAgICAgICAgICAvLyAgICJyZW1hcmtzIjogbnVsbCwNCiAgICAgICAgICAgICAgLy8gICAicG9ydGFsSWQiOiBudWxsLA0KICAgICAgICAgICAgICAvLyAgICJ0ZW5hbnRJZCI6IDEwMDAwMA0KICAgICAgICAgICAgICAvLyB9DQogICAgICAgICAgICB9KSB8fCBbXQ0KICAgICAgICAgICAgLy8g5beh5qOA6KaB54K5bGlzdOaVsOaNrg0KICAgICAgICAgICAgaWYgKHRoaXMua2V5UG9pbnRzSW5zcGVjdGlvbkxpc3QubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICB0aGlzLmtleVBvaW50c0luc3BlY3Rpb25MaXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgICBsZXQgaVQgPSBbJyddDQogICAgICAgICAgICAgICAgLy8g5aaC5p6caW5wdXRUeXBl5Lit5a2Y5ZyoJy8n77yM5YiZ5bCG5YW26L2s5o2i5oiQ5pWw57uE77yM5beh5qOA6KaB54K557uT5p6cbWFpblZhbHVl6buY6K6k5Li656ys5LiA5Liq5YC877yIImlucHV0VHlwZSI6ICLmmK8v5ZCmIizvvInvvIzlkKbliJltYWluVmFsdWXkuLonJw0KICAgICAgICAgICAgICAgIGlmIChpdGVtLmlucHV0VHlwZS5pbmRleE9mKCcvJykgPiAtMSkgew0KICAgICAgICAgICAgICAgICAgaVQgPSBpdGVtLmlucHV0VHlwZS5zcGxpdCgnLycpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMuJHNldChpdGVtLCAnbWFpblZhbHVlJywgaVRbMF0pIC8vIOivpeimgeeCueW3oeajgOe7k+aenA0KICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gdGhpcy5rZXlQb2ludHNJbnNwZWN0aW9uTGlzdCA9IFsNCiAgICAgICAgICAgIC8vICAgew0KICAgICAgICAgICAgLy8gICAgICJpZCI6ICIxNjU1ODQzMDA3NzY4MjM2MDMzIiwNCiAgICAgICAgICAgIC8vICAgICAiY3JlYXRlQnkiOiAiZmF3a2VzIiwNCiAgICAgICAgICAgIC8vICAgICAiY3JlYXRlRGF0ZSI6ICIyMDIzLTA1LTA5IDE1OjUxOjUxIiwNCiAgICAgICAgICAgIC8vICAgICAidXBkYXRlQnkiOiBudWxsLA0KICAgICAgICAgICAgLy8gICAgICJ1cGRhdGVEYXRlIjogbnVsbCwNCiAgICAgICAgICAgIC8vICAgICAiZGVsZXRlRmxhZyI6IDAsDQogICAgICAgICAgICAvLyAgICAgIm1haW5Qb2ludCI6ICLmtYvor5XmraPluLjlvILluLjmtYvor5XmraPluLjlvILluLjmtYvor5XmraPluLjlvILluLjmtYvor5XmraPluLjlvILluLgiLA0KICAgICAgICAgICAgLy8gICAgICJpbnB1dFR5cGUiOiAi5q2j5bi4L+W8guW4uCIsDQogICAgICAgICAgICAvLyAgICAgInVuaXQiOiAiLyIsDQogICAgICAgICAgICAvLyAgICAgIm1haW5TdGF0dXMiOiAi5ZCv55So5LitIiwNCiAgICAgICAgICAgIC8vICAgICAiYml6VHlwZSI6ICLmsaHmsLQiLA0KICAgICAgICAgICAgLy8gICAgICJvYmplY3RUeXBlIjogIuajgOafpeS6lSIsDQogICAgICAgICAgICAvLyAgICAgInJlbWFya3MiOiBudWxsLA0KICAgICAgICAgICAgLy8gICAgICJwb3J0YWxJZCI6IG51bGwsDQogICAgICAgICAgICAvLyAgICAgInRlbmFudElkIjogMTAwMDAwLA0KICAgICAgICAgICAgLy8gICAgICJtYWluVmFsdWUiOiAi5q2j5bi4Ig0KICAgICAgICAgICAgLy8gICB9LA0KICAgICAgICAgICAgLy8gICB7DQogICAgICAgICAgICAvLyAgICAgImlkIjogIjE2NTU4NDMwMDc3NjgyMzYwMzQiLA0KICAgICAgICAgICAgLy8gICAgICJjcmVhdGVCeSI6ICJmYXdrZXMiLA0KICAgICAgICAgICAgLy8gICAgICJjcmVhdGVEYXRlIjogIjIwMjMtMDUtMDkgMTU6NTE6NTEiLA0KICAgICAgICAgICAgLy8gICAgICJ1cGRhdGVCeSI6IG51bGwsDQogICAgICAgICAgICAvLyAgICAgInVwZGF0ZURhdGUiOiBudWxsLA0KICAgICAgICAgICAgLy8gICAgICJkZWxldGVGbGFnIjogMCwNCiAgICAgICAgICAgIC8vICAgICAibWFpblBvaW50IjogIua1i+ivleW8gOWQr+WFs+mXrea1i+ivleW8gOWQr+WFs+mXrea1i+ivleW8gOWQr+WFs+mXrea1i+ivleW8gOWQr+WFs+mXrSIsDQogICAgICAgICAgICAvLyAgICAgImlucHV0VHlwZSI6ICLlvIDlkK8v5YWz6ZetIiwNCiAgICAgICAgICAgIC8vICAgICAidW5pdCI6ICIvIiwNCiAgICAgICAgICAgIC8vICAgICAibWFpblN0YXR1cyI6ICLlkK/nlKjkuK0iLA0KICAgICAgICAgICAgLy8gICAgICJiaXpUeXBlIjogIuaxoeawtCIsDQogICAgICAgICAgICAvLyAgICAgIm9iamVjdFR5cGUiOiAi5qOA5p+l5LqVIiwNCiAgICAgICAgICAgIC8vICAgICAicmVtYXJrcyI6IG51bGwsDQogICAgICAgICAgICAvLyAgICAgInBvcnRhbElkIjogbnVsbCwNCiAgICAgICAgICAgIC8vICAgICAidGVuYW50SWQiOiAxMDAwMDAsDQogICAgICAgICAgICAvLyAgICAgIm1haW5WYWx1ZSI6ICLlhbPpl60iDQogICAgICAgICAgICAvLyAgIH0sDQogICAgICAgICAgICAvLyAgIHsNCiAgICAgICAgICAgIC8vICAgICAiaWQiOiAiMTY1NTg0MzAwNzc2ODIzNjAzNSIsDQogICAgICAgICAgICAvLyAgICAgImNyZWF0ZUJ5IjogImZhd2tlcyIsDQogICAgICAgICAgICAvLyAgICAgImNyZWF0ZURhdGUiOiAiMjAyMy0wNS0wOSAxNTo1MTo1MSIsDQogICAgICAgICAgICAvLyAgICAgInVwZGF0ZUJ5IjogbnVsbCwNCiAgICAgICAgICAgIC8vICAgICAidXBkYXRlRGF0ZSI6IG51bGwsDQogICAgICAgICAgICAvLyAgICAgImRlbGV0ZUZsYWciOiAwLA0KICAgICAgICAgICAgLy8gICAgICJtYWluUG9pbnQiOiAi5rWL6K+V5piv5ZCm5rWL6K+V5piv5ZCm5rWL6K+V5piv5ZCm5rWL6K+V5piv5ZCmIiwNCiAgICAgICAgICAgIC8vICAgICAiaW5wdXRUeXBlIjogIuaYry/lkKYiLA0KICAgICAgICAgICAgLy8gICAgICJ1bml0IjogIi8iLA0KICAgICAgICAgICAgLy8gICAgICJtYWluU3RhdHVzIjogIuWQr+eUqOS4rSIsDQogICAgICAgICAgICAvLyAgICAgImJpelR5cGUiOiAi5rGh5rC0IiwNCiAgICAgICAgICAgIC8vICAgICAib2JqZWN0VHlwZSI6ICLmo4Dmn6XkupUiLA0KICAgICAgICAgICAgLy8gICAgICJyZW1hcmtzIjogbnVsbCwNCiAgICAgICAgICAgIC8vICAgICAicG9ydGFsSWQiOiBudWxsLA0KICAgICAgICAgICAgLy8gICAgICJ0ZW5hbnRJZCI6IDEwMDAwMCwNCiAgICAgICAgICAgIC8vICAgICAibWFpblZhbHVlIjogIuaYryINCiAgICAgICAgICAgIC8vICAgfSwNCiAgICAgICAgICAgIC8vICAgew0KICAgICAgICAgICAgLy8gICAgICJpZCI6ICIxNjU1ODQzMDA3NzY4MjM2MDM1IiwNCiAgICAgICAgICAgIC8vICAgICAiY3JlYXRlQnkiOiAiZmF3a2VzIiwNCiAgICAgICAgICAgIC8vICAgICAiY3JlYXRlRGF0ZSI6ICIyMDIzLTA1LTA5IDE1OjUxOjUxIiwNCiAgICAgICAgICAgIC8vICAgICAidXBkYXRlQnkiOiBudWxsLA0KICAgICAgICAgICAgLy8gICAgICJ1cGRhdGVEYXRlIjogbnVsbCwNCiAgICAgICAgICAgIC8vICAgICAiZGVsZXRlRmxhZyI6IDAsDQogICAgICAgICAgICAvLyAgICAgIm1haW5Qb2ludCI6ICLmtYvor5XmlbDlgLzmtYvor5XmlbDlgLzmtYvor5XmlbDlgLzmtYvor5XmlbDlgLwiLA0KICAgICAgICAgICAgLy8gICAgICJpbnB1dFR5cGUiOiAi5pWw5YC8IiwNCiAgICAgICAgICAgIC8vICAgICAidW5pdCI6ICIvIiwNCiAgICAgICAgICAgIC8vICAgICAibWFpblN0YXR1cyI6ICLlkK/nlKjkuK0iLA0KICAgICAgICAgICAgLy8gICAgICJiaXpUeXBlIjogIuaxoeawtCIsDQogICAgICAgICAgICAvLyAgICAgIm9iamVjdFR5cGUiOiAi5qOA5p+l5LqVIiwNCiAgICAgICAgICAgIC8vICAgICAicmVtYXJrcyI6IG51bGwsDQogICAgICAgICAgICAvLyAgICAgInBvcnRhbElkIjogbnVsbCwNCiAgICAgICAgICAgIC8vICAgICAidGVuYW50SWQiOiAxMDAwMDAsDQogICAgICAgICAgICAvLyAgICAgIm1haW5WYWx1ZSI6ICIiDQogICAgICAgICAgICAvLyAgIH0NCiAgICAgICAgICAgIC8vIF0NCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCflvZPliY3kuJrliqHlj4rorr7mlr3nsbvlnovkuIvnmoTlt6Hmo4DopoHngrlsaXN0JywgX2Nsb25lRGVlcCh0aGlzLmtleVBvaW50c0luc3BlY3Rpb25MaXN0KSwpOw0KICAgICAgICAgIH0pDQogICAgICAgICAgLmNhdGNoKGVyciA9PiB7IH0pDQogICAgICAgICAgLmZpbmFsbHkoKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5zaWduU2hvdyA9IHRydWUNCiAgICAgICAgICAgIC8vIOacquW3oeajgA0KICAgICAgICAgICAgdGhpcy5oYXNTaWduSW4gPSBmYWxzZQ0KICAgICAgICAgICAgdGhpcy5zaWduRm9ybS5yZW1hcmsgPSAnJw0KICAgICAgICAgICAgdGhpcy5zaWduRm9ybS5saXF1aWRMZXZlbCA9ICcnDQogICAgICAgICAgICB0aGlzLnNpZ25Gb3JtLmV4dDMgPSBmZWF0dXJlLmJpelR5cGUNCiAgICAgICAgICAgIHRoaXMuc2lnbkZvcm0uZGV2aWNlU3RhdHVzID0gJzAnDQogICAgICAgICAgICB0aGlzLnNpZ25Gb3JtLmluc3BJbWFnZXNMaXN0ID0gW10NCiAgICAgICAgICAgIHRoaXMuc2lnbkZvcm0ucG9pbnRJZCA9IGZlYXR1cmUuaWQNCiAgICAgICAgICAgIHRoaXMuc2lnbkZvcm0udGFza0lkID0gdGhpcy4kcm91dGUucXVlcnkudGFza0lkLA0KICAgICAgICAgICAgdGhpcy5zaWduRm9ybS5mZWF0dXJlID0gZmVhdHVyZQ0KICAgICAgICAgIH0pDQogICAgICB9IGVsc2Ugew0KICAgICAgICBsZXQgdG9hc3QgPSBUb2FzdC5sb2FkaW5nKHsNCiAgICAgICAgICBtZXNzYWdlOiAn5q2j5Zyo5Yqg6L29JywNCiAgICAgICAgICBmb3JiaWRDbGljazogdHJ1ZSwNCiAgICAgICAgICBsb2FkaW5nVHlwZTogJ3NwaW5uZXInLA0KICAgICAgICAgIGR1cmF0aW9uOiAwDQogICAgICAgIH0pDQogICAgICAgIHRoaXMuaGFzU2lnbkluID0gdHJ1ZQ0KICAgICAgICBsZXQgcGFyYW1zID0gew0KICAgICAgICAgIHBhZ2U6IDEsDQogICAgICAgICAgc2l6ZTogOTk5LA0KICAgICAgICAgIGRldmljZVN0YXR1czogZmVhdHVyZS5kZXZpY2VTdGF0dXMsDQogICAgICAgICAgcG9pbnRJZDogZmVhdHVyZS5pZCwNCiAgICAgICAgICB0YXNrSWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LnRhc2tJZCwNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KHsNCiAgICAgICAgICB1cmw6ICcveGFzdy1waXBlLW9wZXJhdGlvbi9pbnNwUG9pbnRSZWNvcmQvcGFnZScsDQogICAgICAgICAgbWV0aG9kOiAnZ2V0JywNCiAgICAgICAgICBwYXJhbXM6IHBhcmFtcywNCiAgICAgICAgfSkNCiAgICAgICAgaWYgKHJlcyAmJiByZXMuc3RhdHVzKSB7DQogICAgICAgICAgbGV0IHJlc3VsdCA9IHJlcy5kYXRhLnJlY29yZHNbMF0NCiAgICAgICAgICB0aGlzLnNpZ25Gb3JtLmRldmljZVN0YXR1cyA9IHJlc3VsdC5kZXZpY2VTdGF0dXMNCiAgICAgICAgICB0aGlzLnNpZ25Gb3JtLnJlbWFyayA9IHJlc3VsdC5leHQxDQogICAgICAgICAgdGhpcy5zaWduRm9ybS5saXF1aWRMZXZlbCA9IHJlc3VsdC5saXF1aWRMZXZlbA0KICAgICAgICAgIHRoaXMuc2lnbkZvcm0uaXNSZXBvcnQgPSByZXN1bHQuaXNSZXBvcnQNCiAgICAgICAgICBjb25zdCBhdHQgPSBhd2FpdCByZXF1ZXN0KHsNCiAgICAgICAgICAgIHVybDogJy94YXN3LXBpcGUtb3BlcmF0aW9uL2luc3BQb2ludFJlY29yZCcsDQogICAgICAgICAgICBtZXRob2Q6ICdnZXQnLA0KICAgICAgICAgICAgcGFyYW1zOiB7IGlkOiByZXN1bHQuaWQgfQ0KICAgICAgICAgIH0pDQogICAgICAgICAgaWYgKGF0dCAmJiBhdHQuc3RhdHVzKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygn5bey5beh5qOA5YWz6ZSu54K56K+m5oOF5pWw5o2uJywgX2Nsb25lRGVlcChhdHQpKTsNCiAgICAgICAgICAgIHRoaXMuc2lnbkZvcm0uaW5zcEltYWdlc0xpc3QgPSBhdHQuZGF0YS5pbnNwSW1hZ2VzTGlzdA0KICAgICAgICAgICAgdGhpcy5hdHRhY2htZW50ID0gYXR0LmRhdGEuaW5zcEltYWdlc0xpc3RbMF0uZmlsZUlkDQogICAgICAgICAgICAvLyDlt6Hmo4DopoHngrlsaXN0DQogICAgICAgICAgICB0aGlzLmtleVBvaW50c0luc3BlY3Rpb25MaXN0ID0gYXR0Py5kYXRhPy5yZXN1bHRMaXN0IHx8IFtdDQogICAgICAgICAgfQ0KICAgICAgICAgIHRvYXN0LmNsZWFyKCkNCiAgICAgICAgICB0aGlzLnNpZ25TaG93ID0gdHJ1ZQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICAvLyDmt7Hmi7fotJ0NCiAgICBkZWVwQ2xvbmUoZGF0YSkgew0KICAgICAgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSkpDQogICAgfSwNCiAgICByZXBvcnRFdmVudChmZWF0dXJlKSB7DQogICAgICB0aGlzLnJlcG9ydEZvb3RlclNob3cgPSBmYWxzZQ0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goew0KICAgICAgICBwYXRoOiAnL3BhZ2VzL2luc3BlY3Rpb25NYW5hZ2UvYWRkLWV2ZW50JywNCiAgICAgICAgcXVlcnk6IHsNCiAgICAgICAgICB0YXNrSWQ6IHRoaXMudGFza0RldGFpbC50YXNrSWQsDQogICAgICAgICAgZmVhdHVyZTogZmVhdHVyZSwNCiAgICAgICAgICByYW5nZUxpc3Q6IHRoaXMucmFuZ2VMaXN0LA0KICAgICAgICAgIHRhc2tEZXRhaWw6IHRoaXMudGFza0RldGFpbCwNCiAgICAgICAgfSwNCiAgICAgIH0pDQogICAgfSwNCiAgICBHZXREaXN0YW5jZShjb29yZEFycmF5MSwgY29vcmRBcnJheTIpIHsNCiAgICAgIGxldCBsbmcxID0gY29vcmRBcnJheTFbMF0NCiAgICAgIGxldCBsYXQxID0gY29vcmRBcnJheTFbMV0NCiAgICAgIGxldCBsbmcyID0gY29vcmRBcnJheTJbMF0NCiAgICAgIGxldCBsYXQyID0gY29vcmRBcnJheTJbMV0NCiAgICAgIGxldCByYWRMYXQxID0gKGxhdDEgKiBNYXRoLlBJKSAvIDE4MC4wDQogICAgICBsZXQgcmFkTGF0MiA9IChsYXQyICogTWF0aC5QSSkgLyAxODAuMA0KICAgICAgbGV0IGEgPSByYWRMYXQxIC0gcmFkTGF0Mg0KICAgICAgbGV0IGIgPSAobG5nMSAqIE1hdGguUEkpIC8gMTgwLjAgLSAobG5nMiAqIE1hdGguUEkpIC8gMTgwLjANCiAgICAgIGxldCBzID0NCiAgICAgICAgMiAqDQogICAgICAgIE1hdGguYXNpbigNCiAgICAgICAgICBNYXRoLnNxcnQoDQogICAgICAgICAgICBNYXRoLnBvdyhNYXRoLnNpbihhIC8gMiksIDIpICsNCiAgICAgICAgICAgIE1hdGguY29zKHJhZExhdDEpICogTWF0aC5jb3MocmFkTGF0MikgKiBNYXRoLnBvdyhNYXRoLnNpbihiIC8gMiksIDIpDQogICAgICAgICAgKQ0KICAgICAgICApDQogICAgICBzID0gcyAqIDYzNzguMTM3IC8vIEVBUlRIX1JBRElVUzsNCiAgICAgIHMgPSBNYXRoLnJvdW5kKHMgKiAxMDAwMCkgLyAxMDAwMA0KICAgICAgcmV0dXJuIHMNCiAgICB9LA0KICAgIHJlc2V0TWFwVmlldygpIHsNCiAgICAgIHRoaXMuJHJlZnMubXltYXAgJiYgbWFwT2JqLm1hcC5yZXNldE5vcnRoUGl0Y2goKQ0KICAgIH0NCiAgfSwNCiAgYmVmb3JlRGVzdHJveSgpIHsNCiAgICBUb2FzdC5jbGVhcigpDQogICAgdGhpcy5wb2xsaW5nRmxhZyA9IGZhbHNlDQogICAgdGhpcy5jbGVhckJ1ZmZlclRyYWNrKCkNCiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJwYXVzZSIsIHRoaXMucGF1c2UpDQogICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzdW1lIiwgdGhpcy5yZXN1bWUpDQogICAgaWYgKHR5cGVvZiB5dWFuY2h1ICE9ICd1bmRlZmluZWQnKSB7DQogICAgICB5dWFuY2h1LmxvY2F0aW9uQU1hcC5zdG9wUmVxdWVzdExvY2F0aW9ucygpDQogICAgfQ0KICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdzdGFydFJlY29yZExpbmVzJykNCiAgICBidXMuJG9mZignc3RhcnRTaWduSW4nKQ0KICB9DQp9DQo="},{"version":3,"sources":["daily-task.vue"],"names":[],"mappings":";AAgTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"daily-task.vue","sourceRoot":"src/views/inspectionManage","sourcesContent":["<template>\r\n  <div class=\"task-map full-width\">\r\n    <!-- 导航栏 -->\r\n    <div class=\"navbar-box\">\r\n      <fm-nav-bar :title=\"navbarTitle\" left-arrow @click-left=\"clickBack\" @click-right=\"openPopup\">\r\n        <template #right>\r\n          <fm-popover :visible.sync=\"showPopover\" trigger=\"click\" :actions=\"actions\" @select=\"onSelect\"\r\n            placement=\"bottom-end\">\r\n            <template #reference>\r\n              <img style=\"width: 34px\" v-if=\"!isView\" :src=\"require('@/assets/img/inspection/增加.png')\" />\r\n            </template>\r\n          </fm-popover>\r\n        </template>\r\n      </fm-nav-bar>\r\n    </div>\r\n    <!-- 地图 -->\r\n    <MapComp ref=\"mymap\" :ifInspection=\"true\" @mapLoaded=\"mapLoaded\" :legendConfig=\"legendConfig\"></MapComp>\r\n    <!-- <fm-popup\r\n      :visible.sync=\"pointListShow\"\r\n      close-on-click-modal\r\n      :close-on-popstate=\"true\"\r\n      position=\"bottom\"\r\n      safe-area-inset-bottom\r\n    >\r\n      <fm-tabs type=\"card\" style=\"padding-top: 20px\">\r\n        <fm-tab label=\"未上报关键点\">\r\n          <fm-empty v-if=\"keyDetailList.length <= 0\" description=\"暂无数据\" mode=\"list\"></fm-empty>\r\n        </fm-tab>\r\n        <fm-tab label=\"已上报关键点\">\r\n          <fm-empty v-if=\"keyDetailList.length <= 0\" description=\"暂无数据\" mode=\"list\"></fm-empty>\r\n        </fm-tab>\r\n      </fm-tabs>\r\n    </fm-popup> -->\r\n    <!-- 开始记录与结束记录 -->\r\n    <div class=\"start-record\" v-show=\"!isView\">\r\n      <img v-if=\"!ifRecording\" :src=\"require('@/assets/img/inspection/暂停.png')\" @click=\"startInspRecord\" />\r\n      <img v-else :src=\"require('@/assets/img/inspection/开始.png')\" @click=\"endRecord('pause')\" />\r\n    </div>\r\n    <!-- 数据面板 -->\r\n    <div class=\"controlCard\" v-show=\"!isView\">\r\n      <div class=\"controlContent\">\r\n        <div class=\"infoContent\">\r\n          <div class=\"endControl\">\r\n            <div class=\"leftText\">\r\n              <img :src=\"require('@/assets/img/inspection/剩余时间.png')\" />\r\n              <fm-count-down style=\"margin: auto\" :time=\"getRestTime(taskDetail.taskEndTime)\" format=\"DD天HH小时\" />\r\n            </div>\r\n            <div class=\"rightButton\">\r\n              <fm-button v-show=\"ifRecording\" class=\"endBtn\" round @click=\"endTask\">结束</fm-button>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"bottomSide\">\r\n            <div class=\"block\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ changeToRate(taskDetail.coverage) }}\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">覆盖率</div>\r\n            </div>\r\n\r\n            <div class=\"block\" @click=\"openKeyPointList\" style=\"cursor: pointer;\">\r\n              <div class=\"rate\">\r\n                <div class=\"centerStyle\">\r\n                  <div class=\"inspKp\" style=\"font-size: 19px\">\r\n                    {{ changeToInspCount(taskDetail.reportRate) }}\r\n                  </div>\r\n                  <div class=\"uninspKp\" style=\"font-size: 14px\">\r\n                    /{{ changeToAllInspCount(taskDetail.reportRate) }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">关键点</div>\r\n            </div>\r\n\r\n            <div class=\"block\" @click=\"reportClick\" style=\"cursor: pointer;\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ problemDataList1.length + problemDataList2.length }}\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">上报</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"viewCard\" v-show=\"isView\">\r\n      <div class=\"controlContent\">\r\n        <div class=\"infoContent\">\r\n          <div class=\"bottomSide\">\r\n            <div class=\"block\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ changeToRate(taskDetail.coverage) }}\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">覆盖率</div>\r\n            </div>\r\n\r\n            <div class=\"block\" @click=\"openKeyPointList\" style=\"cursor: pointer;\">\r\n              <div class=\"rate\">\r\n                <div class=\"centerStyle\">\r\n                  <div class=\"inspKp\" style=\"font-size: 19px\">\r\n                    {{ changeToInspCount(taskDetail.reportRate) }}\r\n                  </div>\r\n                  <div class=\"uninspKp\" style=\"font-size: 14px\">\r\n                    /{{ changeToAllInspCount(taskDetail.reportRate) }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">关键点</div>\r\n            </div>\r\n\r\n            <div class=\"block\" @click=\"reportClick\" style=\"cursor: pointer;\">\r\n              <div class=\"rate\" style=\"font-size: 18px\">\r\n                <div class=\"centerStyle\">\r\n                  {{ problemDataList1.length + problemDataList2.length }}\r\n                </div>\r\n              </div>\r\n              <div class=\"name\" style=\"font-size: 14px\">上报</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- 轨迹显示与定位功能 -->\r\n    <div class=\"tool-box\">\r\n      <div class=\"location\" @click=\"startLocation\">\r\n        <fm-image class=\"location-image\" :src=\"require('@/assets/img/inspection/location.png')\"></fm-image>\r\n      </div>\r\n    </div>\r\n    <!-- 签到框 -->\r\n    <fm-popup :visible.sync=\"signShow\" :modal=\"false\" round position=\"bottom\"\r\n      :style=\"{ height: signForm.deviceStatus == '1' ? '60%' : '50%' }\">\r\n      <div class=\"popup-view\">\r\n        <fm-form ref=\"signForm\">\r\n          <div class=\"title\">\r\n            <img :src=\"require('@/assets/img/inspection/sideIcon.png')\" />\r\n            <div class=\"deviceId\">{{ deviceName }}</div>\r\n          </div>\r\n          <fm-field :name=\"signForm.deviceStatus\" error label=\"运行情况\" required>\r\n            <template #input>\r\n              <fm-radio-group v-model=\"signForm.deviceStatus\" :disabled=\"hasSignIn\" direction=\"horizontal\">\r\n                <fm-radio name=\"0\">正常</fm-radio>\r\n                <fm-radio name=\"1\">异常</fm-radio>\r\n              </fm-radio-group>\r\n            </template>\r\n          </fm-field>\r\n          <fm-field v-if=\"signForm.deviceStatus == '1'\" :disabled=\"hasSignIn\" label=\"是否上报\" required>\r\n          </fm-field>\r\n          <fm-field :name=\"signForm.isReport\" v-if=\"signForm.deviceStatus == '1'\">\r\n            <template #input>\r\n              <fm-radio-group v-model=\"signForm.isReport\" :disabled=\"hasSignIn\" direction=\"horizontal\">\r\n                <fm-radio v-for=\"(item, index) in reportChose\" :key=\"index\" :name=\"item.value\">{{ item.name }}\r\n                </fm-radio>\r\n              </fm-radio-group>\r\n            </template>\r\n          </fm-field>\r\n\r\n          <!--\r\n            { value: \"正常/异常\", label: \"正常/异常\" },\r\n            { value: \"开启/关闭\", label: \"开启/关闭\" },\r\n            { value: \"是/否\", label: \"是/否\" },\r\n            { value: \"数值\", label: \"数值\" },\r\n          -->\r\n          <!-- 巡检要点list，已巡检和未巡检要点从不同接口中获取 -->\r\n          <fm-field v-for=\"(item, index) in keyPointsInspectionList\" :key=\"item.id\" :label=\"item.mainPoint\" required>\r\n            <template #input>\r\n              <fm-radio-group v-if=\"item.inputType == '正常/异常' || item.ext1 == '正常/异常'\" v-model=\"item.mainValue\" :disabled=\"hasSignIn\">\r\n                <fm-radio name=\"正常\">正常</fm-radio>\r\n                <fm-radio name=\"异常\">异常</fm-radio>\r\n              </fm-radio-group>\r\n              <fm-radio-group v-if=\"item.inputType == '开启/关闭' || item.ext1 == '开启/关闭'\" v-model=\"item.mainValue\" :disabled=\"hasSignIn\">\r\n                <fm-radio name=\"开启\">开启</fm-radio>\r\n                <fm-radio name=\"关闭\">关闭</fm-radio>\r\n              </fm-radio-group>\r\n              <fm-radio-group v-if=\"item.inputType == '是/否' || item.ext1 == '是/否'\" v-model=\"item.mainValue\" :disabled=\"hasSignIn\">\r\n                <fm-radio name=\"是\">是</fm-radio>\r\n                <fm-radio name=\"否\">否</fm-radio>\r\n              </fm-radio-group>\r\n              <fm-field v-if=\"item.inputType == '数值' || item.ext1 == '数值'\" type=\"number\" v-model=\"item.mainValue\" :disabled=\"hasSignIn\" />\r\n            </template>\r\n          </fm-field>\r\n\r\n          <uploader v-model=\"attachment\" @fileChange=\"fileChange\" multiple :maxImagesCount=\"2\" :deletable=\"!hasSignIn\" :disabled=\"hasSignIn\"\r\n            type=\"image\" />\r\n          <fm-field v-if=\"waterLevelShow\" label=\"液位（米）\" type=\"number\" required name=\"liquidLevel\" placehold=\"请输入液位\" :disabled=\"hasSignIn\"\r\n            v-model=\"signForm.liquidLevel\">\r\n          </fm-field>\r\n          <fm-field label=\"备注\" name=\"remark\" type=\"textarea\" placehold=\"请输入\" :disabled=\"hasSignIn\"\r\n            v-model=\"signForm.remark\">\r\n          </fm-field>\r\n        </fm-form>\r\n      </div>\r\n      <div class=\"btnArea\" v-show=\"!hasSignIn\">\r\n        <fm-button class=\"btn1\" @click=\"onCancel\" round type=\"default\">取消</fm-button>\r\n        <fm-button class=\"btn2\" @click=\"onConfirm\" round type=\"primary\">提交</fm-button>\r\n      </div>\r\n      <div class=\"btnArea\" v-show=\"hasSignIn\">\r\n        <fm-button class=\"btn\" @click=\"onCancel\" round type=\"default\">关闭</fm-button>\r\n      </div>\r\n    </fm-popup>\r\n    <fm-popup :visible.sync=\"reportShow\" @close=\"handleClose\" round position=\"bottom\"\r\n      :overlay-style=\"{ background: 'rgba(0, 0, 0, 0.1)' }\" :style=\"{ height: '50%' }\">\r\n      <fm-tabs v-model=\"active\" swipeable style=\"height: 100%\">\r\n        <fm-tab label=\"问题上报\">\r\n          <div v-for=\"(item, index) in problemDataList1\" :key=\"index\">\r\n            <problemCardInfo type=\"001\" :cardInfo=\"item\" @toDetailPanel=\"toDetailPanel\" @flyToPoint=\"flyToPoint\">\r\n            </problemCardInfo>\r\n          </div>\r\n        </fm-tab>\r\n        <fm-tab label=\"设施缺陷\">\r\n          <div v-for=\"(item, index) in problemDataList2\" :key=\"index\">\r\n            <problemCardInfo type=\"002\" :cardInfo=\"item\" @toDetailPanel=\"toDetailPanel\" @flyToPoint=\"flyToPoint\">\r\n            </problemCardInfo>\r\n          </div>\r\n        </fm-tab>\r\n      </fm-tabs>\r\n    </fm-popup>\r\n\r\n    <!-- 提示层 -->\r\n    <div v-show=\"ifTips\" class=\"tip-tools\">\r\n      <img :src=\"require('@/assets/img/tips.png')\" class=\"tipImg\" />\r\n      <div class=\"context\">请在地图上选择设施或者点位</div>\r\n    </div>\r\n    <fm-overlay :show=\"ifEndTask\" z-index=\"10\">\r\n      <div class=\"confirm-tip\">\r\n        <div class=\"contentSelf\">\r\n          <div class=\"icon\">\r\n            <img :src=\"require('@/assets/img/inspection/终止.png')\" width=\"60\" style=\"margin: auto\" />\r\n          </div>\r\n          <div class=\"info\">\r\n            <span>{{ `您还有${changeToAllInspCount(taskDetail.reportRate) - changeToInspCount(taskDetail.reportRate)}个关键点未打卡，确定提前中止巡检任务？` }}</span>\r\n          </div>\r\n          <div class=\"input\">\r\n            <fm-field v-model=\"stopReason\" placeholder=\"请输入终止原因\" rows=\"3\" autosize type=\"textarea\" maxlength=\"200\" show-word-limit></fm-field>\r\n          </div>\r\n        </div>\r\n        <div class=\"confirm_btn\">\r\n          <div class=\"btn1 btn2\" @click=\"continueTask\">继续任务</div>\r\n          <div class=\"btn1\" @click=\"stopTask\">中止任务</div>\r\n        </div>\r\n      </div>\r\n    </fm-overlay>\r\n    <fm-overlay :show=\"ifLeaveTask\" z-index=\"10\">\r\n      <div class=\"confirm-tip\">\r\n        <div class=\"contentSelf\">\r\n          <div class=\"icon\">\r\n            <img :src=\"require('@/assets/img/inspection/终止.png')\" width=\"60\" style=\"margin: auto\" />\r\n          </div>\r\n          <div class=\"info\">\r\n            <span>{{ '当前为巡检状态，继续退出会暂停巡检，请确定是否退出?' }}</span>\r\n          </div>\r\n        </div>\r\n        <div class=\"confirm_btn\">\r\n          <div class=\"btn1 btn2\" @click=\"cancelLeave\">取消</div>\r\n          <div class=\"btn1\" @click=\"confirmLeave\">退出</div>\r\n        </div>\r\n      </div>\r\n    </fm-overlay>\r\n    <!-- 关键点列表 -->\r\n    <div class=\"content\" :class=\"showKeyList ? '' : 'inactive'\">\r\n      <div class=\"contentArea\">\r\n        <div style=\"overflow-x: scroll; height: 74px;\">\r\n          <div class=\"buttonArea\" :style=\"buttonAreaStyle\">\r\n            <fm-button\r\n              round\r\n              v-for=\"it of buttonList\"\r\n              :key=\"it\"\r\n              class=\"button\"\r\n              :style=\"currentSelect == it ? { 'color': '#1B67D8', 'background': '#DDE8F9' } : {}\"\r\n              @click=\"changeBizType(it)\"\r\n            >{{ it }}</fm-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"listArea\">\r\n          <fm-list\r\n            v-model=\"loading\"\r\n            :finished=\"finished\"\r\n            finished-text=\"到底了\"\r\n          >\r\n            <div v-for=\"(it, idx) of unInspKeyDetailList\" :key=\"it.id\" class=\"list\">\r\n              <div class=\"list_num\">{{ idx + 1 }}</div>\r\n              <div class=\"list_type\">{{ it.deviceType || '' }}</div>\r\n              <div class=\"list_id\">{{ it.deviceId || '' }}</div>\r\n              <div class=\"list_deal\" @click=\"goToDeal(it)\">\r\n                定位\r\n                <img\r\n                  width=\"24\"\r\n                  height=\"24\"\r\n                  style=\"margin: auto 0 auto 4px;\"\r\n                  :src=\"require('@/assets/img/maintenance/deal.png')\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </fm-list>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport bus from '../../views/inspectMap/utils/Bus.js'\r\nimport axios from 'axios'\r\nimport dayjs from 'dayjs'\r\nimport MapComp from '../../views/inspectMap/index.vue'\r\nimport request from '@/utils/request'\r\nimport * as api from './api'\r\nimport { Toast, Dialog, Notify } from 'fawkes-mobile-lib'\r\nimport * as turf from '@turf/turf'\r\nimport Uploader from '@/components/upload/Uploader.vue'\r\nimport problemCardInfo from './problemCardInfo';\r\nimport API from \"@/common/config.js\";\r\nimport _cloneDeep from 'lodash/cloneDeep'\r\nconst mapObj = {\r\n  map: null,\r\n  mapInstance: null,\r\n}\r\nlet pauseStateTrackPoints = []\r\nlet pauseStatePipeIdList = []\r\nexport default {\r\n  name: 'daily-task',\r\n  components: {\r\n    MapComp,\r\n    Uploader,\r\n    problemCardInfo\r\n  },\r\n  data() {\r\n    return {\r\n      showKeyList: false,\r\n      buttonList: [],\r\n      unInspKeyDetailList: [],\r\n      loading: false,\r\n      finished: true,\r\n      currentSelect: '全部',\r\n      isResume: true,\r\n      ifLeaveTask: false,\r\n      stopReason: '',\r\n      ifEndTask: false,\r\n      legendConfig: [],\r\n      ifTips: false,\r\n      reportDataIsLoaded: false,\r\n      // 巡检任务下所有巡检管线\r\n      allTaskLines: [],\r\n      isView: true,\r\n      active: 0,\r\n      deviceName: '',\r\n      hasSignIn: false,\r\n      showPopover: false,\r\n      actions: [\r\n        {\r\n          text: '问题上报',\r\n        },\r\n        {\r\n          text: '设施缺陷',\r\n        },\r\n      ],\r\n      currentRate: 0,\r\n      // 控制关键点列表显隐\r\n      pointListShow: false,\r\n      // 全局发声函数\r\n      // 记录开始巡检的时间，用于判断是否在开始巡检的10s内\r\n      startRecordTimer: '',\r\n      navbarTitle: '日常任务',\r\n      // 上报失败的巡检轨迹点位数组\r\n      reportFailTrackPoints: [],\r\n      isShowRoute: true,\r\n      inspBusinessType: '',\r\n      recordData: [],\r\n      // 当前巡检员所处位置\r\n      currentPosition: null,\r\n      lines: [],\r\n      // 巡检员信息\r\n      userInfo: {},\r\n      ifRecording: false,\r\n      selectEventType: false,\r\n      eventTypeList: [],\r\n      signShow: false,\r\n      attachment: '',\r\n      signForm: {\r\n        deviceStatus: '1',\r\n        inspImagesList: [],\r\n        remark: '',\r\n        isReport: '',\r\n        taskId: '',\r\n        pointId: '',\r\n        liquidLevel: '',\r\n      },\r\n      taskDetail: {\r\n        coverage: '0/0',\r\n        reportRate: '0/0',\r\n        planEndTime: '',\r\n      },\r\n      engInfoDTO: {},\r\n      taskRestTime: 0,\r\n      reportFooterShow: false,\r\n      feature: {},\r\n      planDetail: {},\r\n      // 用于地图中显示范围和关键点\r\n      inspRangeList: [],\r\n      rangeList: [],\r\n      keyDetailList: [],\r\n      isRunList: [\r\n        {\r\n          name: '正常',\r\n          value: '1',\r\n        },\r\n        {\r\n          name: '异常',\r\n          value: '0',\r\n        },\r\n      ],\r\n      reportChose: [\r\n        {\r\n          name: '问题上报',\r\n          value: '问题上报',\r\n        },\r\n        {\r\n          name: '新增缺陷',\r\n          value: '新增缺陷',\r\n        },\r\n        {\r\n          name: '无需上报',\r\n          value: '无需上报',\r\n        },\r\n      ],\r\n      rules: {\r\n      },\r\n      previewURL: '/sys-storage/download_image?f8s=',\r\n      upimgPreview: [],\r\n      headers: {},\r\n      url: {\r\n        // 本页面使用到的url\r\n        uploadFile: 'sys-storage/upload',\r\n        findFile: 'ecidi-cmp/file/cmpFileGroup/findFilesByGroupId',\r\n      },\r\n      pollingFlag: false,\r\n      pollingGapTime: 3,\r\n      trackPointList: [],\r\n      trackPointTimeList: [],\r\n      overSpeedTrackLineList: [],\r\n      trackLocation_start: '',\r\n      trackLocation_end: '',\r\n      showVisible: false,\r\n      reportShow: false, // 问题上报面板显示\r\n      accessToken: this.$storage.get('access_token'),\r\n      header: {},\r\n      formToken: '',\r\n      // 问题上报list\r\n      problemDataList1: [],\r\n      // 设施缺陷list\r\n      problemDataList2: [],\r\n      // 液位输入框是否显示\r\n      waterLevelShow: false,\r\n      // 巡检要点list数据\r\n      keyPointsInspectionList: [],\r\n    }\r\n  },\r\n  computed: {\r\n    buttonAreaStyle() {\r\n      return {\r\n        '--width': this.buttonList.length * (80 + 10) + 'px',\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    // 获取问题上报和设施缺陷数据\r\n    this.getCardListData()\r\n  },\r\n  mounted() {\r\n    document.addEventListener(\"pause\", this.pause, false)\r\n    document.addEventListener(\"resume\", this.resume, false)\r\n    this.userInfo = this.$store.state.userInfo\r\n    console.log('this.userInfo: ', this.userInfo);\r\n    this.isStart = false\r\n    localStorage.setItem('startRecordLines', 'end')\r\n    this.navbarTitle = '日常任务'\r\n    let that = this\r\n    bus.$off('startSignIn').$on('startSignIn', (feature) => {\r\n      that.startSignIn(feature)\r\n    })\r\n    this.isView = this.$route.query.isView\r\n    const id = this.$route.query.taskId\r\n    this.getTaskById(id)\r\n    this.getTrackRecordsById(id)\r\n  },\r\n  methods: {\r\n    openKeyPointList() {\r\n      this.showKeyList = true\r\n    },\r\n    goToDeal(obj) {\r\n      if (obj.startLongitude && obj.startLatitude) {\r\n        this.flyToPoint([obj.startLongitude, obj.startLatitude])\r\n      } else {\r\n        Toast.warning({\r\n          message: '当前设施无地理坐标信息',\r\n          duration: 2000\r\n        })\r\n        return\r\n      }\r\n    },\r\n    changeBizType(type) {\r\n      this.currentSelect = type\r\n      this.unInspKeyDetailList = []\r\n      if (type == '全部') {\r\n        this.unInspKeyDetailList = this.keyDetailList.filter(it => !it.deviceStatus)\r\n      } else {\r\n        this.unInspKeyDetailList = this.keyDetailList.filter(it => !it.deviceStatus && it.bizType == type)\r\n      }\r\n    },\r\n    // 获取问题上报和设施缺陷数据\r\n    getCardListData() {\r\n      // 获取header，查询工单用\r\n      axios({\r\n        url: process.env.VUE_APP_THIRD_REQUEST_URL + '/main/userCenterApi/sso/tokenByToken',\r\n        method: 'post',\r\n        params: {\r\n          token: this.accessToken,\r\n        },\r\n        headers: {\r\n          Authorization: 'Basic b3V0d29yazp3cGcyMDIw',\r\n        },\r\n      }).then((res) => {\r\n        if (res.status == 200) {\r\n          this.formToken = res.data.resultData.token\r\n          this.header = {\r\n            'Content-Type': 'application/json',\r\n            Authorization: 'Bearer ' + this.formToken,\r\n          }\r\n        }\r\n      })\r\n    },\r\n    async getProblemDataList(params) {\r\n      this.problemDataList1 = []\r\n      this.problemDataList2 = []\r\n\r\n      let commonParams = Object.assign({\r\n        sysCode: 'outwork',\r\n        // token: this.accessToken,\r\n        page: {\r\n          current: 1,\r\n          size: 99999, // 查全部\r\n        }\r\n      }, params)\r\n      // 问题上报\r\n      let params1 = {\r\n        ...commonParams,\r\n        smallType: 'abnormal_inform'\r\n      }\r\n      // 设施缺陷\r\n      let params2 = {\r\n        ...commonParams,\r\n        smallType: 'defect'\r\n      }\r\n      let problemPointFeatures = []\r\n      // 问题上报\r\n      await this.getAxiosData(params1, this.problemDataList1)\r\n      // 设施缺陷\r\n      await this.getAxiosData(params2, this.problemDataList2)\r\n      let allProblem = this.problemDataList1.concat(this.problemDataList2)\r\n      allProblem.forEach(it => {\r\n        problemPointFeatures.push({\r\n          type: 'Feature',\r\n          geometry: {\r\n            type: 'Point',\r\n            coordinates: it.lnglat\r\n          },\r\n          properties: {\r\n            id: it.id,\r\n            title: it.title\r\n          }\r\n        })\r\n      })\r\n      this.$refs.mymap.addInspEventLayer(problemPointFeatures)\r\n      this.reportDataIsLoaded = true\r\n    },\r\n    getAxiosData(params, problemDataList) {\r\n      return new Promise((resolve, reject) => {\r\n        axios({\r\n          url: process.env.VUE_APP_THIRD_REQUEST_URL + '/main/outworkapi/ticketStatisticClient/getTicketList',\r\n          method: 'post',\r\n          data: params,\r\n          headers: this.header,\r\n        }).then((res) => {\r\n          if (res.status == 200) {\r\n            res.data.resultData.records.forEach((item) => {\r\n              console.log('item: ', item);\r\n              problemDataList.push({\r\n                id: item.id, // 工单ID\r\n                title: item.title, // 工单标题\r\n                ticketStatusName: item.ticketStatusName,\r\n                handleType: item.formValue.handleType, // 描述\r\n                createByName: item.createByName, // 创建人\r\n                createTime: item.createTime.substring(0, 10), // 创建时间\r\n                defectFrom: item.formValue.defectFrom,\r\n                faultTypes: item.formValue.detail?.defectType || item.formValue.faultTypes,\r\n                // fileUrl: item.formValue?.handleImgs?.[0]?.fileUrl,\r\n                // 图片地址\r\n                url: item.formValue?.files?.[0]?.url,\r\n                // 发生经纬度\r\n                lnglat: [item.appealLng, item.appealLat] || [item.formValue.deviceDetail.longitude, item.formValue.deviceDetail.latitude],\r\n                // deviceType: item.formValue?.deviceType || [],\r\n                deviceType: item.formValue?.deviceType || item.formValue?.device_type || [],\r\n                questionDescribe: item.formValue.questionDescribe,\r\n              })\r\n            })\r\n            resolve()\r\n          }\r\n          // problemDataList.forEach((item) => {\r\n          //   // console.log('图片地址', item.url)\r\n          // })\r\n        })\r\n      })\r\n    },\r\n    // 问题上报点击标题、设施缺陷点击卡片进入详情页  \r\n    toDetailPanel(cardDetail) {\r\n      this.$router.push({\r\n        name: 'detailProblemOrder',\r\n        query: { id: cardDetail.id }\r\n      })\r\n    },\r\n    // 卡片定位\r\n    flyToPoint(lnglat) {\r\n      mapObj.map.flyTo({ center: lnglat, zoom: 17.5 })\r\n    },\r\n    // 上报\r\n    reportClick() {\r\n      if (this.reportDataIsLoaded) {\r\n        this.reportShow = true\r\n        mapObj.map.setLayoutProperty('eventPointsLayer', 'visibility', 'visible')\r\n      } else {\r\n        Toast.loading({\r\n          message: '上报数据加载中。。。',\r\n          loadingType: 'spinner',\r\n          duration: 1500\r\n        })\r\n        return\r\n      }\r\n    },\r\n    handleClose() {\r\n      mapObj.map.setLayoutProperty('eventPointsLayer', 'visibility', 'none')\r\n    },\r\n    fileChange(file) {\r\n      this.signForm.inspImagesList = []\r\n      if (file.fileList.length == 0) {\r\n        this.attachment = ''\r\n      }\r\n      file.fileList.forEach(it => {\r\n        this.signForm.inspImagesList.push(\r\n          {\r\n            fileId: it.response.groupToken,\r\n            imagesName: it.url\r\n          }\r\n        )\r\n      })\r\n      console.log(this.signForm)\r\n    },\r\n    continueTask() {\r\n      this.stopReason = ''\r\n      this.ifEndTask = false\r\n    },\r\n    stopTask() {\r\n      if (this.stopReason == '') {\r\n        Toast.warning({\r\n          message: '请输入终止原因',\r\n          duration: 1500\r\n        })\r\n        return\r\n      }\r\n      this.ifEndTask = false\r\n      this.endRecordConfirm('end')\r\n    },\r\n    async endTask() {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '该巡检任务已结束',\r\n          duration: 1500\r\n        })\r\n        return\r\n      }\r\n      // bus.$off('updateData')\r\n      await this.getTaskById(this.$route.query.taskId)\r\n      let hasInspKp = this.changeToInspCount(this.taskDetail.reportRate)\r\n      let allInspKp = this.changeToAllInspCount(this.taskDetail.reportRate)\r\n      if ((allInspKp - hasInspKp == 0) && this.changeToRate(this.taskDetail.coverage) == '100%') {\r\n        this.endRecordConfirm('end')\r\n      } else {\r\n        this.ifEndTask = true\r\n      }\r\n    },\r\n    openPopup() {\r\n      if (this.isView) {\r\n        return\r\n      }\r\n      this.showPopover = true\r\n    },\r\n    onSelect(val) {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '该巡检任务已结束',\r\n          duration: '1500'\r\n        })\r\n        return\r\n      }\r\n      this.ifTips = true\r\n      mapObj.map.off('click', 'keypointsLayer', this.$refs.mymap.signInBuffer)\r\n      val.text == '问题上报' ? mapObj.map.on('click', this.selectReportPoint) : mapObj.map.on('click', this.selectFlawPoint)\r\n    },\r\n    selectReportPoint(e) {\r\n      let features = mapObj.map.queryRenderedFeatures(e.point)\r\n      if (this.ifTips) {\r\n        this.ifTips = false\r\n      }\r\n      if (features.length > 0) {\r\n        if (\r\n          features[0].source != \"inspUser\"\r\n          // && features[0].source != \"initInspLineSource\" \r\n          && features[0].source != \"keypoints\"\r\n          && (features[0].geometry.type === \"Point\")\r\n        ) {\r\n          this.$refs.mymap.addEventObjMarker(features[0], 'device', 'event', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName, gridManager: { fullName: this.planDetail.gridManager, username: this.planDetail.userName, userId: this.planDetail.userId } });\r\n        } else if (features.length > 1\r\n          && features[1].source != \"eventPoints\"\r\n          && features[1].source != \"inspUser\"\r\n          && features[1].source != \"keypoints\"\r\n          && (features[1].geometry.type === \"Point\")\r\n        ) {\r\n          this.$refs.mymap.addEventObjMarker(features[1], 'device', 'event', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName, gridManager: { fullName: this.planDetail.gridManager, username: this.planDetail.userName, userId: this.planDetail.userId } });\r\n        }\r\n      } else {\r\n        this.$refs.mymap.addEventObjMarker(e.lngLat, 'lnglat', 'event', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName, gridManager: { fullName: this.planDetail.gridManager, username: this.planDetail.userName, userId: this.planDetail.userId } });\r\n      }\r\n      mapObj.map.on('click', 'keypointsLayer', this.$refs.mymap.signInBuffer)\r\n      mapObj.map.off('click', this.selectReportPoint)\r\n    },\r\n    selectFlawPoint(e) {\r\n      let features = mapObj.map.queryRenderedFeatures(e.point)\r\n      if (this.ifTips) {\r\n        this.ifTips = false\r\n      }\r\n      if (features.length > 0) {\r\n        if (\r\n          features[0].source != \"eventPoints\"\r\n          && features[0].source != \"inspUser\"\r\n          // && features[0].source != \"initInspLineSource\" \r\n          && features[0].source != \"keypoints\"\r\n          && (features[0].geometry.type === \"Point\")\r\n        ) {\r\n          this.$refs.mymap.addEventObjMarker(features[0], 'device', 'flaw', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName });\r\n        } else if (features.length > 1\r\n          && features[1].source != \"eventPoints\"\r\n          && features[1].source != \"inspUser\"\r\n          && features[1].source != \"keypoints\"\r\n          && (features[1].geometry.type === \"Point\")\r\n        ) {\r\n          this.$refs.mymap.addEventObjMarker(features[1], 'device', 'flaw', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName });\r\n        }\r\n      } else {\r\n        this.$refs.mymap.addEventObjMarker(e.lngLat, 'lnglat', 'flaw', { gridId: this.planDetail.gridId, gridName: this.planDetail.gridName });\r\n      }\r\n      mapObj.map.on('click', 'keypointsLayer', this.$refs.mymap.signInBuffer)\r\n      mapObj.map.off('click', this.selectFlawPoint)\r\n    },\r\n    getRestTime(time) {\r\n      return time ? new Date(time).getTime() - new Date().getTime() : 0\r\n    },\r\n    changeToInspCount(reportRate) {\r\n      if (reportRate.includes('/')) {\r\n        return Number(reportRate.split('/')[0])\r\n      } else {\r\n        return 0\r\n      }\r\n    },\r\n    changeToAllInspCount(reportRate) {\r\n      if (reportRate.includes('/')) {\r\n        return Number(reportRate.split('/')[1])\r\n      } else {\r\n        return 0\r\n      }\r\n    },\r\n    changeToRate(coverage) {\r\n      if (coverage.includes('/')) {\r\n        let insp = Number(coverage.split('/')[0])\r\n        let uninsp = Number(coverage.split('/')[1])\r\n        if (uninsp) {\r\n          return ((insp / uninsp) * 100).toFixed(2) + '%'\r\n        } else {\r\n          return '0%'\r\n        }\r\n      } else {\r\n        return '0%'\r\n      }\r\n    },\r\n    mapLoaded(mapInstance) {\r\n      console.log('mapLoadedddddddd')\r\n      let that = this\r\n      mapObj.mapInstance = mapInstance\r\n      mapObj.map = mapInstance.map\r\n      // 巡检模拟\r\n      // mapObj.map.on('click', e => {\r\n      //   if (that.trackPointList.length == 0) {\r\n      //     that.trackPointList.push([e.lngLat.lng, e.lngLat.lat])\r\n      //   } else {\r\n      //     that.drawInspLine({ longitude: e.lngLat.lng, latitude: e.lngLat.lat, locTime: that.$dayjs().format('YYYY-MM-DD HH:mm:ss'), locType: 'GPS' })\r\n      //   }\r\n      // })\r\n      mapObj.map.on('click', () => {\r\n        this.showKeyList = false\r\n      })\r\n      this.addMapImg()\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.requestSingleLocation(\r\n          ['1'],\r\n          (res) => {\r\n            that.currentPosition = JSON.parse(JSON.stringify(res))\r\n            const param = {\r\n              ...that.currentPosition,\r\n            }\r\n            this.$refs.mymap.setInspUserPosition(param)\r\n          },\r\n          (err) => {\r\n            console.log('err=', err)\r\n          }\r\n        )\r\n      }\r\n      // // 巡检模拟\r\n      // mapObj.map.on('click', e => {\r\n      //   that.currentPosition = {\r\n      //     longitude: e.lngLat.lng,\r\n      //     latitude: e.lngLat.lat,\r\n      //     locTime: that.$dayjs().format('YYYY-MM-DD HH:mm:ss'),\r\n      //     locType: 'GPS',\r\n      //   }\r\n      //   const param = {\r\n      //     ...that.currentPosition,\r\n      //   }\r\n      //   this.$refs.mymap.setInspUserPosition(param)\r\n      //   // if (that.trackPointList.length == 0) {\r\n      //   //   that.trackPointList.push([e.lngLat.lng, e.lngLat.lat])\r\n      //   // } else {\r\n      //   //   that.drawInspLine({ longitude: e.lngLat.lng, latitude: e.lngLat.lat, locTime: that.$dayjs().format('YYYY-MM-DD HH:mm:ss'), locType: 'GPS' })\r\n      //   // }\r\n      // })\r\n    },\r\n    // 刷新任务\r\n    refreshTask() {\r\n      const id = this.$route.query.taskId\r\n      this.getTaskById(id, 'refresh')\r\n    },\r\n    async getTrackRecordsById(id) {\r\n      const res = await request({\r\n        url: '/xasw-pipe-operation/inspTask/track',\r\n        method: 'get',\r\n        params: { id, pageNum: 1, pageSize: 9999 },\r\n      })\r\n      if (res && res.status) {\r\n        console.log(res)\r\n      }\r\n    },\r\n    // 根据任务id获取巡检状况\r\n    async getTaskById(id, type = null) {\r\n      let toast = Toast.loading({\r\n        message: '地图加载中...',\r\n        loadingType: 'spinner',\r\n        duration: 0,\r\n        forbidClick: true\r\n      })\r\n      // 处理已巡检管线的接口\r\n      const recordLines = await api.recordedPipeLine({\r\n        taskId: id,\r\n        page: 1,\r\n        size: 9999\r\n      })\r\n      this.lines = []\r\n      if (recordLines.status) {\r\n        this.lines = recordLines.data.records.map((item) => item.pipeId)\r\n      }\r\n      const res = await request({\r\n        url: '/xasw-pipe-operation/inspTask/getById',\r\n        method: 'get',\r\n        params: { id, bizScope: this.$route.query.taskType }\r\n      })\r\n      if (res && res.status) {\r\n        this.taskDetail = res.data.inspTask\r\n        this.planDetail = res.data.inspPlan\r\n        this.buttonList = ['全部'].concat(this.planDetail.bizType.split(','))\r\n        this.inspRangeList = res.data.detailList.map((range) => {\r\n          return {\r\n            taskId: id,\r\n            ...range,\r\n          }\r\n        })\r\n        setTimeout(() => {\r\n          this.legendConfig = [\r\n            {\r\n              label: '污水',\r\n              clickFlag: this.planDetail.bizType.includes('污水') ? true : false\r\n            },\r\n            {\r\n              label: '雨水',\r\n              clickFlag: this.planDetail.bizType.includes('雨水') ? true : false\r\n            },\r\n            {\r\n              label: '供水',\r\n              clickFlag: this.planDetail.bizType.includes('供水') ? true : false\r\n            },\r\n            {\r\n              label: '再生水',\r\n              clickFlag: this.planDetail.bizType.includes('再生水') ? true : false\r\n            }\r\n          ];\r\n        }, 5000)\r\n        // 修改未巡检(0)任务状态至巡检中(1)\r\n        if (this.$route.query.isNew && this.taskDetail.taskStatus != 1) {\r\n          this.startOrEndTaskRecord(1)\r\n        }\r\n        if (type != 'refresh') {\r\n          const allTaskLines = await api.getAllTaskLines({\r\n            devType: '管线',\r\n            gridId: this.planDetail.gridId,\r\n            pageNum: 1,\r\n            pageSize: 999999,\r\n            bizScope: this.$route.query.taskType,\r\n            bizType: this.planDetail.bizType\r\n          })\r\n          if (allTaskLines.status) {\r\n            this.allTaskLines = []\r\n            allTaskLines.data.list.forEach(item => {\r\n              this.allTaskLines.push({\r\n                type: 'Feature',\r\n                id: item.id,\r\n                geometry: JSON.parse(item.geom),\r\n                properties: {\r\n                  id: item.id,\r\n                  length: item['length'],\r\n                  bizType: item.bizType\r\n                }\r\n              })\r\n            })\r\n            this.$refs.mymap.setAllInspLineSource(this.allTaskLines)\r\n          }\r\n        }\r\n        const kpRes = await request({\r\n          url: '/xasw-pipe-operation/inspTask/point',\r\n          method: 'get',\r\n          params: { id, gridId: this.planDetail.gridId, pageNum: 1, pageSize: 9999, bizScope: this.$route.query.taskType, bizType: this.planDetail.bizType },\r\n        })\r\n        this.keyDetailList = []\r\n        if (kpRes && kpRes.status) {\r\n          let keys = Object.keys(kpRes.data)\r\n          keys.forEach((item) => {\r\n            this.keyDetailList.push(...kpRes.data[item].list)\r\n          })\r\n          this.unInspKeyDetailList = this.keyDetailList.filter(it => !it.deviceStatus)\r\n        }\r\n        let completion = this.changeToRate(this.taskDetail.coverage)\r\n        this.navbarTitle = this.taskDetail.taskName\r\n        try {\r\n          const that = this\r\n          let timer = setInterval(function () {\r\n            // 30s后取消\r\n            setTimeout(() => {\r\n              clearInterval(timer)\r\n            }, 30000)\r\n            if (that.$refs.mymap && that.$refs.mymap.isOnLoaded()) {\r\n              clearInterval(timer)\r\n              that.$refs.mymap.addKeyPoints(that.keyDetailList)\r\n              if (type != 'refresh') {\r\n                that.$refs.mymap.addRangeList(that.inspRangeList)\r\n              }\r\n              const params = {\r\n                extParam: {\r\n                  task_id: that.$route.query.taskId\r\n                }\r\n              }\r\n              // 问题上报、设施缺陷接口\r\n              that.getProblemDataList(params)\r\n              that.$refs.mymap.addInspRecordTileLineSource(that.lines, completion)\r\n              toast.clear()\r\n              if (!that.currentPosition) return\r\n              const param = {\r\n                ...that.currentPosition,\r\n              }\r\n              that.$refs.mymap.setInspUserPosition(param)\r\n            }\r\n          }, 500)\r\n        } catch (e) {\r\n          console.log(e)\r\n        }\r\n      } else {\r\n        Toast({\r\n          message: '网络状态较差，加载任务失败',\r\n          icon: 'warn',\r\n          duration: 3000\r\n        })\r\n      }\r\n    },\r\n    pause() {\r\n      console.log('进入后台')\r\n      if (this.ifRecording && this.isResume) {\r\n        this.isResume = false\r\n      }\r\n    },\r\n    resume() {\r\n      console.log('进入前台')\r\n      if (this.ifRecording) {\r\n        this.isResume = true\r\n        pauseStateTrackPoints.length > 0 && this.upLoadPauseStateTrackPoints(this.deepClone(pauseStateTrackPoints))\r\n        pauseStatePipeIdList.length > 0 && this.upLoadPauseStatePipeIdList(this.deepClone(pauseStatePipeIdList))\r\n      }\r\n    },\r\n    upLoadPauseStatePipeIdList(data) {\r\n      let that = this\r\n      api.recordInspLine(data).then(async res => {\r\n        if (res.status) {\r\n          console.log('后台巡检管线补充数据上传成功')\r\n          pauseStatePipeIdList.splice(0, data.length) // 移除上传成功的数据。避免重复上传\r\n          const res = await request({\r\n            url: '/xasw-pipe-operation/inspTask/getById',\r\n            method: 'get',\r\n            params: { id: that.$route.query.taskId, bizScope: that.$route.query.taskType }\r\n          })\r\n          if (res.status) {\r\n            that.taskDetail = res.data.inspTask\r\n          }\r\n        } else {\r\n          that.$refs.mymap.uploadFiledPipeIdList.push(...data)\r\n        }\r\n      }).catch(err => {\r\n        setTimeout(() => {\r\n          this.upLoadPauseStatePipeIdList(data)\r\n        }, 5 * 1000)\r\n      })\r\n    },\r\n    upLoadPauseStateTrackPoints(data) {\r\n      api.inspectionTrack(data).then((res) => {\r\n        if (res && res.status) {\r\n          console.log('后台巡检轨迹补充点位上传成功')\r\n          pauseStateTrackPoints.splice(0, data.length) // 移除上传成功的点位。避免重复上传\r\n        } else {\r\n          console.log('后台巡检轨迹补充点位上传异常')\r\n          this.reportFailTrackPoints.push(...data)\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        setTimeout(() => {\r\n          this.upLoadPauseStateTrackPoints(data)\r\n        }, 5 * 1000)\r\n      })\r\n    },\r\n    // 轮询 currentPosition，绘制轨迹线\r\n    polling() {\r\n      let that = this\r\n      if (that.pollingFlag) {\r\n        if (typeof yuanchu != 'undefined') {\r\n          yuanchu.locationAMap.requestLocations(\r\n            [that.$route.query.taskType == '人巡' ? '4' : '2', '1', '20', '100', '0', true],\r\n            (res) => {\r\n              console.log(res)\r\n              that.drawInspLine(res)\r\n            },\r\n            (err) => {\r\n              // Toast.error({\r\n              //   message: 'err' + err,\r\n              //   duration: 2000,\r\n              // })\r\n            }\r\n          )\r\n        }\r\n      }\r\n    },\r\n    drawInspLine(position) {\r\n      const that = this\r\n      that.currentPosition = JSON.parse(JSON.stringify(position))\r\n      that.currentPosition = Object.assign(that.currentPosition, {\r\n        direction: 0\r\n      })\r\n      if (that.currentPosition.locType != 'SAME_REQ' && that.currentPosition.locType != 'FIX_CACHE') { // 过滤缓存定位数据\r\n        let lastPoint = that.trackPointList[that.trackPointList.length - 1]\r\n        let distance = that.GetDistance(lastPoint, [that.currentPosition.longitude, that.currentPosition.latitude]) * 1000\r\n        // 记录过程点\r\n        that.postTrackData_Point(\r\n          that.trackPointList[that.trackPointList.length - 1],\r\n          that.trackPointTimeList[that.trackPointTimeList.length - 1],\r\n          distance\r\n        ).then(res => {\r\n          if (res) {\r\n            // 改变巡检轨迹缓冲区范围内的管线颜色\r\n            let geom = {\r\n              type: 'LineString',\r\n              coordinates: [\r\n                [lastPoint[0], lastPoint[1]],\r\n                [that.currentPosition.longitude, that.currentPosition.latitude],\r\n              ]\r\n            }\r\n            let promise = new Promise((resolve, reject) => {\r\n              that.changeInspLineSourceBySpeed(geom, resolve)\r\n            })\r\n            promise.then(r => {\r\n              if (r) {\r\n                that.trackPointList.push([\r\n                  that.currentPosition.longitude,\r\n                  that.currentPosition.latitude\r\n                ])\r\n                that.trackPointTimeList.push(that.currentPosition.locTime)\r\n                // 构造临时线对象\r\n                let jsonLine = {\r\n                  type: 'Feature',\r\n                  properties: {},\r\n                  geometry: {\r\n                    type: 'LineString',\r\n                    coordinates: that.trackPointList,\r\n                  },\r\n                }\r\n                const coord = [parseFloat(that.currentPosition.longitude), parseFloat(that.currentPosition.latitude)];\r\n                const point = turf.point(coord);\r\n                mapObj.mapInstance.setSourceData(\"inspUser\", {\r\n                  type: \"FeatureCollection\",\r\n                  features: [point]\r\n                })\r\n                let jsonLineFeatureCollection = {\r\n                  type: 'FeatureCollection',\r\n                  features: [jsonLine],\r\n                }\r\n                if (mapObj.map.getSource('trackLineSource_now')) {\r\n                  mapObj.map.getSource('trackLineSource_now').setData(jsonLineFeatureCollection)\r\n                } else {\r\n                  mapObj.map.addSource('trackLineSource_now', {\r\n                    type: 'geojson',\r\n                    data: jsonLineFeatureCollection,\r\n                  })\r\n                }\r\n                if (mapObj.map.getLayer('trackLineLayer_now')) {\r\n                } else {\r\n                  mapObj.map.addLayer({\r\n                    id: 'trackLineLayer_now',\r\n                    type: 'line',\r\n                    source: 'trackLineSource_now',\r\n                    layout: {\r\n                      'line-cap': 'round',\r\n                      'line-join': 'round',\r\n                      'line-sort-key': 1,\r\n                      visibility: 'visible',\r\n                      // visibility: \"none\"\r\n                    },\r\n                    paint: {\r\n                      'line-color': '#addd52',\r\n                      'line-width': 5,\r\n                      'line-opacity': 0.8\r\n                    },\r\n                  }, 'inspUserLayer')\r\n                }\r\n                if (mapObj.map.getLayer('trackLineLayer_arrow')) {\r\n                } else {\r\n                  mapObj.map.addLayer({\r\n                    id: 'trackLineLayer_arrow',\r\n                    type: 'symbol',\r\n                    source: 'trackLineSource_now',\r\n                    layout: {\r\n                      'symbol-placement': 'line',\r\n                      'symbol-spacing': 20,\r\n                      'icon-image': 'arrowIcon',\r\n                      'icon-size': 0.5,\r\n                      'icon-allow-overlap': true,\r\n                      'symbol-sort-key': 3,\r\n                      visibility: 'visible'\r\n                    },\r\n                  }, 'inspUserLayer')\r\n                }\r\n              }\r\n            })\r\n          }\r\n        })\r\n      }\r\n    },\r\n    // 根据速度改变巡检管线颜色\r\n    changeInspLineSourceBySpeed(position, resolve) {\r\n      // const coord = [parseFloat(position.longitude), parseFloat(position.latitude)];\r\n      // const point = turf.point(coord);\r\n      const that = this\r\n      try {\r\n        // 改变周围要素的状态\r\n        let buffered = turf.buffer(position, that.$route.query.taskType == '人巡' ? 0.025 : 0.045, { unit: 'kilometers' });\r\n        that.changeInspLineState(buffered, resolve);\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    },\r\n    // 设置巡检管线为已巡检\r\n    changeInspLineState(geometry, resolve) {\r\n      let that = this\r\n      // 将地理坐标系转化为屏幕坐标系\r\n      function geoTransToPixel(geom) {\r\n        const polygonBox = turf.bbox(geom);\r\n        const southWest = [polygonBox[0], polygonBox[1]];\r\n        const northEast = [polygonBox[2], polygonBox[3]];\r\n        let southWestPointPixel = mapObj.map.project(southWest);\r\n        let northEastPointPixel = mapObj.map.project(northEast);\r\n        // 增大bbox的查询范围\r\n        southWestPointPixel = [\r\n          southWestPointPixel.x - 50,\r\n          southWestPointPixel.y + 50\r\n        ]\r\n        northEastPointPixel = [\r\n          northEastPointPixel.x + 50,\r\n          northEastPointPixel.y - 50\r\n        ]\r\n        return [southWestPointPixel, northEastPointPixel];\r\n      }\r\n      // 对每个划分出来的bbox进行处理\r\n      function chunk(geom, resolve) {\r\n        const boxFeatures = mapObj.map.queryRenderedFeatures(geoTransToPixel(geom), {\r\n          layers: [\"initInspLineLayer\"]\r\n        });\r\n        console.log(boxFeatures, 'boxFeatures')\r\n        let tempPipeList = []\r\n        boxFeatures.forEach(feat => {\r\n          try {\r\n            const result = turf.booleanDisjoint(feat.geometry, geometry)\r\n            // 如果查出的要素与真实的范围相交且没有被巡检过，则改变其状态,并记录其关键字\r\n            if (!result && !feat.state.isInsp) {\r\n              mapObj.map.setFeatureState({\r\n                source: feat.source,\r\n                id: feat.id\r\n              }, { isInsp: true })\r\n              if (!tempPipeList.map(it => it.pipeId).includes(feat.id)) {\r\n                let date = that.$dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n                tempPipeList.push({\r\n                  inspDate: date,\r\n                  pipeId: feat.id,\r\n                  ext3: feat.properties.bizType,\r\n                  pipeLength: feat.properties['length'] || 0,\r\n                  taskId: that.$route.query.taskId\r\n                })\r\n              }\r\n            }\r\n          } catch (error) {\r\n            console.log(error)\r\n          }\r\n        })\r\n        if (that.isResume) {\r\n          tempPipeList.length > 0 && api.recordInspLine(tempPipeList).then(async res => {\r\n            if (res.status) {\r\n              const res = await request({\r\n                url: '/xasw-pipe-operation/inspTask/getById',\r\n                method: 'get',\r\n                params: { id: that.$route.query.taskId, bizScope: that.$route.query.taskType }\r\n              })\r\n              if (res.status) {\r\n                that.taskDetail = res.data.inspTask\r\n              }\r\n            } else {\r\n              console.log('上传失败的tempPipeList: ', tempPipeList);\r\n              that.$refs.mymap.uploadFiledPipeIdList.push(...tempPipeList)\r\n            }\r\n          })\r\n        } else {\r\n          tempPipeList.length > 0 && pauseStatePipeIdList.push(...tempPipeList)\r\n        }\r\n        resolve(true)\r\n      }\r\n      // function cb(features) {\r\n      //   if (features.length > 0) {\r\n      //     setTimeout(() => {\r\n      //       chunk(features.shift());\r\n      //       cb(features);\r\n      //     }, 100);\r\n      //   }\r\n      // }\r\n      chunk(geometry, resolve)\r\n      // cb([geometry]);\r\n    },\r\n    // 绘制起始点\r\n    drawStartPoint() {\r\n      let that = this\r\n      return new Promise(function (resolve, reject) {\r\n        if (typeof yuanchu != 'undefined') {\r\n          yuanchu.locationAMap.requestSingleLocation(\r\n            ['1'],\r\n            (res) => {\r\n              that.currentPosition = JSON.parse(JSON.stringify(res))\r\n              const param = {\r\n                ...that.currentPosition,\r\n              }\r\n              console.log(res)\r\n              that.$refs.mymap.setInspUserPosition(param)\r\n              if (that.currentPosition != null) {\r\n                let recordData = []\r\n                recordData.push({\r\n                  taskId: that.taskDetail.id, // 任务id\r\n                  longitude: that.currentPosition.longitude,\r\n                  latitude: that.currentPosition.latitude,\r\n                  inspTime: that.currentPosition.locTime,\r\n                  distance: 0, // 第一个点距离为0\r\n                  inspDate: that.currentPosition.locTime,\r\n                  inspector: that.userInfo.userFullName,\r\n                })\r\n                api.inspectionTrack(recordData)\r\n                  .then((res) => {\r\n                    if (res && res.status) {\r\n                      // 使用上报点位作为起点\r\n                      console.log('起始点存储成功')\r\n                      that.trackPointList.push([that.currentPosition.longitude, that.currentPosition.latitude])\r\n                      that.trackPointTimeList.push(that.currentPosition.locTime)\r\n                      let jsonPoint = {\r\n                        type: 'Feature',\r\n                        properties: {},\r\n                        geometry: {\r\n                          type: 'Point',\r\n                          coordinates: [that.currentPosition.longitude, that.currentPosition.latitude],\r\n                        },\r\n                      }\r\n                      let jsonPointFeatureCollection = {\r\n                        type: 'FeatureCollection',\r\n                        features: [jsonPoint],\r\n                      }\r\n                      if (mapObj.map.getSource('startPointSource_now')) {\r\n                        mapObj.map.getSource('startPointSource_now').setData(jsonPointFeatureCollection)\r\n                      } else {\r\n                        mapObj.map.addSource('startPointSource_now', {\r\n                          type: 'geojson',\r\n                          data: jsonPointFeatureCollection,\r\n                        })\r\n                      }\r\n                      if (mapObj.map.getLayer('startPointLayer_now')) {\r\n                      } else {\r\n                        mapObj.map.addLayer({\r\n                          id: 'startPointLayer_now',\r\n                          type: 'circle',\r\n                          source: 'startPointSource_now',\r\n                          layout: {\r\n                            'circle-sort-key': 5,\r\n                            visibility: 'visible',\r\n                            // visibility: \"none\"\r\n                          },\r\n                          paint: {\r\n                            'circle-radius': 3,\r\n                            'circle-stroke-width': 5,\r\n                            'circle-stroke-color': '#2A83E6',\r\n                            'circle-color': 'white',\r\n                          },\r\n                        }, 'inspUserLayer')\r\n                      }\r\n                      // label\r\n                      if (mapObj.map.getLayer('startPoint_label')) {\r\n                      } else {\r\n                        mapObj.map.addLayer({\r\n                          id: 'startPoint_label',\r\n                          type: 'symbol',\r\n                          source: 'startPointSource_now',\r\n                          layout: {\r\n                            'symbol-placement': 'point',\r\n                            'icon-image': 'start_point',\r\n                            'icon-size': 0.6,\r\n                            'icon-offset': [0, -35],\r\n                            'icon-allow-overlap': true,\r\n                            'symbol-sort-key': 2,\r\n                            visibility: 'visible',\r\n                            // visibility: \"none\"\r\n                          },\r\n                        })\r\n                      }\r\n                      resolve(true)\r\n                    } else {\r\n                      resolve(false)\r\n                    }\r\n                  })\r\n                  .catch((err) => {\r\n                    reject(err)\r\n                  })\r\n              }\r\n            },\r\n            (err) => {\r\n              console.log('err=', err)\r\n            }\r\n          )\r\n        }\r\n      })\r\n    },\r\n    // 绘制终止点\r\n    async drawEndPoint(type) {\r\n      let that = this\r\n      if (that.currentPosition != null) {\r\n        let lastPoint = that.trackPointList[that.trackPointList.length - 1]\r\n        let distance = that.GetDistance(lastPoint, [that.currentPosition.longitude, that.currentPosition.latitude]) * 1000\r\n        let toast = Toast.loading({\r\n          message: '程序关闭中',\r\n          loadingType: 'spinner',\r\n          duration: 0,\r\n          forbidClick: true\r\n        })\r\n        // 记录终止点\r\n        that.postTrackData_Point(\r\n          that.trackPointList[that.trackPointList.length - 1],\r\n          that.trackPointTimeList[that.trackPointTimeList.length - 1],\r\n          distance\r\n        ).then(res => {\r\n          if (res) {\r\n            toast.close()\r\n            Toast.info({\r\n              message: '暂停成功',\r\n              duration: 1000\r\n            })\r\n            if (typeof yuanchu != 'undefined') {\r\n              yuanchu.locationAMap.stopRequestLocations()\r\n            }\r\n            that.trackPointList.push([that.currentPosition.longitude, that.currentPosition.latitude])\r\n            that.trackPointTimeList.push(that.currentPosition.locTime)\r\n            let jsonPoint = {\r\n              type: 'Feature',\r\n              properties: {},\r\n              geometry: {\r\n                type: 'Point',\r\n                coordinates: [that.currentPosition.longitude, that.currentPosition.latitude],\r\n              },\r\n            }\r\n            let jsonPointFeatureCollection = {\r\n              type: 'FeatureCollection',\r\n              features: [jsonPoint],\r\n            }\r\n            if (mapObj.map.getSource('endPointSource_now')) {\r\n              mapObj.map.getSource('endPointSource_now').setData(jsonPointFeatureCollection)\r\n            } else {\r\n              mapObj.map.addSource('endPointSource_now', {\r\n                type: 'geojson',\r\n                data: jsonPointFeatureCollection,\r\n              })\r\n            }\r\n            if (mapObj.map.getLayer('endPointLayer_now')) {\r\n            } else {\r\n              mapObj.map.addLayer({\r\n                id: 'endPointLayer_now',\r\n                type: 'circle',\r\n                source: 'endPointSource_now',\r\n                layout: {\r\n                  'circle-sort-key': 5,\r\n                  visibility: 'visible',\r\n                  // visibility: \"none\"\r\n                },\r\n                paint: {\r\n                  'circle-radius': 3,\r\n                  'circle-stroke-width': 5,\r\n                  'circle-stroke-color': '#addd52',\r\n                  'circle-color': 'white',\r\n                },\r\n              }, 'inspUserLayer')\r\n            }\r\n\r\n            // 补充trackline\r\n            let jsonLine = {\r\n              type: 'Feature',\r\n              properties: {},\r\n              geometry: {\r\n                type: 'LineString',\r\n                coordinates: that.trackPointList,\r\n              },\r\n            }\r\n            let jsonLineFeatureCollection = {\r\n              type: 'FeatureCollection',\r\n              features: [jsonLine],\r\n            }\r\n            if (mapObj.map.getSource('trackLineSource_now')) {\r\n              mapObj.map.getSource('trackLineSource_now').setData(jsonLineFeatureCollection)\r\n            } else {\r\n              mapObj.map.addSource('trackLineSource_now', {\r\n                type: 'geojson',\r\n                data: jsonLineFeatureCollection,\r\n              })\r\n            }\r\n            if (mapObj.map.getLayer('trackLineLayer_now')) {\r\n            } else {\r\n              mapObj.map.addLayer({\r\n                id: 'trackLineLayer_now',\r\n                type: 'line',\r\n                source: 'trackLineSource_now',\r\n                layout: {\r\n                  'line-cap': 'round',\r\n                  'line-join': 'round',\r\n                  visibility: 'visible',\r\n                  // visibility: \"none\"\r\n                },\r\n                paint: {\r\n                  'line-color': '#addd52',\r\n                  'line-width': 5,\r\n                  'line-opacity': 0.8,\r\n                },\r\n              }, 'inspUserLayer')\r\n            }\r\n            // label\r\n            if (mapObj.map.getLayer('endPoint_label')) {\r\n            } else {\r\n              mapObj.map.addLayer({\r\n                id: 'endPoint_label',\r\n                type: 'symbol',\r\n                source: 'endPointSource_now',\r\n                layout: {\r\n                  'symbol-placement': 'point',\r\n                  'icon-image': 'end_point',\r\n                  'icon-size': 0.6,\r\n                  'icon-offset': [0, -35],\r\n                  'icon-allow-overlap': true,\r\n                  'symbol-sort-key': 2,\r\n                  visibility: 'visible',\r\n                  // visibility: \"none\"\r\n                },\r\n              })\r\n            }\r\n            // 上传之前上传失败的点位\r\n            that.reportFailTrackPoints.length > 0 && that.postFailTrackData()\r\n            that.$refs.mymap.uploadFiledPipeIdList.length > 0 && api.recordInspLine(that.$refs.mymap.uploadFiledPipeIdList).then(res => {\r\n              if (res.status) {\r\n                console.log('管线补充上传成功')\r\n                that.$refs.mymap.uploadFiledPipeIdList = []\r\n              }\r\n            })\r\n            if (type == 'end') {\r\n              this.startOrEndTaskRecord(2) // 已巡检状态 '2'\r\n            } else {\r\n              this.pollingFlag = false\r\n              this.ifRecording = false\r\n              localStorage.setItem('startRecordLines', 'end')\r\n              if (type == 'pause') {\r\n                Toast.success({\r\n                  message: '暂停成功',\r\n                  duration: 2000\r\n                })\r\n                this.refreshTask()\r\n              } else if (type == 'leave') {\r\n                this.$router.go(-1)\r\n              }\r\n            }\r\n          } else {\r\n            Toast.error({\r\n              message: type == 'end' ? '结束失败' : '暂停失败'\r\n            })\r\n          }\r\n        })\r\n      } else {\r\n        let type = type\r\n        let timer = setTimeout(() => {\r\n          that.drawEndPoint(type)\r\n        }, 1000)\r\n      }\r\n    },\r\n    async postFailTrackData() {\r\n      let that = this\r\n      await api\r\n        .inspectionTrack(that.reportFailTrackPoints)\r\n        .then((res) => {\r\n          if (res && res.status) {\r\n            console.log('轨迹存储成功')\r\n            that.reportFailTrackPoints = []\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log('巡检轨迹存储失败：' + err)\r\n        })\r\n    },\r\n\r\n    // 单点-后端记录轨迹数据\r\n    postTrackData_Point(pointData, timeData, distance) {\r\n      return new Promise(async (resolve, reject) => {\r\n        let that = this\r\n        for (let p = 0; p < pointData.length; p++) {\r\n          pointData[p] = Number(pointData[p])\r\n        }\r\n        let date_now = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n        let recordData = []\r\n        recordData.push({\r\n          taskId: that.taskDetail.id,\r\n          inspDate: timeData,\r\n          inspTime: date_now,\r\n          distance,\r\n          inspector: that.userInfo.userFullname,\r\n          longitude: pointData[0],\r\n          latitude: pointData[1],\r\n        })\r\n        if (that.isResume) {\r\n          await api\r\n            .inspectionTrack(recordData)\r\n            .then((res) => {\r\n              if (res && res.status) {\r\n                console.log('轨迹存储成功', recordData)\r\n                resolve(true)\r\n              } else {\r\n                // 上传失败的点位，暂时存在app端\r\n                that.reportFailTrackPoints.push(recordData)\r\n                console.log('that.reportFailTrackPoints: ', that.reportFailTrackPoints);\r\n                resolve(true)\r\n              }\r\n            })\r\n        } else {\r\n          pauseStateTrackPoints.push(...recordData)\r\n          resolve(true)\r\n        }\r\n      })\r\n    },\r\n    startOrEndTaskRecord(status) {\r\n      let data = {\r\n        planId: this.planDetail.id,\r\n        taskName: this.taskDetail.taskName,\r\n        taskCode: this.taskDetail.taskCode,\r\n        taskStatus: status,\r\n        id: this.taskDetail.id,\r\n        taskType: this.taskDetail.taskType,\r\n        bizType: this.planDetail.bizType,\r\n        ext1: status == 2 ? this.stopReason : ''\r\n      }\r\n      if (status == 1) {\r\n        data.planStartTime = this.$dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n      } else if (status == 2) {\r\n        data.planEndTime = this.$dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n      }\r\n      let that = this\r\n      api.changeTaskStatus(data).then((res) => {\r\n        if (res.status) {\r\n          if (status == 2) {\r\n            Toast.success({\r\n              message: '结束成功',\r\n              duration: 2000,\r\n              onClose: () => {\r\n                that.pollingFlag = false\r\n                that.ifRecording = false\r\n                localStorage.setItem('startRecordLines', 'end')\r\n                that.isView = true\r\n                that.$router.go(-1)\r\n              }\r\n            })\r\n          }\r\n        } else {\r\n          if (status == 2) {\r\n            Toast.error({\r\n              message: '结束失败, 请重试',\r\n              duration: 1500\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    // 清除缓存的轨迹数据\r\n    clearBufferTrack() {\r\n      let that = this\r\n      that.isResume = true\r\n      that.ifRecording = false\r\n      that.currentPosition = null\r\n      //数组归零\r\n      that.trackPointList = []\r\n      that.trackPointTimeList = []\r\n      that.overSpeedTrackLineList = []\r\n      pauseStateTrackPoints = []\r\n      pauseStatePipeIdList = []\r\n      //数据源清空\r\n      if (mapObj.map.getSource('trackLineSource_now')) {\r\n        mapObj.map.getSource('trackLineSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n      if (mapObj.map.getSource('trackLineSource_overSpeed')) {\r\n        mapObj.map.getSource('trackLineSource_overSpeed').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n      if (mapObj.map.getSource('startPointSource_now')) {\r\n        mapObj.map.getSource('startPointSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n\r\n      if (mapObj.map.getSource('endPointSource_now')) {\r\n        mapObj.map.getSource('endPointSource_now').setData({\r\n          type: 'FeatureCollection',\r\n          features: [],\r\n        })\r\n      }\r\n    },\r\n    addMapImg() {\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/white_arrow_right.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('arrowIcon')) {\r\n            mapObj.map.addImage('arrowIcon', image, {})\r\n          }\r\n        }\r\n      )\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/icon_starting_point.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('start_point')) {\r\n            mapObj.map.addImage('start_point', image, {})\r\n          }\r\n        }\r\n      )\r\n      mapObj.map.loadImage(\r\n        require('@assets/img/inspection/icon_at_end.png'),\r\n        function (error, image) {\r\n          if (error) throw error\r\n          if (!mapObj.map.hasImage('end_point')) {\r\n            mapObj.map.addImage('end_point', image, {})\r\n          }\r\n        }\r\n      )\r\n    },\r\n    // 开始记录 上传起点成功后才进入巡检过程\r\n    startInspRecord() {\r\n      if (this.isView) {\r\n        Toast({\r\n          message: '该巡检任务已结束',\r\n          duration: 1500\r\n        })\r\n        return\r\n      }\r\n      if (!this.currentPosition || !this.currentPosition.longitude) {\r\n        Toast.warning({\r\n          message: '当前GPS信号弱，请稍后尝试',\r\n          duration: 2000\r\n        })\r\n        return\r\n      }\r\n      this.clearBufferTrack()\r\n      let toast = Toast.loading({\r\n        message: '程序启动中',\r\n        loadingType: 'spinner',\r\n        duration: 0,\r\n        forbidClick: true\r\n      })\r\n      this.drawStartPoint()\r\n        .then((res) => {\r\n          if (res) {\r\n            toast.close()\r\n            Toast.info({\r\n              message: '开始记录',\r\n              duration: 1500\r\n            })\r\n            this.pollingFlag = true\r\n            this.ifRecording = true\r\n            localStorage.setItem('startRecordLines', 'start')\r\n            // 开始轮询\r\n            this.polling()\r\n            // 记录当前时间\r\n            this.startRecordTimer = new Date()\r\n          } else {\r\n            Toast.error({\r\n              message: '接口异常，无法开始任务',\r\n              duration: 2000\r\n            })\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(err)\r\n          Toast.error({\r\n            message: '网络状态异常，正在重试',\r\n            duration: 2000\r\n          })\r\n          setTimeout(() => {\r\n            this.drawStartPoint()\r\n          }, 5000)\r\n        })\r\n    },\r\n    // 结束记录\r\n    endRecord(type) {\r\n      let diff = Math.floor((new Date() - this.startRecordTimer) / 1000)\r\n      if (diff <= 10) {\r\n        Toast.info({\r\n          message: `结束太快了,请${10 - diff}秒后再试`,\r\n          duration: 1000\r\n        })\r\n        return\r\n      }\r\n      this.endRecordConfirm(type)\r\n    },\r\n    // 结束记录确认\r\n    endRecordConfirm(type) {\r\n      this.drawEndPoint(type)\r\n    },\r\n    // 开始定位\r\n    startLocation() {\r\n      let that = this\r\n      yuanchu.locationAMap.requestSingleLocation(\r\n        ['1'],\r\n        (res) => {\r\n          that.currentPosition = JSON.parse(JSON.stringify(res))\r\n          const param = {\r\n            ...that.currentPosition,\r\n          }\r\n          if (!that.currentPosition || !that.currentPosition.longitude || !that.currentPosition.latitude) {\r\n            Toast.error({\r\n              message: '获取位置失败!',\r\n              duration: 2000\r\n            })\r\n            return\r\n          } else {\r\n            const coord = [parseFloat(that.currentPosition.longitude), parseFloat(that.currentPosition.latitude)]\r\n            that.$refs.mymap.setInspUserPosition(param)\r\n            that.flyToPoint(coord)\r\n          }\r\n        },\r\n        (err) => {\r\n          console.log('err=', err)\r\n        }\r\n      )\r\n    },\r\n    goEventOrFlawDetail(feature, type) {\r\n      let currentPoint = feature\r\n      console.log(feature)\r\n      currentPoint = feature\r\n      currentPoint.bigType = feature.bizType || ''\r\n      currentPoint.gridId = this.planDetail.gridId\r\n      currentPoint.gridName = this.planDetail.gridName\r\n      currentPoint.gridManager = { fullName: this.planDetail.gridManager, username: this.planDetail.userName }\r\n      currentPoint.lng = feature.geom.coordinates[0]\r\n      currentPoint.lat = feature.geom.coordinates[1]\r\n      currentPoint.road_name = feature.road || ''\r\n      currentPoint.smallType = feature.deviceType || ''\r\n      currentPoint.code = feature.deviceId || ''\r\n      currentPoint.taskId = this.taskDetail.id\r\n      if (type == 'event') {\r\n        this.$router.push({\r\n          name: 'addProblemIndex',\r\n          query: { msg: currentPoint, token: this.formToken, taskId: this.$route.query.taskId, from: 'insp' },\r\n          params: { type: 'add' },\r\n        })\r\n      } else {\r\n        this.$router.push({\r\n          name: 'addFlaws',\r\n          query: { msg: currentPoint, token: this.formToken, taskId: this.$route.query.taskId, from: 'insp' },\r\n          params: { type: 'add' }\r\n        })\r\n      }\r\n    },\r\n    // 确认\r\n    onConfirm() {\r\n      if (true) {\r\n        let that = this\r\n        let feature = this.signForm.feature\r\n        let copySignForm = this.deepClone(this.signForm)\r\n        if (that.attachment == '') {\r\n          Notify({ type: 'error', message: '请上传附件' })\r\n          return\r\n        }\r\n        // 液位输入框是否显示（污水检查井必须填写液位字段）\r\n        if (this.waterLevelShow == true) {\r\n          if (copySignForm.liquidLevel == '') {\r\n            Notify({ type: 'error', message: '请输入液位' })\r\n            return\r\n          }\r\n        }\r\n        copySignForm.inspDate = dayjs().format('YYYY-MM-DD HH:mm:ss')\r\n        copySignForm.ext1 = copySignForm.remark // 备注\r\n        copySignForm.ext2 = '1' // 巡检记录的ext2字段，默认为1（待复核），已通过为2，已退回为3\r\n        delete copySignForm.feature\r\n\r\n        // resultList通过巡检要点list处理并添加到form中\r\n        let resultList = []\r\n        let textInFlag = false\r\n        // 巡检要点list数据\r\n        if (this.keyPointsInspectionList.length > 0) {\r\n          this.keyPointsInspectionList.forEach(item => {\r\n            resultList.push({\r\n              mainId: item.id, // 巡检要点id\r\n              mainPoint: item.mainPoint, // 巡检要点名称\r\n              mainValue: item.mainValue, // 该要点巡检结果\r\n              ext1: item.inputType, // 巡检要点输入类型，用于查询详情时判断html结构\r\n            })\r\n          })\r\n          for (let i = 0; i < resultList.length; i++) {\r\n            // 不为''或者全空格\r\n            if (resultList[i].mainValue == '' || resultList[i].mainValue.trim() == '') {\r\n              textInFlag = true\r\n            }\r\n          }\r\n        }\r\n        if (textInFlag) {\r\n          Notify({ type: 'error', message: '请将巡检要点补充完整' })\r\n          return\r\n        }\r\n        copySignForm.resultList = resultList\r\n        console.log('提交参数', _cloneDeep(copySignForm));\r\n        \r\n        api.signIn(copySignForm).then((res) => {\r\n          if (res && res.status) {\r\n            Toast.success({\r\n              message: '此关键点签到成功',\r\n              duration: 1000,\r\n              forbidClick: true,\r\n              onClose: () => {\r\n                // 巡检事件上报\r\n                if (copySignForm.isReport == '问题上报') {\r\n                  that.goEventOrFlawDetail(feature, 'event');\r\n                } else if (copySignForm.isReport == '新增缺陷') {\r\n                  that.goEventOrFlawDetail(feature, 'flaw');\r\n                } else {\r\n                  that.refreshTask()\r\n                }\r\n              }\r\n            })\r\n          } else {\r\n            Toast.error({\r\n              message: '此关键点签到失败',\r\n              duration: 2000\r\n            })\r\n          }\r\n          this.signShow = false\r\n          this.signForm.remark = ''\r\n          this.signForm.liquidLevel = ''\r\n          this.signForm.deviceStatus = '0'\r\n          this.signForm.isReport = ''\r\n          this.signForm.inspImagesList = []\r\n          this.attachment = ''\r\n          mapObj.mapInstance.setSourceData('buffered', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n        })\r\n        // localStorage.setItem(\"isReportEvent\", false);\r\n      } else {\r\n        console.log('验证失败')\r\n      }\r\n    },\r\n    // 取消\r\n    onCancel() {\r\n      this.signShow = false\r\n      mapObj.mapInstance.setSourceData('buffered', {\r\n        type: 'FeatureCollection',\r\n        features: [],\r\n      })\r\n    },\r\n    cancelLeave() {\r\n      this.ifLeaveTask = false\r\n    },\r\n    confirmLeave() {\r\n      this.ifLeaveTask = false\r\n      this.endRecord('leave')\r\n    },\r\n    clickBack() {\r\n      if (this.ifRecording) {\r\n        this.ifLeaveTask = true\r\n      } else {\r\n        this.$router.go(-1)\r\n      }\r\n    },\r\n    // 签到\r\n    async startSignIn(feature) {\r\n      console.log('--------签到--------', feature);\r\n      if (feature.bizType == '污水' && feature.deviceType == '检查井') {\r\n        // 液位输入框是否显示\r\n        this.waterLevelShow = true\r\n      } else {\r\n        this.waterLevelShow = false\r\n      }\r\n      this.pointListShow = false\r\n      this.attachment = ''\r\n      this.signForm.isReport = ''\r\n      this.deviceName = feature.deviceType + (feature.deviceId || '')\r\n      // -----------------------------------------------------------------------------------------------------\r\n      //  deviceStatus状态（0正常 1异常 2未巡检） 巡检记录的ext2字段，默认为1（待复核），已通过为2，已退回为3\r\n      if (!feature.deviceStatus || feature.deviceStatus == '2' || feature.ext2 == '3') {\r\n        if (this.$route.query.isView) {\r\n          Toast.warning({\r\n            message: '任务已结束，无法继续打卡',\r\n            duration: 2000\r\n          })\r\n          mapObj.map.getSource('buffered') &&\r\n            mapObj.mapInstance.setSourceData('buffered', {\r\n              type: 'FeatureCollection',\r\n              features: [],\r\n            })\r\n          return\r\n        }\r\n        // 利用feature来判断是否处于35m范围内，如果处于，可以进行签到，否则不能进行签到\r\n        const position = this.currentPosition\r\n        if (!position) {\r\n          Toast.warning({\r\n            message: '获取不到巡检人位置',\r\n            duration: 2000\r\n          })\r\n          mapObj.map.getSource('buffered') &&\r\n          mapObj.mapInstance.setSourceData('buffered', {\r\n            type: 'FeatureCollection',\r\n            features: [],\r\n          })\r\n          return\r\n        }\r\n        const coord = [\r\n          parseFloat(position.longitude),\r\n          parseFloat(position.latitude),\r\n        ]\r\n        const point = turf.point(coord)\r\n        const engGeom = feature.geom\r\n        const buffered = turf.buffer(engGeom, 0.020, { unit: 'kilometers' })\r\n        const isInBuffer = turf.inside(point, buffered)\r\n        if (!isInBuffer) {\r\n          Toast.warning({\r\n            message: '未处于该关键点范围内',\r\n            duration: 2000\r\n          })\r\n          return\r\n        }\r\n        console.log('feature数据', feature);\r\n        // 巡检要点list数据\r\n        this.keyPointsInspectionList = []\r\n        let params4 = {\r\n          bizType: feature.bizType, // 业务类型（污水）\r\n          objectType: feature.deviceType, // 巡检对象类型名称（检查井）\r\n        }\r\n        // app端根据类型查询启用的巡检要点列表\r\n        api.inspPointCheckList(params4)\r\n          .then(res => {\r\n            this.keyPointsInspectionList = res?.data?.filter((item) => {\r\n              return item.mainStatus === \"启用中\"\r\n              // item = {\r\n              //   \"id\": \"1655843007768236033\",\r\n              //   \"createBy\": \"fawkes\",\r\n              //   \"createDate\": \"2023-05-09 15:51:51\",\r\n              //   \"updateBy\": null,\r\n              //   \"updateDate\": null,\r\n              //   \"deleteFlag\": 0,\r\n              //   \"mainPoint\": \"井内是否有大量淤积或杂物影响排水\",\r\n              //   \"inputType\": \"是/否\",\r\n              //   \"unit\": \"/\",\r\n              //   \"mainStatus\": \"启用中\",\r\n              //   \"bizType\": \"污水\",\r\n              //   \"objectType\": \"检查井\",\r\n              //   \"remarks\": null,\r\n              //   \"portalId\": null,\r\n              //   \"tenantId\": 100000\r\n              // }\r\n            }) || []\r\n            // 巡检要点list数据\r\n            if (this.keyPointsInspectionList.length > 0) {\r\n              this.keyPointsInspectionList.forEach((item) => {\r\n                let iT = ['']\r\n                // 如果inputType中存在'/'，则将其转换成数组，巡检要点结果mainValue默认为第一个值（\"inputType\": \"是/否\",），否则mainValue为''\r\n                if (item.inputType.indexOf('/') > -1) {\r\n                  iT = item.inputType.split('/')\r\n                }\r\n                this.$set(item, 'mainValue', iT[0]) // 该要点巡检结果\r\n              })\r\n            }\r\n            // this.keyPointsInspectionList = [\r\n            //   {\r\n            //     \"id\": \"1655843007768236033\",\r\n            //     \"createBy\": \"fawkes\",\r\n            //     \"createDate\": \"2023-05-09 15:51:51\",\r\n            //     \"updateBy\": null,\r\n            //     \"updateDate\": null,\r\n            //     \"deleteFlag\": 0,\r\n            //     \"mainPoint\": \"测试正常异常测试正常异常测试正常异常测试正常异常\",\r\n            //     \"inputType\": \"正常/异常\",\r\n            //     \"unit\": \"/\",\r\n            //     \"mainStatus\": \"启用中\",\r\n            //     \"bizType\": \"污水\",\r\n            //     \"objectType\": \"检查井\",\r\n            //     \"remarks\": null,\r\n            //     \"portalId\": null,\r\n            //     \"tenantId\": 100000,\r\n            //     \"mainValue\": \"正常\"\r\n            //   },\r\n            //   {\r\n            //     \"id\": \"1655843007768236034\",\r\n            //     \"createBy\": \"fawkes\",\r\n            //     \"createDate\": \"2023-05-09 15:51:51\",\r\n            //     \"updateBy\": null,\r\n            //     \"updateDate\": null,\r\n            //     \"deleteFlag\": 0,\r\n            //     \"mainPoint\": \"测试开启关闭测试开启关闭测试开启关闭测试开启关闭\",\r\n            //     \"inputType\": \"开启/关闭\",\r\n            //     \"unit\": \"/\",\r\n            //     \"mainStatus\": \"启用中\",\r\n            //     \"bizType\": \"污水\",\r\n            //     \"objectType\": \"检查井\",\r\n            //     \"remarks\": null,\r\n            //     \"portalId\": null,\r\n            //     \"tenantId\": 100000,\r\n            //     \"mainValue\": \"关闭\"\r\n            //   },\r\n            //   {\r\n            //     \"id\": \"1655843007768236035\",\r\n            //     \"createBy\": \"fawkes\",\r\n            //     \"createDate\": \"2023-05-09 15:51:51\",\r\n            //     \"updateBy\": null,\r\n            //     \"updateDate\": null,\r\n            //     \"deleteFlag\": 0,\r\n            //     \"mainPoint\": \"测试是否测试是否测试是否测试是否\",\r\n            //     \"inputType\": \"是/否\",\r\n            //     \"unit\": \"/\",\r\n            //     \"mainStatus\": \"启用中\",\r\n            //     \"bizType\": \"污水\",\r\n            //     \"objectType\": \"检查井\",\r\n            //     \"remarks\": null,\r\n            //     \"portalId\": null,\r\n            //     \"tenantId\": 100000,\r\n            //     \"mainValue\": \"是\"\r\n            //   },\r\n            //   {\r\n            //     \"id\": \"1655843007768236035\",\r\n            //     \"createBy\": \"fawkes\",\r\n            //     \"createDate\": \"2023-05-09 15:51:51\",\r\n            //     \"updateBy\": null,\r\n            //     \"updateDate\": null,\r\n            //     \"deleteFlag\": 0,\r\n            //     \"mainPoint\": \"测试数值测试数值测试数值测试数值\",\r\n            //     \"inputType\": \"数值\",\r\n            //     \"unit\": \"/\",\r\n            //     \"mainStatus\": \"启用中\",\r\n            //     \"bizType\": \"污水\",\r\n            //     \"objectType\": \"检查井\",\r\n            //     \"remarks\": null,\r\n            //     \"portalId\": null,\r\n            //     \"tenantId\": 100000,\r\n            //     \"mainValue\": \"\"\r\n            //   }\r\n            // ]\r\n            console.log('当前业务及设施类型下的巡检要点list', _cloneDeep(this.keyPointsInspectionList),);\r\n          })\r\n          .catch(err => { })\r\n          .finally(() => {\r\n            this.signShow = true\r\n            // 未巡检\r\n            this.hasSignIn = false\r\n            this.signForm.remark = ''\r\n            this.signForm.liquidLevel = ''\r\n            this.signForm.ext3 = feature.bizType\r\n            this.signForm.deviceStatus = '0'\r\n            this.signForm.inspImagesList = []\r\n            this.signForm.pointId = feature.id\r\n            this.signForm.taskId = this.$route.query.taskId,\r\n            this.signForm.feature = feature\r\n          })\r\n      } else {\r\n        let toast = Toast.loading({\r\n          message: '正在加载',\r\n          forbidClick: true,\r\n          loadingType: 'spinner',\r\n          duration: 0\r\n        })\r\n        this.hasSignIn = true\r\n        let params = {\r\n          page: 1,\r\n          size: 999,\r\n          deviceStatus: feature.deviceStatus,\r\n          pointId: feature.id,\r\n          taskId: this.$route.query.taskId,\r\n        }\r\n        const res = await request({\r\n          url: '/xasw-pipe-operation/inspPointRecord/page',\r\n          method: 'get',\r\n          params: params,\r\n        })\r\n        if (res && res.status) {\r\n          let result = res.data.records[0]\r\n          this.signForm.deviceStatus = result.deviceStatus\r\n          this.signForm.remark = result.ext1\r\n          this.signForm.liquidLevel = result.liquidLevel\r\n          this.signForm.isReport = result.isReport\r\n          const att = await request({\r\n            url: '/xasw-pipe-operation/inspPointRecord',\r\n            method: 'get',\r\n            params: { id: result.id }\r\n          })\r\n          if (att && att.status) {\r\n            console.log('已巡检关键点详情数据', _cloneDeep(att));\r\n            this.signForm.inspImagesList = att.data.inspImagesList\r\n            this.attachment = att.data.inspImagesList[0].fileId\r\n            // 巡检要点list\r\n            this.keyPointsInspectionList = att?.data?.resultList || []\r\n          }\r\n          toast.clear()\r\n          this.signShow = true\r\n        }\r\n      }\r\n    },\r\n    // 深拷贝\r\n    deepClone(data) {\r\n      return JSON.parse(JSON.stringify(data))\r\n    },\r\n    reportEvent(feature) {\r\n      this.reportFooterShow = false\r\n      this.$router.push({\r\n        path: '/pages/inspectionManage/add-event',\r\n        query: {\r\n          taskId: this.taskDetail.taskId,\r\n          feature: feature,\r\n          rangeList: this.rangeList,\r\n          taskDetail: this.taskDetail,\r\n        },\r\n      })\r\n    },\r\n    GetDistance(coordArray1, coordArray2) {\r\n      let lng1 = coordArray1[0]\r\n      let lat1 = coordArray1[1]\r\n      let lng2 = coordArray2[0]\r\n      let lat2 = coordArray2[1]\r\n      let radLat1 = (lat1 * Math.PI) / 180.0\r\n      let radLat2 = (lat2 * Math.PI) / 180.0\r\n      let a = radLat1 - radLat2\r\n      let b = (lng1 * Math.PI) / 180.0 - (lng2 * Math.PI) / 180.0\r\n      let s =\r\n        2 *\r\n        Math.asin(\r\n          Math.sqrt(\r\n            Math.pow(Math.sin(a / 2), 2) +\r\n            Math.cos(radLat1) * Math.cos(radLat2) * Math.pow(Math.sin(b / 2), 2)\r\n          )\r\n        )\r\n      s = s * 6378.137 // EARTH_RADIUS;\r\n      s = Math.round(s * 10000) / 10000\r\n      return s\r\n    },\r\n    resetMapView() {\r\n      this.$refs.mymap && mapObj.map.resetNorthPitch()\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    Toast.clear()\r\n    this.pollingFlag = false\r\n    this.clearBufferTrack()\r\n    document.removeEventListener(\"pause\", this.pause)\r\n    document.removeEventListener(\"resume\", this.resume)\r\n    if (typeof yuanchu != 'undefined') {\r\n      yuanchu.locationAMap.stopRequestLocations()\r\n    }\r\n    localStorage.removeItem('startRecordLines')\r\n    bus.$off('startSignIn')\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n//隐藏滚动条\r\n&::-webkit-scrollbar {\r\n  display: none; //Chrome | Safari\r\n}\r\n/deep/.mapboxgl-popup-content {\r\n  width: auto;\r\n  min-width: 280px;\r\n  height: 50px;\r\n  padding: 24px 36px;\r\n  border-radius: 18px;\r\n  box-shadow: 10px 10px 30px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.task-map {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: hidden;\r\n\r\n  .content {\r\n    width: 100%;\r\n    height: 40%;\r\n    background: #ffffff;\r\n    box-shadow: 0px -6px 12px 0px rgba(104, 115, 127, 0.1);\r\n    border-radius: 30px 30px 0 0;\r\n    position: absolute;\r\n    bottom: 0;\r\n    z-index: 4;\r\n    transition: all 0.5s;\r\n    .contentArea {\r\n      width: 100%;\r\n      height: 100%;\r\n      background: #f5f7f9;\r\n      display: flex;\r\n      flex-direction: column;\r\n      .buttonArea {\r\n        width: var(--width);\r\n        padding: 30px 20px;\r\n        display: flex;\r\n        .button {\r\n          min-width: 160px;\r\n          margin: 0 10px;\r\n          border: none;\r\n          box-shadow: 0px 4px 16px 0px rgba(104, 115, 127, 0.06);\r\n        }\r\n      }\r\n      .listArea {\r\n        margin: 0 4%;\r\n        background: #ffffff;\r\n        height: calc(100% - 148px);\r\n        padding: 20px 36px 0;\r\n        border-radius: 16px 16px 0 0;\r\n        overflow-y: scroll;\r\n        .list {\r\n          height: 45px;\r\n          display: flex;\r\n          padding: 40px 0;\r\n          border-bottom: 1px solid #eeeeee;\r\n          .list_num {\r\n            min-width: 60px;\r\n            margin-right: 30px;\r\n            margin-left: 10px;\r\n            height: 43px;\r\n            font-size: 36px;\r\n            font-family: Helvetica-Bold, Helvetica;\r\n            font-weight: bold;\r\n            color: #1b67d8;\r\n            line-height: 43px;\r\n          }\r\n          .list_type {\r\n            min-width: 160px;\r\n            height: 45px;\r\n            font-size: 32px;\r\n            font-family: PingFangSC-Regular, PingFang SC;\r\n            font-weight: 400;\r\n            color: #333333;\r\n            line-height: 45px;\r\n          }\r\n          .list_id {\r\n            min-width: 200px;\r\n            height: 45px;\r\n            font-size: 32px;\r\n            font-family: PingFangSC-Regular, PingFang SC;\r\n            font-weight: 400;\r\n            color: #333333;\r\n            line-height: 45px;\r\n          }\r\n          .list_deal {\r\n            height: 45px;\r\n            font-size: 32px;\r\n            font-family: PingFangSC-Regular, PingFang SC;\r\n            font-weight: 400;\r\n            color: #1b67d8;\r\n            line-height: 45px;\r\n            display: flex;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .inactive {\r\n    height: 0;\r\n  }\r\n\r\n  .tip-tools {\r\n    position: fixed;\r\n    display: flex;\r\n    top: 15%;\r\n    left: 200px;\r\n    border-radius: 16px;\r\n    padding: 24px;\r\n    background: #FFFFFF;\r\n    box-shadow: 0px 10px 18px 0px rgba(0, 0, 0, 0.06);\r\n    border: 2px solid rgba(23, 144, 254, 0.6);\r\n\r\n    .tipImg {\r\n      width: 32px;\r\n      height: 32px;\r\n      margin-right: 16px;\r\n    }\r\n\r\n    .context {\r\n      font-size: 24px;\r\n      font-family: MicrosoftYaHei;\r\n      color: #1B67D8;\r\n      line-height: 31px;\r\n    }\r\n  }\r\n\r\n  .confirm-tip {\r\n    width: 80%;\r\n    height: 44%;\r\n    margin: auto;\r\n    background: #FFFFFF;\r\n    border-radius: 16px;\r\n    margin: 50% auto;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    /deep/.contentSelf {\r\n      height: calc(100% - 164px);\r\n      padding: 32px;\r\n      display: flex;\r\n      flex-direction: column;\r\n      .icon {\r\n        width: 100%;\r\n        height: 100px;\r\n        display: flex;\r\n        margin: 24px 0 28px;\r\n      }\r\n      .info {\r\n        height: auto;\r\n        font-size: 28px;\r\n        font-family: PingFangSC-Regular, PingFang SC;\r\n        font-weight: 400;\r\n        color: #555555;\r\n        line-height: 40px;\r\n        text-align: center;\r\n      }\r\n    }\r\n    /deep/.confirm_btn {\r\n      width: 100%;\r\n      height: 100px;\r\n      display: flex;\r\n      .btn1 {\r\n        width: 50%;\r\n        height: 100%;\r\n        border-top: 1px solid #DCDEE3;\r\n        font-size: 32px;\r\n        font-family: PingFangSC-Regular, PingFang SC;\r\n        font-weight: 400;\r\n        color: #333333;\r\n        line-height: 100px;\r\n        text-align: center;\r\n      }\r\n      .btn2 {\r\n        border-right: 1px solid #DCDEE3;\r\n      }\r\n    }\r\n  }\r\n\r\n  .alert {\r\n    top: 2.22rem;\r\n    position: fixed;\r\n    width: 100%;\r\n    z-index: 4;\r\n    background-color: #62707c;\r\n    opacity: 0.5;\r\n    font-size: 1rem;\r\n\r\n    .u-alert-content {\r\n      width: 100%;\r\n    }\r\n  }\r\n\r\n  .progress {\r\n    width: 80%;\r\n    height: 1rem;\r\n    background-color: #fff;\r\n    box-shadow: 0 0.4rem 0.6rem 0 rgba(0, 0, 0, 0.2);\r\n    border-radius: 0.1rem;\r\n    margin: 0 0.3rem;\r\n    padding: 0.1rem 0.15rem;\r\n    position: fixed;\r\n    top: 2.5rem;\r\n\r\n    &-box {\r\n      width: 100%;\r\n      margin: 0.3rem 0;\r\n      display: flex;\r\n\r\n      .pro-dot {\r\n        width: 0.3rem;\r\n        height: 0.3rem;\r\n        border-radius: 50%;\r\n        float: left;\r\n        margin: auto 0.3rem;\r\n      }\r\n\r\n      .pro-text {\r\n        line-height: 0.5rem;\r\n        display: flex;\r\n        font-size: 12px;\r\n        float: left;\r\n      }\r\n    }\r\n  }\r\n\r\n  .pro-circle {\r\n    position: fixed;\r\n    width: 1rem;\r\n    height: 1rem;\r\n    right: 0.1rem;\r\n    padding: 0.1rem;\r\n    top: 2.5rem;\r\n    // margin: 0.27rem 0rem;\r\n    background-color: #fff;\r\n    z-index: 3;\r\n    box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n    border-radius: 0.1rem;\r\n\r\n    .progress-text-view {\r\n      font-size: 0.4rem;\r\n      z-index: 4;\r\n\r\n      .progress-text-up {\r\n        color: #306cc8;\r\n      }\r\n\r\n      .progress-text-down {\r\n        border-top: 0.05rem solid #555555;\r\n      }\r\n    }\r\n  }\r\n\r\n  .point-list {\r\n    position: fixed;\r\n    width: 1.2rem;\r\n    height: 1.2rem;\r\n    left: 0.3rem;\r\n    bottom: 2rem;\r\n    background-color: #fff;\r\n    z-index: 3;\r\n    box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n    border-radius: 0.27rem;\r\n\r\n    .list-image {\r\n      margin: 0.18rem;\r\n      width: 0.82rem;\r\n      height: 0.82rem;\r\n    }\r\n  }\r\n\r\n  .footer {\r\n    width: inherit;\r\n    padding: 1.11rem 0.83rem;\r\n    color: #333333;\r\n    background-color: #ffffff;\r\n    height: 3.55rem;\r\n    z-index: 4;\r\n    position: fixed;\r\n    bottom: 0rem;\r\n\r\n    &-content {\r\n      float: left;\r\n    }\r\n\r\n    &-btn {\r\n      float: right;\r\n      width: 4.44rem;\r\n      height: 1.77rem;\r\n      line-height: 1.77rem;\r\n      border-radius: 0.88rem;\r\n    }\r\n  }\r\n\r\n  .start-record {\r\n    position: absolute;\r\n    z-index: 3;\r\n    left: 50%;\r\n    bottom: 235px;\r\n    transform: translate(-50%, 0);\r\n\r\n    img {\r\n      width: 140px;\r\n      height: 140px;\r\n    }\r\n  }\r\n\r\n  .controlCard {\r\n    width: 100%;\r\n    height: 328px;\r\n    position: absolute;\r\n    bottom: 0;\r\n    background-image: url('~@/assets/img/inspection/controlBg.png');\r\n    background-repeat: no-repeat;\r\n    background-size: 100%;\r\n\r\n    .controlContent {\r\n      margin: 60px 30px 0;\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      .infoContent {\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-around;\r\n        margin-bottom: 24px;\r\n\r\n        .block {\r\n          text-align: center;\r\n          width: 210px;\r\n          height: 160px;\r\n          display: flex;\r\n          flex-direction: column;\r\n          align-items: center;\r\n          background: rgba(27, 103, 216, 0.05);\r\n          border-radius: 16px;\r\n          // margin: 0 20px;\r\n\r\n          .rate {\r\n            width: 100%;\r\n            height: 50%;\r\n            display: flex;\r\n            align-items: center;\r\n            margin: auto;\r\n            font-size: 48px;\r\n            font-family: Helvetica-Bold, Helvetica;\r\n            font-weight: bold;\r\n            color: #306cc8;\r\n\r\n            .centerStyle {\r\n              margin: auto;\r\n              display: flex;\r\n              align-items: center;\r\n              font-size: 38px;\r\n              font-family: Helvetica-Bold, Helvetica;\r\n              font-weight: bold;\r\n\r\n              .inspKp {\r\n                padding-bottom: 3px;\r\n                padding-right: 3px;\r\n                color: #306cc8;\r\n              }\r\n\r\n              .uninspKp {\r\n                color: #191919;\r\n                letter-spacing: 3px;\r\n              }\r\n            }\r\n          }\r\n\r\n          .name {\r\n            font-size: 14px;\r\n            font-family: PingFangSC-Regular, PingFang SC;\r\n            font-weight: 400;\r\n            color: #555555;\r\n            width: 100%;\r\n            height: 33%;\r\n          }\r\n        }\r\n      }\r\n\r\n      .bottomSide {\r\n        width: 100%;\r\n        display: flex;\r\n        margin-top: 24px;\r\n        justify-content: space-around;\r\n      }\r\n\r\n      .endControl {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n\r\n        .leftText {\r\n          width: 27%;\r\n          display: flex;\r\n          justify-content: space-around;\r\n          align-items: center;\r\n\r\n          img {\r\n            width: 32px;\r\n            height: 32px;\r\n            margin: auto;\r\n          }\r\n\r\n          /deep/.fm-count-down {\r\n            font-size: 24px;\r\n            color: #306cc8;\r\n          }\r\n        }\r\n\r\n        .rightButton {\r\n          display: flex;\r\n\r\n          .endBtn {\r\n            font-size: 24px;\r\n            width: 120px;\r\n            height: 60px;\r\n            background: #ffffff;\r\n            color: #306cc8;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .viewCard {\r\n    width: 100%;\r\n    height: 260px;\r\n    position: absolute;\r\n    bottom: 0;\r\n    background: #FFFFFF;\r\n    box-shadow: 0px 0px 18px 0px rgba(104, 115, 127, 0.18);\r\n    // background-image: url('~@/assets/img/inspection/controlBg.png');\r\n    // background-repeat: no-repeat;\r\n    // background-size: 100%;\r\n\r\n    .controlContent {\r\n      margin: 32px 30px 0;\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      .infoContent {\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-around;\r\n        margin-bottom: 24px;\r\n\r\n        .block {\r\n          text-align: center;\r\n          width: 210px;\r\n          height: 160px;\r\n          display: flex;\r\n          flex-direction: column;\r\n          align-items: center;\r\n          background: rgba(27, 103, 216, 0.05);\r\n          border-radius: 16px;\r\n          // margin: 0 20px;\r\n\r\n          .rate {\r\n            width: 100%;\r\n            height: 50%;\r\n            display: flex;\r\n            align-items: center;\r\n            margin: auto;\r\n            font-size: 48px;\r\n            font-family: Helvetica-Bold, Helvetica;\r\n            font-weight: bold;\r\n            color: #306cc8;\r\n\r\n            .centerStyle {\r\n              margin: auto;\r\n              display: flex;\r\n              align-items: center;\r\n              font-size: 38px;\r\n              font-family: Helvetica-Bold, Helvetica;\r\n              font-weight: bold;\r\n\r\n              .inspKp {\r\n                padding-bottom: 3px;\r\n                padding-right: 3px;\r\n                color: #306cc8;\r\n              }\r\n\r\n              .uninspKp {\r\n                color: #191919;\r\n                letter-spacing: 3px;\r\n              }\r\n            }\r\n          }\r\n\r\n          .name {\r\n            font-size: 14px;\r\n            font-family: PingFangSC-Regular, PingFang SC;\r\n            font-weight: 400;\r\n            color: #555555;\r\n            width: 100%;\r\n            height: 33%;\r\n          }\r\n        }\r\n      }\r\n\r\n      .bottomSide {\r\n        width: 100%;\r\n        display: flex;\r\n        margin-top: 24px;\r\n        justify-content: space-around;\r\n      }\r\n\r\n      .endControl {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n\r\n        .leftText {\r\n          width: 27%;\r\n          display: flex;\r\n          justify-content: space-around;\r\n          align-items: center;\r\n\r\n          img {\r\n            width: 32px;\r\n            height: 32px;\r\n            margin: auto;\r\n          }\r\n\r\n          /deep/.fm-count-down {\r\n            font-size: 24px;\r\n            color: #306cc8;\r\n          }\r\n        }\r\n\r\n        .rightButton {\r\n          display: flex;\r\n\r\n          .endBtn {\r\n            font-size: 24px;\r\n            width: 120px;\r\n            height: 60px;\r\n            background: #ffffff;\r\n            color: #306cc8;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .tool-box {\r\n    position: fixed;\r\n    width: 1.2rem;\r\n    height: auto;\r\n    right: 0.3rem;\r\n    bottom: 350px;\r\n\r\n    .refresh {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .route {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .location {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 60px;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n  }\r\n\r\n  /deep/.fm-popup {\r\n    background: #f5f7f9;\r\n  }\r\n\r\n  .popup-view {\r\n    height: auto;\r\n    width: auto;\r\n    margin: 32px;\r\n    overflow: scroll;\r\n    border-radius: 32px;\r\n    background-color: #fff;\r\n\r\n    /deep/.fm-radio--horizontal {\r\n      margin-right: 20px;\r\n    }\r\n\r\n    .title {\r\n      display: flex;\r\n      margin-top: 32px;\r\n      padding-bottom: 32px;\r\n      border-bottom: 1px #f5f5f5 solid;\r\n\r\n      img {\r\n        width: 6px;\r\n        height: 40px;\r\n      }\r\n\r\n      .deviceId {\r\n        margin-left: 32px;\r\n        font-size: 36px;\r\n        font-family: PingFangSC-Semibold, PingFang SC;\r\n        font-weight: 600;\r\n        color: #191919;\r\n        line-height: 50px;\r\n      }\r\n    }\r\n\r\n    /deep/.fm-uploader__wrapper {\r\n      margin-left: 16px;\r\n    }\r\n\r\n    .preview-cover {\r\n      position: absolute;\r\n      bottom: 0;\r\n      box-sizing: border-box;\r\n      width: 100%;\r\n      padding: 4px;\r\n      color: #fff;\r\n      font-size: 12px;\r\n      text-align: center;\r\n      background: rgba(0, 0, 0, 0.3);\r\n    }\r\n  }\r\n\r\n  .btnArea {\r\n    display: flex;\r\n\r\n    .btn {\r\n      width: 94%;\r\n      margin: 0 auto;\r\n    }\r\n\r\n    .btn1 {\r\n      width: 44%;\r\n      margin: 0 12px 0 30px;\r\n    }\r\n\r\n    .btn2 {\r\n      width: 44%;\r\n      margin: 0 30px 0 12px;\r\n    }\r\n  }\r\n\r\n  .confirm-pop {\r\n    .title {\r\n      border-left: 0.22rem solid #306cc8;\r\n      margin: 0.27rem;\r\n      padding-left: 0.55rem;\r\n    }\r\n\r\n    .content {\r\n      border-top: 0.027rem solid rgba(128, 128, 128, 0.322);\r\n      width: 11.66rem;\r\n      padding: 1.33rem;\r\n      text-align: center;\r\n      background-color: #fff;\r\n\r\n      &-view {\r\n        font-size: 0.88rem;\r\n      }\r\n\r\n      .confirm-btn {\r\n        margin-top: 2.22rem;\r\n        justify-items: center;\r\n\r\n        .popup-btn {\r\n          float: left;\r\n          width: 3.33rem;\r\n          height: 1.77rem;\r\n          border-radius: 0.27rem;\r\n\r\n          &-l {\r\n            margin-left: 0.55rem;\r\n            margin-right: 0.55rem;\r\n          }\r\n\r\n          &-r {\r\n            margin-left: 0.55rem;\r\n            margin-right: 0.55rem;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}