{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\TerminatedTask.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\TerminatedTask.vue","mtime":1708928163416},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgSW5zcGVjdGlvblN1Ym1pdENhcmQgZnJvbSAnLi9JbnNwZWN0aW9uU3VibWl0Q2FyZC52dWUnDQppbXBvcnQgeyBwYXRyb2wsIHBhdHJvbEVkaXQsIHVwbG9hZFRyYWNrTGlzdCB9IGZyb20gJy4uL2FwaScNCmV4cG9ydCBkZWZhdWx0IHsNCiAgY29tcG9uZW50czogeyBJbnNwZWN0aW9uU3VibWl0Q2FyZCB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICByZWFzb246ICcnLA0KICAgICAgc2hvdzogZmFsc2UsDQogICAgICBQYXRyb2xEYXRhOiBudWxsLA0KICAgICAgcGF0cm9sUG9pbnRSZXN1bHRMaXN0OiBbXSwNCiAgICB9DQogIH0sDQoNCiAgY3JlYXRlZCgpIHsNCiAgICB0aGlzLmdldFBhdHJvbCgpDQogIH0sDQogIGJlZm9yZURlc3Ryb3koKSB7DQogICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRVcmxRdWVyeScsIHsNCiAgICAgIHRhc2tJZDogdGhpcy4kc3RvcmUuc3RhdGUucHVtcC51cmxRdWVyeS50YXNrSWQsDQogICAgICBmaXJzdENvbmZpZzogZmFsc2UsDQogICAgfSkNCg0KICAgIHRoaXMuc3RvcFJlcXVlc3RMb2NhdGlvbnMoKQ0KICB9LA0KDQogIG1ldGhvZHM6IHsNCiAgICAvL+iOt+WPlueUqOaIt+W3oeajgOeCuQ0KICAgIGFzeW5jIGdldFBhdHJvbCgpIHsNCiAgICAgIGxldCB7IHRhc2tJZCB9ID0gdGhpcy4kc3RvcmUuc3RhdGUucHVtcC51cmxRdWVyeQ0KICAgICAgY29uc3Qgew0KICAgICAgICBkYXRhLA0KICAgICAgICBkYXRhOiB7IHBhdHJvbFBvaW50UmVzdWx0TGlzdCB9LA0KICAgICAgfSA9IGF3YWl0IHBhdHJvbCh0YXNrSWQpDQogICAgICB0aGlzLlBhdHJvbERhdGEgPSBkYXRhDQogICAgICB0aGlzLnBhdHJvbFBvaW50UmVzdWx0TGlzdCA9IHBhdHJvbFBvaW50UmVzdWx0TGlzdA0KDQogICAgICB0aGlzLnJlcXVlc3RTaW5nbGVMb2NhdGlvbigpDQogICAgfSwNCg0KICAgIC8v5byA5aeL5beh5qOADQogICAgcmVxdWVzdFNpbmdsZUxvY2F0aW9uKCkgew0KICAgICAgaWYgKHR5cGVvZiB5dWFuY2h1ICE9ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHl1YW5jaHUubG9jYXRpb25BTWFwLnJlcXVlc3RTaW5nbGVMb2NhdGlvbigNCiAgICAgICAgICBbJzEnXSwNCiAgICAgICAgICAocmVzKSA9PiB7DQogICAgICAgICAgICBsZXQgeyBsYXRpdHVkZSwgbG9uZ2l0dWRlIH0gPSByZXMNCiAgICAgICAgICAgIGxldCBwYXRoID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLiRzdG9yZS5zdGF0ZS5wdW1wLnB1bXBQYXRoKSkNCiAgICAgICAgICAgIHBhdGgucHVzaCh7DQogICAgICAgICAgICAgIGxhdDogbGF0aXR1ZGUsDQogICAgICAgICAgICAgIGxvbjogbG9uZ2l0dWRlLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0UHVtcFBhdGgnLCBwYXRoKQ0KDQogICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLiRzdG9yZS5zdGF0ZS5wdW1wLnB1bXBQYXRoKQ0KICAgICAgICAgIH0sDQogICAgICAgICAgKGVycikgPT4gew0KICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycj0nLCBlcnIpDQogICAgICAgICAgfQ0KICAgICAgICApDQogICAgICB9DQogICAgfSwNCg0KICAgIC8v57uT5p2f5beh5qOADQogICAgc3RvcFJlcXVlc3RMb2NhdGlvbnMoKSB7DQogICAgICBpZiAodHlwZW9mIHl1YW5jaHUgIT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgeXVhbmNodS5sb2NhdGlvbkFNYXAuc3RvcFJlcXVlc3RMb2NhdGlvbnMoKQ0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvL+eCueWHu+aPkOS6pOaMiemSrg0KICAgIHN1Ym1pdCgpIHsNCiAgICAgIGlmICh0aGlzLnJlYXNvbiA9PT0gJycpIHsNCiAgICAgICAgdGhpcy4kdG9hc3QoJ+ivt+Whq+WGmee7iOatouWOn+WboCcpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KDQogICAgICB0aGlzLmlzVW5zdWJtaXR0ZWQoKQ0KDQogICAgICB0aGlzLlBhdHJvbERhdGEgPSB7DQogICAgICAgIC4uLnRoaXMuUGF0cm9sRGF0YSwNCiAgICAgICAgaWQ6IHRoaXMuJHN0b3JlLnN0YXRlLnB1bXAudXJsUXVlcnkudGFza0lkLA0KICAgICAgICBwYXRyb2xFbmRUaW1lOiB0aGlzLiRkYXlqcygpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcycpLA0KICAgICAgICBzdWJtaXRUaW1lOiB0aGlzLiRkYXlqcygpLmZvcm1hdCgnWVlZWS1NTS1ERCBISDptbTpzcycpLA0KICAgICAgICBwYXRyb2xTdGF0dXM6IDQsDQogICAgICAgIGVuZFJlYXNvbjogdGhpcy5yZWFzb24sDQogICAgICAgIHBhdHJvbFBvaW50UmVzdWx0TGlzdDogdGhpcy5wYXRyb2xQb2ludFJlc3VsdExpc3QsDQogICAgICB9DQoNCiAgICAgIHRoaXMuc2hvdyA9IHRydWUNCiAgICB9LA0KDQogICAgLy/mo4Dmn6XmmK/lkKbmnInmnKrmj5DkuqTpobks5bm25o+Q5LqkDQogICAgYXN5bmMgaXNVbnN1Ym1pdHRlZCgpIHsNCiAgICAgIGxldCBzdG9yYWdlSXRlbURhdGFMaXN0ID0gSlNPTi5wYXJzZSh0aGlzLiRzdG9yYWdlLmdldCgncHVtcC1zdG9yYWdlSXRlbURhdGFMaXN0JykpDQogICAgICB0aGlzLnBhdHJvbFBvaW50UmVzdWx0TGlzdD8uZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsNCiAgICAgICAgc3RvcmFnZUl0ZW1EYXRhTGlzdD8uZm9yRWFjaCgoZGF0YSwgaSkgPT4gew0KICAgICAgICAgIGl0ZW0uaWQgPT09IGRhdGEuaWQgPyAodGhpcy5wYXRyb2xQb2ludFJlc3VsdExpc3RbaW5kZXhdID0gc3RvcmFnZUl0ZW1EYXRhTGlzdFtpXSkgOiBudWxsDQogICAgICAgIH0pDQogICAgICB9KQ0KDQogICAgICB0aGlzLiRzdG9yYWdlLnJlbW92ZSgncHVtcC1zdG9yYWdlSXRlbURhdGFMaXN0JykNCiAgICB9LA0KDQogICAgLy/ojrflj5blrp7pmYXlt6Hmo4DkuroNCiAgICBnZXRBY3R1YWxQZXJzb24oYWN0dWFsUGVyc29uKSB7DQogICAgICB0aGlzLiRzZXQodGhpcy5QYXRyb2xEYXRhLCdhY3R1YWxQZXJzb24nLGFjdHVhbFBlcnNvbikNCiAgICB9LA0KDQogICAgLy/mj5DkuqTnu4jmraLku7vliqENCiAgICBhc3luYyBvbkNvbmZpcm0oKSB7DQogICAgICB0cnkgew0KICAgICAgICBsZXQgcXVlcnkgPSB7DQogICAgICAgICAgcGF0cm9sVGFza0lkOiB0aGlzLiRzdG9yZS5zdGF0ZS5wdW1wLnVybFF1ZXJ5LnRhc2tJZCwNCiAgICAgICAgICB0cmFja0RUT1M6IHRoaXMuJHN0b3JlLnN0YXRlLnB1bXAucHVtcFBhdGgsDQogICAgICAgIH0NCg0KICAgICAgICBjb25zdCBwYXRoID0gYXdhaXQgdXBsb2FkVHJhY2tMaXN0KHF1ZXJ5KQ0KICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFB1bXBQYXRoJywgW10pDQoNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcGF0cm9sRWRpdCh0aGlzLlBhdHJvbERhdGEpDQogICAgICAgIHRoaXMuJHJvdXRlci5yZXBsYWNlKCcvcHVtcC9pbnNwZWN0aW9uTWFuYWdlJykNCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUubG9nKGVycm9yKQ0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvL+i/lOWbnuWIl+ihqOmhtQ0KICAgIGdvVG8oKSB7DQogICAgICB0aGlzLiRyb3V0ZXIucmVwbGFjZSh7DQogICAgICAgIHBhdGg6ICcvcHVtcC9pbnNwZWN0aW9uJywNCiAgICAgIH0pDQogICAgfSwNCiAgfSwNCn0NCg=="},{"version":3,"sources":["TerminatedTask.vue"],"names":[],"mappings":";AAgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TerminatedTask.vue","sourceRoot":"src/views/PumpStationInspection/components","sourcesContent":["<template>\r\n  <div class=\"terminated-task\">\r\n    <fm-nav-bar title=\"任务终止\" left-arrow @click-left=\"goTo()\" />\r\n    <div class=\"terminated-task-content\">\r\n      <div class=\"terminated-task-remark\">任务终止需要填写终止原因</div>\r\n\r\n      <fm-field\r\n        class=\"field\"\r\n        v-model=\"reason\"\r\n        label=\"终止原因\"\r\n        autosize\r\n        maxlength=\"500\"\r\n        show-word-limit\r\n        type=\"textarea\"\r\n        placeholder=\"请填写终止原因\"\r\n      />\r\n\r\n      <fm-button type=\"primary\" class=\"terminated-task-submit\" @click=\"submit()\">提交</fm-button>\r\n      <fm-dialog\r\n        :visible.sync=\"show\"\r\n        title=\"巡检任务提交\"\r\n        @confirm=\"onConfirm\"\r\n        show-cancel-button\r\n        width=\"331\"\r\n      >\r\n        <inspection-submit-card :PatrolData=\"PatrolData\"  :reason=\"reason\" @getActualPerson='getActualPerson' />\r\n      </fm-dialog>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport InspectionSubmitCard from './InspectionSubmitCard.vue'\r\nimport { patrol, patrolEdit, uploadTrackList } from '../api'\r\nexport default {\r\n  components: { InspectionSubmitCard },\r\n  data() {\r\n    return {\r\n      reason: '',\r\n      show: false,\r\n      PatrolData: null,\r\n      patrolPointResultList: [],\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getPatrol()\r\n  },\r\n  beforeDestroy() {\r\n    this.$store.commit('setUrlQuery', {\r\n      taskId: this.$store.state.pump.urlQuery.taskId,\r\n      firstConfig: false,\r\n    })\r\n\r\n    this.stopRequestLocations()\r\n  },\r\n\r\n  methods: {\r\n    //获取用户巡检点\r\n    async getPatrol() {\r\n      let { taskId } = this.$store.state.pump.urlQuery\r\n      const {\r\n        data,\r\n        data: { patrolPointResultList },\r\n      } = await patrol(taskId)\r\n      this.PatrolData = data\r\n      this.patrolPointResultList = patrolPointResultList\r\n\r\n      this.requestSingleLocation()\r\n    },\r\n\r\n    //开始巡检\r\n    requestSingleLocation() {\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.requestSingleLocation(\r\n          ['1'],\r\n          (res) => {\r\n            let { latitude, longitude } = res\r\n            let path = JSON.parse(JSON.stringify(this.$store.state.pump.pumpPath))\r\n            path.push({\r\n              lat: latitude,\r\n              lon: longitude,\r\n            })\r\n            this.$store.commit('setPumpPath', path)\r\n\r\n            console.log(this.$store.state.pump.pumpPath)\r\n          },\r\n          (err) => {\r\n            console.log('err=', err)\r\n          }\r\n        )\r\n      }\r\n    },\r\n\r\n    //结束巡检\r\n    stopRequestLocations() {\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.stopRequestLocations()\r\n      }\r\n    },\r\n\r\n    //点击提交按钮\r\n    submit() {\r\n      if (this.reason === '') {\r\n        this.$toast('请填写终止原因')\r\n        return\r\n      }\r\n\r\n      this.isUnsubmitted()\r\n\r\n      this.PatrolData = {\r\n        ...this.PatrolData,\r\n        id: this.$store.state.pump.urlQuery.taskId,\r\n        patrolEndTime: this.$dayjs().format('YYYY-MM-DD HH:mm:ss'),\r\n        submitTime: this.$dayjs().format('YYYY-MM-DD HH:mm:ss'),\r\n        patrolStatus: 4,\r\n        endReason: this.reason,\r\n        patrolPointResultList: this.patrolPointResultList,\r\n      }\r\n\r\n      this.show = true\r\n    },\r\n\r\n    //检查是否有未提交项,并提交\r\n    async isUnsubmitted() {\r\n      let storageItemDataList = JSON.parse(this.$storage.get('pump-storageItemDataList'))\r\n      this.patrolPointResultList?.forEach((item, index) => {\r\n        storageItemDataList?.forEach((data, i) => {\r\n          item.id === data.id ? (this.patrolPointResultList[index] = storageItemDataList[i]) : null\r\n        })\r\n      })\r\n\r\n      this.$storage.remove('pump-storageItemDataList')\r\n    },\r\n\r\n    //获取实际巡检人\r\n    getActualPerson(actualPerson) {\r\n      this.$set(this.PatrolData,'actualPerson',actualPerson)\r\n    },\r\n\r\n    //提交终止任务\r\n    async onConfirm() {\r\n      try {\r\n        let query = {\r\n          patrolTaskId: this.$store.state.pump.urlQuery.taskId,\r\n          trackDTOS: this.$store.state.pump.pumpPath,\r\n        }\r\n\r\n        const path = await uploadTrackList(query)\r\n        this.$store.commit('setPumpPath', [])\r\n\r\n        const res = await patrolEdit(this.PatrolData)\r\n        this.$router.replace('/pump/inspectionManage')\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    },\r\n\r\n    //返回列表页\r\n    goTo() {\r\n      this.$router.replace({\r\n        path: '/pump/inspection',\r\n      })\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.terminated-task {\r\n  height: 100%;\r\n  background: #f5f7f9;\r\n\r\n  .terminated-task-content {\r\n    padding: 0 30px;\r\n  }\r\n\r\n  .terminated-task-remark {\r\n    display: flex;\r\n    align-items: center;\r\n    height: 74px;\r\n    font-size: 28px;\r\n    color: #999;\r\n  }\r\n\r\n  .field {\r\n    height: auto !important;\r\n    min-height: 300px;\r\n    max-height: 70vh;\r\n    overflow: scroll;\r\n    border-radius: 16px !important;\r\n  }\r\n\r\n  .terminated-task-submit {\r\n    width: 100%;\r\n    height: 88px;\r\n    border-radius: 44px;\r\n    margin-top: 60px;\r\n  }\r\n}\r\n</style>\r\n"]}]}