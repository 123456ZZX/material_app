{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\inspectionManage\\keypoint-list.vue?vue&type=style&index=0&id=444f855e&lang=scss&scoped=true","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\inspectionManage\\keypoint-list.vue","mtime":1705912800086},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoNCi5wdWxsLWJhciB7DQogIC5jb250ZW50IHsNCiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOw0KICAgIG1hcmdpbjogMC4ycmVtIDAuNTVyZW07DQogICAgLy8gYm94LXNpemluZzogY29udGVudC1ib3g7DQogICAgLmhlYWQgew0KICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIH0NCiAgICAudGFibGUgew0KICAgICAgbWFyZ2luLXRvcDogMXJlbTsNCiAgICAgIC51LXRkIHsNCiAgICAgICAgaGVpZ2h0OiAyLjdyZW07DQogICAgICB9DQogICAgICAubnVtIHsNCiAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgIGhlaWdodDogMnJlbTsNCiAgICAgICAgbGluZS1oZWlnaHQ6IDJyZW07DQogICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgICAvLyB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgICAgICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsNCiAgICAgICAgLW8tdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7DQogICAgICB9DQogICAgICAuZml4ZWQgew0KICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgLmJ0biB7DQogICAgICAgICAgY29sb3I6ICMyQTgzRTY7DQogICAgICAgICAgbWFyZ2luOiBhdXRvOw0KICAgICAgICB9DQogICAgICAgIC5kaXNhYmxlZCB7DQogICAgICAgICAgY29sb3I6IGdyZXk7DQogICAgICAgICAgbWFyZ2luOiBhdXRvOw0KICAgICAgICB9DQogICAgICAgIC50YWcgew0KICAgICAgICAgIGJveC1zaXppbmc6IGNvbnRlbnQtYm94Ow0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9DQp9DQoNCg=="},{"version":3,"sources":["keypoint-list.vue"],"names":[],"mappings":";;AA8JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"keypoint-list.vue","sourceRoot":"src/views/inspectionManage","sourcesContent":["<template>\r\n    <div class=\"content\">\r\n      <div class=\"head\">\r\n        <!-- 分段 -->\r\n        <!-- <u-subsection\r\n          mode=\"subsection\"\r\n          :list=\"subSectionlist\" \r\n          :current=\"current\" \r\n          active-color=\"#2A83E6\"\r\n          @change=\"onChange\"></u-subsection> -->\r\n      </div>\r\n      <div class=\"table\">\r\n        <fm-list\r\n          style=\"height:70%; max-height: 20rem;\"\r\n        >\r\n          <!-- <u-table border-color=\"#fff\"> -->\r\n            <!-- 表头 -->\r\n            <!-- <u-tr>\r\n              <u-th v-for=\"(item, index) in theaderList\" :key=\"index\" :width=\"index === 2 ? '30%' : '35%'\">\r\n                {{item}}\r\n              </u-th>\r\n            </u-tr> -->\r\n            <!-- 表内容 -->\r\n            <!-- <u-tr v-for=\"(item, index) in pointList\" :key=\"index\">\r\n              <u-td>\r\n                <view class=\"num\">\r\n                  {{item.num === 'no_equipment' ? '-' : item.num}}\r\n                </view>\r\n              </u-td>\r\n              <u-td>\r\n                <view class=\"num\">\r\n                  {{item.name}}\r\n                </view>\r\n              </u-td>\r\n              <u-td class=\"fixed\" width=\"30%\">\r\n                <view v-if=\"current === 0\" :class=\"item.isInBuffer ? 'btn' : 'disabled'\" @click=\"handleReport(item.engId, item.isInBuffer)\">上报</view>\r\n                <u-tag v-else class=\"tag\" :text=\"item.result\" :type=\" item.result === '正常' ?'success' :'error'\" :closeable=\"false\"></u-tag>\r\n              </u-td>\r\n            </u-tr>\r\n          </u-table> -->\r\n          <fm-empty v-if=\"pointList.length <= 0\" description=\"暂无数据\" mode=\"list\"></fm-empty>\r\n        </fm-list>\r\n      </div>\r\n    </div>\r\n  <!-- <PullupBar class=\"pull-bar\" :initTop=\"initTop\" :showClose=\"true\" @close=\"$emit('close')\">\r\n  </PullupBar> -->\r\n</template>\r\n<script>\r\n// import PullupBar from \"@comp/pullup-bar/index2.vue\";\r\nimport * as turf from '@turf/turf'\r\nexport default {\r\n  name: 'keypoint-list',\r\n  components: {\r\n    // PullupBar\r\n  },\r\n  props: {\r\n    keyPointList: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    position: {\r\n      type: Object,\r\n      default: () => null\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      initTop: '70%',\r\n      subSectionlist: [\r\n        {\r\n          name: '未上报关键点'\r\n        },{\r\n          name: '已上报关键点'\r\n        }\r\n      ],\r\n      current: 0,\r\n      result: {\r\n        'true': '正常',\r\n        'false': '异常'\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    theaderList() {\r\n      return this.current === 0 ?\r\n        [\r\n          \"对象编号\",\"对象名称\",\"操作\"\r\n        ]\r\n        :[\r\n          \"对象编号\",\"对象名称\",\"巡检结果\"\r\n        ];\r\n    },\r\n    pointList() {\r\n      const { keyPointList, result } = this;\r\n      const list = keyPointList.map(item => {\r\n        return {\r\n          engId: item?.engInfoDTO.engId,\r\n          num: item?.engInfoDTO.engNum,\r\n          name: item?.engInfoDTO.engName,\r\n          result: item?.inspectionTaskDetailDTO?.inspectionTaskDetail?.inspItemResult,\r\n          isInBuffer: this.isInKeyPointBuffer(item?.engInfoDTO?.engGeom),\r\n          distance: this.getDistance(item?.engInfoDTO?.engGeom)\r\n        }\r\n      })\r\n      const report = list.filter(item => item.result !== null).map(it => {\r\n        return {\r\n          ...it,\r\n          result: result[it.result]\r\n        }\r\n      });\r\n      const unreport = list.filter(item => item.result === null);\r\n      const sortList = unreport.sort((a, b) => a.distance - b.distance)\r\n      return this.current === 0 ? sortList : report;\r\n    }\r\n  },\r\n  methods: {\r\n    onChange(value) {\r\n      this.current = value;\r\n    },\r\n    handleReport(id, isInBuffer) {\r\n      if (isInBuffer) {\r\n        this.$emit(\"report-keypoint\", id)\r\n      }\r\n    },\r\n    // 判断是否在关键点巡检范围内\r\n    isInKeyPointBuffer(engGeom) {\r\n      if (!engGeom) return false;\r\n      const { position } = this;\r\n      if (!position) {\r\n        return false;\r\n      }\r\n      const coord = [ parseFloat(position.longitude), parseFloat(position.latitude)];\r\n      const point = turf.point(coord);\r\n      const geom = typeof engGeom === \"string\" ? JSON.parse(engGeom) : engGeom;\r\n      const buffered = turf.buffer(geom, 0.030, \"kilometers\");\r\n      const isInBuffer = turf.inside(point, buffered);\r\n      return isInBuffer;\r\n    },\r\n    // 计算当前点位与所有关键点之间的距离\r\n    getDistance(engGeom) {\r\n      if (!engGeom) return Number.MAX_VALUE;\r\n      const { position } = this;\r\n      if (!position) {\r\n        return Number.MAX_VALUE;\r\n      }\r\n      const coord = [ parseFloat(position.longitude), parseFloat(position.latitude)];\r\n      const point = turf.point(coord);\r\n      const geom = typeof engGeom === \"string\" ? JSON.parse(engGeom) : engGeom;\r\n      const distance =  turf.distance(\r\n        point, turf.point(geom.coordinates)\r\n      ) * 1000;\r\n      return distance;\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n\r\n.pull-bar {\r\n  .content {\r\n    background-color: #fff;\r\n    margin: 0.2rem 0.55rem;\r\n    // box-sizing: content-box;\r\n    .head {\r\n      position: relative;\r\n    }\r\n    .table {\r\n      margin-top: 1rem;\r\n      .u-td {\r\n        height: 2.7rem;\r\n      }\r\n      .num {\r\n        width: 100%;\r\n        height: 2rem;\r\n        line-height: 2rem;\r\n        display: block;\r\n        overflow: hidden;\r\n        // white-space: nowrap;\r\n        text-overflow: ellipsis;\r\n        -o-text-overflow: ellipsis;\r\n      }\r\n      .fixed {\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        .btn {\r\n          color: #2A83E6;\r\n          margin: auto;\r\n        }\r\n        .disabled {\r\n          color: grey;\r\n          margin: auto;\r\n        }\r\n        .tag {\r\n          box-sizing: content-box;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n</style>\r\n\r\n\r\n"]}]}