{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\inspectionManage\\keypoint-list.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\inspectionManage\\keypoint-list.vue","mtime":1705912800086},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQovLyBpbXBvcnQgUHVsbHVwQmFyIGZyb20gIkBjb21wL3B1bGx1cC1iYXIvaW5kZXgyLnZ1ZSI7DQppbXBvcnQgKiBhcyB0dXJmIGZyb20gJ0B0dXJmL3R1cmYnDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICdrZXlwb2ludC1saXN0JywNCiAgY29tcG9uZW50czogew0KICAgIC8vIFB1bGx1cEJhcg0KICB9LA0KICBwcm9wczogew0KICAgIGtleVBvaW50TGlzdDogew0KICAgICAgdHlwZTogQXJyYXksDQogICAgICBkZWZhdWx0OiAoKSA9PiBbXQ0KICAgIH0sDQogICAgcG9zaXRpb246IHsNCiAgICAgIHR5cGU6IE9iamVjdCwNCiAgICAgIGRlZmF1bHQ6ICgpID0+IG51bGwNCiAgICB9DQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGluaXRUb3A6ICc3MCUnLA0KICAgICAgc3ViU2VjdGlvbmxpc3Q6IFsNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICfmnKrkuIrmiqXlhbPplK7ngrknDQogICAgICAgIH0sew0KICAgICAgICAgIG5hbWU6ICflt7LkuIrmiqXlhbPplK7ngrknDQogICAgICAgIH0NCiAgICAgIF0sDQogICAgICBjdXJyZW50OiAwLA0KICAgICAgcmVzdWx0OiB7DQogICAgICAgICd0cnVlJzogJ+ato+W4uCcsDQogICAgICAgICdmYWxzZSc6ICflvILluLgnDQogICAgICB9DQogICAgfQ0KICB9LA0KICBjb21wdXRlZDogew0KICAgIHRoZWFkZXJMaXN0KCkgew0KICAgICAgcmV0dXJuIHRoaXMuY3VycmVudCA9PT0gMCA/DQogICAgICAgIFsNCiAgICAgICAgICAi5a+56LGh57yW5Y+3Iiwi5a+56LGh5ZCN56ewIiwi5pON5L2cIg0KICAgICAgICBdDQogICAgICAgIDpbDQogICAgICAgICAgIuWvueixoee8luWPtyIsIuWvueixoeWQjeensCIsIuW3oeajgOe7k+aenCINCiAgICAgICAgXTsNCiAgICB9LA0KICAgIHBvaW50TGlzdCgpIHsNCiAgICAgIGNvbnN0IHsga2V5UG9pbnRMaXN0LCByZXN1bHQgfSA9IHRoaXM7DQogICAgICBjb25zdCBsaXN0ID0ga2V5UG9pbnRMaXN0Lm1hcChpdGVtID0+IHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBlbmdJZDogaXRlbT8uZW5nSW5mb0RUTy5lbmdJZCwNCiAgICAgICAgICBudW06IGl0ZW0/LmVuZ0luZm9EVE8uZW5nTnVtLA0KICAgICAgICAgIG5hbWU6IGl0ZW0/LmVuZ0luZm9EVE8uZW5nTmFtZSwNCiAgICAgICAgICByZXN1bHQ6IGl0ZW0/Lmluc3BlY3Rpb25UYXNrRGV0YWlsRFRPPy5pbnNwZWN0aW9uVGFza0RldGFpbD8uaW5zcEl0ZW1SZXN1bHQsDQogICAgICAgICAgaXNJbkJ1ZmZlcjogdGhpcy5pc0luS2V5UG9pbnRCdWZmZXIoaXRlbT8uZW5nSW5mb0RUTz8uZW5nR2VvbSksDQogICAgICAgICAgZGlzdGFuY2U6IHRoaXMuZ2V0RGlzdGFuY2UoaXRlbT8uZW5nSW5mb0RUTz8uZW5nR2VvbSkNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICAgIGNvbnN0IHJlcG9ydCA9IGxpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS5yZXN1bHQgIT09IG51bGwpLm1hcChpdCA9PiB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgLi4uaXQsDQogICAgICAgICAgcmVzdWx0OiByZXN1bHRbaXQucmVzdWx0XQ0KICAgICAgICB9DQogICAgICB9KTsNCiAgICAgIGNvbnN0IHVucmVwb3J0ID0gbGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtLnJlc3VsdCA9PT0gbnVsbCk7DQogICAgICBjb25zdCBzb3J0TGlzdCA9IHVucmVwb3J0LnNvcnQoKGEsIGIpID0+IGEuZGlzdGFuY2UgLSBiLmRpc3RhbmNlKQ0KICAgICAgcmV0dXJuIHRoaXMuY3VycmVudCA9PT0gMCA/IHNvcnRMaXN0IDogcmVwb3J0Ow0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIG9uQ2hhbmdlKHZhbHVlKSB7DQogICAgICB0aGlzLmN1cnJlbnQgPSB2YWx1ZTsNCiAgICB9LA0KICAgIGhhbmRsZVJlcG9ydChpZCwgaXNJbkJ1ZmZlcikgew0KICAgICAgaWYgKGlzSW5CdWZmZXIpIHsNCiAgICAgICAgdGhpcy4kZW1pdCgicmVwb3J0LWtleXBvaW50IiwgaWQpDQogICAgICB9DQogICAgfSwNCiAgICAvLyDliKTmlq3mmK/lkKblnKjlhbPplK7ngrnlt6Hmo4DojIPlm7TlhoUNCiAgICBpc0luS2V5UG9pbnRCdWZmZXIoZW5nR2VvbSkgew0KICAgICAgaWYgKCFlbmdHZW9tKSByZXR1cm4gZmFsc2U7DQogICAgICBjb25zdCB7IHBvc2l0aW9uIH0gPSB0aGlzOw0KICAgICAgaWYgKCFwb3NpdGlvbikgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgICBjb25zdCBjb29yZCA9IFsgcGFyc2VGbG9hdChwb3NpdGlvbi5sb25naXR1ZGUpLCBwYXJzZUZsb2F0KHBvc2l0aW9uLmxhdGl0dWRlKV07DQogICAgICBjb25zdCBwb2ludCA9IHR1cmYucG9pbnQoY29vcmQpOw0KICAgICAgY29uc3QgZ2VvbSA9IHR5cGVvZiBlbmdHZW9tID09PSAic3RyaW5nIiA/IEpTT04ucGFyc2UoZW5nR2VvbSkgOiBlbmdHZW9tOw0KICAgICAgY29uc3QgYnVmZmVyZWQgPSB0dXJmLmJ1ZmZlcihnZW9tLCAwLjAzMCwgImtpbG9tZXRlcnMiKTsNCiAgICAgIGNvbnN0IGlzSW5CdWZmZXIgPSB0dXJmLmluc2lkZShwb2ludCwgYnVmZmVyZWQpOw0KICAgICAgcmV0dXJuIGlzSW5CdWZmZXI7DQogICAgfSwNCiAgICAvLyDorqHnrpflvZPliY3ngrnkvY3kuI7miYDmnInlhbPplK7ngrnkuYvpl7TnmoTot53nprsNCiAgICBnZXREaXN0YW5jZShlbmdHZW9tKSB7DQogICAgICBpZiAoIWVuZ0dlb20pIHJldHVybiBOdW1iZXIuTUFYX1ZBTFVFOw0KICAgICAgY29uc3QgeyBwb3NpdGlvbiB9ID0gdGhpczsNCiAgICAgIGlmICghcG9zaXRpb24pIHsNCiAgICAgICAgcmV0dXJuIE51bWJlci5NQVhfVkFMVUU7DQogICAgICB9DQogICAgICBjb25zdCBjb29yZCA9IFsgcGFyc2VGbG9hdChwb3NpdGlvbi5sb25naXR1ZGUpLCBwYXJzZUZsb2F0KHBvc2l0aW9uLmxhdGl0dWRlKV07DQogICAgICBjb25zdCBwb2ludCA9IHR1cmYucG9pbnQoY29vcmQpOw0KICAgICAgY29uc3QgZ2VvbSA9IHR5cGVvZiBlbmdHZW9tID09PSAic3RyaW5nIiA/IEpTT04ucGFyc2UoZW5nR2VvbSkgOiBlbmdHZW9tOw0KICAgICAgY29uc3QgZGlzdGFuY2UgPSAgdHVyZi5kaXN0YW5jZSgNCiAgICAgICAgcG9pbnQsIHR1cmYucG9pbnQoZ2VvbS5jb29yZGluYXRlcykNCiAgICAgICkgKiAxMDAwOw0KICAgICAgcmV0dXJuIGRpc3RhbmNlOw0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["keypoint-list.vue"],"names":[],"mappings":";AAgDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"keypoint-list.vue","sourceRoot":"src/views/inspectionManage","sourcesContent":["<template>\r\n    <div class=\"content\">\r\n      <div class=\"head\">\r\n        <!-- 分段 -->\r\n        <!-- <u-subsection\r\n          mode=\"subsection\"\r\n          :list=\"subSectionlist\" \r\n          :current=\"current\" \r\n          active-color=\"#2A83E6\"\r\n          @change=\"onChange\"></u-subsection> -->\r\n      </div>\r\n      <div class=\"table\">\r\n        <fm-list\r\n          style=\"height:70%; max-height: 20rem;\"\r\n        >\r\n          <!-- <u-table border-color=\"#fff\"> -->\r\n            <!-- 表头 -->\r\n            <!-- <u-tr>\r\n              <u-th v-for=\"(item, index) in theaderList\" :key=\"index\" :width=\"index === 2 ? '30%' : '35%'\">\r\n                {{item}}\r\n              </u-th>\r\n            </u-tr> -->\r\n            <!-- 表内容 -->\r\n            <!-- <u-tr v-for=\"(item, index) in pointList\" :key=\"index\">\r\n              <u-td>\r\n                <view class=\"num\">\r\n                  {{item.num === 'no_equipment' ? '-' : item.num}}\r\n                </view>\r\n              </u-td>\r\n              <u-td>\r\n                <view class=\"num\">\r\n                  {{item.name}}\r\n                </view>\r\n              </u-td>\r\n              <u-td class=\"fixed\" width=\"30%\">\r\n                <view v-if=\"current === 0\" :class=\"item.isInBuffer ? 'btn' : 'disabled'\" @click=\"handleReport(item.engId, item.isInBuffer)\">上报</view>\r\n                <u-tag v-else class=\"tag\" :text=\"item.result\" :type=\" item.result === '正常' ?'success' :'error'\" :closeable=\"false\"></u-tag>\r\n              </u-td>\r\n            </u-tr>\r\n          </u-table> -->\r\n          <fm-empty v-if=\"pointList.length <= 0\" description=\"暂无数据\" mode=\"list\"></fm-empty>\r\n        </fm-list>\r\n      </div>\r\n    </div>\r\n  <!-- <PullupBar class=\"pull-bar\" :initTop=\"initTop\" :showClose=\"true\" @close=\"$emit('close')\">\r\n  </PullupBar> -->\r\n</template>\r\n<script>\r\n// import PullupBar from \"@comp/pullup-bar/index2.vue\";\r\nimport * as turf from '@turf/turf'\r\nexport default {\r\n  name: 'keypoint-list',\r\n  components: {\r\n    // PullupBar\r\n  },\r\n  props: {\r\n    keyPointList: {\r\n      type: Array,\r\n      default: () => []\r\n    },\r\n    position: {\r\n      type: Object,\r\n      default: () => null\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      initTop: '70%',\r\n      subSectionlist: [\r\n        {\r\n          name: '未上报关键点'\r\n        },{\r\n          name: '已上报关键点'\r\n        }\r\n      ],\r\n      current: 0,\r\n      result: {\r\n        'true': '正常',\r\n        'false': '异常'\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    theaderList() {\r\n      return this.current === 0 ?\r\n        [\r\n          \"对象编号\",\"对象名称\",\"操作\"\r\n        ]\r\n        :[\r\n          \"对象编号\",\"对象名称\",\"巡检结果\"\r\n        ];\r\n    },\r\n    pointList() {\r\n      const { keyPointList, result } = this;\r\n      const list = keyPointList.map(item => {\r\n        return {\r\n          engId: item?.engInfoDTO.engId,\r\n          num: item?.engInfoDTO.engNum,\r\n          name: item?.engInfoDTO.engName,\r\n          result: item?.inspectionTaskDetailDTO?.inspectionTaskDetail?.inspItemResult,\r\n          isInBuffer: this.isInKeyPointBuffer(item?.engInfoDTO?.engGeom),\r\n          distance: this.getDistance(item?.engInfoDTO?.engGeom)\r\n        }\r\n      })\r\n      const report = list.filter(item => item.result !== null).map(it => {\r\n        return {\r\n          ...it,\r\n          result: result[it.result]\r\n        }\r\n      });\r\n      const unreport = list.filter(item => item.result === null);\r\n      const sortList = unreport.sort((a, b) => a.distance - b.distance)\r\n      return this.current === 0 ? sortList : report;\r\n    }\r\n  },\r\n  methods: {\r\n    onChange(value) {\r\n      this.current = value;\r\n    },\r\n    handleReport(id, isInBuffer) {\r\n      if (isInBuffer) {\r\n        this.$emit(\"report-keypoint\", id)\r\n      }\r\n    },\r\n    // 判断是否在关键点巡检范围内\r\n    isInKeyPointBuffer(engGeom) {\r\n      if (!engGeom) return false;\r\n      const { position } = this;\r\n      if (!position) {\r\n        return false;\r\n      }\r\n      const coord = [ parseFloat(position.longitude), parseFloat(position.latitude)];\r\n      const point = turf.point(coord);\r\n      const geom = typeof engGeom === \"string\" ? JSON.parse(engGeom) : engGeom;\r\n      const buffered = turf.buffer(geom, 0.030, \"kilometers\");\r\n      const isInBuffer = turf.inside(point, buffered);\r\n      return isInBuffer;\r\n    },\r\n    // 计算当前点位与所有关键点之间的距离\r\n    getDistance(engGeom) {\r\n      if (!engGeom) return Number.MAX_VALUE;\r\n      const { position } = this;\r\n      if (!position) {\r\n        return Number.MAX_VALUE;\r\n      }\r\n      const coord = [ parseFloat(position.longitude), parseFloat(position.latitude)];\r\n      const point = turf.point(coord);\r\n      const geom = typeof engGeom === \"string\" ? JSON.parse(engGeom) : engGeom;\r\n      const distance =  turf.distance(\r\n        point, turf.point(geom.coordinates)\r\n      ) * 1000;\r\n      return distance;\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n\r\n.pull-bar {\r\n  .content {\r\n    background-color: #fff;\r\n    margin: 0.2rem 0.55rem;\r\n    // box-sizing: content-box;\r\n    .head {\r\n      position: relative;\r\n    }\r\n    .table {\r\n      margin-top: 1rem;\r\n      .u-td {\r\n        height: 2.7rem;\r\n      }\r\n      .num {\r\n        width: 100%;\r\n        height: 2rem;\r\n        line-height: 2rem;\r\n        display: block;\r\n        overflow: hidden;\r\n        // white-space: nowrap;\r\n        text-overflow: ellipsis;\r\n        -o-text-overflow: ellipsis;\r\n      }\r\n      .fixed {\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        .btn {\r\n          color: #2A83E6;\r\n          margin: auto;\r\n        }\r\n        .disabled {\r\n          color: grey;\r\n          margin: auto;\r\n        }\r\n        .tag {\r\n          box-sizing: content-box;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n</style>\r\n\r\n\r\n"]}]}