{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\InspectionMap.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\PumpStationInspection\\components\\InspectionMap.vue","mtime":1705912915816},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgTWFwQ29tcCBmcm9tICdAL3ZpZXdzL2luc3BlY3RNYXAvaW5kZXgudnVlJw0KDQppbXBvcnQgeyB0cmFja0xpc3QsIHVwbG9hZFRyYWNrTGlzdCB9IGZyb20gJy4uL2FwaScNCg0KY29uc3QgbWFwT2JqID0gew0KICBtYXA6IG51bGwsDQogIG1hcEluc3RhbmNlOiBudWxsLA0KfQ0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGNvbXBvbmVudHM6IHsgTWFwQ29tcCB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBzdGF0dXNDb250ZW50U2hvdzogZmFsc2UsDQogICAgICBub3RpZnlTaG93OiBmYWxzZSwNCiAgICAgIGluc3BlY3Rpb25Vcmw6ICcvcHVtcC9pbnNwZWN0aW9uJywgLy/lt6Hmo4DliJfooajlnLDlnYANCiAgICAgIGhpZGRlblVybDogJy9Gb3JtQmFzZScsIC8v6ZqQ5oKj5bel5Y2V55WM6Z2iDQoNCiAgICAgIHRyYWNrTGlzdDogW10sDQoNCiAgICAgIGN1cnJlbnRQb3NpdGlvbjogbnVsbCwNCiAgICB9DQogIH0sDQoNCiAgY3JlYXRlZCgpIHsNCiAgICAvLyB0aGlzLnNldFRyYWNrTGlzdCgpDQogIH0sDQoNCiAgbWV0aG9kczogew0KICAgIC8v6Lez6L2s6Iez5beh5qOA5YiX6KGo6aG1DQogICAgLy8gZ29Ubyh1cmwpIHsNCiAgICAvLyAgIHRoaXMuJHJvdXRlci5wdXNoKHVybCkNCiAgICAvLyB9LA0KDQogICAgLy/ojrflj5blt6Hmo4Dngrnovajov7kNCiAgICBhc3luYyBnZXRUcmFja0xpc3QoKSB7DQogICAgICBsZXQgeyB0YXNrSWQgfSA9IHRoaXMuJHJvdXRlLnF1ZXJ5DQogICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHRyYWNrTGlzdCh0YXNrSWQpDQogICAgICB0aGlzLnRyYWNrTGlzdCA9IGRhdGE/Lm1hcCgoaXRlbSkgPT4gew0KICAgICAgICByZXR1cm4gW2l0ZW0ubG9uLCBpdGVtLmxhdF0NCiAgICAgIH0pDQogICAgfSwNCg0KICAgIC8v5LiK5Lyg5beh5qOA54K55YiX6KGoDQogICAgLy8gYXN5bmMgc2V0VHJhY2tMaXN0KCkgew0KICAgIC8vICAgbGV0IHsgdGFza0lkIH0gPSB0aGlzLiRyb3V0ZS5xdWVyeQ0KICAgIC8vICAgbGV0IHF1ZXJ5ID0gew0KICAgIC8vICAgICBwYXRyb2xUYXNrSWQ6IHRhc2tJZCwNCiAgICAvLyAgICAgdHJhY2tEVE9TOiBbDQogICAgLy8gICAgICAgew0KICAgIC8vICAgICAgICAgbGF0OiAzOS4wNjA3NTU0OTU4OTA3MywNCiAgICAvLyAgICAgICAgIGxvbjogMTE1LjkyNDg2MTAxMzY5NDI4LA0KICAgIC8vICAgICAgIH0sDQogICAgLy8gICAgICAgew0KICAgIC8vICAgICAgICAgbGF0OiAzOS4xNjA3NTU0OTU4OTA3MywNCiAgICAvLyAgICAgICAgIGxvbjogMTE1LjkyNDg2MTAxMzY5NDI4LA0KICAgIC8vICAgICAgIH0sDQogICAgLy8gICAgIF0sDQogICAgLy8gICB9DQogICAgLy8gICBjb25zdCByZXMgPSBhd2FpdCB1cGxvYWRUcmFja0xpc3QocXVlcnkpDQogICAgLy8gfSwNCg0KICAgIC8v5Zyw5Zu+5Yid5aeL5YyWDQogICAgYXN5bmMgbWFwTG9hZGVkKG1hcEluc3RhbmNlKSB7DQogICAgICBtYXBPYmoubWFwSW5zdGFuY2UgPSBtYXBJbnN0YW5jZQ0KICAgICAgbWFwT2JqLm1hcCA9IG1hcEluc3RhbmNlLm1hcA0KDQogICAgICAvLyBhd2FpdCB0aGlzLmdldFRyYWNrTGlzdCgpDQoNCiAgICAgIGlmICh0eXBlb2YgeXVhbmNodSAhPSAndW5kZWZpbmVkJykgew0KICAgICAgICB5dWFuY2h1LmxvY2F0aW9uQU1hcC5yZXF1ZXN0U2luZ2xlTG9jYXRpb24oDQogICAgICAgICAgWycxJ10sDQogICAgICAgICAgKHJlcykgPT4gew0KICAgICAgICAgICAgbGV0IHsgbGF0aXR1ZGUsIGxvbmdpdHVkZSB9ID0gcmVzDQoNCiAgICAgICAgICAgIGxldCBwYXRoID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLiRzdG9yZS5zdGF0ZS5wdW1wLnB1bXBQYXRoKSkNCg0KICAgICAgICAgICAgcGF0aC5wdXNoKHsNCiAgICAgICAgICAgICAgbGF0OiBsYXRpdHVkZSwNCiAgICAgICAgICAgICAgbG9uOiBsb25naXR1ZGUsDQogICAgICAgICAgICB9KQ0KDQogICAgICAgICAgICB0aGlzLnRyYWNrTGlzdCA9IHBhdGg/Lm1hcCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgICByZXR1cm4gW2l0ZW0ubG9uLCBpdGVtLmxhdF0NCiAgICAgICAgICAgIH0pDQoNCiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0UHVtcFBhdGgnLCBwYXRoKQ0KDQogICAgICAgICAgICBtYXBPYmoubWFwLmdldExheWVyKCdwdW1wLXJvdXRlJykgJiYgbWFwT2JqLm1hcC5yZW1vdmVMYXllcigncHVtcC1yb3V0ZScpDQogICAgICAgICAgICBtYXBPYmoubWFwLmdldFNvdXJjZSgncHVtcC1yb3V0ZScpICYmIG1hcE9iai5tYXAucmVtb3ZlU291cmNlKCdwdW1wLXJvdXRlJykNCg0KICAgICAgICAgICAgbWFwT2JqLm1hcC5hZGRMYXllcih7DQogICAgICAgICAgICAgIGlkOiAncHVtcC1yb3V0ZScsDQogICAgICAgICAgICAgIHR5cGU6ICdsaW5lJywNCiAgICAgICAgICAgICAgc291cmNlOiB7DQogICAgICAgICAgICAgICAgdHlwZTogJ2dlb2pzb24nLA0KICAgICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlJywNCiAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LA0KICAgICAgICAgICAgICAgICAgZ2VvbWV0cnk6IHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0xpbmVTdHJpbmcnLA0KICAgICAgICAgICAgICAgICAgICBjb29yZGluYXRlczogdGhpcy50cmFja0xpc3QsDQogICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIGxheW91dDogew0KICAgICAgICAgICAgICAgICdsaW5lLWpvaW4nOiAncm91bmQnLA0KICAgICAgICAgICAgICAgICdsaW5lLWNhcCc6ICdyb3VuZCcsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHBhaW50OiB7DQogICAgICAgICAgICAgICAgJ2xpbmUtY29sb3InOiAnIzJEN0VGRicsDQogICAgICAgICAgICAgICAgJ2xpbmUtd2lkdGgnOiAyLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSkNCg0KICAgICAgICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb24gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcykpDQogICAgICAgICAgICBjb25zdCBwYXJhbSA9IHsNCiAgICAgICAgICAgICAgLi4udGhpcy5jdXJyZW50UG9zaXRpb24sDQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLiRyZWZzLm15bWFwLnNldEluc3BVc2VyUG9zaXRpb24ocGFyYW0pDQogICAgICAgICAgfSwNCiAgICAgICAgICAoZXJyKSA9PiB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyPScsIGVycikNCiAgICAgICAgICB9DQogICAgICAgICkNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLy8g5Y2h54mH5a6a5L2NDQogICAgZmx5VG9Qb2ludChsbmdsYXQpIHsNCiAgICAgIG1hcE9iai5tYXAuZmx5VG8oeyBjZW50ZXI6IGxuZ2xhdCwgem9vbTogMTcuNSB9KQ0KICAgIH0sDQogICAgLy8g5byA5aeL5a6a5L2NDQogICAgc3RhcnRMb2NhdGlvbigpIHsNCiAgICAgIGlmICgNCiAgICAgICAgIXRoaXMuY3VycmVudFBvc2l0aW9uIHx8DQogICAgICAgICF0aGlzLmN1cnJlbnRQb3NpdGlvbi5sb25naXR1ZGUgfHwNCiAgICAgICAgIXRoaXMuY3VycmVudFBvc2l0aW9uLmxhdGl0dWRlDQogICAgICApIHsNCiAgICAgICAgdGhpcy4kdG9hc3Qoew0KICAgICAgICAgIG1lc3NhZ2U6ICfojrflj5bkvY3nva7lpLHotKUhJywNCiAgICAgICAgICBkdXJhdGlvbjogMjAwMCwNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9IGVsc2Ugew0KICAgICAgICBjb25zdCBjb29yZCA9IFsNCiAgICAgICAgICBwYXJzZUZsb2F0KHRoaXMuY3VycmVudFBvc2l0aW9uLmxvbmdpdHVkZSksDQogICAgICAgICAgcGFyc2VGbG9hdCh0aGlzLmN1cnJlbnRQb3NpdGlvbi5sYXRpdHVkZSksDQogICAgICAgIF0NCiAgICAgICAgdGhpcy5mbHlUb1BvaW50KGNvb3JkKQ0KICAgICAgfQ0KICAgIH0sDQogIH0sDQp9DQo="},{"version":3,"sources":["InspectionMap.vue"],"names":[],"mappings":";AA6BA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"InspectionMap.vue","sourceRoot":"src/views/PumpStationInspection/components","sourcesContent":["<template>\r\n  <div class=\"inspection-map\">\r\n    <div class=\"notify-network\" v-if=\"notifyShow\">\r\n      <span>网络异常，无法记录巡检轨迹！</span>\r\n      <img\r\n        src=\"@/assets/img/pump/inspection-cross.png\"\r\n        class=\"cross-icon\"\r\n        alt=\"\"\r\n        @click=\"notifyShow = false\"\r\n      />\r\n    </div>\r\n    <!-- 地图 -->\r\n    <MapComp ref=\"mymap\" :ifInspection=\"true\" @mapLoaded=\"mapLoaded\"></MapComp>\r\n    <div class=\"map-line-remark\">\r\n      <div class=\"remark-text\">轨迹记录</div>\r\n    </div>\r\n    <!-- 轨迹显示与定位功能 -->\r\n    <div class=\"tool-box\">\r\n      <div class=\"location\" @click=\"startLocation\">\r\n        <fm-image\r\n          class=\"location-image\"\r\n          :src=\"require('@/assets/img/inspection/location.png')\"\r\n        ></fm-image>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport MapComp from '@/views/inspectMap/index.vue'\r\n\r\nimport { trackList, uploadTrackList } from '../api'\r\n\r\nconst mapObj = {\r\n  map: null,\r\n  mapInstance: null,\r\n}\r\n\r\nexport default {\r\n  components: { MapComp },\r\n  data() {\r\n    return {\r\n      statusContentShow: false,\r\n      notifyShow: false,\r\n      inspectionUrl: '/pump/inspection', //巡检列表地址\r\n      hiddenUrl: '/FormBase', //隐患工单界面\r\n\r\n      trackList: [],\r\n\r\n      currentPosition: null,\r\n    }\r\n  },\r\n\r\n  created() {\r\n    // this.setTrackList()\r\n  },\r\n\r\n  methods: {\r\n    //跳转至巡检列表页\r\n    // goTo(url) {\r\n    //   this.$router.push(url)\r\n    // },\r\n\r\n    //获取巡检点轨迹\r\n    async getTrackList() {\r\n      let { taskId } = this.$route.query\r\n      const { data } = await trackList(taskId)\r\n      this.trackList = data?.map((item) => {\r\n        return [item.lon, item.lat]\r\n      })\r\n    },\r\n\r\n    //上传巡检点列表\r\n    // async setTrackList() {\r\n    //   let { taskId } = this.$route.query\r\n    //   let query = {\r\n    //     patrolTaskId: taskId,\r\n    //     trackDTOS: [\r\n    //       {\r\n    //         lat: 39.06075549589073,\r\n    //         lon: 115.92486101369428,\r\n    //       },\r\n    //       {\r\n    //         lat: 39.16075549589073,\r\n    //         lon: 115.92486101369428,\r\n    //       },\r\n    //     ],\r\n    //   }\r\n    //   const res = await uploadTrackList(query)\r\n    // },\r\n\r\n    //地图初始化\r\n    async mapLoaded(mapInstance) {\r\n      mapObj.mapInstance = mapInstance\r\n      mapObj.map = mapInstance.map\r\n\r\n      // await this.getTrackList()\r\n\r\n      if (typeof yuanchu != 'undefined') {\r\n        yuanchu.locationAMap.requestSingleLocation(\r\n          ['1'],\r\n          (res) => {\r\n            let { latitude, longitude } = res\r\n\r\n            let path = JSON.parse(JSON.stringify(this.$store.state.pump.pumpPath))\r\n\r\n            path.push({\r\n              lat: latitude,\r\n              lon: longitude,\r\n            })\r\n\r\n            this.trackList = path?.map((item) => {\r\n              return [item.lon, item.lat]\r\n            })\r\n\r\n            this.$store.commit('setPumpPath', path)\r\n\r\n            mapObj.map.getLayer('pump-route') && mapObj.map.removeLayer('pump-route')\r\n            mapObj.map.getSource('pump-route') && mapObj.map.removeSource('pump-route')\r\n\r\n            mapObj.map.addLayer({\r\n              id: 'pump-route',\r\n              type: 'line',\r\n              source: {\r\n                type: 'geojson',\r\n                data: {\r\n                  type: 'Feature',\r\n                  properties: {},\r\n                  geometry: {\r\n                    type: 'LineString',\r\n                    coordinates: this.trackList,\r\n                  },\r\n                },\r\n              },\r\n              layout: {\r\n                'line-join': 'round',\r\n                'line-cap': 'round',\r\n              },\r\n              paint: {\r\n                'line-color': '#2D7EFF',\r\n                'line-width': 2,\r\n              },\r\n            })\r\n\r\n            this.currentPosition = JSON.parse(JSON.stringify(res))\r\n            const param = {\r\n              ...this.currentPosition,\r\n            }\r\n            this.$refs.mymap.setInspUserPosition(param)\r\n          },\r\n          (err) => {\r\n            console.log('err=', err)\r\n          }\r\n        )\r\n      }\r\n    },\r\n\r\n    // 卡片定位\r\n    flyToPoint(lnglat) {\r\n      mapObj.map.flyTo({ center: lnglat, zoom: 17.5 })\r\n    },\r\n    // 开始定位\r\n    startLocation() {\r\n      if (\r\n        !this.currentPosition ||\r\n        !this.currentPosition.longitude ||\r\n        !this.currentPosition.latitude\r\n      ) {\r\n        this.$toast({\r\n          message: '获取位置失败!',\r\n          duration: 2000,\r\n        })\r\n        return\r\n      } else {\r\n        const coord = [\r\n          parseFloat(this.currentPosition.longitude),\r\n          parseFloat(this.currentPosition.latitude),\r\n        ]\r\n        this.flyToPoint(coord)\r\n      }\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.inspection-map {\r\n  position: relative;\r\n  height: 100%;\r\n  overflow: hidden;\r\n\r\n  .notify-network {\r\n    position: relative;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    height: 60px;\r\n    background: rgba(255, 77, 79, 0.2);\r\n    border-radius: 38px;\r\n    margin: 0 30px;\r\n    font-size: 28px;\r\n    color: #ff4d4f;\r\n\r\n    .cross-icon {\r\n      position: absolute;\r\n      right: 20px;\r\n      width: 28px;\r\n      height: 28px;\r\n    }\r\n  }\r\n\r\n  .map-line-remark {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    position: absolute;\r\n    bottom: 30px;\r\n    right: 30px;\r\n    width: 168px;\r\n    height: 68px;\r\n    font-size: 28px;\r\n    color: #000000;\r\n    background: #ffffff;\r\n    box-shadow: 0px 8px 20px 0px rgba(180, 197, 226, 1);\r\n    border-radius: 34px;\r\n    padding: 0 20px;\r\n\r\n    &::after {\r\n      display: inline-block;\r\n      content: '';\r\n      width: 40px;\r\n      height: 4px;\r\n      line-height: 68px;\r\n      background: #2d7eff;\r\n    }\r\n  }\r\n\r\n  .tool-box {\r\n    position: fixed;\r\n    width: 1.2rem;\r\n    height: auto;\r\n    right: 0.3rem;\r\n    bottom: 350px;\r\n\r\n    .refresh {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .route {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      margin-bottom: 0.55rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 0.27rem;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n\r\n    .location {\r\n      width: 1.2rem;\r\n      height: 1.2rem;\r\n      background-color: #fff;\r\n      z-index: 3;\r\n      box-shadow: 0rem 0.22rem 0.61rem 0rem rgba(0, 0, 0, 0.2);\r\n      border-radius: 60px;\r\n\r\n      &-image {\r\n        margin: 0.18rem;\r\n        width: 0.82rem;\r\n        height: 0.82rem;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}