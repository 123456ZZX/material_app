{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\NewsNotice\\NewsInfo.vue?vue&type=style&index=0&id=bd13410a&lang=less&scoped=true","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\NewsNotice\\NewsInfo.vue","mtime":1708928163393},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouTmV3c0luZm9TdHlsZSB7DQogIGhlaWdodDogMTAwJTsNCiAgYmFja2dyb3VuZC1jb2xvcjogIzVkZmY3MzsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjdmOTsNCn0NCg0KLm1haW5Db250YWluZXIgew0KICB3aWR0aDogMTAwJTsNCiAgaGVpZ2h0OiBjYWxjKDEwMCUgLSAxNDBweCk7DQogIGRpc3BsYXk6IGZsZXg7DQogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgb3ZlcmZsb3c6IHNjcm9sbDsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjdmOTsNCg0KICAvLyDkuIvmi4nliLfmlrDnu4Tku7blhoXlrrnmuqLlh7rmmL7npLoNCiAgLmZtLXB1bGwtcmVmcmVzaCB7DQogICAgb3ZlcmZsb3c6IHZpc2libGU7DQogIH0NCg0KICAuY2FyZExpc3RBcnJTdHlsZSB7DQogICAgd2lkdGg6IDY5MHB4Ow0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBiYWNrZ3JvdW5kOiAjZjVmN2Y5Ow0KDQogICAgLnRpbWVTdHlsZSB7DQogICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgd2lkdGg6IDEwMCU7DQogICAgICBoZWlnaHQ6IDQwcHg7DQogICAgICBtYXJnaW46IDI0cHggMDsNCiAgICAgIGZvbnQtc2l6ZTogMjhweDsNCiAgICAgIGZvbnQtZmFtaWx5OiBTRlByb1RleHQtUmVndWxhciwgU0ZQcm9UZXh0Ow0KICAgICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICAgIGNvbG9yOiAjY2NjY2NjOw0KICAgIH0NCg0KICAgIC5jYXJkQ29udGFpbmVyU3R5bGUgew0KICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgd2lkdGg6IDY5MHB4Ow0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7DQogICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgIHBhZGRpbmc6IDMwcHggMzBweCAwIDMwcHg7DQogICAgICBtYXJnaW4tYm90dG9tOiAyNHB4Ow0KICAgICAgYm9yZGVyLXJhZGl1czogMTZweDsNCiAgICAgIGJhY2tncm91bmQ6ICNmZmZmZmY7DQogICAgICBib3gtc2hhZG93OiAwcHggNHB4IDE2cHggMHB4IHJnYmEoMCwgMCwgMCwgMC4wOCk7DQoNCiAgICAgIC5yZWRQb2ludCB7DQogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgdG9wOiAxNnB4Ow0KICAgICAgICByaWdodDogMTZweDsNCiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgICB3aWR0aDogMTJweDsNCiAgICAgICAgaGVpZ2h0OiAxMnB4Ow0KICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgICAgIGJhY2tncm91bmQ6ICNmZTQ4NTQ7DQogICAgICB9DQoNCiAgICAgIC50b3BDb250YWluZXIgew0KICAgICAgICB3aWR0aDogMTAwJTsNCg0KICAgICAgICAudG9wVGl0bGUgew0KICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgICAgICAgIGFsaWduLWl0ZW1zOiBiYXNlbGluZTsNCg0KICAgICAgICAgIC50aXRsZUxlZnQgew0KICAgICAgICAgICAgZm9udC1zaXplOiAzMnB4Ow0KICAgICAgICAgICAgZm9udC1mYW1pbHk6IFBpbmdGYW5nU0MtTWVkaXVtLCBQaW5nRmFuZyBTQzsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7DQogICAgICAgICAgICBjb2xvcjogIzE5MTkxOTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAudGltZVJpZ2h0IHsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMjRweDsNCiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBTRlByb1RleHQtUmVndWxhciwgU0ZQcm9UZXh0Ow0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICAgICAgICAgIGNvbG9yOiAjY2NjY2NjOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIOmdnuWRiuitpua2iOaBr+aYvuekuuWGheWuuQ0KICAgICAgICAudG9wQ29udGVudDEgew0KICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgIG1hcmdpbi10b3A6IDI0cHg7DQogICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjRweDsNCiAgICAgICAgICBmb250LXNpemU6IDI4cHg7DQogICAgICAgICAgZm9udC1mYW1pbHk6IFBpbmdGYW5nU0MtUmVndWxhciwgUGluZ0ZhbmcgU0M7DQogICAgICAgICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICAgICAgICBjb2xvcjogIzU1NTU1NTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIOWRiuitpua2iOaBr+aYvuekuuWGheWuuQ0KICAgICAgICAudG9wQ29udGVudDIgew0KICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICBtYXJnaW4tdG9wOiAyNHB4Ow0KICAgICAgICAgIG1hcmdpbi1ib3R0b206IDI0cHg7DQoNCiAgICAgICAgICAubGluZVN0eWxlIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogNTZweDsNCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQoNCiAgICAgICAgICAgIC50ZXh0MSB7DQogICAgICAgICAgICAgIG1hcmdpbjogMCAzMnB4IDAgOHB4Ow0KICAgICAgICAgICAgICBmb250LXNpemU6IDI0cHg7DQogICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBTRlByb1RleHQtUmVndWxhciwgU0ZQcm9UZXh0Ow0KICAgICAgICAgICAgICBmb250LXdlaWdodDogNDAwOw0KICAgICAgICAgICAgICBjb2xvcjogIzk5OTk5OTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLnRleHQyIHsNCiAgICAgICAgICAgICAgd2lkdGg6IDcyJTsNCiAgICAgICAgICAgICAgZm9udC1zaXplOiAyNHB4Ow0KICAgICAgICAgICAgICBmb250LWZhbWlseTogU0ZQcm9UZXh0LVJlZ3VsYXIsIFNGUHJvVGV4dDsNCiAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICAgICAgICAgICAgY29sb3I6ICM1NTU1NTU7DQogICAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgICAgICAgIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOw0KICAgICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpbWcgew0KICAgICAgICAgICAgICB3aWR0aDogMzJweDsNCiAgICAgICAgICAgICAgaGVpZ2h0OiAzMnB4Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICAuYm90dG9tRGV0YWlsIHsNCiAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgIGhlaWdodDogODhweDsNCiAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICBib3JkZXItdG9wOiAxcHggc29saWQgI2U5ZTllOTsNCiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjsNCiAgICAgICAgZm9udC1zaXplOiAyOHB4Ow0KICAgICAgICBmb250LWZhbWlseTogU0ZQcm9UZXh0LVJlZ3VsYXIsIFNGUHJvVGV4dDsNCiAgICAgICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICAgICAgY29sb3I6ICMzMzMzMzM7DQoNCiAgICAgICAgLnJpZ2h0SWNvbiB7DQogICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgICAgIHdpZHRoOiAxNnB4Ow0KICAgICAgICAgIGhlaWdodDogMTZweDsNCiAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCAjYzdjN2M3Ow0KICAgICAgICAgIGJvcmRlci10b3A6IG5vbmU7DQogICAgICAgICAgYm9yZGVyLWxlZnQ6IG5vbmU7DQogICAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoLTQ1ZGVnKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0KDQovZGVlcC8uZm0tZGlhbG9nX19jb250ZW50IHsNCiAgLnRleHRDb250YWluZXIgew0KICAgIG1hcmdpbjogMjBweCAwOw0KICAgIHBhZGRpbmctbGVmdDogMTZweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsNCg0KICAgIC5sZWZ0VGl0bGUgew0KICAgICAgd2lkdGg6IDEzMHB4Ow0KICAgICAgbWluLXdpZHRoOiAxMzBweDsNCiAgICAgIGZvbnQtc2l6ZTogMjRweDsNCiAgICAgIGZvbnQtZmFtaWx5OiBTRlByb1RleHQtUmVndWxhciwgU0ZQcm9UZXh0Ow0KICAgICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgICAgIGNvbG9yOiAjOTk5OTk5Ow0KICAgIH0NCg0KICAgIC5yaWdodFRleHQgew0KICAgICAgZm9udC1zaXplOiAyNHB4Ow0KICAgICAgZm9udC1mYW1pbHk6IFNGUHJvVGV4dC1SZWd1bGFyLCBTRlByb1RleHQ7DQogICAgICBmb250LXdlaWdodDogNDAwOw0KICAgICAgY29sb3I6ICM1NTU1NTU7DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["NewsInfo.vue"],"names":[],"mappings":";AAkTA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"NewsInfo.vue","sourceRoot":"src/views/NewsNotice","sourcesContent":["<template>\r\n  <div class=\"NewsInfoStyle\">\r\n    <fm-nav-bar :title=\"routeData.msgTitle\" left-arrow @click-left=\"onClickLeft\">\r\n      <template #left>\r\n        <i class=\"fm-icon fm-icon-arrow-left\" style=\"font-size: 18px; color: #000 !important\"></i>\r\n      </template>\r\n    </fm-nav-bar>\r\n    <div class=\"mainContainer\">\r\n      <fm-pull-refresh v-model=\"topLoading\" @refresh=\"onRefresh\">\r\n        <!-- List 组件通过 bottomLoading 和 bottomFinished 两个变量控制加载状态，当组件滚动到底部时，会触发 load 事件并将 bottomLoading 设置成 true。 -->\r\n        <!-- 此时可以发起异步操作并更新数据，数据更新完毕后，将 bottomLoading 设置成 false 即可。若数据已全部加载完毕，则直接将 bottomFinished 设置成 true 即可。 -->\r\n        <fm-list\r\n          v-model=\"bottomLoading\"\r\n          :bottomFinished=\"bottomFinished\"\r\n          bottomFinished-text=\"没有更多了\"\r\n          @load=\"onLoad\"\r\n        >\r\n          <div v-for=\"(item1, index1) in dealMessageArr\" :key=\"index1\" class=\"cardListArrStyle\">\r\n            <div class=\"timeStyle\">{{ item1.time }}</div>\r\n            <div\r\n              v-for=\"(item2, index2) in item1.seamTimeList\"\r\n              :key=\"index2\"\r\n              class=\"cardContainerStyle\"\r\n            >\r\n              <!-- 右上角未读红点，定位 -->\r\n              <span\r\n                v-if=\"item2.status === -1 && routeData.msgType != 100 && routeData.msgType != 201\"\r\n                class=\"redPoint\"\r\n              ></span>\r\n              <div class=\"topContainer\">\r\n                <div class=\"topTitle\">\r\n                  <span class=\"titleLeft\">{{ item2.title }}</span>\r\n                  <span class=\"timeRight\">{{ item2.updateDate.slice(11) }}</span>\r\n                </div>\r\n                <!-- 非告警消息显示内容 -->\r\n                <div v-if=\"true\" class=\"topContent1\">{{ item2.msgBody }}</div>\r\n                <!-- 告警消息显示内容 -->\r\n                <div v-if=\"false\" class=\"topContent2\">\r\n                  <div class=\"lineStyle\">\r\n                    <img src=\"./imgs/告警数值.png\" alt=\"\" />\r\n                    <span class=\"text1\">告警数值</span>\r\n                    <span class=\"text2\" style=\"color: #ff4d4f\">0.21 Mpa（+21%）</span>\r\n                  </div>\r\n                  <div class=\"lineStyle\">\r\n                    <img src=\"./imgs/告警点位.png\" alt=\"\" />\r\n                    <span class=\"text1\">告警点位</span>\r\n                    <span class=\"text2\">奥威路交界口</span>\r\n                  </div>\r\n                  <div class=\"lineStyle\">\r\n                    <img src=\"./imgs/持续时间.png\" alt=\"\" />\r\n                    <span class=\"text1\">持续时间</span>\r\n                    <span class=\"text2\">19分钟</span>\r\n                  </div>\r\n                  <div class=\"lineStyle\">\r\n                    <img src=\"./imgs/报警时间.png\" alt=\"\" />\r\n                    <span class=\"text1\">报警时间</span>\r\n                    <span class=\"text2\">2022-12-23 09:11</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <!-- 类型(100:公告，200:业务通知，201:告警，202:工单，203:事件，300:私信) -->\r\n              <div\r\n                v-if=\"routeData.msgType != 100 && routeData.msgType != 201\"\r\n                class=\"bottomDetail\"\r\n                @click=\"viewDetailMsg(item2)\"\r\n              >\r\n                <span>查看详情</span>\r\n                <span class=\"rightIcon\"></span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </fm-list>\r\n      </fm-pull-refresh>\r\n    </div>\r\n    <fm-dialog :visible.sync=\"showDialog\" :title=\"viewDialogData.title\">\r\n      <div class=\"textContainer\">\r\n        <span class=\"leftTitle\">消息类型：</span>\r\n        <span class=\"rightText\">{{ viewDialogData.msgType | transferEnum('msgTypes') }}</span>\r\n      </div>\r\n      <div class=\"textContainer\">\r\n        <span class=\"leftTitle\">接收时间：</span>\r\n        <span class=\"rightText\">{{ viewDialogData.updateDate }}</span>\r\n      </div>\r\n      <div class=\"textContainer\">\r\n        <span class=\"leftTitle\">消息内容：</span>\r\n        <span class=\"rightText\">{{ viewDialogData.msgBody }}</span>\r\n      </div>\r\n    </fm-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nimport * as api from '@/views/Home/api.js'\r\nimport { updateMsgStatusById, updateBatchMsgStatus } from '@/api/message.js'\r\nimport { Toast } from 'fawkes-mobile-lib'\r\nimport _cloneDeep from 'lodash/cloneDeep'\r\nexport default {\r\n  name: 'NewsInfo',\r\n  components: {\r\n    [Toast.name]: Toast,\r\n  },\r\n  data: () => ({\r\n    // 路由参数\r\n    routeData: {},\r\n    topLoading: false, // 下拉刷新是否处于加载中状态，下拉时组件会自动设置true，下拉刷新时会触发 refresh 事件，操作完成后将 v-model 设置为 false，表示加载完成。\r\n    bottomLoading: false, // 列表加载更多时控制加载状态，加载时组件会自动设置为true，加载完成后需手动设置为false\r\n    bottomFinished: false, // 列表加载更多时控制加载状态，全部加载完成时需设置为true\r\n    pageNum: 1,\r\n    valueText: '', // 搜索框文本\r\n    showDialog: false, // 是否显示详情弹窗\r\n    viewDialogData: {}, // 查看详情弹窗数据\r\n    // 消息列表\r\n    messageList: [],\r\n    // 根据消息通知时间分类的数组\r\n    dealMessageArr: [{ time: '', seamTimeList: [] }],\r\n    // 未读\r\n    // formListNot: [],\r\n    // 已读\r\n    // formListDone: [],\r\n  }),\r\n  watch: {},\r\n  created() {\r\n    // 从路由中获取参数\r\n    this.routeData = this.$route.query\r\n    console.log('msgType === ', this.routeData.msgType, _cloneDeep(this.routeData))\r\n    // {\r\n    // \"msgType\": \"200\",\r\n    // \"msgTitle\": \"业务通知\",\r\n    // \"msgContent\": \"报警平台:管网告警工单【工单编号：20230421000263】，发起节点已办理完结，请及时关注。\",\r\n    // \"msgTime\": \"2023-04-21 16:07:06\",\r\n    // \"newMessage\": \"2508\",\r\n    // \"msgIcon\": \"data:image/\",\r\n    // \"nowCheckedBtn\": \"未读\"\r\n    // }\r\n\r\n    if (this.routeData.msgType != 200) {\r\n      // 批量更新站内信状态，将未读改为已读，成功后请求消息列表\r\n      this.clearAllMessage(this.routeData.msgType)\r\n    } else {\r\n      // 请求消息列表\r\n      this.onRefresh()\r\n    }\r\n  },\r\n  methods: {\r\n    // 批量更新站内信状态\r\n    clearAllMessage(msgType) {\r\n      let params = {\r\n        msgTypeList: msgType.toString(), // 站内信类型\r\n        status: 0, // 状态(0:已读,-1:未读,-2:删除)\r\n      }\r\n      updateBatchMsgStatus(params).then((res) => {\r\n        if (res.message === '成功') {\r\n          this.onRefresh()\r\n        }\r\n      })\r\n    },\r\n    // 下拉刷新，下拉时组件会自动设置 topLoading 为 true\r\n    onRefresh() {\r\n      console.log('onRefresh触发')\r\n      // 重置列表\r\n      this.pageNum = 1\r\n      // 任务列表\r\n      this.messageList = []\r\n      // 全部数据加载完毕状态改为false\r\n      this.bottomFinished = false\r\n      this.getMsgList()\r\n    },\r\n    // 当组件滚动到底部时，会触发 load 事件并将 bottomLoading 设置成 true\r\n    onLoad() {\r\n      console.log('onLoad触发')\r\n      this.pageNum = this.pageNum + 1\r\n      if (this.bottomFinished === true) {\r\n        this.bottomLoading = false\r\n        return\r\n      }\r\n      this.getMsgList()\r\n    },\r\n    // 获取消息\r\n    getMsgList() {\r\n      let params = {\r\n        currentPage: this.pageNum,\r\n        pageSize: 15,\r\n        // status: -1, // 状态(0:已读，-1:未读)\r\n        searchValue: this.valueText, // 消息内容\r\n        startDate: '', // 开始日期\r\n        endDate: '', // 结束日期\r\n        type: this.routeData.msgType, // 消息类型\r\n      }\r\n      if (this.routeData.nowCheckedBtn === '未读') {\r\n        params.status = -1\r\n      }\r\n      api\r\n        .getMsgList(params)\r\n        .then((res) => {\r\n          if (res.data && res.data.list.length > 0) {\r\n            console.log('res.data', res.data)\r\n\r\n            // 若数据已全部加载完毕，则直接将 bottomFinished 设置成 true，展示: 没有更多了\r\n            if (res.data.pageNum >= res.data.pages) {\r\n              this.bottomFinished = true\r\n            }\r\n\r\n            this.messageList = [...(res?.data?.list || []), ...this.messageList]\r\n            // 根据消息的id去重\r\n            this.messageList = this.messageList.reduce((prev, next) => {\r\n              prev.some((item) => item.id === next.id) ? console.log(next.id) : prev.push(next)\r\n              return prev\r\n            }, [])\r\n\r\n            console.log('this.messageList', _cloneDeep(this.messageList))\r\n\r\n            // 根据消息通知时间分类的数组\r\n            this.dealMessageArr = []\r\n\r\n            // 遍历消息列表，将消息按照 updateDate 分组，将相同年月日时分的消息放在同一个数组中，根据时间排序，最后将分组后的数组赋值给 dealMessageArr\r\n            if (this.messageList.length > 0) {\r\n              // 如果msgBody中含有html标签，则删除html标签\r\n              this.messageList.forEach((item) => {\r\n                if (item.msgBody.indexOf('<') !== -1) {\r\n                  item.msgBody = item.msgBody.replace(/<[^>]+>/g, '')\r\n                }\r\n              })\r\n\r\n              let tempArr = []\r\n              this.messageList.forEach((item) => {\r\n                let time = item.updateDate.slice(0, 16)\r\n                let index = tempArr.findIndex((item) => item.time === time)\r\n                if (index === -1) {\r\n                  tempArr.push({\r\n                    time: time,\r\n                    seamTimeList: [item],\r\n                  })\r\n                } else {\r\n                  tempArr[index].seamTimeList.push(item)\r\n                }\r\n              })\r\n              this.dealMessageArr = tempArr.sort((a, b) => {\r\n                return new Date(b.time).getTime() - new Date(a.time).getTime()\r\n              })\r\n              console.log('this.dealMessageArr', _cloneDeep(this.dealMessageArr))\r\n            }\r\n          }\r\n        })\r\n        .catch(() => {})\r\n        .finally(() => {\r\n          // 下拉时组件会自动设置true，下拉刷新时会触发 refresh 事件，操作完成后将 v-model 设置为 false，表示加载完成。\r\n          this.topLoading = false\r\n          // 列表加载更多时控制加载状态，加载时组件会自动设置为true，加载完成后需手动设置为false\r\n          this.bottomLoading = false\r\n        })\r\n    },\r\n    // 跳转消息详情\r\n    viewDetailMsg(item) {\r\n      let msgTemplateParam = JSON.parse(item.msgTemplateParam)\r\n      console.log('msgTemplateParam', msgTemplateParam)\r\n      // 通知消息状态\r\n      // status: -1, // 状态(0:已读，-1:未读)\r\n      if (item.status == -1) {\r\n        let params = {\r\n          receiveLogIdList: item.receiveLogId,\r\n          status: 0,\r\n        }\r\n        // 更新消息状态为已读\r\n        updateMsgStatusById(params).then((res) => {\r\n          item.status = 0\r\n        })\r\n      }\r\n\r\n      // 消息来源自威派格\r\n      if (msgTemplateParam.source == 'wpg') {\r\n        // msgTemplateParam = {\r\n        //   \"destination\": \"/topic/message\",\r\n        //   \"content\": \"报警平台:管网告警工单【工单编号：20230413000118】，发起节点已办理完结，请及时关注。\",\r\n        //   \"stepDetailId\": \"d708ee5bb8eae5d5ef6a50f49e38296a\",\r\n        //   \"currentUserName\": \"系统管理员\",\r\n        //   \"messageType\": \"done_cc_step\",\r\n        //   \"ticketNo\": \"20230413000118\",\r\n        //   \"stepName\": \"发起\",\r\n        //   \"src\": \"https://sw.chinaxiongan.cn/outworkApp/#/pages/ticket/detail/index?id=d4cbf93d702f657d48c60cf69ddbb144\",\r\n        //   \"label\": \"节点办结抄送\",\r\n        //   \"source\": \"wpg\",\r\n        //   \"title\": \"节点办结通知\",\r\n        //   \"stepStatus\": \"2\",\r\n        //   \"sendTime\": \"2023-04-13 10:04:20\"\r\n        // }\r\n        this.$router.push({\r\n          path: '/iframeMessage',\r\n          query: {\r\n            src: msgTemplateParam?.src || '',\r\n          },\r\n        })\r\n      }\r\n      // 消息不来源自威派格\r\n      // if (!msgTemplateParam?.source || msgTemplateParam?.source != 'wpg')\r\n      else {\r\n        this.viewDialogData = item\r\n        this.showDialog = true\r\n      }\r\n    },\r\n    // 返回上一页\r\n    onClickLeft() {\r\n      this.$router.go(-1)\r\n    },\r\n  },\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.NewsInfoStyle {\r\n  height: 100%;\r\n  background-color: #5dff73;\r\n  background-color: #f5f7f9;\r\n}\r\n\r\n.mainContainer {\r\n  width: 100%;\r\n  height: calc(100% - 140px);\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: flex-start;\r\n  align-items: center;\r\n  overflow: scroll;\r\n  background-color: #f5f7f9;\r\n\r\n  // 下拉刷新组件内容溢出显示\r\n  .fm-pull-refresh {\r\n    overflow: visible;\r\n  }\r\n\r\n  .cardListArrStyle {\r\n    width: 690px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: flex-start;\r\n    align-items: center;\r\n    background: #f5f7f9;\r\n\r\n    .timeStyle {\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      width: 100%;\r\n      height: 40px;\r\n      margin: 24px 0;\r\n      font-size: 28px;\r\n      font-family: SFProText-Regular, SFProText;\r\n      font-weight: 400;\r\n      color: #cccccc;\r\n    }\r\n\r\n    .cardContainerStyle {\r\n      position: relative;\r\n      width: 690px;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: flex-start;\r\n      align-items: center;\r\n      box-sizing: border-box;\r\n      padding: 30px 30px 0 30px;\r\n      margin-bottom: 24px;\r\n      border-radius: 16px;\r\n      background: #ffffff;\r\n      box-shadow: 0px 4px 16px 0px rgba(0, 0, 0, 0.08);\r\n\r\n      .redPoint {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        display: inline-block;\r\n        width: 12px;\r\n        height: 12px;\r\n        border-radius: 50%;\r\n        background: #fe4854;\r\n      }\r\n\r\n      .topContainer {\r\n        width: 100%;\r\n\r\n        .topTitle {\r\n          width: 100%;\r\n          display: flex;\r\n          justify-content: space-between;\r\n          align-items: baseline;\r\n\r\n          .titleLeft {\r\n            font-size: 32px;\r\n            font-family: PingFangSC-Medium, PingFang SC;\r\n            font-weight: 500;\r\n            color: #191919;\r\n          }\r\n\r\n          .timeRight {\r\n            font-size: 24px;\r\n            font-family: SFProText-Regular, SFProText;\r\n            font-weight: 400;\r\n            color: #cccccc;\r\n          }\r\n        }\r\n\r\n        // 非告警消息显示内容\r\n        .topContent1 {\r\n          width: 100%;\r\n          margin-top: 24px;\r\n          margin-bottom: 24px;\r\n          font-size: 28px;\r\n          font-family: PingFangSC-Regular, PingFang SC;\r\n          font-weight: 400;\r\n          color: #555555;\r\n        }\r\n\r\n        // 告警消息显示内容\r\n        .topContent2 {\r\n          width: 100%;\r\n          display: flex;\r\n          flex-direction: column;\r\n          margin-top: 24px;\r\n          margin-bottom: 24px;\r\n\r\n          .lineStyle {\r\n            display: flex;\r\n            width: 100%;\r\n            height: 56px;\r\n            justify-content: flex-start;\r\n            align-items: center;\r\n\r\n            .text1 {\r\n              margin: 0 32px 0 8px;\r\n              font-size: 24px;\r\n              font-family: SFProText-Regular, SFProText;\r\n              font-weight: 400;\r\n              color: #999999;\r\n            }\r\n\r\n            .text2 {\r\n              width: 72%;\r\n              font-size: 24px;\r\n              font-family: SFProText-Regular, SFProText;\r\n              font-weight: 400;\r\n              color: #555555;\r\n              overflow: hidden;\r\n              text-overflow: ellipsis;\r\n              white-space: nowrap;\r\n            }\r\n\r\n            img {\r\n              width: 32px;\r\n              height: 32px;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      .bottomDetail {\r\n        width: 100%;\r\n        height: 88px;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        border-top: 1px solid #e9e9e9;\r\n        background-color: #ffffff;\r\n        font-size: 28px;\r\n        font-family: SFProText-Regular, SFProText;\r\n        font-weight: 400;\r\n        color: #333333;\r\n\r\n        .rightIcon {\r\n          display: inline-block;\r\n          width: 16px;\r\n          height: 16px;\r\n          border: 2px solid #c7c7c7;\r\n          border-top: none;\r\n          border-left: none;\r\n          transform: rotate(-45deg);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/deep/.fm-dialog__content {\r\n  .textContainer {\r\n    margin: 20px 0;\r\n    padding-left: 16px;\r\n    display: flex;\r\n    justify-content: flex-start;\r\n\r\n    .leftTitle {\r\n      width: 130px;\r\n      min-width: 130px;\r\n      font-size: 24px;\r\n      font-family: SFProText-Regular, SFProText;\r\n      font-weight: 400;\r\n      color: #999999;\r\n    }\r\n\r\n    .rightText {\r\n      font-size: 24px;\r\n      font-family: SFProText-Regular, SFProText;\r\n      font-weight: 400;\r\n      color: #555555;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}