{"remainingRequest":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\OneMap\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\src\\views\\OneMap\\index.vue","mtime":1708928163402},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ty_project\\xasw-yy\\revenue\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgbWFwYm94Z2wgZnJvbSAnbWFwYm94LWdsJw0KaW1wb3J0IG1hcFRvb2xzIGZyb20gJy4vbWFwVG9vbHMnDQppbXBvcnQgbW9uaXRvckxpc3QgZnJvbSAnLi9tb25pdG9yTGlzdCcNCmltcG9ydCB7IGFkZEljb25Ub01hcCB9IGZyb20gJ0AvdXRpbHMvbWFwVXRpbHMnDQppbXBvcnQgeyBnZXRBbGxFcXVpcG1lbnRJbmZvcm1hdGlvbiB9IGZyb20gJy4vYXBpJw0KaW1wb3J0IHsgYmJveCwgY2VudGVyIGFzIGdldENlbnRlciB9IGZyb20gJ0B0dXJmL3R1cmYnDQppbXBvcnQgX2Nsb25lRGVlcCBmcm9tICdsb2Rhc2gvY2xvbmVEZWVwJw0KLy8g5Zu+5L6LDQppbXBvcnQgeyBkZWZhbHRMZWdlbmRMaXN0IH0gZnJvbSAnLi9kZWZhbHRMZWdlbmRMaXN0LmpzJw0KLy8g5Y6L5Yqb55uR5rWL54K55Ye75by556qXDQppbXBvcnQgUHJlc3N1cmVNb25pdG9yRGV0YWlsIGZyb20gJy4vY29tcG9uZW50cy9QcmVzc3VyZU1vbml0b3JEZXRhaWwudnVlJw0KaW1wb3J0IExpbmVEZXRhaWwgZnJvbSAnLi9jb21wb25lbnRzL0xpbmVEZXRhaWwudnVlJw0KaW1wb3J0IEVxdWlwbWVudERldGFpbCBmcm9tICcuL2NvbXBvbmVudHMvZXF1aXBtZW50RGV0YWlsLnZ1ZScNCmltcG9ydCBNYXBMZWdlbmQgZnJvbSAnLi9jb21wb25lbnRzL21hcExlZ2VuZC52dWUnDQppbXBvcnQgeyBsZWdlbmRMaXN0SW1wb3J0IH0gZnJvbSAnLi9sZWdlbmRMaXN0Jw0KaW1wb3J0IFRpdGxlVGFicyBmcm9tICdAL2NvbXBvbmVudHMvVGl0bGVUYWJzJw0KY29uc3QgTWFwT2JqID0gew0KICBtYXA6IG51bGwsDQogIHZpZXdlcjogbnVsbCwNCiAgcG9wdXBJdGVtOiAnJywgLy9tYXBib3jmsJTms6HmoYYNCiAgbWFya2VyOiAnJywNCiAgbW9uaXRvclBvcHVwczogW10sDQogIG1vbml0b3JQb3B1cENvbnRlbnQ6IFtdLA0KICBwb3B1cEFycmF5OiBbXSwgLy/msJTms6HmoYbmlbDnu4QNCn0NCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ09uZU1hcCcsDQogIGNvbXBvbmVudHM6IHsNCiAgICBtYXBUb29scywNCiAgICBtb25pdG9yTGlzdCwNCiAgICBQcmVzc3VyZU1vbml0b3JEZXRhaWwsDQogICAgTGluZURldGFpbCwNCiAgICBNYXBMZWdlbmQsDQogICAgVGl0bGVUYWJzLA0KICAgIEVxdWlwbWVudERldGFpbA0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBzZWFyY2hWYWx1ZTogJycsDQogICAgICBzZWxlY3RlZFRhYjogJ+WcsOWbvicsDQogICAgICBlcXVpcG1lbnRUeXBlOiAnbWFwX3N1cHBseV9waXBlJywNCiAgICAgIHBvcHVwU2hvdzogZmFsc2UsDQogICAgICBsZWdlbmRMaXN0OiBsZWdlbmRMaXN0SW1wb3J0LA0KICAgICAgcHJlc3N1cmVNb25pdG9yU2hvdzogZmFsc2UsIC8vIOWOi+WKm+ebkea1i+ivpuaDhemdouadv+aYvumakA0KICAgICAgcGlwZWxpbmVTaG93OiBmYWxzZSwgLy8g566h57q/6K+m5oOF6Z2i5p2/5pi+6ZqQDQogICAgICBlcXVpcG1lbnRTaG93OiBmYWxzZSwgLy8g6K6+5aSH6K+m5oOF6Z2i5p2/5pi+6ZqQDQogICAgICBlcXVpcG1lbnRCYXNlSW5mbzoge30sDQogICAgICBwcmVzc3VyZURhdGFEZXRhaWw6IHt9LCAvLyDljovlipvnm5HmtYvor6bmg4XpnaLmnb/ln7rnoYDkv6Hmga8NCiAgICAgIHBpcGVsaW5lQmFzZUluZm86IHt9LCAvLyDnrqHnur/or6bmg4XpnaLmnb/ln7rnoYDkv6Hmga8NCiAgICAgIGxheWVySUQ6ICcnLA0KICAgICAgbGVnZW5kQ29uZmlnOiBbXSwNCiAgICAgIGljb25zOiBbDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5rO156uZJywNCiAgICAgICAgICB1cmw6IHJlcXVpcmUoJ0AvYXNzZXRzL2ltZy9tYXAvcHVtcC5wbmcnKSwNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICflho3nlJ/msLTljoInLA0KICAgICAgICAgIHVybDogcmVxdWlyZSgnQC9hc3NldHMvaW1nL21hcC/lho3nlJ/msLTljoLlnLDlm74ucG5nJyksDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5L6b5rC05Y6CJywNCiAgICAgICAgICB1cmw6IHJlcXVpcmUoJ0AvYXNzZXRzL2ltZy9tYXAv5L6b5rC05Y6C5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+e7meawtOWKoOWOi+azteermScsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+e7meawtOWKoOWOi+azteermeWcsOWbvi5wbmcnKSwNCiAgICAgICAgfSwNCiAgICAgICAgLy8g55uR5rWL6K6+5aSH5byA5aeLLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+a1gemHj+iuoSjkvpspKicsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+a1gemHj+iuoeWcsOWbvi5wbmcnKSwNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICfmtYHph4/nprvnur/kvpsnLA0KICAgICAgICAgIHVybDogcmVxdWlyZSgnQC9hc3NldHMvaW1nL21hcC/mtYHph4/nprvnur/kvpvlnLDlm74ucG5nJyksDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5rWB6YeP5oql6K2m5L6bJywNCiAgICAgICAgICB1cmw6IHJlcXVpcmUoJ0AvYXNzZXRzL2ltZy9tYXAv5rWB6YeP5oql6K2m5L6b5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+a1gemHj+iuoSjlho3nlJ8pKicsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+a1gemHj+iuoeWGjeeUn+WcsOWbvi5wbmcnKSwNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICfmtYHph4/nprvnur/lho3nlJ8nLA0KICAgICAgICAgIHVybDogcmVxdWlyZSgnQC9hc3NldHMvaW1nL21hcC/mtYHph4/nprvnur/lho3nlJ/lnLDlm74ucG5nJyksDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5rWB6YeP5oql6K2m5YaN55SfJywNCiAgICAgICAgICB1cmw6IHJlcXVpcmUoJ0AvYXNzZXRzL2ltZy9tYXAv5rWB6YeP5oql6K2m5YaN55Sf5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+WOi+WKm+ebkea1iyjkvpspKicsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+WOi+WKm+ebkea1iy5wbmcnKSwNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICfljovlipvnm5HmtYvnprvnur/kvpsnLA0KICAgICAgICAgIHVybDogcmVxdWlyZSgnQC9hc3NldHMvaW1nL21hcC/ljovlipvnprvnur/kvpvlnLDlm74ucG5nJyksDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5Y6L5Yqb55uR5rWL5oql6K2m5L6bJywNCiAgICAgICAgICB1cmw6IHJlcXVpcmUoJ0AvYXNzZXRzL2ltZy9tYXAv5Y6L5Yqb5oql6K2m5L6b5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+WOi+WKm+ebkea1iyjlho3nlJ8pKicsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+WGjeeUn+awtOWOi+WKm+ebkea1iy5wbmcnKSwNCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICfljovlipvnm5HmtYvnprvnur/lho3nlJ8nLA0KICAgICAgICAgIHVybDogcmVxdWlyZSgnQC9hc3NldHMvaW1nL21hcC/ljovlipvnprvnur/lho3nlJ/lnLDlm74ucG5nJyksDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5Y6L5Yqb55uR5rWL5oql6K2m5YaN55SfJywNCiAgICAgICAgICB1cmw6IHJlcXVpcmUoJ0AvYXNzZXRzL2ltZy9tYXAv5Y6L5Yqb5oql6K2m5YaN55Sf5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+a2suS9jeiuoSjpm6gpKicsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+a2suS9jeiuoSjpm6gp5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+a2suS9jeiuoeemu+e6v+mbqCcsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+a2suS9jeiuoSjpm6gp56a757q/5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+a2suS9jeiuoeaKpeitpumbqCcsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+a2suS9jeiuoSjpm6gp5oql6K2m5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+a2suS9jeiuoSjmsaEpKicsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+a2suS9jeiuoSjmsaEp5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+a2suS9jeiuoeemu+e6v+axoScsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+a2suS9jeiuoSjmsaEp56a757q/5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+a2suS9jeiuoeaKpeitpuaxoScsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+a2suS9jeiuoSjmsaEp5oql6K2m5Zyw5Zu+LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+awtOS9jeiuoSonLA0KICAgICAgICAgIHVybDogcmVxdWlyZSgnQC9hc3NldHMvaW1nL21hcC/msLTkvY3orqHlnLDlm74ucG5nJyksDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn5rC05L2N6K6h56a757q/JywNCiAgICAgICAgICB1cmw6IHJlcXVpcmUoJ0AvYXNzZXRzL2ltZy9tYXAv5rC05L2N6K6h5Zyw5Zu+56a757q/LnBuZycpLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogJ+awtOS9jeiuoeaKpeitpicsDQogICAgICAgICAgdXJsOiByZXF1aXJlKCdAL2Fzc2V0cy9pbWcvbWFwL+awtOS9jeiuoeWcsOWbvuaKpeitpi5wbmcnKSwNCiAgICAgICAgfSwNCiAgICAgICAgLy8g55uR5rWL6K6+5aSH57uT5p2fLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAvLyB7DQogICAgICAgIC8vICAgbmFtZTogIuaPkOagh+aUuemAoOe7meawtOWOgiIsDQogICAgICAgIC8vICAgdXJsOiByZXF1aXJlKCJAL2Fzc2V0cy9pbWcvbWFwL+aPkOagh+aUuemAoOe7meawtOWOgi5wbmciKSwNCiAgICAgICAgLy8gfSwNCiAgICAgICAgLy8gew0KICAgICAgICAvLyAgIG5hbWU6ICLop4TliJLmlrDlu7rnu5nmsLTljoIiLA0KICAgICAgICAvLyAgIHVybDogcmVxdWlyZSgiQC9hc3NldHMvaW1nL21hcC/op4TliJLmlrDlu7rnu5nmsLTljoIucG5nIiksDQogICAgICAgIC8vIH0sDQogICAgICBdLA0KICAgICAgc2hvd01vbml0b3JUeXBlOiBmYWxzZSwNCiAgICAgIG1vbml0b3JUeXBlczogWw0KICAgICAgICB7DQogICAgICAgICAgdGV4dDogJ+WOi+WKmycsDQogICAgICAgICAgbmFtZTogJ0lWVE0nLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgdGV4dDogJ+a1gemHjycsDQogICAgICAgICAgbmFtZTogJ0Zsb3dtZXRlcicsDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICB0ZXh0OiAn5rC06LSoJywNCiAgICAgICAgfSwNCiAgICAgIF0sDQogICAgICBtb25pdG9yUG9wdXBWaXNpYmxlOiBmYWxzZSwgLy8g5rCU5rOh5qGG5pi+6ZqQDQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIC8vIOWfuuacrOS/oeaBr+i1i+WAvA0KICAgIGlmICh0aGlzLiRyb3V0ZS5xdWVyeS5kYXRhID09ICfnm5HmtYvliJfooagnKSB7DQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgIHRoaXMuc2VsZWN0ZWRUYWIgPSAn55uR5rWL5YiX6KGoJw0KICAgICAgICB0aGlzLiRyZWZzLnRpdGxlVGFic1JlZi5zZWxlY3RlZFRhYiA9ICfnm5HmtYvliJfooagnDQogICAgICB9KQ0KICAgIH0NCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBzZWxlY3RlZFRhYihuZXdWYWx1ZSwgb2xkVmFsdWUpIHsNCiAgICAgIGlmKHRoaXMuc2VsZWN0ZWRUYWIgPT0gJ+WcsOWbvicpIHsNCiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCk9PiB7DQogICAgICAgICAgdGhpcy5zaG93U2VhcmNoQmFyKCkNCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBvblNlYXJjaCgpIHt9LA0KICAgIG9uQ2xlYXIoKSB7fSwNCiAgICBjaGFuZ2VTZWxlY3RUYWIobmFtZSkgew0KICAgICAgdGhpcy5zZWxlY3RlZFRhYiA9IG5hbWUNCiAgICB9LA0KICAgIHNob3dTZWFyY2hCYXIoKSB7DQoNCiAgICAgIGxldCB0ZW1wTGVuZ3RoID0gMA0KICAgICAgaWYgKHR5cGVvZiB5dWFuY2h1ICE9ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgeXVhbmNodT8uc3RhdHVzQmFyPy5nZXRTdGF0dXNCYXJIZWlnaHQoKHJlcykgPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKDExMTExMTExMTExLCByZXMpOw0KICAgICAgICAgIHRlbXBMZW5ndGggPSByZXMNCiAgICAgICAgfSkNCiAgICAgIH0NCg0KICAgICAgICBsZXQgZm1OYXZCYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuZm0tbmF2LWJhci1jbGFzcyIpOw0KICAgICAgICBsZXQgZm1OYXZCYXJIZWlnaHQgPSBmbU5hdkJhci5jbGllbnRIZWlnaHQNCiAgICAgICAgbGV0IHBhZGRpbmdUb3AgPSBwYXJzZUludChnZXRDb21wdXRlZFN0eWxlKGZtTmF2QmFyKS5wYWRkaW5nVG9wKTsNCiAgICAgICAgZm1OYXZCYXJIZWlnaHQgLT0gcGFkZGluZ1RvcA0KICAgICAgICBmbU5hdkJhckhlaWdodCArPSB0ZW1wTGVuZ3RoDQogICAgICAgIGNvbnNvbGUubG9nKGZtTmF2QmFyLmNsaWVudEhlaWdodCwgJ2ZtTmF2QmFySGVpZ2h0Jyk7DQogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpPT4gew0KICAgICAgICAgIGNvbnNvbGUubG9nKGZtTmF2QmFySGVpZ2h0LCAnZm1OYXZCYXJIZWlnaHQnKTsNCiAgICAgICAgICBpZihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuZm0tc2VhcmNoLWNsYXNzIikpIHsNCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5mbS1zZWFyY2gtY2xhc3MiKS5zdHlsZS50b3AgPSBmbU5hdkJhckhlaWdodCArIDQ4ICsgJ3B4Jw0KICAgICAgICAgICAgY29uc29sZS5sb2coZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmZtLXNlYXJjaC1jbGFzcyIpLnN0eWxlLnRvcCwgJ2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5mbS1zZWFyY2gtY2xhc3MiKS5zdHlsZS50b3AnKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgfSwNCiAgICBvblNlbGVjdChhY3Rpb24pIHsNCiAgICAgIGlmIChhY3Rpb24udGV4dCA9PSAn5rC06LSoJykgew0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIHRoaXMuJHJlZnMubW9uaXRvckxpc3QudHlwZUNsaWNrKGFjdGlvbi5uYW1lKQ0KICAgIH0sDQogICAgLy8g5Zu+5L6L54K55Ye75LqL5Lu2DQogICAgbGVnZW5kQ2xpY2soZSwgaXRlbSwgaWQpIHsNCiAgICAgIGlmICh0eXBlb2YgaXRlbS5pZCA9PSAnbnVtYmVyJykgew0KICAgICAgICB0aGlzLiRub3RpZnkoew0KICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJywNCiAgICAgICAgICBtZXNzYWdlOiAn5b2T5YmN5Zu+5bGC5pqC5peg5pWw5o2u77yBJywNCiAgICAgICAgfSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICBpdGVtLmNsaWNrRmxhZyA9ICFpdGVtLmNsaWNrRmxhZw0KICAgICAgdGhpcy5sZWdlbmRDb250cm9sTGF5ZXIoaXRlbSkNCiAgICAgIHRoaXMuZmxhZ0J0bkNsaWNrKHRoaXMubW9uaXRvclBvcHVwVmlzaWJsZSkgLy8g5Yi35paw5rCU5rOh5qGGDQogICAgfSwNCiAgICBsZWdlbmRDb250cm9sTGF5ZXIoaXRlbSkgew0KICAgICAgbGV0IG1hcCA9IHdpbmRvdy54YU1hcA0KICAgICAgaWYgKG1hcC5nZXRMYXllcihpdGVtLmlkKSkgew0KICAgICAgICBpZiAoaXRlbS5jbGlja0ZsYWcpIHsNCiAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoaXRlbS5pZCwgJ3Zpc2liaWxpdHknLCAnbm9uZScpDQogICAgICAgICAgaWYgKGl0ZW0uaWQgPT0gJ3JkX21hcF9kcmFpbnBpcGVfeXNfYmlnJykgew0KICAgICAgICAgICAgbGV0IGZpbHRlciA9IG1hcC5nZXRGaWx0ZXIoJ3JkX21hcF9tYW5ob2xlJykNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgZmlsdGVyLnRvU3RyaW5nKCkgPT0gWydhbGwnXS50b1N0cmluZygpIHx8DQogICAgICAgICAgICAgIGZpbHRlci50b1N0cmluZygpID09IFsnaW4nLCAnbWFuaG9sZV90eXBlJywgJ+mbqOawtCddLnRvU3RyaW5nKCkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgbWFwLmdldExheW91dFByb3BlcnR5KA0KICAgICAgICAgICAgICAgICAgJ3JkX21hcF9kcmFpbnBpcGVfd3NfYmlnJywNCiAgICAgICAgICAgICAgICAgICd2aXNpYmlsaXR5Jw0KICAgICAgICAgICAgICAgICkgPT0gJ25vbmUnDQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIGZpbHRlciA9IFsnaW4nLCAnbWFuaG9sZV90eXBlJywgJyddDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZmlsdGVyID0gWydpbicsICdtYW5ob2xlX3R5cGUnLCAn5rGh5rC0J10NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy/pm6jmsLTnrqHnur/lm77lsYLmjqfliLbpm6jmsLTkupXjgIHpm6jmsLTnrq3lpLTjgIHpm6jmsLTovoPlsI/lsYLnuqflm77lsYLmmL7npLoNCiAgICAgICAgICAgIG1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgncmRfbWFwX2NvbWInLCAndmlzaWJpbGl0eScsICdub25lJykNCg0KICAgICAgICAgICAgbWFwLnNldEZpbHRlcigncmRfbWFwX21hbmhvbGUnLCBmaWx0ZXIpDQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3lzX2JpZ19kaXJlY3Rpb24nLA0KICAgICAgICAgICAgICAndmlzaWJpbGl0eScsDQogICAgICAgICAgICAgICdub25lJw0KICAgICAgICAgICAgKQ0KICAgICAgICAgICAgbWFwLnNldExheW91dFByb3BlcnR5KA0KICAgICAgICAgICAgICAncmRfbWFwX2RyYWlucGlwZV95c19zbWFsbCcsDQogICAgICAgICAgICAgICd2aXNpYmlsaXR5JywNCiAgICAgICAgICAgICAgJ25vbmUnDQogICAgICAgICAgICApDQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3lzX3NtYWxsX2RpcmVjdGlvbicsDQogICAgICAgICAgICAgICd2aXNpYmlsaXR5JywNCiAgICAgICAgICAgICAgJ25vbmUnDQogICAgICAgICAgICApDQogICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmlkID09ICdtYXBfc3VwcGx5X3BpcGVfY2lyY3VsYXRpbmcnKSB7DQogICAgICAgICAgICAvL+W+queOr+awtO+8iOWbnuawtO+8ieeuoee6v+aOp+WItuW+queOr+awtO+8iOWbnuawtO+8ieiKgueCueaYvuekug0KICAgICAgICAgICAgbWFwLnNldExheW91dFByb3BlcnR5KA0KICAgICAgICAgICAgICAnbWFwX3N1cHBseV9ub2RlX2NpcmN1bGF0aW5nJywNCiAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknLA0KICAgICAgICAgICAgICAnbm9uZScNCiAgICAgICAgICAgICkNCiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uaWQgPT0gJ21hcF9zdXBwbHlfcGlwZV9kaXN0cmlidXRlJykgew0KICAgICAgICAgICAgLy/phY3msLTnrqHnur/mjqfliLbphY3msLToioLngrnmmL7npLoNCiAgICAgICAgICAgIG1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgNCiAgICAgICAgICAgICAgJ21hcF9zdXBwbHlfbm9kZV9kaXN0cmlidXRlJywNCiAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknLA0KICAgICAgICAgICAgICAnbm9uZScNCiAgICAgICAgICAgICkNCiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uaWQgPT0gJ21hcF9zdXBwbHlfcGlwZV9kZWxpdmVyeScpIHsNCiAgICAgICAgICAgIC8v6L6T5rC0566h57q/5o6n5Yi26L6T5rC06IqC54K55pi+56S6DQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdtYXBfc3VwcGx5X25vZGVfZGVsaXZlcnknLA0KICAgICAgICAgICAgICAndmlzaWJpbGl0eScsDQogICAgICAgICAgICAgICdub25lJw0KICAgICAgICAgICAgKQ0KICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5pZCA9PSAnbWFwX3JlY3ljbGVfcGlwZScpIHsNCiAgICAgICAgICAgIC8v5YaN55Sf5rC0566h57q/5o6n5Yi25YaN55Sf5rC06IqC54K55pi+56S6DQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoJ21hcF9yZWN5Y2xlX25vZGUnLCAndmlzaWJpbGl0eScsICdub25lJykNCiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uaWQgPT0gJ3JkX21hcF9kcmFpbnBpcGVfd3NfYmlnJykgew0KICAgICAgICAgICAgLy/msaHmsLTnrqHnur/lm77lsYLmjqfliLbmsaHmsLTkupXjgIHmsaHmsLTnrq3lpLTjgIHmsaHmsLTovoPlsI/lsYLnuqflm77lsYLmmL7npLoNCiAgICAgICAgICAgIGxldCBmaWx0ZXIgPSBtYXAuZ2V0RmlsdGVyKCdyZF9tYXBfbWFuaG9sZScpDQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGZpbHRlci50b1N0cmluZygpID09IFsnYWxsJ10udG9TdHJpbmcoKSB8fA0KICAgICAgICAgICAgICBmaWx0ZXIudG9TdHJpbmcoKSA9PSBbJ2luJywgJ21hbmhvbGVfdHlwZScsICfmsaHmsLQnXS50b1N0cmluZygpDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgIG1hcC5nZXRMYXlvdXRQcm9wZXJ0eSgNCiAgICAgICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3lzX2JpZycsDQogICAgICAgICAgICAgICAgICAndmlzaWJpbGl0eScNCiAgICAgICAgICAgICAgICApID09ICdub25lJw0KICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBbJ2luJywgJ21hbmhvbGVfdHlwZScsICcnXQ0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGZpbHRlciA9IFsnaW4nLCAnbWFuaG9sZV90eXBlJywgJ+mbqOawtCddDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG1hcC5zZXRGaWx0ZXIoJ3JkX21hcF9tYW5ob2xlJywgZmlsdGVyKQ0KICAgICAgICAgICAgbWFwLnNldExheW91dFByb3BlcnR5KA0KICAgICAgICAgICAgICAncmRfbWFwX2RyYWlucGlwZV93c19iaWdfZGlyZWN0aW9uJywNCiAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknLA0KICAgICAgICAgICAgICAnbm9uZScNCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIG1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgNCiAgICAgICAgICAgICAgJ3JkX21hcF9kcmFpbnBpcGVfd3Nfc21hbGwnLA0KICAgICAgICAgICAgICAndmlzaWJpbGl0eScsDQogICAgICAgICAgICAgICdub25lJw0KICAgICAgICAgICAgKQ0KICAgICAgICAgICAgbWFwLnNldExheW91dFByb3BlcnR5KA0KICAgICAgICAgICAgICAncmRfbWFwX2RyYWlucGlwZV93c19zbWFsbF9kaXJlY3Rpb24nLA0KICAgICAgICAgICAgICAndmlzaWJpbGl0eScsDQogICAgICAgICAgICAgICdub25lJw0KICAgICAgICAgICAgKQ0KICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5pZCA9PSAn5Y6L5Yqb55uR5rWLJykgew0KICAgICAgICAgICAgLy8gbWFwLnNldExheW91dFByb3BlcnR5KA0KICAgICAgICAgICAgLy8gICAi5Y6L5Yqb55uR5rWLLeaKpeitpiIsDQogICAgICAgICAgICAvLyAgICJ2aXNpYmlsaXR5IiwNCiAgICAgICAgICAgIC8vICAgIm5vbmUiDQogICAgICAgICAgICAvLyApOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoaXRlbS5pZCwgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpDQogICAgICAgICAgaWYgKGl0ZW0uaWQgPT0gJ3JkX21hcF9kcmFpbnBpcGVfeXNfYmlnJykgew0KICAgICAgICAgICAgbGV0IGZpbHRlciA9IG1hcC5nZXRGaWx0ZXIoJ3JkX21hcF9tYW5ob2xlJykNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgZmlsdGVyLnRvU3RyaW5nKCkgPT0gWydpbicsICdtYW5ob2xlX3R5cGUnLCAnJ10udG9TdHJpbmcoKSB8fA0KICAgICAgICAgICAgICBmaWx0ZXIudG9TdHJpbmcoKSA9PSBbJ2luJywgJ21hbmhvbGVfdHlwZScsICfmsaHmsLQnXS50b1N0cmluZygpDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgIG1hcC5nZXRMYXlvdXRQcm9wZXJ0eSgNCiAgICAgICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3dzX2JpZycsDQogICAgICAgICAgICAgICAgICAndmlzaWJpbGl0eScNCiAgICAgICAgICAgICAgICApICE9ICdub25lJw0KICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBbJ2FsbCddDQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZmlsdGVyID0gWydpbicsICdtYW5ob2xlX3R5cGUnLCAn6Zuo5rC0J10NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbWFwLnNldEZpbHRlcigncmRfbWFwX21hbmhvbGUnLCBmaWx0ZXIpDQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9jb21iJywgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpDQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3lzX2JpZ19kaXJlY3Rpb24nLA0KICAgICAgICAgICAgICAndmlzaWJpbGl0eScsDQogICAgICAgICAgICAgICd2aXNpYmxlJw0KICAgICAgICAgICAgKQ0KICAgICAgICAgICAgbWFwLnNldExheW91dFByb3BlcnR5KA0KICAgICAgICAgICAgICAncmRfbWFwX2RyYWlucGlwZV95c19zbWFsbCcsDQogICAgICAgICAgICAgICd2aXNpYmlsaXR5JywNCiAgICAgICAgICAgICAgJ3Zpc2libGUnDQogICAgICAgICAgICApDQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3lzX3NtYWxsX2RpcmVjdGlvbicsDQogICAgICAgICAgICAgICd2aXNpYmlsaXR5JywNCiAgICAgICAgICAgICAgJ3Zpc2libGUnDQogICAgICAgICAgICApDQogICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmlkID09ICdtYXBfc3VwcGx5X3BpcGVfY2lyY3VsYXRpbmcnKSB7DQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdtYXBfc3VwcGx5X25vZGVfY2lyY3VsYXRpbmcnLA0KICAgICAgICAgICAgICAndmlzaWJpbGl0eScsDQogICAgICAgICAgICAgICd2aXNpYmxlJw0KICAgICAgICAgICAgKQ0KICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5pZCA9PSAnbWFwX3N1cHBseV9waXBlX2Rpc3RyaWJ1dGUnKSB7DQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdtYXBfc3VwcGx5X25vZGVfZGlzdHJpYnV0ZScsDQogICAgICAgICAgICAgICd2aXNpYmlsaXR5JywNCiAgICAgICAgICAgICAgJ3Zpc2libGUnDQogICAgICAgICAgICApDQogICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmlkID09ICdtYXBfc3VwcGx5X3BpcGVfZGVsaXZlcnknKSB7DQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdtYXBfc3VwcGx5X25vZGVfZGVsaXZlcnknLA0KICAgICAgICAgICAgICAndmlzaWJpbGl0eScsDQogICAgICAgICAgICAgICd2aXNpYmxlJw0KICAgICAgICAgICAgKQ0KICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5pZCA9PSAnbWFwX3JlY3ljbGVfcGlwZScpIHsNCiAgICAgICAgICAgIG1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgnbWFwX3JlY3ljbGVfbm9kZScsICd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKQ0KICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5pZCA9PSAncmRfbWFwX2RyYWlucGlwZV93c19iaWcnKSB7DQogICAgICAgICAgICBsZXQgZmlsdGVyID0gbWFwLmdldEZpbHRlcigncmRfbWFwX21hbmhvbGUnKQ0KICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICBmaWx0ZXIudG9TdHJpbmcoKSA9PSBbJ2luJywgJ21hbmhvbGVfdHlwZScsICcnXS50b1N0cmluZygpIHx8DQogICAgICAgICAgICAgIGZpbHRlci50b1N0cmluZygpID09IFsnaW4nLCAnbWFuaG9sZV90eXBlJywgJ+mbqOawtCddLnRvU3RyaW5nKCkNCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgbWFwLmdldExheW91dFByb3BlcnR5KA0KICAgICAgICAgICAgICAgICAgJ3JkX21hcF9kcmFpbnBpcGVfeXNfYmlnJywNCiAgICAgICAgICAgICAgICAgICd2aXNpYmlsaXR5Jw0KICAgICAgICAgICAgICAgICkgIT0gJ25vbmUnDQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIGZpbHRlciA9IFsnYWxsJ10NCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBbJ2luJywgJ21hbmhvbGVfdHlwZScsICfmsaHmsLQnXQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3dzX2JpZ19kaXJlY3Rpb24nLA0KICAgICAgICAgICAgICAndmlzaWJpbGl0eScsDQogICAgICAgICAgICAgICd2aXNpYmxlJw0KICAgICAgICAgICAgKQ0KICAgICAgICAgICAgbWFwLnNldEZpbHRlcigncmRfbWFwX21hbmhvbGUnLCBmaWx0ZXIpDQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoJ3JkX21hcF9tYW5ob2xlJywgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpDQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3dzX3NtYWxsX2RpcmVjdGlvbicsDQogICAgICAgICAgICAgICd2aXNpYmlsaXR5JywNCiAgICAgICAgICAgICAgJ3Zpc2libGUnDQogICAgICAgICAgICApDQogICAgICAgICAgICBtYXAuc2V0TGF5b3V0UHJvcGVydHkoDQogICAgICAgICAgICAgICdyZF9tYXBfZHJhaW5waXBlX3dzX3NtYWxsJywNCiAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknLA0KICAgICAgICAgICAgICAndmlzaWJsZScNCiAgICAgICAgICAgICkNCiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uaWQgPT0gJ+WOi+WKm+ebkea1iycpIHsNCiAgICAgICAgICAgIC8vIG1hcC5zZXRMYXlvdXRQcm9wZXJ0eSgNCiAgICAgICAgICAgIC8vICAgIuWOi+WKm+ebkea1iy3miqXoraYiLA0KICAgICAgICAgICAgLy8gICAidmlzaWJpbGl0eSIsDQogICAgICAgICAgICAvLyAgICJ2aXNpYmxlIg0KICAgICAgICAgICAgLy8gKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOWbvuS+i+agh+mimOeCueWHu+S6i+S7tg0KICAgIGxlZ2VuZFRpdGxlTmFtZUNsaWNrKGxlZ2VuZFRpdGxlTmFtZSkgew0KICAgICAgdGhpcy5sZWdlbmRMaXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgaWYgKGl0ZW0ubGFiZWwgPT09IGxlZ2VuZFRpdGxlTmFtZSkgew0KICAgICAgICAgIGl0ZW0udGl0bGVTdGF0dXMgPSAhaXRlbS50aXRsZVN0YXR1cw0KICAgICAgICAgIC8vDQogICAgICAgICAgaXRlbS5vcHRpb25zLmZvckVhY2goKHNtYWxsSXRlbSkgPT4gew0KICAgICAgICAgICAgLy8g5b2T6K+l5qCH6aKY5LiL5Zu+5bGC5YaF5a655Li65pi+56S654q25oCB5pe25omN6L+b5YWl5Yik5patDQogICAgICAgICAgICBpZiAoaXRlbS50aXRsZVN0YXR1cyA9PT0gdHJ1ZSAmJiB0eXBlb2Ygc21hbGxJdGVtLmlkID09ICdudW1iZXInKSB7DQogICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7DQogICAgICAgICAgICAgICAgICB0eXBlOiAnd2FybmluZycsDQogICAgICAgICAgICAgICAgICBtZXNzYWdlOiBzbWFsbEl0ZW0ubGFiZWwgKyAn5Zu+5bGC5pqC5peg5pWw5o2u77yBJywNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICB9LCAwKQ0KICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChpdGVtLnRpdGxlU3RhdHVzID09PSB0cnVlKSB7DQogICAgICAgICAgICAgIC8vIOagh+mimOeKtuaAgeeCueS6ruaXtg0KICAgICAgICAgICAgICBzbWFsbEl0ZW0uY2xpY2tGbGFnID0gZmFsc2UgLy8g5Zu+5bGC5Z2H5pi+56S6DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBzbWFsbEl0ZW0uY2xpY2tGbGFnID0gdHJ1ZSAvLyDlm77lsYLlnYfpmpDol48NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMubGVnZW5kQ29udHJvbExheWVyKHNtYWxsSXRlbSkNCiAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgICAgdGhpcy5mbGFnQnRuQ2xpY2sodGhpcy5tb25pdG9yUG9wdXBWaXNpYmxlKSAvLyDliLfmlrDmsJTms6HmoYYNCiAgICB9LA0KICAgIGNsb3NlUG9wKHZhbCkgew0KICAgICAgdGhpcy5wb3B1cFNob3cgPSB2YWwNCiAgICB9LA0KICAgIHNob3dNYXBMZWdlbmQoKSB7DQogICAgICB0aGlzLnBvcHVwU2hvdyA9IHRydWUNCiAgICB9LA0KICAgIGdldERlZmF1bHRCYXNlTGF5ZXJzKGxheWVycykgew0KICAgICAgdGhpcy4kcmVmcy5tYXBUb29scy5nZXREZWZhdWx0QmFzZUxheWVycyhsYXllcnMpDQogICAgfSwNCiAgICBnZXRCYXNlTGF5ZXJPYmplY3QobGF5ZXJzKSB7DQogICAgICB0aGlzLiRyZWZzLm1hcFRvb2xzLmdldEJhc2VMYXllck9iamVjdChsYXllcnMpDQogICAgfSwNCiAgICAvKirliJ3lp4vljJblnLDlm77kuovku7YgKi8NCiAgICBhc3luYyBpbml0U2NlbmUoKSB7DQogICAgICB3aW5kb3cueGFNYXAucmVzaXplKCkNCiAgICAgIHRoaXMubGVnZW5kQ29uZmlnID0gZGVmYWx0TGVnZW5kTGlzdA0KICAgICAgLy8gdGhpcy5yZWJ1aWxkTGVnZW5kTGlzdCA9IGxlZ2VuZExpc3QNCiAgICAgIE1hcE9iai5tYXAgPSB3aW5kb3cueGFNYXANCiAgICAgIGF3YWl0IGFkZEljb25Ub01hcChNYXBPYmoubWFwLCB0aGlzLmljb25zKQ0KICAgICAgLy8g5re75Yqg5Y6L5Yqb55uR5rWL6K6+5aSH54K5DQogICAgICB0aGlzLmdldFByZXNzdXJlUG9pbnQoKQ0KICAgIH0sDQogICAgLy8g5Y6L5Yqb55uR5rWL6K6+5aSH5re75Yqg5Zu+5qCHDQogICAgYXN5bmMgZ2V0UHJlc3N1cmVQb2ludCgpIHsNCiAgICAgIGxldCBwYXJhbXMgPSB7DQogICAgICAgIGRldmljZVR5cGU6ICcnLA0KICAgICAgfQ0KICAgICAgbGV0IGFyciA9IFtdDQoNCiAgICAgIGxldCBmbG93QXJyID0gW10gLy/mtYHph4/orqENCiAgICAgIGxldCBzdXBwbHlGbG93QXJyID0gW10gLy/kvpvmsLTmtYHph4/orqENCiAgICAgIGxldCByZWN5Y2xlRmxvd0FyciA9IFtdIC8v5YaN55Sf5rC05rWB6YeP6K6hDQoNCiAgICAgIGxldCBwcmVzc3VyZUFyciA9IFtdIC8v5Y6L5Yqb6K6hDQogICAgICBsZXQgc3VwcGx5UHJlc3N1cmVBcnIgPSBbXSAvL+S+m+awtOWOi+WKm+iuoQ0KICAgICAgbGV0IHJlY3ljbGVQcmVzc3VyZUFyciA9IFtdIC8v5YaN55Sf5rC05Y6L5YqbDQoNCiAgICAgIGxldCBsaXF1aWRvbWV0QXJyID0gW107IC8v5ray5L2N6K6hDQogICAgICBsZXQgcmFpbkxpcXVpZG9tZXRBcnIgPSBbXTsgLy/pm6jmsLTmtrLkvY3orqENCiAgICAgIGxldCBzZXdhZ2VMaXF1aWRvbWV0QXJyID0gW107IC8v5rGh5rC05ray5L2N6K6hDQoNCiAgICAgIGxldCBmbHV2aW9ncmFwaEFyciA9IFtdOyAvL+eUteWtkOawtOWwuu+8iOawtOS9jeiuoe+8iQ0KDQogICAgICAvLyDojrflj5bmiYDmnInnm5HmtYvorr7lpIfln7rnoYDkv6Hmga8NCiAgICAgIGF3YWl0IGdldEFsbEVxdWlwbWVudEluZm9ybWF0aW9uKHBhcmFtcykudGhlbigocmVzKSA9PiB7DQogICAgICAgIGlmIChyZXMuZGF0YSAmJiByZXMuZGF0YS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgYXJyID0gcmVzLmRhdGENCiAgICAgICAgICAvLyDmtYHph4/orqENCiAgICAgICAgICBmbG93QXJyID0gYXJyLmZpbHRlcigoaXRlbSkgPT4gew0KICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZGV2aWNlVHlwZSA9PSAnRmxvd21ldGVyJw0KICAgICAgICAgIH0pDQogICAgICAgICAgc3VwcGx5Rmxvd0FyciA9IGZsb3dBcnIuZmlsdGVyKChpdGVtKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gaXRlbS5iZWxvbmdTeXN0ZW0gPT0gJ+S+m+awtCcNCiAgICAgICAgICB9KQ0KICAgICAgICAgIHJlY3ljbGVGbG93QXJyID0gZmxvd0Fyci5maWx0ZXIoKGl0ZW0pID0+IHsNCiAgICAgICAgICAgIHJldHVybiBpdGVtLmJlbG9uZ1N5c3RlbSA9PSAn5YaN55Sf5rC0Jw0KICAgICAgICAgIH0pDQogICAgICAgICAgY29uc29sZS5sb2coIuS+m+awtOa1gemHj+iuoSIsIHN1cHBseUZsb3dBcnIsICLlho3nlJ/msLTmtYHph4/orqEiLCByZWN5Y2xlRmxvd0Fycik7DQogICAgICAgICAgLy8g5Y6L5Yqb6K6hDQogICAgICAgICAgcHJlc3N1cmVBcnIgPSBhcnIuZmlsdGVyKChpdGVtKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gaXRlbS5kZXZpY2VUeXBlID09ICdJVlRNJw0KICAgICAgICAgIH0pDQogICAgICAgICAgc3VwcGx5UHJlc3N1cmVBcnIgPSBwcmVzc3VyZUFyci5maWx0ZXIoKGl0ZW0pID0+IHsNCiAgICAgICAgICAgIHJldHVybiBpdGVtLmJlbG9uZ1N5c3RlbSA9PSAn5L6b5rC0Jw0KICAgICAgICAgIH0pDQogICAgICAgICAgcmVjeWNsZVByZXNzdXJlQXJyID0gcHJlc3N1cmVBcnIuZmlsdGVyKChpdGVtKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gaXRlbS5iZWxvbmdTeXN0ZW0gPT0gJ+WGjeeUn+awtCcNCiAgICAgICAgICB9KQ0KICAgICAgICAgIGNvbnNvbGUubG9nKCLkvpvmsLTljovlipvorqEiLCBzdXBwbHlQcmVzc3VyZUFyciwgIuWGjeeUn+awtOWOi+WKm+iuoSIsIHJlY3ljbGVQcmVzc3VyZUFycik7DQogICAgICAgICAgLy8g5ray5L2N6K6hDQogICAgICAgICAgbGlxdWlkb21ldEFyciA9IGFyci5maWx0ZXIoKGl0ZW0pID0+IHsNCiAgICAgICAgICAgIHJldHVybiBpdGVtLmRldmljZVR5cGUgPT0gIkxpcXVpZG9tZXQiDQogICAgICAgICAgfSkNCiAgICAgICAgICByYWluTGlxdWlkb21ldEFyciA9IGxpcXVpZG9tZXRBcnIuZmlsdGVyKChpdGVtKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gaXRlbS5iZWxvbmdTeXN0ZW0gPT0gIumbqOawtCI7DQogICAgICAgICAgfSk7DQogICAgICAgICAgc2V3YWdlTGlxdWlkb21ldEFyciA9IGxpcXVpZG9tZXRBcnIuZmlsdGVyKChpdGVtKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gaXRlbS5iZWxvbmdTeXN0ZW0gPT0gIuaxoeawtCI7DQogICAgICAgICAgfSk7DQogICAgICAgICAgY29uc29sZS5sb2coIumbqOawtOa2suS9jeiuoSIsIHJhaW5MaXF1aWRvbWV0QXJyLCAi5rGh5rC05ray5L2N6K6hIiwgc2V3YWdlTGlxdWlkb21ldEFycik7DQogICAgICAgICAgLy8g55S15a2Q5rC05bC677yI5rC05L2N6K6h77yJDQogICAgICAgICAgZmx1dmlvZ3JhcGhBcnIgPSBhcnIuZmlsdGVyKChpdGVtKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gaXRlbS5kZXZpY2VUeXBlID09ICJGbHV2aW9ncmFwaCINCiAgICAgICAgICB9KQ0KICAgICAgICAgIGNvbnNvbGUubG9nKCLnlLXlrZDmsLTlsLrvvIjmsLTkvY3orqHvvIkiLCBmbHV2aW9ncmFwaEFycik7DQogICAgICAgICAgTWFwT2JqLnBvcHVwQXJyYXkgPSBbXSAvLyDmuIXnqbrlvLnnqpfmlbDnu4QNCiAgICAgICAgICB0aGlzLmFkZFlvdXJMYXllcigNCiAgICAgICAgICAgIHN1cHBseUZsb3dBcnIsDQogICAgICAgICAgICAn5rWB6YeP6K6hKOS+mykqJywNCiAgICAgICAgICAgICfmtYHph4/nprvnur/kvpsnLA0KICAgICAgICAgICAgJ+a1gemHj+aKpeitpuS+mycNCiAgICAgICAgICApDQogICAgICAgICAgdGhpcy5hZGRZb3VyTGF5ZXIoDQogICAgICAgICAgICByZWN5Y2xlRmxvd0FyciwNCiAgICAgICAgICAgICfmtYHph4/orqEo5YaN55SfKSonLA0KICAgICAgICAgICAgJ+a1gemHj+emu+e6v+WGjeeUnycsDQogICAgICAgICAgICAn5rWB6YeP5oql6K2m5YaN55SfJw0KICAgICAgICAgICkNCiAgICAgICAgICB0aGlzLmFkZFlvdXJMYXllcigNCiAgICAgICAgICAgIHN1cHBseVByZXNzdXJlQXJyLA0KICAgICAgICAgICAgJ+WOi+WKm+ebkea1iyjkvpspKicsDQogICAgICAgICAgICAn5Y6L5Yqb55uR5rWL56a757q/5L6bJywNCiAgICAgICAgICAgICfljovlipvnm5HmtYvmiqXorabkvpsnDQogICAgICAgICAgKQ0KICAgICAgICAgIHRoaXMuYWRkWW91ckxheWVyKA0KICAgICAgICAgICAgcmVjeWNsZVByZXNzdXJlQXJyLA0KICAgICAgICAgICAgJ+WOi+WKm+ebkea1iyjlho3nlJ8pKicsDQogICAgICAgICAgICAn5Y6L5Yqb55uR5rWL56a757q/5YaN55SfJywNCiAgICAgICAgICAgICfljovlipvnm5HmtYvmiqXorablho3nlJ8nDQogICAgICAgICAgKQ0KICAgICAgICAgIHRoaXMuYWRkWW91ckxheWVyKA0KICAgICAgICAgICAgcmFpbkxpcXVpZG9tZXRBcnIsDQogICAgICAgICAgICAi5ray5L2N6K6hKOmbqCkqIiwNCiAgICAgICAgICAgICLmtrLkvY3orqHnprvnur/pm6giLA0KICAgICAgICAgICAgIua2suS9jeiuoeaKpeitpumbqCINCiAgICAgICAgICApDQogICAgICAgICAgdGhpcy5hZGRZb3VyTGF5ZXIoDQogICAgICAgICAgICBzZXdhZ2VMaXF1aWRvbWV0QXJyLA0KICAgICAgICAgICAgIua2suS9jeiuoSjmsaEpKiIsDQogICAgICAgICAgICAi5ray5L2N6K6h56a757q/5rGhIiwNCiAgICAgICAgICAgICLmtrLkvY3orqHmiqXorabmsaEiDQogICAgICAgICAgKQ0KICAgICAgICAgIHRoaXMuYWRkWW91ckxheWVyKA0KICAgICAgICAgICAgZmx1dmlvZ3JhcGhBcnIsDQogICAgICAgICAgICAi5rC05L2N6K6hKiIsDQogICAgICAgICAgICAi5rC05L2N6K6h56a757q/IiwNCiAgICAgICAgICAgICLmsLTkvY3orqHmiqXoraYiDQogICAgICAgICAgKQ0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQogICAgLy8g5Zyo5Zyw5Zu+5LiK5re75Yqg5Zu+5qCH5Zu+5bGCDQogICAgYWRkWW91ckxheWVyKHBvaW50TGlzdCwgaWQsIG9mZmxpbmVJbWFnZUlkLCB3YXJuSW1hZ2VJZCkgew0KICAgICAgbGV0IHZpc2liaWxpdHkgPSAndmlzaWJsZScNCiAgICAgIGlmIChpZCA9PSAn5Y6L5Yqb55uR5rWLKOS+mykqJykgew0KICAgICAgICB2aXNpYmlsaXR5ID0gJ3Zpc2libGUnDQogICAgICB9IGVsc2Ugew0KICAgICAgICB2aXNpYmlsaXR5ID0gJ25vbmUnDQogICAgICB9DQogICAgICBjb25zdCBzb3VyY2VEYXRhID0gew0KICAgICAgICB0eXBlOiAnRmVhdHVyZUNvbGxlY3Rpb24nLA0KICAgICAgICBmZWF0dXJlczogcG9pbnRMaXN0Lm1hcCgoaSkgPT4gew0KICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICB0eXBlOiAnRmVhdHVyZScsDQogICAgICAgICAgICBnZW9tZXRyeTogew0KICAgICAgICAgICAgICB0eXBlOiAnUG9pbnQnLA0KICAgICAgICAgICAgICBjb29yZGluYXRlczogW2kubG9uLCBpLmxhdF0sDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcHJvcGVydGllczogaSwNCiAgICAgICAgICB9DQogICAgICAgIH0pLA0KICAgICAgfQ0KICAgICAgaWYgKHdpbmRvdy54YU1hcC5nZXRTb3VyY2UoaWQpKSB7DQogICAgICAgIHdpbmRvdy54YU1hcC5nZXRTb3VyY2UoaWQpLnNldERhdGEoc291cmNlRGF0YSkNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICB3aW5kb3cueGFNYXAuYWRkTGF5ZXIoDQogICAgICAgIHsNCiAgICAgICAgICBpZDogaWQsDQogICAgICAgICAgdHlwZTogJ3N5bWJvbCcsDQogICAgICAgICAgc291cmNlOiB7DQogICAgICAgICAgICB0eXBlOiAnZ2VvanNvbicsDQogICAgICAgICAgICBkYXRhOiBzb3VyY2VEYXRhLA0KICAgICAgICAgIH0sDQogICAgICAgICAgbGF5b3V0OiB7DQogICAgICAgICAgICAnaWNvbi1pbWFnZSc6IFsNCiAgICAgICAgICAgICAgJ2Nhc2UnLA0KICAgICAgICAgICAgICBbDQogICAgICAgICAgICAgICAgJ2FsbCcsDQogICAgICAgICAgICAgICAgWyc9PScsIFsnZ2V0JywgJ2lvdE9ubGluZSddLCAnMCddLA0KICAgICAgICAgICAgICAgIFsnIT0nLCBbJ2dldCcsICdpc1dhcm4nXSwgJzEnXSwNCiAgICAgICAgICAgICAgXSwNCiAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgIFsnPT0nLCBbJ2dldCcsICdpb3RPbmxpbmUnXSwgJzEnXSwNCiAgICAgICAgICAgICAgb2ZmbGluZUltYWdlSWQsDQogICAgICAgICAgICAgIFsNCiAgICAgICAgICAgICAgICAnYWxsJywNCiAgICAgICAgICAgICAgICBbJz09JywgWydnZXQnLCAnaW90T25saW5lJ10sICcwJ10sDQogICAgICAgICAgICAgICAgWyc9PScsIFsnZ2V0JywgJ2lzV2FybiddLCAnMSddLA0KICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgICB3YXJuSW1hZ2VJZCwNCiAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgJ2ljb24tc2l6ZSc6IDAuOCwNCiAgICAgICAgICAgIC8vIOWbvuagh+W8uuWItuWFqOmDqOaYvuekug0KICAgICAgICAgICAgJ2ljb24taWdub3JlLXBsYWNlbWVudCc6IHRydWUsDQogICAgICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmlsaXR5LA0KICAgICAgICAgIH0sDQogICAgICAgICAgLy8g6L+Z5q615Luj56CB5piv5YWz5LqO5Zyw5Zu+5qCH6K6w5Zu+5bGC55qE5qC35byP6K6+572u77yM6YCa5bi45Zyo5Zyw5Zu+5bqU55So56iL5bqP5Lit5L2/55So44CC5a6D5o6n5Yi25LqG5qCH6K6w5Zu+5qCH55qE5pi+56S65pa55byP77yM5YyF5ous5Zu+5qCH55qE5Zu+5YOP44CB5aSn5bCP5ZKM5Y+v6KeB5oCn562J5pa56Z2i44CCDQogICAgICAgICAgLy8g5Luj56CB55qE5Li76KaB6YOo5YiG5piv5LiA5LiqYGxheW91dGDlr7nosaHvvIzlhbbkuK3ljIXlkKvkuobkuIDns7vliJflsZ7mgKforr7nva7vvIzmiJHkvJrpgJDkuIDop6Pph4rvvJoNCiAgICAgICAgICAvLyAxLiBgaWNvbi1pbWFnZWA6IOi/meaYr+S4gOS4queUqOS6juiuvue9ruWbvuagh+WbvuWDj+eahOWxnuaAp+OAguWug+S9v+eUqOS6huS4gOenjeadoeS7tuivreWPpee7k+aehO+8jOagueaNruS4jeWQjOeahOadoeS7tumAieaLqeS4jeWQjOeahOWbvuagh+WbvuWDj+OAguWFt+S9k+adpeivtO+8jOWug+agueaNruS7peS4i+adoeS7tuadpemAieaLqeWbvuagh+WbvuWDj++8mg0KICAgICAgICAgIC8vIC0g5aaC5p6cYGlvdE9ubGluZWDlsZ7mgKfnmoTlgLznrYnkuo5gMGDvvIzlubbkuJRgaXNXYXJuYOWxnuaAp+eahOWAvOS4jeetieS6jmAxYO+8jOWImeS9v+eUqGBpZGDkvZzkuLrlm77moIflm77lg4/jgIINCiAgICAgICAgICAvLyAtIOWmguaenGBpb3RPbmxpbmVg5bGe5oCn55qE5YC8562J5LqOYDFg77yM5YiZ5L2/55SoYG9mZmxpbmVJbWFnZUlkYOS9nOS4uuWbvuagh+WbvuWDj+OAgg0KICAgICAgICAgIC8vIC0g5aaC5p6cYGlvdE9ubGluZWDlsZ7mgKfnmoTlgLznrYnkuo5gMGDvvIzlubbkuJRgaXNXYXJuYOWxnuaAp+eahOWAvOetieS6jmAxYO+8jOWImeS9v+eUqGB3YXJuSW1hZ2VJZGDkvZzkuLrlm77moIflm77lg4/jgIINCiAgICAgICAgICAvLyAtIOWmguaenOS7peS4iuadoeS7tumDveS4jea7oei2s++8jOWImeS9v+eUqGBpZGDkvZzkuLrlm77moIflm77lg4/jgIINCiAgICAgICAgICAvLyAyLiBgaWNvbi1zaXplYDog6L+Z5piv5LiA5Liq55So5LqO6K6+572u5Zu+5qCH5aSn5bCP55qE5bGe5oCn77yM5YC85Li6YDAuN2DvvIzooajnpLrlm77moIflpKflsI/kuLrljp/lp4vlpKflsI/nmoQgNzAl44CCDQogICAgICAgICAgLy8gMy4gYGljb24taWdub3JlLXBsYWNlbWVudGA6IOi/meaYr+S4gOS4quW4g+WwlOWAvOWxnuaAp++8jOiuvue9ruS4umB0cnVlYOOAguWug+aOp+WItuaYr+WQpuW/veeVpeWbvuagh+eahOaUvue9ruinhOWIme+8jOWNs+S4jeWPl+Wbvuagh+S5i+mXtOeahOebuOS6kumBruaMoeW9seWTje+8jOW8uuWItuWFqOmDqOaYvuekuuWbvuagh+OAgg0KICAgICAgICAgIC8vIDQuIGB2aXNpYmlsaXR5YDog6L+Z5piv5LiA5Liq55So5LqO6K6+572u5Zu+5bGC5Y+v6KeB5oCn55qE5bGe5oCn77yM5YW25LitYHZpc2liaWxpdHlg55qE5YC855Sx5aSW6YOo5Y+Y6YeP56Gu5a6a44CC6L+Z5Y+v6IO95piv5o6n5Yi25Zu+5qCH5Zu+5bGC5Zyo5Zyw5Zu+5LiK5piv5ZCm5Y+v6KeB55qE5byA5YWz44CCDQogICAgICAgICAgbWluem9vbTogMTMsDQogICAgICAgIH0sDQogICAgICAgICcnDQogICAgICApDQoNCiAgICAgIHBvaW50TGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgIGxldCBzaG93VGV4dCA9ICcnDQogICAgICAgIGxldCBzaG93RnVuY3Rpb25Qb2ludEFyciA9IGl0ZW0ucmVhbHRpbWVEYXRhLmZpbHRlcigoaSkgPT4gew0KICAgICAgICAgIHJldHVybiBpLmlzU2hvdyA9PSAwDQogICAgICAgIH0pDQogICAgICAgIGlmIChzaG93RnVuY3Rpb25Qb2ludEFyci5sZW5ndGggPiAwKSBzaG93VGV4dCA9IHNob3dGdW5jdGlvblBvaW50QXJyWzBdLnZhbCArICcgJyArIHNob3dGdW5jdGlvblBvaW50QXJyWzBdLmRlc2MNCiAgICAgICAgbGV0IHBvcHVwID0gbmV3IG1hcGJveGdsLlBvcHVwKHsNCiAgICAgICAgICBjbG9zZUJ1dHRvbjogZmFsc2UsIC8vIOaYr+WQpuaYvuekuuWFs+mXreaMiemSrg0KICAgICAgICAgIGNsb3NlT25DbGljazogZmFsc2UsIC8vIOaYr+WQpuaUr+aMgeeCueWHu+WFs+mXreaMiemSrg0KICAgICAgICAgIG9mZnNldDogWzAsIC0xMF0sIC8vIOWBj+enu+mHjw0KICAgICAgICB9KQ0KICAgICAgICAgIC5zZXRMbmdMYXQoW2l0ZW0ubG9uLCBpdGVtLmxhdF0pDQogICAgICAgICAgLnNldEhUTUwoYDxkaXYgY2xhc3M9InBvcHVwLWNvbnRlbnQtbW9uaXRvciAke2l0ZW0uYmVsb25nU3lzdGVtfSI+YCArIHNob3dUZXh0ICsgJzwvZGl2PicpDQogICAgICAgIC8vIC5hZGRUbyh3aW5kb3cueGFNYXApOw0KICAgICAgICBwb3B1cC5iZWxvbmdTeXN0ZW0gPSBpdGVtLmJlbG9uZ1N5c3RlbQ0KICAgICAgICBwb3B1cC5sYXllcklkTmFtZSA9IGlkDQogICAgICAgIE1hcE9iai5wb3B1cEFycmF5LnB1c2gocG9wdXApDQogICAgICB9KQ0KDQogICAgICBsZXQgb2JqID0ge30NCiAgICAgIG9ialtpZF0gPSBwb2ludExpc3QNCiAgICAgIE1hcE9iai5tb25pdG9yUG9wdXBDb250ZW50LnB1c2gob2JqKQ0KICAgICAgLy8gd2luZG93LnhhTWFwLm9uKCJtb3VzZWVudGVyIiwgaWQsIHRoaXMuaGFuZGxlTW91c2VFbnRlcik7DQogICAgICAvLyB3aW5kb3cueGFNYXAub24oIm1vdXNlb3V0IiwgaWQsIHRoaXMuaGFuZGxlTW91c2VPdXQpOw0KICAgICAgd2luZG93LnhhTWFwLm9uKCdjbGljaycsIGlkLCB0aGlzLmhhbmRsZU1vdXNlQ2xpY2spDQogICAgICAvLyB3aW5kb3cueGFNYXAub24oImxvYWQiLCAoKSA9PiB7DQogICAgICAvLyAgIHdpbmRvdy54YU1hcC5tb3ZlTGF5ZXIoIuWOi+WKm+ebkea1iyIsICIiKTsNCiAgICAgIC8vIH0pOw0KICAgIH0sDQogICAgZmxhZ0J0bkNsaWNrKGZsYWcpIHsNCiAgICAgIHRoaXMubW9uaXRvclBvcHVwVmlzaWJsZSA9IGZsYWcgLy8g5o6n5Yi25by556qX5pi+56S66ZqQ6JePDQogICAgICBsZXQgbW9uaXRvckxheWVySWRMaXN0ID0gWyLmtYHph4/orqEo5L6bKSoiLCAi5rWB6YeP6K6hKOWGjeeUnykqIiwgIuWOi+WKm+ebkea1iyjkvpspKiIsICLljovlipvnm5HmtYso5YaN55SfKSoiLCAi5ray5L2N6K6hKOmbqCkqIiwgIua2suS9jeiuoSjmsaEpKiIsICLmsLTkvY3orqEqIl0NCiAgICAgIC8vIOaJvuWHuuWcsOWbvuS4iuaJgOacieebkea1i+iuvuWkh+WbvuWxgnZpc2liaWxpdHnkuLp2aXNpYmxl55qE5Zu+5bGCDQogICAgICBsZXQgdmlzaWJsZUxheWVyTGlzdCA9IG1vbml0b3JMYXllcklkTGlzdC5maWx0ZXIoKGl0ZW0pID0+IHsNCiAgICAgICAgcmV0dXJuIHdpbmRvdy54YU1hcC5nZXRMYXlvdXRQcm9wZXJ0eShpdGVtLCAidmlzaWJpbGl0eSIpID09ICJ2aXNpYmxlIg0KICAgICAgfSkNCiAgICAgIGNvbnNvbGUubG9nKCJ2aXNpYmxlTGF5ZXJMaXN0IiwgdmlzaWJsZUxheWVyTGlzdCk7DQogICAgICBNYXBPYmoucG9wdXBBcnJheS5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgIGl0ZW0ucmVtb3ZlKCkNCiAgICAgIH0pDQogICAgICBpZiAoZmxhZykgew0KICAgICAgICBNYXBPYmoucG9wdXBBcnJheS5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgLy8gY29uc29sZS5sb2coIm1hcGJveCBQb3B1cCIsIGl0ZW0pOw0KICAgICAgICAgIGlmIChpdGVtLmJlbG9uZ1N5c3RlbSA9PSAn5YaN55Sf5rC0Jykgew0KICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBpdGVtLmJlbG9uZ1N5c3RlbSkuZm9yRWFjaCgoaSkgPT4gew0KICAgICAgICAgICAgICBpLnBhcmVudEVsZW1lbnQuc3R5bGUuYm9yZGVyVG9wID0gJzJweCBzb2xpZCAjMDBEMTg2Jw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uYmVsb25nU3lzdGVtID09ICfmsaHmsLQnKSB7DQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGl0ZW0uYmVsb25nU3lzdGVtKS5mb3JFYWNoKChpKSA9PiB7DQogICAgICAgICAgICAgIGkucGFyZW50RWxlbWVudC5zdHlsZS5ib3JkZXJUb3AgPSAnMnB4IHNvbGlkICM5MTUxMEEnDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGl0ZW0uYmVsb25nU3lzdGVtKS5mb3JFYWNoKChpKSA9PiB7DQogICAgICAgICAgICAgIGkucGFyZW50RWxlbWVudC5zdHlsZS5ib3JkZXJUb3AgPSAnMnB4IHNvbGlkICMxQjY3RDgnDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgICB2aXNpYmxlTGF5ZXJMaXN0LmZvckVhY2goKGkpID0+IHsNCiAgICAgICAgICAgIGlmIChpdGVtLmxheWVySWROYW1lID09IGkpIHsNCiAgICAgICAgICAgICAgaXRlbS5hZGRUbyh3aW5kb3cueGFNYXApDQogICAgICAgICAgICB9DQogICAgICAgICAgfSkNCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOm8oOagh+eCueWHuw0KICAgIGhhbmRsZU1vdXNlQ2xpY2soZSkgew0KICAgICAgY29uc3QgZmVhdHVyZSA9IGUuZmVhdHVyZXNbMF0NCiAgICAgIHdpbmRvdy54YU1hcC5nZXRDYW52YXMoKS5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcicNCiAgICAgIC8vIOeuoee6v+ivpuaDhemdouadv+WFs+mXrQ0KICAgICAgdGhpcy5waXBlbGluZVNob3cgPSBmYWxzZQ0KICAgICAgLy8g6LWL5YC85Lyg6YCS57uZ6K+m5oOF6Z2i5p2/UHJlc3N1cmVNb25pdG9yLnZ1ZQ0KICAgICAgdGhpcy5wcmVzc3VyZURhdGFEZXRhaWwgPSBfY2xvbmVEZWVwKGZlYXR1cmUucHJvcGVydGllcykNCiAgICAgIHRoaXMucHJlc3N1cmVEYXRhRGV0YWlsLnJlYWx0aW1lRGF0YSA9IEpTT04ucGFyc2UoDQogICAgICAgIGZlYXR1cmUucHJvcGVydGllcy5yZWFsdGltZURhdGENCiAgICAgICkNCiAgICAgIC8vIOWOi+WKm+ebkea1i+ivpuaDhemdouadvw0KICAgICAgdGhpcy5wcmVzc3VyZU1vbml0b3JTaG93ID0gdHJ1ZQ0KICAgIH0sDQogICAgLy8g566h57q/Li4u54K55Ye7DQogICAgaGFuZGxlTGF5ZXJDbGljayhlKSB7DQogICAgICB3aW5kb3cueGFNYXAuZ2V0Q2FudmFzKCkuc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInDQogICAgICBjb25zdCBmZWF0dXJlID0gd2luZG93LnhhTWFwLnF1ZXJ5UmVuZGVyZWRGZWF0dXJlcyhlLnBvaW50KVswXQ0KICAgICAgY29uc29sZS5sb2coJy0tLS0tZmVhdHVyZS0tLS0tJywgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShmZWF0dXJlKSkpOw0KICAgICAgdGhpcy5sYXllcklEID0gZmVhdHVyZS5sYXllci5pZA0KICAgICAgLy8gdGhpcy5yZWJ1aWxkRGV0YWlsSW5mbyhmZWF0dXJlKTsNCg0KICAgICAgY29uc3QgdHlwZSA9IGZlYXR1cmUuZ2VvbWV0cnkudHlwZQ0KICAgICAgY29uc3Qgc291cmNlRGF0YSA9IHsNCiAgICAgICAgdHlwZTogJ0ZlYXR1cmVDb2xsZWN0aW9uJywNCiAgICAgICAgZmVhdHVyZXM6IFtmZWF0dXJlXSwNCiAgICAgIH0NCiAgICAgIGxldCBjZW50ZXIgPSBnZXRDZW50ZXIoc291cmNlRGF0YSkuZ2VvbWV0cnkuY29vcmRpbmF0ZXMNCiAgICAgIHRoaXMuaGlnaGxpZ2h0T25NYXAodHlwZSwgW2ZlYXR1cmVdLCB0aGlzLmxheWVySUQsIGNlbnRlcikNCiAgICAgIGlmICgNCiAgICAgICAgdGhpcy5sYXllcklEID09PSAicmRfbWFwX2RyYWlucGlwZV95c19iaWciIHx8DQogICAgICAgIHRoaXMubGF5ZXJJRCA9PSAicmRfbWFwX2RyYWlucGlwZV95c19zbWFsbCIgfHwNCiAgICAgICAgdGhpcy5sYXllcklEID09PSAicmRfbWFwX2RyYWlucGlwZV93c19iaWciIHx8DQogICAgICAgIHRoaXMubGF5ZXJJRCA9PSAicmRfbWFwX2RyYWlucGlwZV93c19zbWFsbCINCiAgICAgICkgew0KICAgICAgICAvLyDljovlipvnm5HmtYvor6bmg4XpnaLmnb/lhbPpl60NCiAgICAgICAgdGhpcy5wcmVzc3VyZU1vbml0b3JTaG93ID0gZmFsc2UNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRTaG93ID0gZmFsc2UNCiAgICAgICAgLy8g566h57q/5by556qX5omT5byADQogICAgICAgIHRoaXMucGlwZWxpbmVTaG93ID0gdHJ1ZQ0KICAgICAgICB0aGlzLnBpcGVsaW5lQmFzZUluZm8gPSBmZWF0dXJlLnByb3BlcnRpZXMNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRUeXBlID0gIm1hcF9kcmFpbnBpcGUiOw0KICAgICAgfSBlbHNlIGlmKA0KICAgICAgICB0aGlzLmxheWVySUQgPT0gIm1hcF9zdXBwbHlfcGlwZV9kaXN0cmlidXRlIiB8fA0KICAgICAgICB0aGlzLmxheWVySUQgPT0gIm1hcF9zdXBwbHlfcGlwZV9jaXJjdWxhdGluZyIgfHwNCiAgICAgICAgdGhpcy5sYXllcklEID09ICJtYXBfc3VwcGx5X3BpcGVfZGVsaXZlcnkiIHx8IA0KICAgICAgICB0aGlzLmxheWVySUQgPT0gIm1hcF9zdXBwbHlfcGlwZV9vcmlnaW4iIHx8DQogICAgICAgIHRoaXMubGF5ZXJJRCA9PSAibWFwX3N1cHBseV9waXBlX2RyaW5rIg0KICAgICAgKSB7DQogICAgICAgIHRoaXMucHJlc3N1cmVNb25pdG9yU2hvdyA9IGZhbHNlDQogICAgICAgIHRoaXMuZXF1aXBtZW50U2hvdyA9IGZhbHNlDQogICAgICAgIHRoaXMucGlwZWxpbmVTaG93ID0gdHJ1ZQ0KICAgICAgICB0aGlzLnBpcGVsaW5lQmFzZUluZm8gPSBmZWF0dXJlLnByb3BlcnRpZXMNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRUeXBlID0gIm1hcF9zdXBwbHlfcGlwZSI7DQogICAgICB9IGVsc2UgaWYodGhpcy5sYXllcklEID09ICJtYXBfcmVjeWNsZV9waXBlIikgew0KICAgICAgICB0aGlzLnByZXNzdXJlTW9uaXRvclNob3cgPSBmYWxzZQ0KICAgICAgICB0aGlzLmVxdWlwbWVudFNob3cgPSBmYWxzZQ0KICAgICAgICB0aGlzLnBpcGVsaW5lU2hvdyA9IHRydWUNCiAgICAgICAgdGhpcy5waXBlbGluZUJhc2VJbmZvID0gZmVhdHVyZS5wcm9wZXJ0aWVzDQogICAgICAgIHRoaXMuZXF1aXBtZW50VHlwZSA9ICJtYXBfcmVjeWNsZV9waXBlIjsNCiAgICAgIH0gZWxzZSBpZiAodGhpcy5sYXllcklEID09ICJtYXBfc3VwcGx5X2ZpcmVoeWRyYW50Iikgew0KICAgICAgICB0aGlzLmVxdWlwbWVudFR5cGUgPSAibWFwX3N1cHBseV9maXJlaHlkcmFudCI7DQogICAgICAgIHRoaXMucHJlc3N1cmVNb25pdG9yU2hvdyA9IGZhbHNlDQogICAgICAgIHRoaXMucGlwZWxpbmVTaG93ID0gZmFsc2UNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRTaG93ID0gdHJ1ZQ0KICAgICAgICB0aGlzLmVxdWlwbWVudEJhc2VJbmZvID0gZmVhdHVyZS5wcm9wZXJ0aWVzDQogICAgICB9IGVsc2UgaWYgKHRoaXMubGF5ZXJJRCA9PSAibWFwX3N1cHBseV92YWx2ZSIpIHsNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRUeXBlID0gIm1hcF9zdXBwbHlfdmFsdmUiOw0KICAgICAgICB0aGlzLnByZXNzdXJlTW9uaXRvclNob3cgPSBmYWxzZQ0KICAgICAgICB0aGlzLnBpcGVsaW5lU2hvdyA9IGZhbHNlDQogICAgICAgIHRoaXMuZXF1aXBtZW50U2hvdyA9IHRydWUNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRCYXNlSW5mbyA9IGZlYXR1cmUucHJvcGVydGllcw0KICAgICAgfSBlbHNlIGlmICh0aGlzLmxheWVySUQgPT0gInJkX21hcF9tYW5ob2xlIikgew0KICAgICAgICB0aGlzLmVxdWlwbWVudFR5cGUgPSAibWFwX21hbmhvbGUiOw0KICAgICAgICB0aGlzLnByZXNzdXJlTW9uaXRvclNob3cgPSBmYWxzZQ0KICAgICAgICB0aGlzLnBpcGVsaW5lU2hvdyA9IGZhbHNlDQogICAgICAgIHRoaXMuZXF1aXBtZW50U2hvdyA9IHRydWUNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRCYXNlSW5mbyA9IGZlYXR1cmUucHJvcGVydGllcw0KICAgICAgfSBlbHNlIGlmICh0aGlzLmxheWVySUQgPT0gInJkX21hcF9vdXRmYWxsIikgew0KICAgICAgICB0aGlzLmVxdWlwbWVudFR5cGUgPSAibWFwX291dGZhbGwiOw0KICAgICAgICB0aGlzLnByZXNzdXJlTW9uaXRvclNob3cgPSBmYWxzZQ0KICAgICAgICB0aGlzLnBpcGVsaW5lU2hvdyA9IGZhbHNlDQogICAgICAgIHRoaXMuZXF1aXBtZW50U2hvdyA9IHRydWUNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRCYXNlSW5mbyA9IGZlYXR1cmUucHJvcGVydGllcw0KICAgICAgfSBlbHNlIGlmICh0aGlzLmxheWVySUQgPT0gInJkX21hcF9jb21iIikgew0KICAgICAgICAvLyB0aGlzLmVxdWlwbWVudFR5cGUgPSAicmRfbWFwX2NvbWIiOw0KICAgICAgICB0aGlzLmVxdWlwbWVudFR5cGUgPSAibWFwX2NvbWIiOw0KICAgICAgICB0aGlzLnByZXNzdXJlTW9uaXRvclNob3cgPSBmYWxzZQ0KICAgICAgICB0aGlzLnBpcGVsaW5lU2hvdyA9IGZhbHNlDQogICAgICAgIHRoaXMuZXF1aXBtZW50U2hvdyA9IHRydWUNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRCYXNlSW5mbyA9IGZlYXR1cmUucHJvcGVydGllcw0KICAgICAgfSBlbHNlIGlmICh0aGlzLmxheWVySUQgPT0gInJkX21hcF9nYXRlIikgew0KICAgICAgICAvLyB0aGlzLmVxdWlwbWVudFR5cGUgPSAicmRfbWFwX2dhdGUiOw0KICAgICAgICB0aGlzLmVxdWlwbWVudFR5cGUgPSAibWFwX2dhdGUiOw0KICAgICAgICB0aGlzLnByZXNzdXJlTW9uaXRvclNob3cgPSBmYWxzZQ0KICAgICAgICB0aGlzLnBpcGVsaW5lU2hvdyA9IGZhbHNlDQogICAgICAgIHRoaXMuZXF1aXBtZW50U2hvdyA9IHRydWUNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRCYXNlSW5mbyA9IGZlYXR1cmUucHJvcGVydGllcw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8g566h57q/5by556qX5YWz6ZetDQogICAgICAgIHRoaXMucGlwZWxpbmVTaG93ID0gZmFsc2UNCiAgICAgICAgdGhpcy5lcXVpcG1lbnRTaG93ID0gZmFsc2UNCiAgICAgIH0NCiAgICB9LA0KICAgIC8qKg0KICAgICAqIOmrmOS6rumAieS4reeahOWFg+e0oA0KICAgICAqLw0KICAgIGhpZ2hsaWdodE9uTWFwKHR5cGUsIGZlYXR1cmVzLCBsYXllcklELCBsbmdMYXQpIHsNCiAgICAgIGlmIChsYXllcklEKSB0aGlzLmxheWVySUQgPSBsYXllcklEDQogICAgICB0aGlzLnJlbW92ZUFsbEhpZ2hsaWdodExheWVyKCkNCiAgICAgIGNvbnN0IHNvdXJjZURhdGEgPSB7DQogICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsDQogICAgICAgIGZlYXR1cmVzOiBmZWF0dXJlcywNCiAgICAgIH0NCiAgICAgIGNvbnN0IGJvdW5kID0gYmJveChzb3VyY2VEYXRhKQ0KICAgICAgY29uc3QgY2VudGVyID0gbG5nTGF0DQogICAgICAgID8gbG5nTGF0DQogICAgICAgIDogZ2V0Q2VudGVyKHNvdXJjZURhdGEpLmdlb21ldHJ5LmNvb3JkaW5hdGVzDQogICAgICAvLyB3aW5kb3cueGFNYXAuZml0Qm91bmRzKGJvdW5kLCB7IG1heFpvb206IDEyLCBwYWRkaW5nOiB7IHJpZ2h0OiA0MDAgfSB9KTsNCiAgICAgIC8vIHRoaXMuc2hvd1BvcHVwKGNlbnRlciwgZmVhdHVyZXMpOw0KICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBpZiAoWydQb2ludCcsICdNdWx0aVBvaW50J10uaW5jbHVkZXModHlwZSkpIHsNCiAgICAgICAgICAvLyDngrkNCiAgICAgICAgICBpZiAoZmVhdHVyZXNbMF0ubGF5ZXIgJiYgZmVhdHVyZXNbMF0ubGF5ZXIubGF5b3V0WydpY29uLWltYWdlJ10pIHsNCiAgICAgICAgICAgIGNvbnN0IGljb25OYW1lID0NCiAgICAgICAgICAgICAgZmVhdHVyZXNbMF0ubGF5ZXIubGF5b3V0WydpY29uLWltYWdlJ10/Lm5hbWUgfHwNCiAgICAgICAgICAgICAgZmVhdHVyZXNbMF0ubGF5ZXIubGF5b3V0WydpY29uLWltYWdlJ10NCiAgICAgICAgICAgIGNvbnN0IGljb25zaXplID0gZmVhdHVyZXNbMF0ubGF5ZXIubGF5b3V0WydpY29uLXNpemUnXSB8fCAxDQogICAgICAgICAgICB0aGlzLnJlbW92ZUxheWVyU291cmNlKCdoaWdodGxpZ2h0UG9pbnQnKQ0KICAgICAgICAgICAgLy8gaWYodGhpcy5tb3VzZUVudGVyQ2FsbGJhY2spIHRoaXMubW91c2VFbnRlckNhbGxiYWNrKGUubG5nTGF0LCBbZmVhdHVyZV0pOw0KICAgICAgICAgICAgd2luZG93LnhhTWFwLmFkZExheWVyKHsNCiAgICAgICAgICAgICAgaWQ6ICdoaWdodGxpZ2h0UG9pbnQnLA0KICAgICAgICAgICAgICB0eXBlOiAnc3ltYm9sJywNCiAgICAgICAgICAgICAgc291cmNlOiB7DQogICAgICAgICAgICAgICAgdHlwZTogJ2dlb2pzb24nLA0KICAgICAgICAgICAgICAgIGRhdGE6IGZlYXR1cmVzWzBdLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICAnaWNvbi1zaXplJzogaWNvbnNpemUgKiAxLjQsDQogICAgICAgICAgICAgICAgJ2ljb24taW1hZ2UnOiBpY29uTmFtZSwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHdpbmRvdy54YU1hcC5hZGRMYXllcih7DQogICAgICAgICAgICAgIGlkOiBgaGlnaHRsaWdodFBvaW50YCwNCiAgICAgICAgICAgICAgdHlwZTogJ2NpcmNsZScsDQogICAgICAgICAgICAgIHNvdXJjZTogew0KICAgICAgICAgICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgICAgICAgICBkYXRhOiBzb3VyY2VEYXRhLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBwYWludDogew0KICAgICAgICAgICAgICAgICdjaXJjbGUtY29sb3InOiAncmVkJywNCiAgICAgICAgICAgICAgICAnY2lyY2xlLW9wYWNpdHknOiAwLA0KICAgICAgICAgICAgICAgICdjaXJjbGUtcmFkaXVzJzogNiwNCiAgICAgICAgICAgICAgICAnY2lyY2xlLXN0cm9rZS1jb2xvcic6ICcjMUQ3NUZGJywNCiAgICAgICAgICAgICAgICAnY2lyY2xlLXN0cm9rZS1vcGFjaXR5JzogMSwNCiAgICAgICAgICAgICAgICAnY2lyY2xlLXN0cm9rZS13aWR0aCc6IDMsDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIC8vIGxheW91dDogew0KICAgICAgICAgICAgICAvLyAgICdpY29uLWltYWdlJzogJ3VuY3VyZWQtcHVsc2luZy1kb3QnLA0KICAgICAgICAgICAgICAvLyAgICdpY29uLWlnbm9yZS1wbGFjZW1lbnQnOiB0cnVlLA0KICAgICAgICAgICAgICAvLyAgICdpY29uLWFsbG93LW92ZXJsYXAnOiB0cnVlDQogICAgICAgICAgICAgIC8vIH0sDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ1NIT1dfTUFQUkVTRVJWT0lSJywgZmFsc2UpDQogICAgICAgIH0gZWxzZSBpZiAoWydMaW5lU3RyaW5nJywgJ011bHRpTGluZVN0cmluZyddLmluY2x1ZGVzKHR5cGUpKSB7DQogICAgICAgICAgbGV0IGNvbG9yID0gJyM5MTUxMEEnDQogICAgICAgICAgaWYgKGxheWVySUQgPT0gJ3JkX21hcF9kcmFpbnBpcGVfeXNfc21hbGwnKSB7DQogICAgICAgICAgICBjb2xvciA9ICcjMzk5QUVBJw0KICAgICAgICAgIH0gZWxzZSBpZiAobGF5ZXJJRCA9PSAncmRfbWFwX2RyYWlucGlwZV93c19zbWFsbCcpIHsNCiAgICAgICAgICAgIGNvbG9yID0gJyM5MTUxMEEnDQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGRlZmFsdExlZ2VuZExpc3QuZm9yRWFjaCgobGVnZW5kKSA9PiB7DQogICAgICAgICAgICAgIGlmIChsZWdlbmQuaWQgPT0gbGF5ZXJJRCkgew0KICAgICAgICAgICAgICAgIGNvbG9yID0gbGVnZW5kLmNsaWNrQ29sb3INCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICB9DQogICAgICAgICAgLy8g57q/DQogICAgICAgICAgd2luZG93LnhhTWFwLmFkZExheWVyKHsNCiAgICAgICAgICAgIGlkOiBgaGlnaHRsaWdodExpbmVgLA0KICAgICAgICAgICAgdHlwZTogJ2xpbmUnLA0KICAgICAgICAgICAgc291cmNlOiB7DQogICAgICAgICAgICAgIHR5cGU6ICdnZW9qc29uJywNCiAgICAgICAgICAgICAgZGF0YTogc291cmNlRGF0YSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBwYWludDogew0KICAgICAgICAgICAgICAnbGluZS1jb2xvcic6IGNvbG9yLA0KICAgICAgICAgICAgICAnbGluZS13aWR0aCc6IDgsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgLy8gbGF5b3V0OiB7DQogICAgICAgICAgICAvLyAgICdpY29uLWltYWdlJzogJ3VuY3VyZWQtcHVsc2luZy1kb3QnLA0KICAgICAgICAgICAgLy8gICAnaWNvbi1pZ25vcmUtcGxhY2VtZW50JzogdHJ1ZSwNCiAgICAgICAgICAgIC8vICAgJ2ljb24tYWxsb3ctb3ZlcmxhcCc6IHRydWUNCiAgICAgICAgICAgIC8vIH0sDQogICAgICAgICAgfSkNCiAgICAgICAgICAvLyB3aW5kb3cueGFNYXAuZml0Qm91bmRzKGJvdW5kLCB7bWF4Wm9vbTogMTUsIHBhZGRpbmc6IHtyaWdodDogNDAwfX0pOw0KICAgICAgICB9IGVsc2UgaWYgKFsnUG9seWdvbicsICdNdWx0aVBvbHlnb24nXS5pbmNsdWRlcyh0eXBlKSkgew0KICAgICAgICAgIC8vIOmdog0KICAgICAgICAgIHdpbmRvdy54YU1hcC5hZGRMYXllcih7DQogICAgICAgICAgICBpZDogYGhpZ2h0bGlnaHRQb2x5Z29uYCwNCiAgICAgICAgICAgIHR5cGU6ICdmaWxsJywNCiAgICAgICAgICAgIHNvdXJjZTogew0KICAgICAgICAgICAgICB0eXBlOiAnZ2VvanNvbicsDQogICAgICAgICAgICAgIGRhdGE6IHNvdXJjZURhdGEsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcGFpbnQ6IHsNCiAgICAgICAgICAgICAgJ2ZpbGwtY29sb3InOiAncmdiYSgyNTUsIDAsIDAsIDAuNiknLA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8vIGxheW91dDogew0KICAgICAgICAgICAgLy8gICAnaWNvbi1pbWFnZSc6ICd1bmN1cmVkLXB1bHNpbmctZG90JywNCiAgICAgICAgICAgIC8vICAgJ2ljb24taWdub3JlLXBsYWNlbWVudCc6IHRydWUsDQogICAgICAgICAgICAvLyAgICdpY29uLWFsbG93LW92ZXJsYXAnOiB0cnVlDQogICAgICAgICAgICAvLyB9LA0KICAgICAgICAgIH0pDQogICAgICAgICAgLy8gd2luZG93LnhhTWFwLmZpdEJvdW5kcyhib3VuZCwge21heFpvb206IDE1LCBwYWRkaW5nOiB7cmlnaHQ6IDQwMH19KTsNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIHJlbW92ZUFsbEhpZ2hsaWdodExheWVyKGUpIHsNCiAgICAgIHRoaXMucmVtb3ZlTGF5ZXJTb3VyY2UoJ2hpZ2h0bGlnaHRQb2ludCcpDQogICAgICB0aGlzLnJlbW92ZUxheWVyU291cmNlKCdoaWdodGxpZ2h0TGluZScpDQogICAgICB0aGlzLnJlbW92ZUxheWVyU291cmNlKCdoaWdodGxpZ2h0UG9seWdvbicpDQogICAgfSwNCiAgICAvKioNCiAgICAgKiDmuIXnqbrkuLTml7bnmoTlm77lsYLlkozmupANCiAgICAgKi8NCiAgICByZW1vdmVMYXllclNvdXJjZShuYW1lKSB7DQogICAgICBpZiAod2luZG93LnhhTWFwLmdldExheWVyKGAke25hbWV9YCkpIHdpbmRvdy54YU1hcC5yZW1vdmVMYXllcihgJHtuYW1lfWApDQogICAgICBpZiAod2luZG93LnhhTWFwLmdldFNvdXJjZShgJHtuYW1lfWApKQ0KICAgICAgICB3aW5kb3cueGFNYXAucmVtb3ZlU291cmNlKGAke25hbWV9YCkNCiAgICB9LA0KICAgIC8vIOWOi+WKm+ebkea1i+ivpuaDhemdouadv1ByZXNzdXJlTW9uaXRvci52dWXlhbPpl63mjInpkq7lm57osIMNCiAgICBjbG9zZVBvcHVwX3ByZXNzdXJlKCkgew0KICAgICAgLy8g5Y6L5Yqb55uR5rWL6K+m5oOF6Z2i5p2/DQogICAgICB0aGlzLnByZXNzdXJlTW9uaXRvclNob3cgPSBmYWxzZQ0KICAgIH0sDQogICAgLy/lhbPpl63nrqHnur/lvLnnqpcNCiAgICBjbG9zZVBvcHVwX2xpbmUoKSB7DQogICAgICB0aGlzLnBpcGVsaW5lU2hvdyA9IGZhbHNlDQogICAgICB0aGlzLmVxdWlwbWVudFNob3cgPSBmYWxzZQ0KICAgIH0sDQogIH0sDQogIG1vdW50ZWQgKCkgew0KICAgIHRoaXMuc2hvd1NlYXJjaEJhcigpDQogIH0sDQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAuFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/OneMap","sourcesContent":["<template>\r\n  <div class=\"main\">\r\n    <fm-nav-bar class=\"fm-nav-bar-class\">\r\n      <template #title>\r\n        <title-tabs ref=\"titleTabsRef\" leftTitleName=\"地图\" rightTitleName=\"监测列表\" @changeSelectTab=\"changeSelectTab\"></title-tabs>\r\n      </template>\r\n      <template #right>\r\n        <img\r\n          v-if=\"selectedTab == '地图'\"\r\n          style=\"height: 24px; position: absolute; right: 20px\"\r\n          :src=\"require('@/assets/img/map/right.png')\"\r\n          @click=\"showMapLegend\"\r\n        />\r\n        <fm-popover\r\n          v-else\r\n          :visible.sync=\"showMonitorType\"\r\n          trigger=\"click\"\r\n          :actions=\"monitorTypes\"\r\n          @select=\"onSelect\"\r\n          placement=\"bottom-end\"\r\n        >\r\n          <template #reference>\r\n            <img\r\n              style=\"height: 24px\"\r\n              :src=\"require('@/assets/img/map/right.png')\"\r\n            />\r\n          </template>\r\n        </fm-popover>\r\n      </template>\r\n    </fm-nav-bar>\r\n    <xa-map\r\n      class=\"xa-map-one-map\"\r\n      v-if=\"selectedTab == '地图'\"\r\n      :create=\"initScene\"\r\n      :legendConfig=\"legendConfig\"\r\n      @getDefaultBaseLayers=\"getDefaultBaseLayers\"\r\n      @getBaseLayerObject=\"getBaseLayerObject\"\r\n      @handleLayerClick=\"handleLayerClick\"\r\n    ></xa-map>\r\n    <fm-search\r\n      v-if=\"selectedTab == '地图'\"\r\n      class = \"fm-search-class\"\r\n      v-model=\"searchValue\"\r\n      placeholder=\"搜索\"\r\n      @clear=\"onClear\"\r\n      @search=\"onSearch\"\r\n    />\r\n    <mapTools\r\n     ref=\"mapTools\" \r\n     @flagBtnClick=\"flagBtnClick\"\r\n     v-if=\"selectedTab == '地图'\r\n    \">\r\n    </mapTools>\r\n    <monitorList\r\n      ref=\"monitorList\"\r\n      v-if=\"selectedTab == '监测列表'\"\r\n    ></monitorList>\r\n    <PressureMonitorDetail\r\n      v-if=\"pressureMonitorShow && selectedTab == '地图'\"\r\n      :pressureDataDetail=\"pressureDataDetail\"\r\n      @closePopup_pressure=\"closePopup_pressure\"\r\n    >\r\n    </PressureMonitorDetail>\r\n    <LineDetail\r\n      v-if=\"pipelineShow && selectedTab == '地图'\"\r\n      :pipelineBaseInfo=\"pipelineBaseInfo\"\r\n      @closePopup_line=\"closePopup_line\"\r\n    >\r\n    </LineDetail>\r\n    <EquipmentDetail\r\n      v-if=\"equipmentShow && selectedTab == '地图'\"\r\n      :equipmentType=\"equipmentType\"\r\n      :equipmentBaseInfo=\"equipmentBaseInfo\"\r\n      @closePopup_line=\"closePopup_line\"\r\n    />\r\n    <map-legend\r\n      :popupShow=\"popupShow\"\r\n      shape=\"rectangle\"\r\n      :data-source=\"legendList\"\r\n      :click-func=\"legendClick\"\r\n      @closePop=\"closePop\"\r\n      @legendTitleNameClick=\"legendTitleNameClick\"\r\n    ></map-legend>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport mapboxgl from 'mapbox-gl'\r\nimport mapTools from './mapTools'\r\nimport monitorList from './monitorList'\r\nimport { addIconToMap } from '@/utils/mapUtils'\r\nimport { getAllEquipmentInformation } from './api'\r\nimport { bbox, center as getCenter } from '@turf/turf'\r\nimport _cloneDeep from 'lodash/cloneDeep'\r\n// 图例\r\nimport { defaltLegendList } from './defaltLegendList.js'\r\n// 压力监测点击弹窗\r\nimport PressureMonitorDetail from './components/PressureMonitorDetail.vue'\r\nimport LineDetail from './components/LineDetail.vue'\r\nimport EquipmentDetail from './components/equipmentDetail.vue'\r\nimport MapLegend from './components/mapLegend.vue'\r\nimport { legendListImport } from './legendList'\r\nimport TitleTabs from '@/components/TitleTabs'\r\nconst MapObj = {\r\n  map: null,\r\n  viewer: null,\r\n  popupItem: '', //mapbox气泡框\r\n  marker: '',\r\n  monitorPopups: [],\r\n  monitorPopupContent: [],\r\n  popupArray: [], //气泡框数组\r\n}\r\nexport default {\r\n  name: 'OneMap',\r\n  components: {\r\n    mapTools,\r\n    monitorList,\r\n    PressureMonitorDetail,\r\n    LineDetail,\r\n    MapLegend,\r\n    TitleTabs,\r\n    EquipmentDetail\r\n  },\r\n  data() {\r\n    return {\r\n      searchValue: '',\r\n      selectedTab: '地图',\r\n      equipmentType: 'map_supply_pipe',\r\n      popupShow: false,\r\n      legendList: legendListImport,\r\n      pressureMonitorShow: false, // 压力监测详情面板显隐\r\n      pipelineShow: false, // 管线详情面板显隐\r\n      equipmentShow: false, // 设备详情面板显隐\r\n      equipmentBaseInfo: {},\r\n      pressureDataDetail: {}, // 压力监测详情面板基础信息\r\n      pipelineBaseInfo: {}, // 管线详情面板基础信息\r\n      layerID: '',\r\n      legendConfig: [],\r\n      icons: [\r\n        {\r\n          name: '泵站',\r\n          url: require('@/assets/img/map/pump.png'),\r\n        },\r\n        {\r\n          name: '再生水厂',\r\n          url: require('@/assets/img/map/再生水厂地图.png'),\r\n        },\r\n        {\r\n          name: '供水厂',\r\n          url: require('@/assets/img/map/供水厂地图.png'),\r\n        },\r\n        {\r\n          name: '给水加压泵站',\r\n          url: require('@/assets/img/map/给水加压泵站地图.png'),\r\n        },\r\n        // 监测设备开始-------------------------------------------------------------------------------\r\n        {\r\n          name: '流量计(供)*',\r\n          url: require('@/assets/img/map/流量计地图.png'),\r\n        },\r\n        {\r\n          name: '流量离线供',\r\n          url: require('@/assets/img/map/流量离线供地图.png'),\r\n        },\r\n        {\r\n          name: '流量报警供',\r\n          url: require('@/assets/img/map/流量报警供地图.png'),\r\n        },\r\n        {\r\n          name: '流量计(再生)*',\r\n          url: require('@/assets/img/map/流量计再生地图.png'),\r\n        },\r\n        {\r\n          name: '流量离线再生',\r\n          url: require('@/assets/img/map/流量离线再生地图.png'),\r\n        },\r\n        {\r\n          name: '流量报警再生',\r\n          url: require('@/assets/img/map/流量报警再生地图.png'),\r\n        },\r\n        {\r\n          name: '压力监测(供)*',\r\n          url: require('@/assets/img/map/压力监测.png'),\r\n        },\r\n        {\r\n          name: '压力监测离线供',\r\n          url: require('@/assets/img/map/压力离线供地图.png'),\r\n        },\r\n        {\r\n          name: '压力监测报警供',\r\n          url: require('@/assets/img/map/压力报警供地图.png'),\r\n        },\r\n        {\r\n          name: '压力监测(再生)*',\r\n          url: require('@/assets/img/map/再生水压力监测.png'),\r\n        },\r\n        {\r\n          name: '压力监测离线再生',\r\n          url: require('@/assets/img/map/压力离线再生地图.png'),\r\n        },\r\n        {\r\n          name: '压力监测报警再生',\r\n          url: require('@/assets/img/map/压力报警再生地图.png'),\r\n        },\r\n        {\r\n          name: '液位计(雨)*',\r\n          url: require('@/assets/img/map/液位计(雨)地图.png'),\r\n        },\r\n        {\r\n          name: '液位计离线雨',\r\n          url: require('@/assets/img/map/液位计(雨)离线地图.png'),\r\n        },\r\n        {\r\n          name: '液位计报警雨',\r\n          url: require('@/assets/img/map/液位计(雨)报警地图.png'),\r\n        },\r\n        {\r\n          name: '液位计(污)*',\r\n          url: require('@/assets/img/map/液位计(污)地图.png'),\r\n        },\r\n        {\r\n          name: '液位计离线污',\r\n          url: require('@/assets/img/map/液位计(污)离线地图.png'),\r\n        },\r\n        {\r\n          name: '液位计报警污',\r\n          url: require('@/assets/img/map/液位计(污)报警地图.png'),\r\n        },\r\n        {\r\n          name: '水位计*',\r\n          url: require('@/assets/img/map/水位计地图.png'),\r\n        },\r\n        {\r\n          name: '水位计离线',\r\n          url: require('@/assets/img/map/水位计地图离线.png'),\r\n        },\r\n        {\r\n          name: '水位计报警',\r\n          url: require('@/assets/img/map/水位计地图报警.png'),\r\n        },\r\n        // 监测设备结束-------------------------------------------------------------------------------\r\n        // {\r\n        //   name: \"提标改造给水厂\",\r\n        //   url: require(\"@/assets/img/map/提标改造给水厂.png\"),\r\n        // },\r\n        // {\r\n        //   name: \"规划新建给水厂\",\r\n        //   url: require(\"@/assets/img/map/规划新建给水厂.png\"),\r\n        // },\r\n      ],\r\n      showMonitorType: false,\r\n      monitorTypes: [\r\n        {\r\n          text: '压力',\r\n          name: 'IVTM',\r\n        },\r\n        {\r\n          text: '流量',\r\n          name: 'Flowmeter',\r\n        },\r\n        {\r\n          text: '水质',\r\n        },\r\n      ],\r\n      monitorPopupVisible: false, // 气泡框显隐\r\n    }\r\n  },\r\n  created() {\r\n    // 基本信息赋值\r\n    if (this.$route.query.data == '监测列表') {\r\n      this.$nextTick(() => {\r\n        this.selectedTab = '监测列表'\r\n        this.$refs.titleTabsRef.selectedTab = '监测列表'\r\n      })\r\n    }\r\n  },\r\n  watch: {\r\n    selectedTab(newValue, oldValue) {\r\n      if(this.selectedTab == '地图') {\r\n        this.$nextTick(()=> {\r\n          this.showSearchBar()\r\n        })\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    onSearch() {},\r\n    onClear() {},\r\n    changeSelectTab(name) {\r\n      this.selectedTab = name\r\n    },\r\n    showSearchBar() {\r\n\r\n      let tempLength = 0\r\n      if (typeof yuanchu != 'undefined') {\r\n          yuanchu?.statusBar?.getStatusBarHeight((res) => {\r\n          console.log(11111111111, res);\r\n          tempLength = res\r\n        })\r\n      }\r\n\r\n        let fmNavBar = document.querySelector(\".fm-nav-bar-class\");\r\n        let fmNavBarHeight = fmNavBar.clientHeight\r\n        let paddingTop = parseInt(getComputedStyle(fmNavBar).paddingTop);\r\n        fmNavBarHeight -= paddingTop\r\n        fmNavBarHeight += tempLength\r\n        console.log(fmNavBar.clientHeight, 'fmNavBarHeight');\r\n        this.$nextTick(()=> {\r\n          console.log(fmNavBarHeight, 'fmNavBarHeight');\r\n          if(document.querySelector(\".fm-search-class\")) {\r\n            document.querySelector(\".fm-search-class\").style.top = fmNavBarHeight + 48 + 'px'\r\n            console.log(document.querySelector(\".fm-search-class\").style.top, 'document.querySelector(\".fm-search-class\").style.top');\r\n          }\r\n        })\r\n    },\r\n    onSelect(action) {\r\n      if (action.text == '水质') {\r\n        return\r\n      }\r\n      this.$refs.monitorList.typeClick(action.name)\r\n    },\r\n    // 图例点击事件\r\n    legendClick(e, item, id) {\r\n      if (typeof item.id == 'number') {\r\n        this.$notify({\r\n          type: 'warning',\r\n          message: '当前图层暂无数据！',\r\n        })\r\n        return\r\n      }\r\n      item.clickFlag = !item.clickFlag\r\n      this.legendControlLayer(item)\r\n      this.flagBtnClick(this.monitorPopupVisible) // 刷新气泡框\r\n    },\r\n    legendControlLayer(item) {\r\n      let map = window.xaMap\r\n      if (map.getLayer(item.id)) {\r\n        if (item.clickFlag) {\r\n          map.setLayoutProperty(item.id, 'visibility', 'none')\r\n          if (item.id == 'rd_map_drainpipe_ys_big') {\r\n            let filter = map.getFilter('rd_map_manhole')\r\n            if (\r\n              filter.toString() == ['all'].toString() ||\r\n              filter.toString() == ['in', 'manhole_type', '雨水'].toString()\r\n            ) {\r\n              if (\r\n                map.getLayoutProperty(\r\n                  'rd_map_drainpipe_ws_big',\r\n                  'visibility'\r\n                ) == 'none'\r\n              ) {\r\n                filter = ['in', 'manhole_type', '']\r\n              } else {\r\n                filter = ['in', 'manhole_type', '污水']\r\n              }\r\n            }\r\n            //雨水管线图层控制雨水井、雨水箭头、雨水较小层级图层显示\r\n            map.setLayoutProperty('rd_map_comb', 'visibility', 'none')\r\n\r\n            map.setFilter('rd_map_manhole', filter)\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ys_big_direction',\r\n              'visibility',\r\n              'none'\r\n            )\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ys_small',\r\n              'visibility',\r\n              'none'\r\n            )\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ys_small_direction',\r\n              'visibility',\r\n              'none'\r\n            )\r\n          } else if (item.id == 'map_supply_pipe_circulating') {\r\n            //循环水（回水）管线控制循环水（回水）节点显示\r\n            map.setLayoutProperty(\r\n              'map_supply_node_circulating',\r\n              'visibility',\r\n              'none'\r\n            )\r\n          } else if (item.id == 'map_supply_pipe_distribute') {\r\n            //配水管线控制配水节点显示\r\n            map.setLayoutProperty(\r\n              'map_supply_node_distribute',\r\n              'visibility',\r\n              'none'\r\n            )\r\n          } else if (item.id == 'map_supply_pipe_delivery') {\r\n            //输水管线控制输水节点显示\r\n            map.setLayoutProperty(\r\n              'map_supply_node_delivery',\r\n              'visibility',\r\n              'none'\r\n            )\r\n          } else if (item.id == 'map_recycle_pipe') {\r\n            //再生水管线控制再生水节点显示\r\n            map.setLayoutProperty('map_recycle_node', 'visibility', 'none')\r\n          } else if (item.id == 'rd_map_drainpipe_ws_big') {\r\n            //污水管线图层控制污水井、污水箭头、污水较小层级图层显示\r\n            let filter = map.getFilter('rd_map_manhole')\r\n            if (\r\n              filter.toString() == ['all'].toString() ||\r\n              filter.toString() == ['in', 'manhole_type', '污水'].toString()\r\n            ) {\r\n              if (\r\n                map.getLayoutProperty(\r\n                  'rd_map_drainpipe_ys_big',\r\n                  'visibility'\r\n                ) == 'none'\r\n              ) {\r\n                filter = ['in', 'manhole_type', '']\r\n              } else {\r\n                filter = ['in', 'manhole_type', '雨水']\r\n              }\r\n            }\r\n            map.setFilter('rd_map_manhole', filter)\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ws_big_direction',\r\n              'visibility',\r\n              'none'\r\n            )\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ws_small',\r\n              'visibility',\r\n              'none'\r\n            )\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ws_small_direction',\r\n              'visibility',\r\n              'none'\r\n            )\r\n          } else if (item.id == '压力监测') {\r\n            // map.setLayoutProperty(\r\n            //   \"压力监测-报警\",\r\n            //   \"visibility\",\r\n            //   \"none\"\r\n            // );\r\n          }\r\n        } else {\r\n          map.setLayoutProperty(item.id, 'visibility', 'visible')\r\n          if (item.id == 'rd_map_drainpipe_ys_big') {\r\n            let filter = map.getFilter('rd_map_manhole')\r\n            if (\r\n              filter.toString() == ['in', 'manhole_type', ''].toString() ||\r\n              filter.toString() == ['in', 'manhole_type', '污水'].toString()\r\n            ) {\r\n              if (\r\n                map.getLayoutProperty(\r\n                  'rd_map_drainpipe_ws_big',\r\n                  'visibility'\r\n                ) != 'none'\r\n              ) {\r\n                filter = ['all']\r\n              } else {\r\n                filter = ['in', 'manhole_type', '雨水']\r\n              }\r\n            }\r\n            map.setFilter('rd_map_manhole', filter)\r\n            map.setLayoutProperty('rd_map_comb', 'visibility', 'visible')\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ys_big_direction',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ys_small',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ys_small_direction',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n          } else if (item.id == 'map_supply_pipe_circulating') {\r\n            map.setLayoutProperty(\r\n              'map_supply_node_circulating',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n          } else if (item.id == 'map_supply_pipe_distribute') {\r\n            map.setLayoutProperty(\r\n              'map_supply_node_distribute',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n          } else if (item.id == 'map_supply_pipe_delivery') {\r\n            map.setLayoutProperty(\r\n              'map_supply_node_delivery',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n          } else if (item.id == 'map_recycle_pipe') {\r\n            map.setLayoutProperty('map_recycle_node', 'visibility', 'visible')\r\n          } else if (item.id == 'rd_map_drainpipe_ws_big') {\r\n            let filter = map.getFilter('rd_map_manhole')\r\n            if (\r\n              filter.toString() == ['in', 'manhole_type', ''].toString() ||\r\n              filter.toString() == ['in', 'manhole_type', '雨水'].toString()\r\n            ) {\r\n              if (\r\n                map.getLayoutProperty(\r\n                  'rd_map_drainpipe_ys_big',\r\n                  'visibility'\r\n                ) != 'none'\r\n              ) {\r\n                filter = ['all']\r\n              } else {\r\n                filter = ['in', 'manhole_type', '污水']\r\n              }\r\n            }\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ws_big_direction',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n            map.setFilter('rd_map_manhole', filter)\r\n            map.setLayoutProperty('rd_map_manhole', 'visibility', 'visible')\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ws_small_direction',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n            map.setLayoutProperty(\r\n              'rd_map_drainpipe_ws_small',\r\n              'visibility',\r\n              'visible'\r\n            )\r\n          } else if (item.id == '压力监测') {\r\n            // map.setLayoutProperty(\r\n            //   \"压力监测-报警\",\r\n            //   \"visibility\",\r\n            //   \"visible\"\r\n            // );\r\n          }\r\n        }\r\n      }\r\n    },\r\n    // 图例标题点击事件\r\n    legendTitleNameClick(legendTitleName) {\r\n      this.legendList.forEach((item) => {\r\n        if (item.label === legendTitleName) {\r\n          item.titleStatus = !item.titleStatus\r\n          //\r\n          item.options.forEach((smallItem) => {\r\n            // 当该标题下图层内容为显示状态时才进入判断\r\n            if (item.titleStatus === true && typeof smallItem.id == 'number') {\r\n              setTimeout(() => {\r\n                this.$notify({\r\n                  type: 'warning',\r\n                  message: smallItem.label + '图层暂无数据！',\r\n                })\r\n              }, 0)\r\n              return\r\n            }\r\n            if (item.titleStatus === true) {\r\n              // 标题状态点亮时\r\n              smallItem.clickFlag = false // 图层均显示\r\n            } else {\r\n              smallItem.clickFlag = true // 图层均隐藏\r\n            }\r\n            this.legendControlLayer(smallItem)\r\n          })\r\n        }\r\n      })\r\n      this.flagBtnClick(this.monitorPopupVisible) // 刷新气泡框\r\n    },\r\n    closePop(val) {\r\n      this.popupShow = val\r\n    },\r\n    showMapLegend() {\r\n      this.popupShow = true\r\n    },\r\n    getDefaultBaseLayers(layers) {\r\n      this.$refs.mapTools.getDefaultBaseLayers(layers)\r\n    },\r\n    getBaseLayerObject(layers) {\r\n      this.$refs.mapTools.getBaseLayerObject(layers)\r\n    },\r\n    /**初始化地图事件 */\r\n    async initScene() {\r\n      window.xaMap.resize()\r\n      this.legendConfig = defaltLegendList\r\n      // this.rebuildLegendList = legendList\r\n      MapObj.map = window.xaMap\r\n      await addIconToMap(MapObj.map, this.icons)\r\n      // 添加压力监测设备点\r\n      this.getPressurePoint()\r\n    },\r\n    // 压力监测设备添加图标\r\n    async getPressurePoint() {\r\n      let params = {\r\n        deviceType: '',\r\n      }\r\n      let arr = []\r\n\r\n      let flowArr = [] //流量计\r\n      let supplyFlowArr = [] //供水流量计\r\n      let recycleFlowArr = [] //再生水流量计\r\n\r\n      let pressureArr = [] //压力计\r\n      let supplyPressureArr = [] //供水压力计\r\n      let recyclePressureArr = [] //再生水压力\r\n\r\n      let liquidometArr = []; //液位计\r\n      let rainLiquidometArr = []; //雨水液位计\r\n      let sewageLiquidometArr = []; //污水液位计\r\n\r\n      let fluviographArr = []; //电子水尺（水位计）\r\n\r\n      // 获取所有监测设备基础信息\r\n      await getAllEquipmentInformation(params).then((res) => {\r\n        if (res.data && res.data.length > 0) {\r\n          arr = res.data\r\n          // 流量计\r\n          flowArr = arr.filter((item) => {\r\n            return item.deviceType == 'Flowmeter'\r\n          })\r\n          supplyFlowArr = flowArr.filter((item) => {\r\n            return item.belongSystem == '供水'\r\n          })\r\n          recycleFlowArr = flowArr.filter((item) => {\r\n            return item.belongSystem == '再生水'\r\n          })\r\n          console.log(\"供水流量计\", supplyFlowArr, \"再生水流量计\", recycleFlowArr);\r\n          // 压力计\r\n          pressureArr = arr.filter((item) => {\r\n            return item.deviceType == 'IVTM'\r\n          })\r\n          supplyPressureArr = pressureArr.filter((item) => {\r\n            return item.belongSystem == '供水'\r\n          })\r\n          recyclePressureArr = pressureArr.filter((item) => {\r\n            return item.belongSystem == '再生水'\r\n          })\r\n          console.log(\"供水压力计\", supplyPressureArr, \"再生水压力计\", recyclePressureArr);\r\n          // 液位计\r\n          liquidometArr = arr.filter((item) => {\r\n            return item.deviceType == \"Liquidomet\"\r\n          })\r\n          rainLiquidometArr = liquidometArr.filter((item) => {\r\n            return item.belongSystem == \"雨水\";\r\n          });\r\n          sewageLiquidometArr = liquidometArr.filter((item) => {\r\n            return item.belongSystem == \"污水\";\r\n          });\r\n          console.log(\"雨水液位计\", rainLiquidometArr, \"污水液位计\", sewageLiquidometArr);\r\n          // 电子水尺（水位计）\r\n          fluviographArr = arr.filter((item) => {\r\n            return item.deviceType == \"Fluviograph\"\r\n          })\r\n          console.log(\"电子水尺（水位计）\", fluviographArr);\r\n          MapObj.popupArray = [] // 清空弹窗数组\r\n          this.addYourLayer(\r\n            supplyFlowArr,\r\n            '流量计(供)*',\r\n            '流量离线供',\r\n            '流量报警供'\r\n          )\r\n          this.addYourLayer(\r\n            recycleFlowArr,\r\n            '流量计(再生)*',\r\n            '流量离线再生',\r\n            '流量报警再生'\r\n          )\r\n          this.addYourLayer(\r\n            supplyPressureArr,\r\n            '压力监测(供)*',\r\n            '压力监测离线供',\r\n            '压力监测报警供'\r\n          )\r\n          this.addYourLayer(\r\n            recyclePressureArr,\r\n            '压力监测(再生)*',\r\n            '压力监测离线再生',\r\n            '压力监测报警再生'\r\n          )\r\n          this.addYourLayer(\r\n            rainLiquidometArr,\r\n            \"液位计(雨)*\",\r\n            \"液位计离线雨\",\r\n            \"液位计报警雨\"\r\n          )\r\n          this.addYourLayer(\r\n            sewageLiquidometArr,\r\n            \"液位计(污)*\",\r\n            \"液位计离线污\",\r\n            \"液位计报警污\"\r\n          )\r\n          this.addYourLayer(\r\n            fluviographArr,\r\n            \"水位计*\",\r\n            \"水位计离线\",\r\n            \"水位计报警\"\r\n          )\r\n        }\r\n      })\r\n    },\r\n    // 在地图上添加图标图层\r\n    addYourLayer(pointList, id, offlineImageId, warnImageId) {\r\n      let visibility = 'visible'\r\n      if (id == '压力监测(供)*') {\r\n        visibility = 'visible'\r\n      } else {\r\n        visibility = 'none'\r\n      }\r\n      const sourceData = {\r\n        type: 'FeatureCollection',\r\n        features: pointList.map((i) => {\r\n          return {\r\n            type: 'Feature',\r\n            geometry: {\r\n              type: 'Point',\r\n              coordinates: [i.lon, i.lat],\r\n            },\r\n            properties: i,\r\n          }\r\n        }),\r\n      }\r\n      if (window.xaMap.getSource(id)) {\r\n        window.xaMap.getSource(id).setData(sourceData)\r\n        return\r\n      }\r\n      window.xaMap.addLayer(\r\n        {\r\n          id: id,\r\n          type: 'symbol',\r\n          source: {\r\n            type: 'geojson',\r\n            data: sourceData,\r\n          },\r\n          layout: {\r\n            'icon-image': [\r\n              'case',\r\n              [\r\n                'all',\r\n                ['==', ['get', 'iotOnline'], '0'],\r\n                ['!=', ['get', 'isWarn'], '1'],\r\n              ],\r\n              id,\r\n              ['==', ['get', 'iotOnline'], '1'],\r\n              offlineImageId,\r\n              [\r\n                'all',\r\n                ['==', ['get', 'iotOnline'], '0'],\r\n                ['==', ['get', 'isWarn'], '1'],\r\n              ],\r\n              warnImageId,\r\n              id,\r\n            ],\r\n            'icon-size': 0.8,\r\n            // 图标强制全部显示\r\n            'icon-ignore-placement': true,\r\n            visibility: visibility,\r\n          },\r\n          // 这段代码是关于地图标记图层的样式设置，通常在地图应用程序中使用。它控制了标记图标的显示方式，包括图标的图像、大小和可见性等方面。\r\n          // 代码的主要部分是一个`layout`对象，其中包含了一系列属性设置，我会逐一解释：\r\n          // 1. `icon-image`: 这是一个用于设置图标图像的属性。它使用了一种条件语句结构，根据不同的条件选择不同的图标图像。具体来说，它根据以下条件来选择图标图像：\r\n          // - 如果`iotOnline`属性的值等于`0`，并且`isWarn`属性的值不等于`1`，则使用`id`作为图标图像。\r\n          // - 如果`iotOnline`属性的值等于`1`，则使用`offlineImageId`作为图标图像。\r\n          // - 如果`iotOnline`属性的值等于`0`，并且`isWarn`属性的值等于`1`，则使用`warnImageId`作为图标图像。\r\n          // - 如果以上条件都不满足，则使用`id`作为图标图像。\r\n          // 2. `icon-size`: 这是一个用于设置图标大小的属性，值为`0.7`，表示图标大小为原始大小的 70%。\r\n          // 3. `icon-ignore-placement`: 这是一个布尔值属性，设置为`true`。它控制是否忽略图标的放置规则，即不受图标之间的相互遮挡影响，强制全部显示图标。\r\n          // 4. `visibility`: 这是一个用于设置图层可见性的属性，其中`visibility`的值由外部变量确定。这可能是控制图标图层在地图上是否可见的开关。\r\n          minzoom: 13,\r\n        },\r\n        ''\r\n      )\r\n\r\n      pointList.forEach((item) => {\r\n        let showText = ''\r\n        let showFunctionPointArr = item.realtimeData.filter((i) => {\r\n          return i.isShow == 0\r\n        })\r\n        if (showFunctionPointArr.length > 0) showText = showFunctionPointArr[0].val + ' ' + showFunctionPointArr[0].desc\r\n        let popup = new mapboxgl.Popup({\r\n          closeButton: false, // 是否显示关闭按钮\r\n          closeOnClick: false, // 是否支持点击关闭按钮\r\n          offset: [0, -10], // 偏移量\r\n        })\r\n          .setLngLat([item.lon, item.lat])\r\n          .setHTML(`<div class=\"popup-content-monitor ${item.belongSystem}\">` + showText + '</div>')\r\n        // .addTo(window.xaMap);\r\n        popup.belongSystem = item.belongSystem\r\n        popup.layerIdName = id\r\n        MapObj.popupArray.push(popup)\r\n      })\r\n\r\n      let obj = {}\r\n      obj[id] = pointList\r\n      MapObj.monitorPopupContent.push(obj)\r\n      // window.xaMap.on(\"mouseenter\", id, this.handleMouseEnter);\r\n      // window.xaMap.on(\"mouseout\", id, this.handleMouseOut);\r\n      window.xaMap.on('click', id, this.handleMouseClick)\r\n      // window.xaMap.on(\"load\", () => {\r\n      //   window.xaMap.moveLayer(\"压力监测\", \"\");\r\n      // });\r\n    },\r\n    flagBtnClick(flag) {\r\n      this.monitorPopupVisible = flag // 控制弹窗显示隐藏\r\n      let monitorLayerIdList = [\"流量计(供)*\", \"流量计(再生)*\", \"压力监测(供)*\", \"压力监测(再生)*\", \"液位计(雨)*\", \"液位计(污)*\", \"水位计*\"]\r\n      // 找出地图上所有监测设备图层visibility为visible的图层\r\n      let visibleLayerList = monitorLayerIdList.filter((item) => {\r\n        return window.xaMap.getLayoutProperty(item, \"visibility\") == \"visible\"\r\n      })\r\n      console.log(\"visibleLayerList\", visibleLayerList);\r\n      MapObj.popupArray.forEach((item) => {\r\n        item.remove()\r\n      })\r\n      if (flag) {\r\n        MapObj.popupArray.forEach((item) => {\r\n          // console.log(\"mapbox Popup\", item);\r\n          if (item.belongSystem == '再生水') {\r\n            document.querySelectorAll('.' + item.belongSystem).forEach((i) => {\r\n              i.parentElement.style.borderTop = '2px solid #00D186'\r\n            })\r\n          } else if (item.belongSystem == '污水') {\r\n            document.querySelectorAll('.' + item.belongSystem).forEach((i) => {\r\n              i.parentElement.style.borderTop = '2px solid #91510A'\r\n            })\r\n          } else {\r\n            document.querySelectorAll('.' + item.belongSystem).forEach((i) => {\r\n              i.parentElement.style.borderTop = '2px solid #1B67D8'\r\n            })\r\n          }\r\n          visibleLayerList.forEach((i) => {\r\n            if (item.layerIdName == i) {\r\n              item.addTo(window.xaMap)\r\n            }\r\n          })\r\n        })\r\n      }\r\n    },\r\n    // 鼠标点击\r\n    handleMouseClick(e) {\r\n      const feature = e.features[0]\r\n      window.xaMap.getCanvas().style.cursor = 'pointer'\r\n      // 管线详情面板关闭\r\n      this.pipelineShow = false\r\n      // 赋值传递给详情面板PressureMonitor.vue\r\n      this.pressureDataDetail = _cloneDeep(feature.properties)\r\n      this.pressureDataDetail.realtimeData = JSON.parse(\r\n        feature.properties.realtimeData\r\n      )\r\n      // 压力监测详情面板\r\n      this.pressureMonitorShow = true\r\n    },\r\n    // 管线...点击\r\n    handleLayerClick(e) {\r\n      window.xaMap.getCanvas().style.cursor = 'pointer'\r\n      const feature = window.xaMap.queryRenderedFeatures(e.point)[0]\r\n      console.log('-----feature-----', JSON.parse(JSON.stringify(feature)));\r\n      this.layerID = feature.layer.id\r\n      // this.rebuildDetailInfo(feature);\r\n\r\n      const type = feature.geometry.type\r\n      const sourceData = {\r\n        type: 'FeatureCollection',\r\n        features: [feature],\r\n      }\r\n      let center = getCenter(sourceData).geometry.coordinates\r\n      this.highlightOnMap(type, [feature], this.layerID, center)\r\n      if (\r\n        this.layerID === \"rd_map_drainpipe_ys_big\" ||\r\n        this.layerID == \"rd_map_drainpipe_ys_small\" ||\r\n        this.layerID === \"rd_map_drainpipe_ws_big\" ||\r\n        this.layerID == \"rd_map_drainpipe_ws_small\"\r\n      ) {\r\n        // 压力监测详情面板关闭\r\n        this.pressureMonitorShow = false\r\n        this.equipmentShow = false\r\n        // 管线弹窗打开\r\n        this.pipelineShow = true\r\n        this.pipelineBaseInfo = feature.properties\r\n        this.equipmentType = \"map_drainpipe\";\r\n      } else if(\r\n        this.layerID == \"map_supply_pipe_distribute\" ||\r\n        this.layerID == \"map_supply_pipe_circulating\" ||\r\n        this.layerID == \"map_supply_pipe_delivery\" || \r\n        this.layerID == \"map_supply_pipe_origin\" ||\r\n        this.layerID == \"map_supply_pipe_drink\"\r\n      ) {\r\n        this.pressureMonitorShow = false\r\n        this.equipmentShow = false\r\n        this.pipelineShow = true\r\n        this.pipelineBaseInfo = feature.properties\r\n        this.equipmentType = \"map_supply_pipe\";\r\n      } else if(this.layerID == \"map_recycle_pipe\") {\r\n        this.pressureMonitorShow = false\r\n        this.equipmentShow = false\r\n        this.pipelineShow = true\r\n        this.pipelineBaseInfo = feature.properties\r\n        this.equipmentType = \"map_recycle_pipe\";\r\n      } else if (this.layerID == \"map_supply_firehydrant\") {\r\n        this.equipmentType = \"map_supply_firehydrant\";\r\n        this.pressureMonitorShow = false\r\n        this.pipelineShow = false\r\n        this.equipmentShow = true\r\n        this.equipmentBaseInfo = feature.properties\r\n      } else if (this.layerID == \"map_supply_valve\") {\r\n        this.equipmentType = \"map_supply_valve\";\r\n        this.pressureMonitorShow = false\r\n        this.pipelineShow = false\r\n        this.equipmentShow = true\r\n        this.equipmentBaseInfo = feature.properties\r\n      } else if (this.layerID == \"rd_map_manhole\") {\r\n        this.equipmentType = \"map_manhole\";\r\n        this.pressureMonitorShow = false\r\n        this.pipelineShow = false\r\n        this.equipmentShow = true\r\n        this.equipmentBaseInfo = feature.properties\r\n      } else if (this.layerID == \"rd_map_outfall\") {\r\n        this.equipmentType = \"map_outfall\";\r\n        this.pressureMonitorShow = false\r\n        this.pipelineShow = false\r\n        this.equipmentShow = true\r\n        this.equipmentBaseInfo = feature.properties\r\n      } else if (this.layerID == \"rd_map_comb\") {\r\n        // this.equipmentType = \"rd_map_comb\";\r\n        this.equipmentType = \"map_comb\";\r\n        this.pressureMonitorShow = false\r\n        this.pipelineShow = false\r\n        this.equipmentShow = true\r\n        this.equipmentBaseInfo = feature.properties\r\n      } else if (this.layerID == \"rd_map_gate\") {\r\n        // this.equipmentType = \"rd_map_gate\";\r\n        this.equipmentType = \"map_gate\";\r\n        this.pressureMonitorShow = false\r\n        this.pipelineShow = false\r\n        this.equipmentShow = true\r\n        this.equipmentBaseInfo = feature.properties\r\n      } else {\r\n        // 管线弹窗关闭\r\n        this.pipelineShow = false\r\n        this.equipmentShow = false\r\n      }\r\n    },\r\n    /**\r\n     * 高亮选中的元素\r\n     */\r\n    highlightOnMap(type, features, layerID, lngLat) {\r\n      if (layerID) this.layerID = layerID\r\n      this.removeAllHighlightLayer()\r\n      const sourceData = {\r\n        type: 'FeatureCollection',\r\n        features: features,\r\n      }\r\n      const bound = bbox(sourceData)\r\n      const center = lngLat\r\n        ? lngLat\r\n        : getCenter(sourceData).geometry.coordinates\r\n      // window.xaMap.fitBounds(bound, { maxZoom: 12, padding: { right: 400 } });\r\n      // this.showPopup(center, features);\r\n      this.$nextTick(() => {\r\n        if (['Point', 'MultiPoint'].includes(type)) {\r\n          // 点\r\n          if (features[0].layer && features[0].layer.layout['icon-image']) {\r\n            const iconName =\r\n              features[0].layer.layout['icon-image']?.name ||\r\n              features[0].layer.layout['icon-image']\r\n            const iconsize = features[0].layer.layout['icon-size'] || 1\r\n            this.removeLayerSource('hightlightPoint')\r\n            // if(this.mouseEnterCallback) this.mouseEnterCallback(e.lngLat, [feature]);\r\n            window.xaMap.addLayer({\r\n              id: 'hightlightPoint',\r\n              type: 'symbol',\r\n              source: {\r\n                type: 'geojson',\r\n                data: features[0],\r\n              },\r\n              layout: {\r\n                'icon-size': iconsize * 1.4,\r\n                'icon-image': iconName,\r\n              },\r\n            })\r\n          } else {\r\n            window.xaMap.addLayer({\r\n              id: `hightlightPoint`,\r\n              type: 'circle',\r\n              source: {\r\n                type: 'geojson',\r\n                data: sourceData,\r\n              },\r\n              paint: {\r\n                'circle-color': 'red',\r\n                'circle-opacity': 0,\r\n                'circle-radius': 6,\r\n                'circle-stroke-color': '#1D75FF',\r\n                'circle-stroke-opacity': 1,\r\n                'circle-stroke-width': 3,\r\n              },\r\n              // layout: {\r\n              //   'icon-image': 'uncured-pulsing-dot',\r\n              //   'icon-ignore-placement': true,\r\n              //   'icon-allow-overlap': true\r\n              // },\r\n            })\r\n          }\r\n          this.$store.commit('SHOW_MAPRESERVOIR', false)\r\n        } else if (['LineString', 'MultiLineString'].includes(type)) {\r\n          let color = '#91510A'\r\n          if (layerID == 'rd_map_drainpipe_ys_small') {\r\n            color = '#399AEA'\r\n          } else if (layerID == 'rd_map_drainpipe_ws_small') {\r\n            color = '#91510A'\r\n          } else {\r\n            defaltLegendList.forEach((legend) => {\r\n              if (legend.id == layerID) {\r\n                color = legend.clickColor\r\n              }\r\n            })\r\n          }\r\n          // 线\r\n          window.xaMap.addLayer({\r\n            id: `hightlightLine`,\r\n            type: 'line',\r\n            source: {\r\n              type: 'geojson',\r\n              data: sourceData,\r\n            },\r\n            paint: {\r\n              'line-color': color,\r\n              'line-width': 8,\r\n            },\r\n            // layout: {\r\n            //   'icon-image': 'uncured-pulsing-dot',\r\n            //   'icon-ignore-placement': true,\r\n            //   'icon-allow-overlap': true\r\n            // },\r\n          })\r\n          // window.xaMap.fitBounds(bound, {maxZoom: 15, padding: {right: 400}});\r\n        } else if (['Polygon', 'MultiPolygon'].includes(type)) {\r\n          // 面\r\n          window.xaMap.addLayer({\r\n            id: `hightlightPolygon`,\r\n            type: 'fill',\r\n            source: {\r\n              type: 'geojson',\r\n              data: sourceData,\r\n            },\r\n            paint: {\r\n              'fill-color': 'rgba(255, 0, 0, 0.6)',\r\n            },\r\n            // layout: {\r\n            //   'icon-image': 'uncured-pulsing-dot',\r\n            //   'icon-ignore-placement': true,\r\n            //   'icon-allow-overlap': true\r\n            // },\r\n          })\r\n          // window.xaMap.fitBounds(bound, {maxZoom: 15, padding: {right: 400}});\r\n        }\r\n      })\r\n    },\r\n    removeAllHighlightLayer(e) {\r\n      this.removeLayerSource('hightlightPoint')\r\n      this.removeLayerSource('hightlightLine')\r\n      this.removeLayerSource('hightlightPolygon')\r\n    },\r\n    /**\r\n     * 清空临时的图层和源\r\n     */\r\n    removeLayerSource(name) {\r\n      if (window.xaMap.getLayer(`${name}`)) window.xaMap.removeLayer(`${name}`)\r\n      if (window.xaMap.getSource(`${name}`))\r\n        window.xaMap.removeSource(`${name}`)\r\n    },\r\n    // 压力监测详情面板PressureMonitor.vue关闭按钮回调\r\n    closePopup_pressure() {\r\n      // 压力监测详情面板\r\n      this.pressureMonitorShow = false\r\n    },\r\n    //关闭管线弹窗\r\n    closePopup_line() {\r\n      this.pipelineShow = false\r\n      this.equipmentShow = false\r\n    },\r\n  },\r\n  mounted () {\r\n    this.showSearchBar()\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n/deep/ .mapboxgl-popup {\r\n}\r\n/deep/ .mapboxgl-popup-content {\r\n}\r\n.main {\r\n  width: 100%;\r\n  height: calc(100% - 98px - env(safe-area-inset-bottom));\r\n  height: calc(100% - 98px - constant(safe-area-inset-bottom));\r\n  position: relative;\r\n  /deep/ .fm-hairline--bottom::after{\r\n    display: none;\r\n  }\r\n  .xa-map-one-map {\r\n    height: calc(100% - 98px - env(safe-area-inset-bottom));\r\n    height: calc(100% - 98px - constant(safe-area-inset-bottom));\r\n  }\r\n  .top {\r\n    width: 100%;\r\n    height: 70px;\r\n    padding: 12px 0;\r\n    position: relative;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    .top-title {\r\n      width: 400px;\r\n      height: 64px;\r\n      background: #f5f5f5;\r\n      border-radius: 36px;\r\n      display: flex;\r\n      align-items: center;\r\n      padding: 4px;\r\n      span {\r\n        width: 50%;\r\n        height: 100%;\r\n        font-size: 28px;\r\n        font-family: PingFangSC-Regular, PingFang SC;\r\n        font-weight: 400;\r\n        color: #555555;\r\n        line-height: 40px;\r\n        border-radius: 36px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n      }\r\n      .active {\r\n        background: #1b67d8;\r\n        box-shadow: 0px 8px 16px 0px rgba(104, 115, 127, 0.06);\r\n        font-weight: 500;\r\n        color: #FFFFFF;        \r\n      }\r\n    }\r\n  }\r\n}\r\n// /deep/.fm-search {\r\n  // position: absolute;\r\n  // width: 100%;\r\n  // // top: 1.60rem;\r\n  // padding: 0 36px;\r\n  // background-color: transparent;\r\n// }\r\n/deep/.fm-search__content {\r\n  background-color: #ffffff;\r\n  box-shadow: 0px 8px 20px 0px rgba(104, 115, 127, 0.2);\r\n  border-radius: 16px;\r\n  height: 80px;\r\n}\r\n/deep/.fm-search-class {\r\n  // background-color: #ffffff;\r\n  // box-shadow: 0px 8px 20px 0px rgba(104, 115, 127, 0.2);\r\n  // border-radius: 16px;\r\n  // height: 80px;\r\n  position: absolute;\r\n  width: 100%;\r\n  // top: 1.60rem;\r\n  padding: 0 36px;\r\n  background-color: transparent;\r\n}\r\n</style>"]}]}