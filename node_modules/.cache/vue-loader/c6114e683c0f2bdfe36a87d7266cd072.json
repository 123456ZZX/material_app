{"remainingRequest":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\ProblemReport\\addProblemIndex.vue?vue&type=style&index=0&id=f37168e4&lang=less&scoped=true","dependencies":[{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\src\\views\\ProblemReport\\addProblemIndex.vue","mtime":1713146885264},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Code\\Project\\WL\\xasw-mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQovL+makOiXj+a7muWKqOadoQ0KJjo6LXdlYmtpdC1zY3JvbGxiYXIgew0KICBkaXNwbGF5OiBub25lOyAvL0Nocm9tZSB8IFNhZmFyaQ0KfQ0KDQovLyBAaW1wb3J0ICcvZmtzLW1vYmlsZS1saWIvc3JjL2Fzc2V0cy9mbS1pY29uL2ZtLWljb24uY3NzJzsNCi5tYWluIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2YyZjNmNCAhaW1wb3J0YW50Ow0KICBoZWlnaHQ6IDEwMCU7DQp9DQoNCi5tYWluLWNvbnRhaW5lciB7DQogIGhlaWdodDogY2FsYygxMDAlIC0gMjYwcHgpOw0KICBvdmVyZmxvdzogYXV0bzsNCn0NCg0KLmJvdHRvbSB7DQogIHBvc2l0aW9uOiBmaXhlZDsNCiAgYm90dG9tOiAwcHg7DQogIGxlZnQ6IDBweDsNCiAgd2lkdGg6IDEwMCU7DQogIGhlaWdodDogMTM2cHg7DQogIGJhY2tncm91bmQ6ICNmZmZmZmY7DQoNCiAgLmJvdHRvbS1kaXYgew0KICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIHdpZHRoOiAzNzBweDsNCiAgICBmbG9hdDogbGVmdDsNCiAgICBoZWlnaHQ6IDg4cHg7DQogICAgbGluZS1oZWlnaHQ6IDg4cHg7DQogICAgZm9udC1zaXplOiAzMnB4Ow0KICAgIGZvbnQtZmFtaWx5OiBQaW5nRmFuZ1NDLVJlZ3VsYXIsIFBpbmdGYW5nIFNDOw0KICAgIGZvbnQtd2VpZ2h0OiA0MDA7DQoNCiAgICAuY2FuY2VsIHsNCiAgICAgIHdpZHRoOiA5MCU7DQogICAgICBib3JkZXItcmFkaXVzOiA0NHB4Ow0KICAgICAgYm9yZGVyOiAxcHggc29saWQgIzFiNjdkODsNCiAgICAgIGNvbG9yOiAjMWI2N2Q4Ow0KICAgIH0NCg0KICAgIC5zdWJtaXQgew0KICAgICAgd2lkdGg6IDkwJTsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDQ0cHg7DQogICAgICBjb2xvcjogI2ZmZmZmZjsNCiAgICAgIGJhY2tncm91bmQ6ICMxYjY3ZDg7DQogICAgfQ0KICB9DQp9DQoNCi9kZWVwLy5mbS1maWVsZF9fY29udHJvbCB7DQogIHRleHQtYWxpZ246IHJpZ2h0ICFpbXBvcnRhbnQ7DQp9DQoNCi9kZWVwLy5mbS1maWVsbGRfZXJyb3ItbWVzc2FnZSB7DQogIHRleHQtYWxpZ246IHJpZ2h0ICFpbXBvcnRhbnQ7DQp9DQo="},{"version":3,"sources":["addProblemIndex.vue"],"names":[],"mappings":";AA0rBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"addProblemIndex.vue","sourceRoot":"src/views/ProblemReport","sourcesContent":["<template>\r\n  <div class=\"main\">\r\n    <fm-nav-bar title=\"问题上报\" left-arrow @click-left=\"$router.go(-1)\"></fm-nav-bar>\r\n    <div class=\"main-container\">\r\n      <fm-form @submit=\"onFormSubmit\" @failed=\"onFailed\">\r\n        <fm-field\r\n          ref=\"formData\"\r\n          readonly\r\n          clickable\r\n          name=\"picker\"\r\n          suffix-icon=\"arrow\"\r\n          required\r\n          :rules=\"[{ required: true, message: '请选择问题来源' }]\"\r\n          :value=\"defectFrom\"\r\n          label=\"问题来源\"\r\n          placeholder=\"点击选择\"\r\n          input-align=\"right\"\r\n          @click=\"sourceShowPicker = true\"\r\n        />\r\n        <fm-popup :visible.sync=\"sourceShowPicker\" position=\"bottom\">\r\n          <fm-picker\r\n            show-toolbar\r\n            :columns=\"sourceColumns\"\r\n            @confirm=\"sourceOnConfirm\"\r\n            @cancel=\"sourceShowPicker = false\"\r\n          />\r\n        </fm-popup>\r\n        <fm-field\r\n          name=\"radio\"\r\n          required\r\n          input-align=\"right\"\r\n          :rules=\"[{ required: true, message: '请选择紧急程度' }]\"\r\n          label=\"紧急程度\"\r\n        >\r\n          <template #input>\r\n            <fm-radio-group v-model=\"priority\" direction=\"horizontal\">\r\n              <fm-radio name=\"0\" @click=\"selectPriority('0')\">紧急</fm-radio>\r\n              <fm-radio name=\"1\" @click=\"selectPriority('1')\">高</fm-radio>\r\n              <fm-radio name=\"2\" @click=\"selectPriority('2')\">中</fm-radio>\r\n              <fm-radio name=\"3\" @click=\"selectPriority('3')\">低</fm-radio>\r\n            </fm-radio-group>\r\n          </template>\r\n        </fm-field>\r\n        <fm-field v-model=\"formData.position\" name=\"问题位置\" label=\"问题位置\" placeholder=\"回填\" />\r\n\r\n        <fm-field\r\n          v-model=\"formData.bigType\"\r\n          name=\"业务类型\"\r\n          readonly\r\n          clickable\r\n          label=\"业务类型\"\r\n          placeholder=\"回填\"\r\n          suffix-icon=\"arrow\"\r\n          @click=\"showPickerBt = true\"\r\n        />\r\n        <fm-popup :visible.sync=\"showPickerBt\" position=\"bottom\">\r\n          <fm-picker\r\n            show-toolbar\r\n            :columns=\"bigTypeList\"\r\n            @confirm=\"onConfirmBigType\"\r\n            @cancel=\"showPickerBt = false\"\r\n          />\r\n        </fm-popup>\r\n\r\n        <fm-field\r\n          v-model=\"formData.smallType\"\r\n          name=\"对象类型\"\r\n          readonly\r\n          clickable\r\n          label=\"对象类型\"\r\n          placeholder=\"回填\"\r\n          suffix-icon=\"arrow\"\r\n          @click=\"showPickerSt = true\"\r\n        />\r\n        <fm-popup :visible.sync=\"showPickerSt\" position=\"bottom\">\r\n          <fm-picker\r\n            show-toolbar\r\n            :columns=\"smallTypeList\"\r\n            @confirm=\"onConfirmSmallType\"\r\n            @cancel=\"showPickerSt = false\"\r\n          />\r\n        </fm-popup>\r\n\r\n        <fm-field v-model=\"formData.code\" name=\"设施编号\" label=\"设施编号\" placeholder=\"回填\" />\r\n        <fm-field\r\n          readonly\r\n          clickable\r\n          name=\"picker\"\r\n          :value=\"faultTypes\"\r\n          label=\"问题类型\"\r\n          required\r\n          placeholder=\"点击选择\"\r\n          suffix-icon=\"arrow\"\r\n          input-align=\"right\"\r\n          :rules=\"[{ required: true, message: '请选择问题类型' }]\"\r\n          @click=\"typeShowPicker = true\"\r\n        />\r\n        <fm-popup :visible.sync=\"typeShowPicker\" position=\"bottom\">\r\n          <fm-picker\r\n            show-toolbar\r\n            :columns=\"typeColumns\"\r\n            @confirm=\"typeOnConfirm\"\r\n            @cancel=\"typeShowPicker = false\"\r\n          />\r\n        </fm-popup>\r\n        <fm-field\r\n          v-if=\"type\"\r\n          readonly\r\n          clickable\r\n          name=\"picker\"\r\n          :value=\"faultDetail\"\r\n          label=\"故障明细\"\r\n          placeholder=\"点击选择\"\r\n          @click=\"fixShowPicker = true\"\r\n        />\r\n        <fm-popup :visible.sync=\"fixShowPicker\" position=\"bottom\">\r\n          <fm-picker\r\n            show-toolbar\r\n            :columns=\"fixColumns\"\r\n            @confirm=\"fixOnConfirm\"\r\n            @cancel=\"fixShowPicker = false\"\r\n          />\r\n        </fm-popup>\r\n        <fm-field\r\n          v-model=\"questionDescribe\"\r\n          rows=\"5\"\r\n          autosize\r\n          label=\"现场描述\"\r\n          type=\"textarea\"\r\n          maxlength=\"300\"\r\n          placeholder=\"请输入现场描述\"\r\n          show-word-limit\r\n        />\r\n        <uploader\r\n          :wpgHeader=\"wpgHeader\"\r\n          label=\"多媒体附件\"\r\n          v-model=\"attachment1\"\r\n          ref=\"files\"\r\n          @fileChange=\"(recall) => fileChange1(recall, '', files)\"\r\n          style=\"width: 100%\"\r\n        ></uploader>\r\n        <fm-field\r\n          name=\"radio\"\r\n          label=\"处理方式\"\r\n          required\r\n          :rules=\"[{ required: true, message: '请选择处理方式' }]\"\r\n          input-align=\"right\"\r\n        >\r\n          <template #input>\r\n            <fm-radio-group v-model=\"handleType\" direction=\"horizontal\">\r\n              <fm-radio name=\"上报负责人\" @click=\"select('上报负责人')\">上报负责人</fm-radio>\r\n              <fm-radio name=\"派维修工单\" @click=\"select('派维修工单')\">派维修工单</fm-radio>\r\n              <fm-radio name=\"上报客服中心\" @click=\"select('上报客服中心')\">上报客服中心</fm-radio>\r\n              <fm-radio name=\"直接处理\" @click=\"select('直接处理')\">直接处理</fm-radio>\r\n            </fm-radio-group>\r\n          </template>\r\n        </fm-field>\r\n        <fm-field\r\n          v-if=\"handle\"\r\n          v-model=\"handleRemark\"\r\n          rows=\"5\"\r\n          autosize\r\n          label=\"处理措施\"\r\n          type=\"textarea\"\r\n          maxlength=\"300\"\r\n          placeholder=\"请输入处理措施\"\r\n          show-word-limit\r\n        />\r\n\r\n        <uploader\r\n          v-if=\"handle\"\r\n          :wpgHeader=\"wpgHeader\"\r\n          label=\"处理后照片\"\r\n          v-model=\"attachment2\"\r\n          ref=\"handleImgs\"\r\n          @fileChange=\"(recall) => fileChange2(recall, '', handleImgs)\"\r\n          style=\"width: 100%\"\r\n        ></uploader>\r\n        <!-- :disabled=\"handleType == '上报负责人'\" -->\r\n        <selectUser\r\n          key=\"selectUser1\"\r\n          v-if=\"report\"\r\n          title=\"负责人\"\r\n          @change=\"getChange\"\r\n          :userName.sync=\"responPersonName\"\r\n          :userFullname.sync=\"responPersonFullName\"\r\n          :required=\"true\"\r\n          placeholder=\"请选择负责人\"\r\n        />\r\n        <selectUser\r\n          key=\"selectUser2\"\r\n          v-if=\"repair\"\r\n          title=\"维修负责人\"\r\n          @change=\"getChange\"\r\n          :userName.sync=\"responPersonName\"\r\n          :userFullname.sync=\"responPersonFullName\"\r\n          :required=\"true\"\r\n          placeholder=\"请选择维修负责人\"\r\n        />\r\n        <selectUser\r\n          key=\"selectUser3\"\r\n          v-if=\"serve\"\r\n          title=\"客服负责人\"\r\n          @change=\"getChange\"\r\n          :userName.sync=\"responPersonName\"\r\n          :userFullname.sync=\"responPersonFullName\"\r\n          :required=\"true\"\r\n          placeholder=\"请选择客服负责人\"\r\n        />\r\n\r\n        <fm-field v-model=\"creatorfullName\" name=\"上报人\" label=\"上报人\" placeholder=\"巡检信息回填\" />\r\n        <fm-field v-model=\"createDate\" name=\"上报时间\" label=\"上报时间\" placeholder=\"回填\" />\r\n      </fm-form>\r\n    </div>\r\n\r\n    <div class=\"bottom\">\r\n      <div class=\"bottom-div\">\r\n        <fm-button native-type=\"button\" class=\"cancel\" @click=\"concal\">取消</fm-button>\r\n      </div>\r\n      <div class=\"bottom-div\">\r\n        <fm-button class=\"submit\" @click=\"onFormSubmit\">提交</fm-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Uploader from './upload/Uploader'\r\nimport { ENUM } from '@/store/State/stateTypes'\r\nimport selectUser from '@/components/select-user/index.vue'\r\nimport axios from 'axios'\r\nimport {\r\n  Form,\r\n  Field,\r\n  NavBar,\r\n  Search,\r\n  Toast,\r\n  Cell,\r\n  CellGroup,\r\n  PullRefresh,\r\n  List,\r\n  Sidebar,\r\n  SidebarItem,\r\n  SwipeCell,\r\n  Button,\r\n  NoticeBar,\r\n  Icon,\r\n  Dialog,\r\n} from 'fawkes-mobile-lib'\r\n\r\nexport default {\r\n  name: 'Inspection',\r\n  components: {\r\n    Uploader,\r\n    selectUser,\r\n    [Form.name]: Form,\r\n    [Field.name]: Field,\r\n    [NavBar.name]: NavBar,\r\n    [Search.name]: Search,\r\n    [Toast.name]: Toast,\r\n    [Cell.name]: Cell,\r\n    [CellGroup.name]: CellGroup,\r\n    [PullRefresh.name]: PullRefresh,\r\n    [List.name]: List,\r\n    [Sidebar.name]: Sidebar,\r\n    [SidebarItem.name]: SidebarItem,\r\n    [SwipeCell.name]: SwipeCell,\r\n    [Button.name]: Button,\r\n    [NoticeBar.name]: NoticeBar,\r\n    [Icon.name]: Icon,\r\n    [Dialog.name]: Dialog,\r\n  },\r\n  data() {\r\n    return {\r\n      creatorFullName: this.$store.state.userInfo.userFullname,\r\n      responPersonName: '',\r\n      responPersonFullName: '',\r\n      attachment1: '',\r\n      attachment2: '',\r\n      files: [],\r\n      handleImgs: [],\r\n      handleRemark: '',\r\n      wpgHeader: {}, //上传相关\r\n      handleType: '',\r\n      questionDescribe: '',\r\n      defectFrom: '',\r\n      priority: '',\r\n      faultTypes: '',\r\n      creatorName: '',\r\n      creatorfullName: '',\r\n      createDate: '',\r\n      faultDetail: '',\r\n      header: {},\r\n      token: '',\r\n      formData: {},\r\n      upTime: '',\r\n      upPerson: '',\r\n      report: false,\r\n      repair: false,\r\n      serve: false,\r\n      handle: false,\r\n      type: false,\r\n      uploader: [{ url: '/static/img/leaf.jpg' }],\r\n      radio: '1',\r\n      fixShowPicker: false,\r\n      typeShowPicker: false,\r\n      sourceShowPicker: false,\r\n      sourceColumns: ['巡检', '客服投诉', '养护', '监护', '填报'],\r\n      // typeColumns: [\r\n      //   '违规排放',\r\n      //   '管道周边施工监管',\r\n      //   '管道破坏',\r\n      //   '安全隐患',\r\n      //   '设施故障',\r\n      //   '漏水爆管',\r\n      //   '其他',\r\n      // ],\r\n      name: '',\r\n      userType: '',\r\n      userName: '',\r\n      fixColumns: [\r\n        '水管鸣叫',\r\n        '阀门破损',\r\n        '水表丢失',\r\n        '水表错位',\r\n        '水表倒装',\r\n        '水管滴漏',\r\n      ],\r\n      bigTypeList: [],\r\n      flawsManage: [], //业务对象事件类型\r\n      showPickerBt: false, //业务类型选项\r\n      showPickerSt: false, //设施类型选项\r\n    }\r\n  },\r\n  computed: {\r\n    smallTypeList() {\r\n      let list = []\r\n      if (this.flawsManage) {\r\n        console.log(\r\n          '业务-对象',\r\n          this.flawsManage.find((it) => it.code == this.formData.bigType)?.child\r\n        )\r\n        this.flawsManage\r\n          .find((it) => it.code == this.formData.bigType)\r\n          ?.child.forEach((it) => {\r\n            list.push(it['zh-CN'])\r\n          })\r\n        return list\r\n      } else {\r\n        return []\r\n      }\r\n    },\r\n    typeColumns() {\r\n      let list = []\r\n      this.$store.state[ENUM].faultTypes.forEach((it) => {\r\n        list.push(it['zh-CN'])\r\n      })\r\n      return list\r\n    },\r\n    handleTypeDic() {\r\n      return this.$store.state[ENUM].handleType\r\n    },\r\n    handleTypeDicListDic() {\r\n      let listDic = {}\r\n      if (this.handleTypeDic) {\r\n        this.handleTypeDic.forEach((dic) => {\r\n          listDic[dic['zh-CN']] = dic.code\r\n        })\r\n      }\r\n      return listDic\r\n    },\r\n    defectFromDic() {\r\n      return this.$store.state[ENUM].defectFrom\r\n    },\r\n    defectFromListDic() {\r\n      let listDic = {}\r\n      if (this.defectFromDic) {\r\n        this.defectFromDic.forEach((dic) => {\r\n          listDic[dic['zh-CN']] = dic.code\r\n        })\r\n      }\r\n      return listDic\r\n    },\r\n    // 系统字典虽叫defectType，但实际二级为 业务类型/设施类型\r\n    // 业务类型/设施类型\r\n    busDeviceTypeDic() {\r\n      console.log(\r\n        'this.$store.state[ENUM].defectType: ',\r\n        this.$store.state[ENUM].defectType\r\n      )\r\n      return this.$store.state[ENUM].defectType\r\n    },\r\n    // bigTypeList() {\r\n    //   let list = []\r\n    //   if (this.busDeviceTypeDic) {\r\n    //     this.busDeviceTypeDic.forEach((dic) => {\r\n    //       list.push(dic['zh-CN'])\r\n    //     })\r\n    //   }\r\n    //   return list\r\n    // },\r\n    bigTypeListDic() {\r\n      let listDic = {}\r\n      if (this.busDeviceTypeDic) {\r\n        this.busDeviceTypeDic.forEach((dic) => {\r\n          listDic[dic['zh-CN']] = dic.code\r\n        })\r\n      }\r\n      return listDic\r\n    },\r\n    faultDetailDic() {\r\n      return this.$store.state[ENUM].faultDetail\r\n    },\r\n    faultDetailDicListDic() {\r\n      let listDic = {}\r\n      if (this.faultDetailDic) {\r\n        this.faultDetailDic.forEach((dic) => {\r\n          listDic[dic['zh-CN']] = dic.code\r\n        })\r\n      }\r\n      return listDic\r\n    },\r\n  },\r\n  created() {\r\n    this.formData = this.$route.query.msg\r\n    if (this.$route.query.from == 'insp') {\r\n      this.defectFrom = '巡检'\r\n    } else if (this.$route.query.from == 'mainten') {\r\n      this.defectFrom = '养护'\r\n    }\r\n    this.token = this.$route.query.token\r\n    this.formData.position =\r\n      this.formData.road_name ||\r\n      [this.formData.lng, this.formData.lat].toString()\r\n    this.wpgHeader = {\r\n      'Content-Type': 'application/json',\r\n      Authorization: 'Bearer ' + this.token,\r\n    }\r\n  },\r\n  mounted() {\r\n    this.flawsManage = this.$store.state[ENUM].flawsManage //业务对象事件类型\r\n    console.log('this.flawsManage: ', this.flawsManage)\r\n    this.flawsManage.forEach((it) => {\r\n      this.bigTypeList.push(it['zh-CN'])\r\n    })\r\n\r\n    let time = new Date()\r\n    this.createDate = time.toLocaleString()\r\n    console.log('this.$store.state.userInfo: ', this.$store.state.userInfo)\r\n    this.creatorName =\r\n      this.$store.state.userInfo.userName ||\r\n      localStorage.getItem('cs_userFullname')\r\n    this.creatorfullName = this.$store.state.userInfo.userFullname || '' // localStorage.getItem('cs_userfullname')\r\n  },\r\n  methods: {\r\n    onConfirmBigType(val) {\r\n      this.formData.bigType = val\r\n      this.showPickerBt = false\r\n    },\r\n    onConfirmSmallType(val) {\r\n      this.formData.smallType = val\r\n      this.showPickerSt = false\r\n    },\r\n    concal() {\r\n      this.$router.go(-1)\r\n    },\r\n    // 处理后照片\r\n    fileChange2(recall, mark, rowItem) {\r\n      if (recall.res) {\r\n        let formFile2 = {\r\n          fileUrl: recall.res.resultData.url,\r\n          fileType: recall.res.resultData.suffix,\r\n          fileSize: recall.res.resultData.size,\r\n          fileId: recall.res.resultData.id,\r\n          name: recall.res.resultData.oldName,\r\n          url:\r\n            process.env.VUE_APP_THIRD_REQUEST_URL +\r\n            '/main/userCenterApi/FileManager/download/' +\r\n            recall.res.resultData.id,\r\n          uid: recall.res.resultData.id,\r\n        }\r\n        this.handleImgs.push(formFile2)\r\n      }\r\n    },\r\n    fileChange1(recall, mark, rowItem) {\r\n      if (recall.res) {\r\n        let formFile1 = {\r\n          fileUrl: recall.res.resultData.url,\r\n          fileType: recall.res.resultData.suffix,\r\n          fileSize: recall.res.resultData.size,\r\n          fileId: recall.res.resultData.id,\r\n          name: recall.res.resultData.oldName,\r\n          url:\r\n            process.env.VUE_APP_THIRD_REQUEST_URL +\r\n            '/main/userCenterApi/FileManager/download/' +\r\n            recall.res.resultData.id,\r\n          uid: recall.res.resultData.id,\r\n        }\r\n        this.files.push(formFile1)\r\n      }\r\n    },\r\n    selectPriority(val) {\r\n      this.priority = val\r\n    },\r\n    getChange(val) {\r\n      console.log(this.responPersonName);\r\n      console.log(this.responPersonFullName);\r\n      console.log(val);\r\n      // this.name = val[0]?.userFullname || ''\r\n      // this.userName = val[0]?.userName || ''\r\n      // this.userType = val[0]?.userType || ''\r\n    },\r\n    //提交前 校验未通过\r\n    onFailed() {\r\n      if (\r\n        this.defectFrom == '' ||\r\n        this.priority == '' ||\r\n        this.faultTypes == '' ||\r\n        this.handleType == '' ||\r\n        this.responPersonFullName == ''\r\n      ) {\r\n        Toast({\r\n          message: '请检查必填信息',\r\n          position: 'top',\r\n        })\r\n        return\r\n      }\r\n    },\r\n    // 提交\r\n    onFormSubmit() {\r\n      console.log('this.formData', this.formData)\r\n      console.log('responPersonName: ', this.responPersonName)\r\n      console.log('responPersonFullName: ', this.responPersonFullName)\r\n      Toast({\r\n        message: '提交中',\r\n        position: 'top',\r\n      })\r\n      if (\r\n        this.defectFrom != '' &&\r\n        this.priority !== '' &&\r\n        this.faultTypes != '' &&\r\n        this.handleType != '' &&\r\n        (this.handleType == '直接处理' || this.responPersonFullName != '')\r\n      ) {\r\n        // 提交按钮\r\n        let params = {\r\n          templateCode: 'abnormal_inform_template',\r\n          title: '问题新增',\r\n          sysSource: 'outwork',\r\n          createType: 'APP',\r\n          latitude: this.formData.lat,\r\n          longitude: this.formData.lng,\r\n          questionDescribe: this.questionDescribe, //现场描述\r\n          address: this.formData.road_name || this.formData.position, //问题位置\r\n          priority: this.priority, //紧急程度（优先级）\r\n          formJson: {\r\n            files: this.files, //多媒体\r\n            gridId: this.formData.gridId,\r\n            gridName: this.formData.gridName,\r\n            deviceId: this.formData.id,\r\n            // task_id: this.formData.taskId, //巡检任务ID\r\n            task_id: this.$route.query.taskId, //巡检任务ID\r\n            handleImgs: this.handleImgs, //处理后照片\r\n            handleRemark: this.handleRemark, //处理措施\r\n            deviceType: [\r\n              this.formData.bigType || '',\r\n              this.formData.smallType || '',\r\n            ], //对象类型\r\n            deviceCode: this.formData.code, //设施编号\r\n            handleType: this.handleTypeDicListDic[this.handleType], //处理方式\r\n            defectFrom: this.defectFromListDic[this.defectFrom], //问题来源\r\n            priority: this.priority, //紧急程度\r\n            faultTypes: this.faultTypes, //问题类型\r\n            ticketDispatchUserIds: [\r\n              {\r\n                name: this.responPersonFullName, //处理人名称\r\n                id: this.responPersonName, //处理人ID\r\n                type: '99',\r\n              },\r\n            ], //负责人\r\n            creatorName: this.creatorName, //上报人\r\n            createDate: this.createDate, //上报时间\r\n            faultDetail: this.faultDetailDicListDic[this.faultDetail], //故障明细\r\n          },\r\n        }\r\n        // console.log(JSON.parse(JSON.stringify(params.longitude)), JSON.parse(JSON.stringify(params.latitude)))\r\n        if (Array.isArray(params.longitude) || Array.isArray(params.latitude)) {\r\n          params.longitude = params.longitude[0] // 经度\r\n          params.latitude = params.latitude[1] // 纬度\r\n        }\r\n        console.log('params: ', JSON.parse(JSON.stringify(params)))\r\n        this.createTicket(params)\r\n      } else {\r\n        Toast({\r\n          message: '请检查必填信息',\r\n          position: 'top',\r\n        })\r\n      }\r\n    },\r\n    createTicket(params) {\r\n      axios({\r\n        url:\r\n          process.env.VUE_APP_THIRD_REQUEST_URL +\r\n          '/main/outworkapi/ticketClient/create',\r\n          // url: 'https://xionganwater.cn/main/outworkapi/ticketClient/create',\r\n        method: 'post',\r\n        data: params,\r\n        headers: this.wpgHeader,\r\n      }).then((res) => {\r\n        console.log('res: ', res)\r\n        if (res.status == 200 && res.data.success) {\r\n          Toast.success({\r\n            message: '提交成功',\r\n            duration: 1000,\r\n            onClose: () => {\r\n              this.formData = {}\r\n              this.$router.go(-1)\r\n            },\r\n          })\r\n        } else {\r\n          Toast.error('提交失败, 请稍后再试')\r\n        }\r\n      })\r\n    },\r\n    select(val) {\r\n      console.log('val: ', val)\r\n      this.handle = true\r\n      this.report = false\r\n      this.repair = false\r\n      this.serve = false\r\n      this.name = ''\r\n      this.responPersonFullName = ''\r\n      this.userName = ''\r\n      this.responPersonName = ''\r\n      // 处理后照片置空，只有处理方式为 \"直接处理\" 时才有处理后照片\r\n      this.attachment2 = ''\r\n      this.handleImgs = []\r\n      // 处理措施置空，只有处理方式为 \"直接处理\" 时才有处理措施\r\n      this.handleRemark = ''\r\n\r\n      if (val == '直接处理') {\r\n        this.handle = true\r\n      } else {\r\n        this.handle = false\r\n      }\r\n      if (val == '派维修工单') {\r\n        this.handle = false\r\n        this.repair = true\r\n      } else {\r\n        this.repair = false\r\n      }\r\n      if (val == '上报客服中心') {\r\n        this.handle = false\r\n        this.serve = true\r\n      } else {\r\n        this.serve = false\r\n      }\r\n      if (val == '上报负责人') {\r\n        this.handle = false\r\n        // this.report = true // 负责人选择（隐藏）\r\n        console.log(' this.$route.query.msg: ', this.$route.query.msg)\r\n        this.name = this.$route.query.msg.gridManager?.fullName || ''\r\n        this.responPersonFullName = this.$route.query.msg.gridManager?.fullName || ''\r\n        this.userName = this.$route.query.msg.gridManager?.username || ''\r\n        this.responPersonName = this.$route.query.msg.gridManager?.username || ''\r\n        console.log(\r\n          'allName:',\r\n          this.name,\r\n          this.responPersonFullName,\r\n          this.userName,\r\n          this.responPersonName\r\n        )\r\n      } else {\r\n        this.report = false\r\n      }\r\n    },\r\n    typeOnConfirm(value) {\r\n      this.faultTypes = value\r\n      this.typeShowPicker = false\r\n      if (this.faultTypes == '设备故障') {\r\n        this.type = true\r\n      } else {\r\n        this.type = false\r\n      }\r\n    },\r\n    fixOnConfirm(value) {\r\n      this.faultDetail = value\r\n      this.fixShowPicker = false\r\n    },\r\n    sourceOnConfirm(value) {\r\n      this.defectFrom = value\r\n      this.sourceShowPicker = false\r\n    },\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n//隐藏滚动条\r\n&::-webkit-scrollbar {\r\n  display: none; //Chrome | Safari\r\n}\r\n\r\n// @import '/fks-mobile-lib/src/assets/fm-icon/fm-icon.css';\r\n.main {\r\n  background-color: #f2f3f4 !important;\r\n  height: 100%;\r\n}\r\n\r\n.main-container {\r\n  height: calc(100% - 260px);\r\n  overflow: auto;\r\n}\r\n\r\n.bottom {\r\n  position: fixed;\r\n  bottom: 0px;\r\n  left: 0px;\r\n  width: 100%;\r\n  height: 136px;\r\n  background: #ffffff;\r\n\r\n  .bottom-div {\r\n    margin-top: 20px;\r\n    text-align: center;\r\n    width: 370px;\r\n    float: left;\r\n    height: 88px;\r\n    line-height: 88px;\r\n    font-size: 32px;\r\n    font-family: PingFangSC-Regular, PingFang SC;\r\n    font-weight: 400;\r\n\r\n    .cancel {\r\n      width: 90%;\r\n      border-radius: 44px;\r\n      border: 1px solid #1b67d8;\r\n      color: #1b67d8;\r\n    }\r\n\r\n    .submit {\r\n      width: 90%;\r\n      border-radius: 44px;\r\n      color: #ffffff;\r\n      background: #1b67d8;\r\n    }\r\n  }\r\n}\r\n\r\n/deep/.fm-field__control {\r\n  text-align: right !important;\r\n}\r\n\r\n/deep/.fm-fielld_error-message {\r\n  text-align: right !important;\r\n}\r\n</style>\r\n"]}]}